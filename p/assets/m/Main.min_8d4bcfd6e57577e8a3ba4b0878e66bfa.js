!function(t){class e{constructor(t){this._css=t}css(){return this._css}$(t){return!t&&this._cache||(this._cache=$(this._css))}join(t,o){return new e(this._css+o+t._css)}or(t){return this.join(t,", ")}and(t){return this.join(t,"")}anscestorOf(t){return this.join(t," ")}parentOf(t){return this.join(t,">")}followedBy(t){return this.join(t,"~")}immediatelyFollowedBy(t){return this.join(t,"+")}exists(t){return this.$(t).length>0}addClass(t){return this.$().addClass(t.name()),this}removeClass(t){return this.$().removeClass(t.name()),this}toggleClass(t,e){return this.$().toggleClass(t.name(),e),this}hasClass(t){return this.$().hasClass(t.name())}addAttr(t){return this.$().attr(t,t),this}toggleAttr(t,e){return e?this.$().attr(t,t):this.$().removeAttr(t),this}removeAttr(t){return this.$().removeAttr(t),this}}class o extends e{tag(){return this.css()}constructor(t){super(t)}}class i extends e{constructor(t){super("."+t),this._name=t}name(){return this._name}elements(){return document.querySelectorAll(this.css())}}class s extends e{constructor(t){super("#"+t),this._name=t}name(){return this._name}el(){return document.getElementById(this._name)}}class r{constructor(t){this.key=t,this.caseSensitive=!0}caseInsensitive(){return this.caseSensitive=!1,this}exists(){return new e("["+this.key+"]")}build(t,o){return new e("["+this.key+t+'"'+o+'"'+(this.caseSensitive?"":" i")+"]")}equals(t){return this.build("=",t)}containsWhitespaceSeparatedToken(t){return this.build("~=",t)}equalsOrPlusDashStartsWith(t){return this.build("|=",t)}startsWith(t){return this.build("^=",t)}endsWidth(t){return this.build("$=",t)}contains(t){return this.build("*=",t)}}var n,a,l,c,p,u,h,d,g,m,f,S,w,C,y,b,v,A,k,M,x,T,_,D,P,R,E,F,I,B,O,L,z,U,G,N,H,V,W,Y,X,q,J,Q,j,Z,K,tt,et,ot,it,st,rt,nt,at,lt,ct,pt,ut,ht,dt,gt,mt,ft,St,wt,Ct,yt,bt,vt,At,kt,Mt,xt,Tt;!function(t){function o(t){return new r(t)}t.empty=new e(""),t.html=new e("html"),t.body=new e("body"),t.htmlBody=new e("html, body"),t.$window=$(window),t.data=function(t){return o("data-"+t)},t.attr=o,t.id=function(t){return new s(t)},t.c=function(t){return new i(t)}}(D||(D={})),function(t){t.active=new i("active")}(n||(n={})),function(t){function e(t,e){return t[e]}t.get=e,t.getOrElse=function(t,o,i){var s=e(t,o);return void 0===s?i:s},t.set=function(t,e,o){return t[e]=o},t.cast=function(t){return t}}(a||(a={})),function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=[],i=new Uint8Array(256);for(var s=0;s<e.length;s++)o[s]=e.charAt(s),i[e.charCodeAt(s)]=s;function r(t,e){return i[0|t.charCodeAt(e)]}function n(t){return o[63&t]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63,t.decode=function(t){if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4. ");var e,o,i=t.length,s="="===t.charAt(i-2)?2:"="===t.charAt(i-1)?1:0,n=new Uint8Array(3*t.length/4-s),a=s>0?t.length-4:t.length,l=0;function c(t){n[l++]=255&t}for(e=0;e<a;e+=4)c((o=r(t,e)<<18|r(t,e+1)<<12|r(t,e+2)<<6|r(t,e+3))>>16),c(o>>8),c(o);return 2===s?c(o=r(t,e)<<2|r(t,e+1)>>4):1===s&&(c((o=r(t,e)<<10|r(t,e+1)<<4|r(t,e+2)>>2)>>8),c(o)),n},t.decodeString=function(t,e){try{return atob(t)}catch(t){}return e},t.encode=function(t,e){if(t instanceof Uint8Array){const r=(e=e||t.length)%3;var o,i="";const a=e-r;for(var s=0;s<a;s+=3)i+=n((o=(t[s]<<16)+(t[s+1]<<8)+t[s+2])>>18),i+=n(o>>12),i+=n(o>>6),i+=n(o);return 1==r?(i+=n((o=t[a])>>2),i+=n(o<<4),i+="=="):2==r&&(i+=n((o=(t[a]<<8)+t[a+1])>>10),i+=n(o>>4),i+=n(o<<2),i+="="),i.replace(/\!/,"!")}return btoa(a.cast(t))}}(l||(l={})),function(t){const e=[0];function o(t,e){return t.toFixed(e).replace(/\.?0+$/,"")}function i(t,e){"use strict";if(null==t)throw new TypeError("can't convert "+t+" to object");if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var o="",i=0;i<e;i++)o+=t;return o}function s(t,e){return(t%e+e)%e}function r(t,e){return(t%e-e)%e}function n(t){if(!t)return null;const e=t.match(/data:(.*?)(;base64)?,(.*)/);if(!e)return null;const o=e[1]||"text/plain",i=!!e[2],s=decodeURIComponent(e[3].trim());if(i){const t=l.decode(s);let e=new Blob([t],{type:o});return e.size!=t.length&&(e=new Blob([t.buffer],{type:o})),e}return new Blob([s],{type:o})}function c(t,e,o){const i=t;return i.name=e,a.set(i,"lastModifiedDate",o||Date.now()),a.cast(i)}t.tic=function(){e.push(Date.now())},t.toc=function(t){Date.now(),e.pop()},t.toFixed=o,t.formatAspectRatio=function(t){return o(t.w,3)+":"+o(t.h,3)},t.hex=function(t,e){return("000000000"+t.toString(16)).substr(-e)},t.fuzzyAspectRatioEx=function(t,e){for(var o=t.w/t.h,i=0;i<e.length;i++){var s=e[i],r=s.w/s.h;if(Math.abs((o-r)/r)<.01)return s}return t.w>t.h?{w:t.w/t.h,h:1}:{w:1,h:t.h/t.w}},t.roundTo=function(t,e){return parseFloat(t.toFixed(e))},t.empty=function(){},t.sign=function(t){return 0==t?0:t>0?1:-1},t.clamp=function(t,e,o){return Math.max(e,Math.min(t,o))},t.log10=function(t){return Math.log(t)/Math.LN10},t.parseIntWithAlt=function(t,e,o){const i=parseInt(t,e);return isNaN(i)?o:i},t.padStart=function(t,e,o){return e>>=0,o=String(void 0!==o?o:" "),t.length>e?String(t):((e-=t.length)>o.length&&(o+=i(o,e/o.length)),o.slice(0,e)+String(t))},t.repeat=i,t.posMod=s,t.negMod=r,t.minMod=function(t,e){var o=s(t,e),i=r(t,e);return Math.abs(o)<=Math.abs(i)?o:i},t.startsWith=function(t,e){return 0==t.lastIndexOf(e,0)},t.endsWith=function(t,e){return t.indexOf(e,t.length-e.length)>=0},t.blobToArrayBuffer=function(t,e,o){var i=new FileReader;i.onerror=i.onabort=o,i.onloadend=function(t){e(a.cast(i.result))},i.readAsArrayBuffer(t)},t.blobToString=function(t,e,o){var i=new FileReader;i.onerror=i.onabort=o,i.onloadend=function(t){e(a.cast(i.result))},i.readAsText(t)},t.dataUrlToBlob=n,t.dataUrlToFile=function(t,e){return c(n(t),e)},t.blobToFile=c,t.svgStringToDataUrl=function(t){return"data:image/svg+xml;base64,"+btoa(t)},t.toDataUrl=function(t,e){return"data:"+e+";base64,"+l.encode(t)},t.min=function(t){return Math.min.apply(null,t)},t.max=function(t){return Math.max.apply(null,t)},t.minBy=function(t,e){if(0!=t.length){let o=0,i=t[0],s=e(i);for(let r=1;r<t.length;r++){let n=t[r],a=e(n);a<s&&(i=n,s=a,o=r)}return{min:i,value:s,index:o}}},t.maxBy=function(t,e){if(0!=t.length){let o=0,i=t[0],s=e(i);for(let r=1;r<t.length;r++){let n=t[r],a=e(n);a>s&&(i=n,s=a,o=r)}return{max:i,value:s,index:o}}},t.signedNumber=function(t){return 0==t?"0":t>0?"+"+t:""+t},t.splitExtensionFromFilename=function(t){let e=t.lastIndexOf(".");return e>=0?{base:t.substr(0,e),extension:t.substr(e+1)}:{base:t,extension:""}},t.dropExtension=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(0,e):t},t.getExtensionWithDot=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(e):""},t.getExtensionNoDot=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(e+1):""},t.parsePx=function(t){try{return parseInt(t)}catch(t){return 0}},t.colorBytesToRgbaCss=function(t){return"rgba("+t.join(",")+")"},t.colorBytesToAbgr32=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},t.colorBytesToRgba32=function(t){return t[0]<<24|t[1]<<16|t[2]<<8|t[3]},t.spliterate=function(t,e,o){for(var i,s=0;(i=t.indexOf(e,s))>=0;)o(t.substring(s,i)),s=i+e.length;s<t.length-1&&o(t.substring(s,t.length))},t.stringify=function(t){if(void 0===t)return"undefined";if(null==t)return"null";if(t.hasOwnProperty("message"))return t.message||"[No message]";if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t.toString()}},t.join16=function(t,e){return t.map(t=>(0|t).toString(16)).join(e)},t.uint8ArrayToString=function(t){for(var e="",o=0;o<t.byteLength;o++)e+=String.fromCharCode(t[o]);return e},t.randomInt=function(t){return Math.floor(Math.random()*t)},t.randomInt2=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t.centerElide=function(t,e){if(t&&t.length>=e){let o=Math.floor((e-4)/2);return t.substring(0,o)+"..."+t.substring(t.length-o)}return t},t.elide=function(t,e){return t&&t.length>=e?t.substring(0,e-3)+"...":t},t.sqr=function(t){return t*t},t.cube=function(t){return t*t*t},t.safeDiv=function(t,e,o=0){return 0==e?o:t/e},t.find=function(t,e){for(var o=0;o<t.length;o++)if(e(t[o]))return t[o];return null}}(P||(P={})),function(t){t.ajax=function(t){if("undefined"!=typeof csrfToken){"GET"!=(t.method||t.type||"GET").toUpperCase()&&(t.url=(e=t.url||"","undefined"==typeof csrfToken?e:e+(e.indexOf("?")<0?"?":"&")+csrfToken.name+"="+csrfToken.value))}var e;return $.ajax(t)}}(c||(c={})),function(t){const e=/(''|[^']|^){(\d+)}/g,o=/(''|[^']|^){(\d+),plural,\s*(one\s*{([^}]*)})?\s*(few\s*{([^}]*)})?\s*other\s*{([^}]*)}\s*}/g;let i;t.s=function(t,...i){if(0==t.length)return"";const s=t;for(var r=t.length,n=0;n<r&&s.charCodeAt(n)<=32;)n++;for(;n<r&&s.charCodeAt(r-1)<=32;)r--;const a=0==n?"":s.substring(0,n);t=0==n&&r==s.length?s:s.substring(n,r);const l=r==s.length?"":s.substring(r,s.length);var p=window.I18nPhrases[t];return void 0===p&&(!function(t,e){if(window.I18nPhrases[t]=t,!window.I18nPhrases.__translations_disabled__){const i={en:t,args:e};c.ajax({url:"/logMissingI18nPhrase",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(i)});const s=window.I18nPhrases||{};for(var o in s)s.hasOwnProperty(o)&&0}}(t,i),p=t),i.length>0&&(p=(p=p.replace(e,(function(t,e,o){return"''"==e&&(e="'"),e+i[parseInt(o,10)]}))).replace(o,(function(t,e,o,s,r,n,a,l){"''"==e&&(e="'");const c=i[parseInt(o,10)];return e+(function(t,e,o){switch(GlobalsShared.locale.split("-")[0]){case"zh":case"ja":case"ko":case"tr":case"th":case"id":return;case"ru":return t%10==1&&t%100!=11?e:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?o:void 0;case"po":return 1==t?e:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?o:void 0;case"fr":case"pt":return t>1?e:void 0;default:return 1==t?e:void 0}}(parseInt(c),r,a)||l)}))),a&&(p=a+p),l&&(p+=l),p},t.commaList=function(t){return t.join(", ")},function(t){t.format=function(t){return"$"+t.toFixed(2)}}(i||(i={}));class s{constructor(t){this.currency=t}format(t){return this.currency+t.toFixed(2)}}const r={};function n(t,e,o=GlobalsShared.locale){const n=o+"-"+t;return(r[n]||(r[n]=function(t,e){try{return new Intl.NumberFormat(e,{style:"currency",currency:t})}catch(e){return"USD"==t?i:new s(t)}}(t,o))).format(e/100)}let a;t.dollars=function(t,e=GlobalsShared.locale){return n("USD",t,e)},t.currencyAmount=n,function(t){t.format=function(t){return(100*t).toFixed(0)+"%"}}(a||(a={}));const l={};t.percent=function(t,e=GlobalsShared.locale){return(l[e]||(l[e]=function(t){try{return new Intl.NumberFormat(t,{style:"percent",minimumFractionDigits:0})}catch(t){return a}}(e))).format(t/100)}}(p||(p={}));class _t{constructor(t){this.data=new Uint8Array(t),this.offsetCount=0}length(){return this.data.length}hasMore(){return this.offsetCount<this.data.length}skip(t){this.offsetCount+=t}nonEmpty(){return this.data.length>0}readInt8(){return this.data[this.offsetCount++]}readInt8s(t){var e=this.data.slice(this.offsetCount,this.offsetCount+t);return this.offsetCount+=t,e}readInt16(){return 256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readInt24(){return 256*this.data[this.offsetCount++]*256+256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readInt32(){return 256*this.data[this.offsetCount++]*256*256+256*this.data[this.offsetCount++]*256+256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readSignedInt16(){var t=this.readInt16();return t>=32768&&(t-=65536),t}}!function(t){const e={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},o={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},i={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},s={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};const r={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function n(t,e,o){for(var i,s,n,a,l=new DataView(t),p={},u=e;u<e+o;)28===l.getUint8(u)&&2===l.getUint8(u+1)&&(a=l.getUint8(u+2))in r&&((n=l.getInt16(u+3))+5,s=r[a],i=c(l,u+5,n),p.hasOwnProperty(s)?p[s]instanceof Array?p[s].push(i):p[s]=[p[s],i]:p[s]=i),u++;return p}function a(t,e,o,i,s){var r,n,a=t.getUint16(o,!s),c={};for(n=0;n<a;n++)r=o+12*n+2,c[i[t.getUint16(r,!s)]]=l(t,r,e,o,s);return c}function l(t,e,o,i,s){var r,n,a,l,p,u,h=t.getUint16(e+2,!s),d=t.getUint32(e+4,!s),g=t.getUint32(e+8,!s)+o;switch(h){case 1:case 7:if(1==d)return t.getUint8(e+8);for(r=d>4?g:e+8,n=[],l=0;l<d;l++)n[l]=t.getUint8(r+l);return n;case 2:return c(t,r=d>4?g:e+8,d-1);case 3:if(1==d)return t.getUint16(e+8,!s);for(r=d>2?g:e+8,n=[],l=0;l<d;l++)n[l]=t.getUint16(r+2*l,!s);return n;case 4:if(1==d)return t.getUint32(e+8,!s);for(n=[],l=0;l<d;l++)n[l]=t.getUint32(g+4*l,!s);return n;case 5:if(1==d)return p=t.getUint32(g,!s),u=t.getUint32(g+4,!s),(a=new Number(p/u)).numerator=p,a.denominator=u,a;for(n=[],l=0;l<d;l++)p=t.getUint32(g+8*l,!s),u=t.getUint32(g+4+8*l,!s),n[l]=new Number(p/u),n[l].numerator=p,n[l].denominator=u;return n;case 9:if(1==d)return t.getInt32(e+8,!s);for(n=[],l=0;l<d;l++)n[l]=t.getInt32(g+4*l,!s);return n;case 10:if(1==d)return t.getInt32(g,!s)/t.getInt32(g+4,!s);for(n=[],l=0;l<d;l++)n[l]=t.getInt32(g+8*l,!s)/t.getInt32(g+4+8*l,!s);return n}}function c(t,e,o){for(var i="",s=e;s<e+o;s++)i+=String.fromCharCode(t.getUint8(s));return i}function p(t,r,n){if("Exif"!=c(t,r,4))return!1;var l,p,u,h,d,g=r+6;if(18761==t.getUint16(g))l=!1;else{if(19789!=t.getUint16(g))return!1;l=!0}if(42!=t.getUint16(g+2,!l))return!1;var m=t.getUint32(g+4,!l);if(m<8)return!1;if((p=a(t,g,g+m,o,l)).ExifIFDPointer)for(u in h=a(t,g,g+p.ExifIFDPointer,e,l)){switch(u){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":h[u]=s[u][h[u]];break;case"ExifVersion":case"FlashpixVersion":h[u]=String.fromCharCode(h[u][0],h[u][1],h[u][2],h[u][3]);break;case"ComponentsConfiguration":h[u]=s.Components[h[u][0]]+s.Components[h[u][1]]+s.Components[h[u][2]]+s.Components[h[u][3]]}p[u]=h[u]}if(p.GPSInfoIFDPointer)for(u in d=a(t,g,g+p.GPSInfoIFDPointer,i,l)){switch(u){case"GPSVersionID":d[u]=d[u][0]+"."+d[u][1]+"."+d[u][2]+"."+d[u][3]}p[u]=d[u]}return p}t.readFromBinaryFile=function(t){return{iptc:function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var o=2,i=t.byteLength,s=function(t,e){return 56===t.getUint8(e)&&66===t.getUint8(e+1)&&73===t.getUint8(e+2)&&77===t.getUint8(e+3)&&4===t.getUint8(e+4)&&4===t.getUint8(e+5)};o<i;){if(s(e,o)){var r=e.getUint8(o+7);return r%2!=0&&(r+=1),0===r&&(r=4),n(t,o+8+r,e.getUint16(o+6+r))}o++}}(t),exif:function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var o=2,i=t.byteLength;o<i;){if(255!=e.getUint8(o))return!1;if(225==e.getUint8(o+1))return p(e,o+4,e.getUint16(o+2)-2);o+=2+e.getUint16(o+2)}}(t)}}}(u||(u={})),function(t){t[t.Undefined=0]="Undefined",t[t.R0=1]="R0",t[t.R90=2]="R90",t[t.R180=3]="R180",t[t.R270=4]="R270"}(h||(h={})),function(t){t[t.Undefined=0]="Undefined",t[t.Uncalibrated=1]="Uncalibrated",t[t.sRgb=2]="sRgb",t[t.adobeRgb=3]="adobeRgb"}(d||(d={})),function(t){t[t.Success=0]="Success",t[t.ErrorFileReader=1]="ErrorFileReader",t[t.ErrorParse=2]="ErrorParse",t[t.ErrorException=3]="ErrorException"}(g||(g={})),function(t){t[t.Undefined=0]="Undefined",t[t.None=1]="None",t[t.Inch=2]="Inch",t[t.Centimeter=3]="Centimeter",t[t.Meter=4]="Meter"}(m||(m={}));class Dt{constructor(t,e,o,i,s,r,n,a){this.statusCode=t,this.width=e,this.height=o,this.orientation=i,this.resolutionUnits=s,this.resolutionX=r,this.resolutionY=n,this.colorSpace=a}}!function(t){const e=[137,80,78,71,13,10,26,10],o=new Number(0);function i(t){return new Dt(t,0,0,h.Undefined,m.Undefined,0,0,d.Undefined)}t.inverseOrientation=function(t){switch(t){default:case h.Undefined:return h.Undefined;case h.R0:return h.R0;case h.R90:return h.R270;case h.R180:return h.R180;case h.R270:return h.R90}},t.get=function(t,s){P.blobToArrayBuffer(t,(function(r){try{let n=new _t(r);switch(t.type){case"image/png":s(function(t){for(let o=0;o<e.length&&t.hasMore();o++)if(e[o]!=t.readInt8())return i(g.ErrorParse);let o=0,s=0,r=0,n=0,a=m.Undefined,l=d.Undefined,c=h.Undefined;for(;t.hasMore();){let e=t.readInt32(),i=P.uint8ArrayToString(t.readInt8s(4));if("pHYs"==i){o=t.readInt32(),s=t.readInt32();let e=t.readInt8();a=0==e?m.None:1==e?m.Meter:m.Undefined}else if("IHDR"==i){let o=t.offsetCount;r=t.readInt32(),n=t.readInt32(),t.offsetCount=o;t.readInt8s(e)}else if("iCCP"==i){let o=t.offsetCount,i="",s=t.readInt8(),r=0;for(;0!=s&&r<79;)i+=String.fromCharCode(s),s=t.readInt8(),r++;t.readInt8s(e-(t.offsetCount-o))}else{t.readInt8s(e)}t.readInt32()}return new Dt(g.Success,r,n,c,a,o,s,l)}(n));break;case"image/jpg":case"image/jpeg":s(function(t){let e=o,i=o,s=0,r=0,n=m.Undefined,l=d.Undefined,c=h.Undefined,p=u.readFromBinaryFile(t.data.buffer);if(p.exif){e=a.getOrElse(p.exif,"XResolution",o),i=a.getOrElse(p.exif,"YResolution",o),s=a.getOrElse(p.exif,"ImageWidth",0),r=a.getOrElse(p.exif,"ImageHeight",0);let t=a.getOrElse(p.exif,"ResolutionUnit",0);n=3==t?m.Centimeter:2==t?m.Inch:1==t?m.None:m.Undefined;let u=a.getOrElse(p.exif,"ColorSpace",0);l=65535==u?d.Uncalibrated:1==u?d.sRgb:d.Undefined;let g=a.getOrElse(p.exif,"Orientation",0);c=1==g?h.R0:3==g?h.R180:6==g?h.R90:8==g?h.R270:h.Undefined}return new Dt(g.Success,s,r,c,n,e,i,l)}(n));break;case"image/gif":default:s(i(g.ErrorParse))}}catch(t){s(i(g.ErrorException))}}),(function(t){s(i(g.ErrorFileReader))}))}}(f||(f={}));class Pt{constructor(t,e){this.x=t,this.y=e}static empty(){return new Pt(0,0)}static zero(){return new Pt(0,0)}static nan(){return new Pt(Number.NaN,Number.NaN)}static from(t){return new Pt(t.x,t.y)}toString(){return"("+this.x+", "+this.y+")"}inFinite(){return this.isFinite()}isFinite(){return isFinite(this.x)&&isFinite(this.y)}isNaN(){return isNaN(this.x)||isNaN(this.y)}interpolate(t,e){return new Pt(this.x*(1-e)+t.x*e,this.y*(1-e)+t.y*e)}setInterpolated(t,e,o){return this.setXy(t.x*(1-o)+e.x*o,t.y*(1-o)+e.y*o)}distanceSqrTo(t){let e=this.x-t.x,o=this.y-t.y;return e*e+o*o}distanceTo(t){return Math.sqrt(this.distanceSqrTo(t))}offset(t,e){return new Pt(this.x+t,this.y+e)}set(t){return this.x=t.x,this.y=t.y,this}setXy(t,e){return this.x=t,this.y=e,this}setNan(){return this.setXy(Number.NaN,Number.NaN)}round(){return new Pt(Math.round(this.x),Math.round(this.y))}floor(){return new Pt(Math.floor(this.x),Math.floor(this.y))}snap(t=.5,e=.5){return new Pt(Math.floor(this.x)+t,Math.floor(this.y)+e)}rotateInPlace(t,e){const o=Math.sin(t),i=Math.cos(t),s=this.x-e.x,r=this.y-e.y;return this.setXy(e.x+i*s-o*r,e.y+o*s+i*r),this}rotateInto(t,e,o,i,s){const r=this.x-o,n=this.y-i;s.setXy(o+t*r-e*n,i+e*r+t*n)}rotate(t,e){const o=Math.sin(t),i=Math.cos(t),s=this.x-e.x,r=this.y-e.y;return new Pt(e.x+i*s-o*r,e.y+o*s+i*r)}plusEquals(t){return this.x+=t.x,this.y+=t.y,this}plusEqualsXy(t,e){return this.x+=t,this.y+=e,this}plusEqualsScaled(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}equals(t){return t&&this.x==t.x&&this.y==t.y}notEquals(t){return!this.equals(t)}minusEquals(t){return this.x-=t.x,this.y-=t.y,this}minusXyEquals(t,e){return this.x-=t,this.y-=e,this}minus(t){return new Pt(this.x-t.x,this.y-t.y)}plus(t){return new Pt(this.x+t.x,this.y+t.y)}times(t){return new Pt(t*this.x,t*this.y)}timesEquals(t){return this.x*=t,this.y*=t,this}cross(t){return this.x*t.y-this.y*t.x}ortho(){return new Pt(this.y,-this.x)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}normalize(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}capLength(t){let e=this.length();return e>t&&this.timesEquals(t/e),this}dup(){return Pt.from(this)}}!function(t){t[t.TopLeft=0]="TopLeft",t[t.Top=1]="Top",t[t.TopRight=2]="TopRight",t[t.Right=3]="Right",t[t.BottomRight=4]="BottomRight",t[t.Bottom=5]="Bottom",t[t.BottomLeft=6]="BottomLeft",t[t.Left=7]="Left",t[t.Center=8]="Center"}(S||(S={})),function(t){t.opposite=function(e){switch(e){case t.TopLeft:return t.BottomRight;case t.Top:return t.Bottom;case t.TopRight:return t.BottomLeft;case t.Right:return t.Left;case t.BottomRight:return t.TopLeft;case t.Bottom:return t.Top;case t.BottomLeft:return t.TopRight;case t.Left:return t.Right;case t.Center:return t.Center}return t.Center},t.flipX=function(e){switch(e){case t.TopLeft:return t.TopRight;case t.Top:return t.Top;case t.TopRight:return t.TopLeft;case t.Right:return t.Left;case t.BottomRight:return t.BottomLeft;case t.Bottom:return t.Bottom;case t.BottomLeft:return t.BottomRight;case t.Left:return t.Right;case t.Center:return t.Center}return t.Center},t.flipY=function(e){switch(e){case t.TopLeft:return t.BottomLeft;case t.Top:return t.Bottom;case t.TopRight:return t.BottomRight;case t.Right:return t.Right;case t.BottomRight:return t.TopRight;case t.Bottom:return t.Top;case t.BottomLeft:return t.TopLeft;case t.Left:return t.Left;case t.Center:return t.Center}return t.Center},t.interpolationCoefficientsFor=function(e){switch(e){case t.TopLeft:return{tx:0,ty:0};case t.Top:return{tx:.5,ty:0};case t.TopRight:return{tx:1,ty:0};case t.Right:return{tx:1,ty:.5};case t.BottomRight:return{tx:1,ty:1};case t.Bottom:return{tx:.5,ty:1};case t.BottomLeft:return{tx:0,ty:1};case t.Left:return{tx:0,ty:.5};case t.Center:return{tx:.5,ty:.5}}return{tx:.5,ty:.5}}}(S||(S={}));class Rt{constructor(t,e,o,i){this.p0=t,this.p1=e,this.p2=o,this.p3=i,this.points=[],this.points.push(t,e,o,i)}static empty(){return new Rt(Pt.empty(),Pt.empty(),Pt.empty(),Pt.empty())}set(t){return this.p0.set(t.p0),this.p1.set(t.p1),this.p2.set(t.p2),this.p3.set(t.p3),this}dup(){return new Rt(this.p0.dup(),this.p1.dup(),this.p2.dup(),this.p3.dup())}contains(t,e){var o=!1;const i=this.points.length;for(var s=0;s<i;s++){var r=this.points[s],n=this.points[(s+1)%i];(n.y<e&&r.y>=e||r.y<e&&n.y>=e)&&n.x+(e-n.y)/(r.y-n.y)*(r.x-n.x)<t&&(o=!o)}return o}isConvex(){function t(t){return t<0?-1:t>0?1:0}var e=this.p1.minus(this.p0),o=this.p2.minus(this.p1),i=this.p3.minus(this.p2),s=this.p0.minus(this.p3),r=t(e.cross(o)),n=t(o.cross(i)),a=t(i.cross(s)),l=t(s.cross(e));return r==n&&r==a&&r==l}rotateInPlace(t,e){return this.p0.rotateInPlace(t,e),this.p1.rotateInPlace(t,e),this.p2.rotateInPlace(t,e),this.p3.rotateInPlace(t,e),this}rotate(t,e){return this.dup().rotateInPlace(t,e)}}class Et{constructor(t,e,o,i){this.left=t,this.top=e,this.right=o,this.bottom=i}static empty(){return new Et(0,0,0,0)}static unit(){return new Et(0,0,1,1)}static fromBoundingRect(t){return new Et(t[0],t[1],t[2],t[3])}static fromCropRect(t){return new Et(t.left0,t.top0,t.right0,t.bottom0)}static fromPoints(t){if(0==t.length)return null;for(var e=t[0],o=new Et(e.x,e.y,e.x,e.y),i=1;i<t.length;i++)o.addPoint(t[i]);return o}static fromQuad(t){return Et.fromPoints(t.points)}dup(){return new Et(this.left,this.top,this.right,this.bottom)}setNull(){return this.set(null,null,null,null)}setFrom(t){return this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom,this}set(t,e,o,i){return this.left=t,this.top=e,this.right=o,this.bottom=i,this}fromCropRect(t){return this.set(t.left0,t.top0,t.right0,t.bottom0)}containsPoint(t){return this.left<=t.x&&t.x<=this.right&&this.top<=t.y&&t.y<=this.bottom}intersectionWith(t){return this.left=Math.max(this.left,t.left),this.top=Math.max(this.top,t.top),this.right=Math.min(this.right,t.right),this.bottom=Math.min(this.bottom,t.bottom),this}leftCenter(){return new Pt(this.left,.5*(this.top+this.bottom))}topLeft(){return new Pt(this.left,this.top)}topCenter(){return new Pt(.5*(this.left+this.right),this.top)}topRight(){return new Pt(this.right,this.top)}rightCenter(){return new Pt(this.right,.5*(this.top+this.bottom))}bottomLeft(){return new Pt(this.left,this.bottom)}bottomCenter(){return new Pt(.5*(this.left+this.right),this.bottom)}bottomRight(){return new Pt(this.right,this.bottom)}center(){return new Pt(.5*(this.left+this.right),.5*(this.top+this.bottom))}translate(t,e){return this.top+=e,this.bottom+=e,this.left+=t,this.right+=t,this}point(t){switch(t){case S.TopLeft:return this.interpolate(0,0);case S.Top:return this.interpolate(.5,0);case S.TopRight:return this.interpolate(1,0);case S.Right:return this.interpolate(1,.5);case S.BottomRight:return this.interpolate(1,1);case S.Bottom:return this.interpolate(.5,1);case S.BottomLeft:return this.interpolate(0,1);case S.Left:return this.interpolate(0,.5);case S.Center:return this.interpolate(.5,.5)}return this.interpolate(.5,.5)}setAnchorPoint(t,e){switch(t){case S.TopLeft:this.left=e.x,this.top=e.y;break;case S.Top:this.top=e.y;break;case S.TopRight:this.top=e.y,this.right=e.x;break;case S.Right:this.right=e.x;break;case S.BottomRight:this.right=e.x,this.bottom=e.y;break;case S.Bottom:this.bottom=e.y;break;case S.BottomLeft:this.left=e.x,this.bottom=e.y;break;case S.Left:this.left=e.x;break;case S.Center:}return this}moveAnchorTo(t,e){let o=this.point(t);return this.translate(e.x-o.x,e.y-o.y),this}moveAnchor(t,e){switch(t){case S.TopLeft:this.left=Math.min(this.left+e.x,this.right),this.top=Math.min(this.top+e.y,this.bottom);break;case S.Top:this.top=Math.min(this.top+e.y,this.bottom);break;case S.TopRight:this.top=Math.min(this.top+e.y,this.bottom),this.right=Math.max(this.right+e.x,this.left);break;case S.Right:this.right=Math.max(this.right+e.x,this.left);break;case S.BottomRight:this.right=Math.max(this.right+e.x,this.left),this.bottom=Math.max(this.bottom+e.y,this.top);break;case S.Bottom:this.bottom=Math.max(this.bottom+e.y,this.top);break;case S.BottomLeft:this.left=Math.min(this.left+e.x,this.right),this.bottom=Math.max(this.bottom+e.y,this.top);break;case S.Left:this.left=Math.min(this.left+e.x,this.right);break;case S.Center:this.left+=e.x,this.top+=e.y,this.right+=e.x,this.bottom+=e.y}return this}moveAnchorToMinSize(t,e,o){var i=Math.max(0,e-this.width()),s=Math.max(0,o-this.height());switch(t){case S.TopLeft:this.left-=i,this.top-=s;break;case S.Top:this.top-=s;break;case S.TopRight:this.top-=s,this.right+=i;break;case S.Right:this.right+=i;break;case S.BottomRight:this.right+=i,this.bottom+=s;break;case S.Bottom:this.bottom+=s;break;case S.BottomLeft:this.left-=i,this.bottom+=s;break;case S.Left:this.left-=i;break;case S.Center:i*=.5,s*=.5,this.left-=i,this.right+=i,this.top-=s,this.bottom+=s}return this}forceAspectRatio(t,e){const o=t*this.width();var i=0,s=0;e==S.TopLeft||e==S.TopRight||e==S.BottomRight||e==S.BottomLeft?o>this.height()?i=o-this.height():s=this.height()/t-this.width():e==S.Top||e==S.Bottom?s=this.height()/t-this.width():i=o-this.height();const r=.5*s,n=.5*i;switch(e){case S.Top:this.bottom+=i,this.left-=r,this.right+=r;break;case S.Left:this.right+=s,this.top-=n,this.bottom+=n;break;case S.Bottom:this.top-=i,this.left-=r,this.right+=r;break;case S.Right:this.left-=s,this.top-=n,this.bottom+=n;break;case S.TopLeft:this.bottom+=i,this.right+=s;break;case S.TopRight:this.bottom+=i,this.left-=s;break;case S.BottomRight:this.top-=i,this.left-=s;break;case S.BottomLeft:this.top-=i,this.right+=s;break;case S.Center:this.top-=n,this.bottom+=n,this.left-=r,this.right+=r}return this}interpolate(t,e){return new Pt(this.left*(1-t)+t*this.right,this.top*(1-e)+e*this.bottom)}transform(t,e){return new Pt(e.left+(t.x-this.left)/this.width()*e.width(),e.top+(t.y-this.top)/this.height()*e.height())}sampleGrid(t,e){for(var o=[],i=0;i<e;i++)for(var s=i/(e-1),r=0;r<t;r++)o.push(this.interpolate(r/(t-1),s));return o}setHorizontal(t){return this.left=t.left,this.right=t.right,this}padToFit(t){var e=0,o=0;return e=Math.max(e,this.left-t.left),e=Math.max(e,t.right-this.right),o=Math.max(o,this.top-t.top),o=Math.max(o,t.bottom-this.bottom),this.left-=e,this.right+=e,this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom),this}addRect(t){return this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom),this}addPoint(t){this.left=Math.min(this.left,t.x),this.top=Math.min(this.top,t.y),this.right=Math.max(this.right,t.x),this.bottom=Math.max(this.bottom,t.y)}addPointSafe(t){t&&(null==this.left?(this.left=t.x,this.top=t.y,this.right=t.x,this.bottom=t.y):this.addPoint(t))}width(){return this.right-this.left}height(){return this.bottom-this.top}pad(t,e,o,i){return null==e&&(e=t),null==o&&(o=t),null==i&&(i=e),this.left-=t,this.top-=e,this.right+=o,this.bottom+=i,this}padBottom(t){return this.bottom+=t,this}toQuad(){return new Rt(this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft())}snap(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this}round(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this}normalize(){var t=Math.min(this.left,this.right),e=Math.max(this.left,this.right),o=Math.min(this.top,this.bottom),i=Math.max(this.top,this.bottom);return this.left=t,this.right=e,this.top=o,this.bottom=i,this}}!function(t){let e=!1,o=new Image;o.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k=",o.onload=function(){e=2==o.width&&3==o.height},t.BrowserRotates=function(){return e}}(w||(w={})),function(t){const e=new Set(["image/png","image/jpeg"]);function o(t){const e=t.naturalWidth,o=t.naturalHeight;let i=new It(e,o);return i.wasShrunk=!1,i.context().setGlobalAlpha(1),i.context().setFillStyle("rgb(255,255,255)"),i.context().fillRect(0,0,e,o),i.context().context.drawImage(t,0,0,e,o),i}t.needsReencoding=function(t){return!e.has(t)},t.recodeCanvasFile=function(t,e){return o=t.type,P.endsWith(o,"jpeg")||P.endsWith(o,"jpg")||P.endsWith(o,"webp")||P.endsWith(o,"jp2")||P.endsWith(o,"cr2")||P.endsWith(o,"nef")||P.endsWith(o,"dng")||P.endsWith(o,"jps")||P.startsWith(o,"image/heif")||P.startsWith(o,"image/avif")?e.toFile("image/jpeg",.95,P.dropExtension(t.name)+".jpeg"):e.toFile("image/png",1,P.dropExtension(t.name)+".png");var o},t.loadCheckRotateFlattenImage=function(e,o,i){f.get(e,(function(s){P.loadImageFromBlob(e,o,e=>{if(s.statusCode!=g.Success||s.orientation==h.R0||s.orientation==h.Undefined||w.BrowserRotates()){const o=t.flattenImage(e);o.wasRotated=!1,i(o)}else{const o=t.rotateAndFlattenImage(e,s.orientation);o.wasRotated=!0,i(o)}})}))},t.flattenImage=o,t.rotateAndFlattenImage=function(t,e){const i=t.naturalWidth,s=t.naturalHeight;let r=i,n=s,a=0;switch(e){case h.Undefined:case h.R0:return o(t);case h.R90:r=s,n=i,a=.5*Math.PI;break;case h.R180:a=Math.PI;break;case h.R270:r=s,n=i,a=.5*-Math.PI}let l=new It(r,n);return l.wasShrunk=!1,l.context().setGlobalAlpha(1),l.context().setFillStyle("rgb(255,255,255)"),l.context().fillRect(0,0,r,n),l.context().save(),l.context().translate(.5*r,.5*n),l.context().rotate(a),l.context().context.drawImage(t,.5*-i,.5*-s,i,s),l.context().restore(),l}}(ct||(ct={}));class Ft{constructor(t,e){this.canvas=t,this.context=e,this.largeFont="18px sans-serif",this.smallFont="12px sans-serif",this.toggleImageSmoothing(!1)}toggleImageSmoothing(t){this.context.mozImageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.imageSmoothingEnabled=t}width(){return this.context.canvas.width}height(){return this.context.canvas.height}logicalWidth(){return this.canvas.logicalWidth()}logicalHeight(){return this.canvas.logicalHeight()}createPattern(t,e){return this.context.createPattern(t,e)}setStrokeStyle(t){this.context.strokeStyle=t}setLineDash(t){this.context.setLineDash(t)}setLineWidth(t){this.context.lineWidth=t}setLineJoin(t){this.context.lineJoin=t}setLineCap(t){this.context.lineCap=t}strokeText(t,e,o){this.context.strokeText(t,e,o)}fillText(t,e,o){this.context.fillText(t,e,o)}measureText(t){return this.context.measureText(t)}setFont(t){this.context.font=t}save(){this.context.save()}stroke(){this.context.stroke()}strokeRect(t,e,o,i){this.context.strokeRect(t,e,o,i)}createRadialGradient(t,e,o,i,s,r){return this.context.createRadialGradient(t,e,o,i,s,r)}createLinearGradient(t,e,o,i){return this.context.createLinearGradient(t,e,o,i)}scale(t,e){this.context.scale(t,e)}translate(t,e){this.context.translate(t,e)}setRectToRectTransform(t,e){let o=e.width()/t.width(),i=e.height()/t.height();this.context.setTransform(o,0,0,i,e.left-t.left*o,e.top-t.top*i)}moveTo(t,e){this.context.moveTo(t,e)}lineTo(t,e){this.context.lineTo(t,e)}quadraticCurveTo(t,e,o,i){this.context.quadraticCurveTo(t,e,o,i)}bezierCurveTo(t,e,o,i,s,r){this.context.bezierCurveTo(t,e,o,i,s,r)}rotate(t){this.context.rotate(t)}beginPath(){this.context.beginPath()}closePath(){this.context.closePath()}arc(t,e,o,i,s,r){this.context.arc(t,e,o,i,s,r)}rect(t,e,o,i){this.context.rect(t,e,o,i)}rectTo(t,e,o,i,s){let r=t+o,n=e+i;this.moveTo(t,e),s?(this.lineTo(r,e),this.lineTo(r,n),this.lineTo(t,n)):(this.lineTo(t,n),this.lineTo(r,n),this.lineTo(r,e)),this.lineTo(t,e),this.closePath()}clip(){this.context.clip()}clipBlock(t,e,o,i,s,r){t?(this.save(),this.beginPath(),this.rect(e,o,i-e,s-o),this.clip(),r(),this.restore()):r()}rotatedFrame(t,e,o){0!=t?(this.save(),this.translate(e.x,e.y),this.rotate(t),this.translate(-e.x,-e.y),o(),this.restore()):o()}restore(){this.context.restore()}setFillStyle(t){this.context.fillStyle=t}clearShadow(){this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowBlur=0,this.context.shadowColor=void 0}setShadow(t,e,o,i){this.context.shadowOffsetX=t,this.context.shadowOffsetY=e,this.context.shadowBlur=o,this.context.shadowColor=i}setGlobalAlpha(t){this.context.globalAlpha=t}withGlobalAlpha(t,e){let o=this.context.globalAlpha;this.setGlobalAlpha(t),e(),this.setGlobalAlpha(o)}clearRect(t,e,o,i){this.context.clearRect(t,e,o,i)}clearAll(){this.clearRect(0,0,this.logicalWidth(),this.logicalHeight())}createImageData(t,e){return this.context.createImageData(t,e)}getImageData(t,e,o,i){return this.context.getImageData(t,e,o,i)}getImageDataFull(){return this.context.getImageData(0,0,this.width(),this.height())}putImageData(t,e,o){this.context.putImageData(t,e,o)}putImageData2(t,e,o,i,s,r,n){this.context.putImageData(t,e,o,i,s,r,n)}fillRect(t,e,o,i){this.context.fillRect(t,e,o,i)}roundedRect(t,e,o,i,s){o<2*s&&(s=o/2),i<2*s&&(s=i/2),this.beginPath(),this.moveTo(t+s,e),this.context.arcTo(t+o,e,t+o,e+i,s),this.context.arcTo(t+o,e+i,t,e+i,s),this.context.arcTo(t,e+i,t,e,s),this.context.arcTo(t,e,t+o,e,s),this.closePath()}fillRoundedRect(t,e,o,i,s){this.roundedRect(t,e,o,i,s),this.context.fill()}drawImage(t,e,o){this.context.drawImage(t,e,o)}drawImage2(t,e,o,i,s){this.context.drawImage(t,e,o,i,s)}drawImage3(t,e,o,i,s,r,n,a,l){this.context.drawImage(t,e,o,i,s,r,n,a,l)}drawCanvasEx(t,e,o){this.context.drawImage(t.element,e,o)}drawCanvasEx2(t,e,o,i,s){this.context.drawImage(t.element,e,o,i,s)}drawCanvasEx3(t,e,o,i,s,r,n,a,l){this.context.drawImage(t.element,e,o,i,s,r,n,a,l)}circle(t,e,o){this.context.beginPath(),this.context.arc(t,e,o,0,2*Math.PI,!0)}fillCircle(t,e,o,i){i&&(this.context.fillStyle=i),this.circle(t,e,o),this.context.fill()}fillSquare(t,e,o,i){i&&(this.context.fillStyle=i),this.context.fillRect(t-o,e-o,2*o,2*o)}strokeSquare(t,e,o,i){i&&(this.context.strokeStyle=i),this.context.strokeRect(t-o,e-o,2*o,2*o)}strokeCircle(t,e,o,i){i&&(this.context.strokeStyle=i),this.circle(t,e,o),this.context.stroke()}strokeLine(t,e,o,i,s,r){s&&(this.context.lineWidth=s),r&&(this.context.strokeStyle=r),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(o,i),this.context.stroke()}strokePolyline(...t){if(t.length>1){this.context.beginPath(),this.context.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)this.context.lineTo(t[e].x,t[e].y);this.context.stroke()}}triangle(t,e,o,i,s,r){var n=120*Math.PI/180;s=s||i,r=r||s,this.context.moveTo(t+i*Math.cos(o),e+i*Math.sin(o)),this.context.lineTo(t+s*Math.cos(o+n),e+s*Math.sin(o+n)),this.context.lineTo(t+r*Math.cos(o+2*n),e+r*Math.sin(o+2*n)),this.context.closePath()}strokeEx(t,e,o,i){o&&(this.context.lineJoin=o),i&&(this.context.lineCap=i),this.context.lineWidth=t,this.context.strokeStyle=e,this.context.stroke()}fillEx(t){this.context.fillStyle=t,this.context.fill()}drawCenteredText(t,e){var o=t;const i=t.length;this.setGlobalAlpha(1),this.setFont(this.largeFont);let s=18;var r=this.measureText(t).width;const n=this.canvas.logicalWidth();var a=n-20;r>a&&(this.setFont(this.smallFont),s=12,(r=this.measureText(t).width)>a&&(t=P.centerElide(o,.75*i),(r=this.measureText(t).width)>a&&(t=P.centerElide(o,.5*i),(r=this.measureText(t).width)>a&&(t=P.centerElide(o,.25*i),r=this.measureText(t).width))));let l=(n-r)/2,c=s+4,p=.25*s+1;this.setGlobalAlpha(.4),this.setFillStyle("#fff"),this.fillRoundedRect(l-4,e-c+p,r+8,c,.4*c),this.setGlobalAlpha(1),this.setFillStyle("#000"),this.fillText(t,l,e)}}class It{constructor(t,e,o=1){this.w=t,this.h=e,this.highDpiRatio=1,this.element=document.createElement("canvas"),this.$element=$(this.element),this.setSize(t,e,o),this.wasShrunk=!1,this.contextCache=null}static fromHTMLImageElement(t,e=1){let o=t.naturalWidth*e,i=t.naturalHeight*e,s=new It(o,i);return s.context().drawImage2(t,0,0,o,i),s}empty(){}width(){return this.w}height(){return this.h}snapStrokeCenterToDevice(t,e){let o=t*this.highDpiRatio,i=e*this.highDpiRatio;return i==Math.round(i)?i%2==0?Math.round(o)/this.highDpiRatio:(Math.floor(o)+.5)/this.highDpiRatio:t}logicalWidth(){return this.wLogical}logicalHeight(){return this.hLogical}boundsRect(){return new Et(0,0,this.width(),this.height())}size(){return this.w*this.h}isInBounds(t,e){return 0<=t&&t<this.width()&&0<=e&&e<this.height()}byteLength(){return 4*this.size()}dup(){let t=new It(this.width(),this.height());return t.context().drawCanvasEx(this,0,0),t}crop(t,e,o,i){let s=new It(o,i);return s.context().drawCanvasEx(this,-t,-e),s}computeMeanRgba(t,e,o,i){if(null!=t&&null!=e&&null!=o&&null!=i){let s=this.context().getImageData(t,e,o,i).data,r=s.length/4;if(r>0){let t=new Float64Array(4);for(let e=0,o=0;e<r;e++)t[0]+=s[o++],t[1]+=s[o++],t[2]+=s[o++],t[3]+=s[o++];let e=new Uint8ClampedArray(4);return e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r,e[3]=t[3]/r,e}}}scale(t){let e=new It(Math.round(this.width()*t),Math.round(this.height()*t));return e.context().drawCanvasEx2(this,0,0,e.width(),e.height()),e}context(){return null==this.contextCache&&(this.contextCache=new Ft(this,this.element.getContext("2d")),1!=this.highDpiRatio&&this.contextCache.scale(this.highDpiRatio,this.highDpiRatio)),this.contextCache}checkSetSize(t,e,o=1){return(this.w!=t||this.h!=e||this.highDpiRatio!=o)&&(this.setSize(t,e,o),!0)}setSize(t,e,o=1){t>0&&e>0&&(this.highDpiRatio=o,this.wLogical=t,this.hLogical=e,this.w=t*this.highDpiRatio,this.h=e*this.highDpiRatio,this.element.style.width=t+"px",this.element.style.height=e+"px",this.element.width=this.w,this.element.height=this.h,this.contextCache=null)}clearAll(){this.context().clearRect(0,0,this.width(),this.height())}toImage(){let t=document.createElement("img");return t.src=this.toDataURL(),t}toDataURL(t,e){return this.element.toDataURL(t,e)}toBlob(t,e){return P.dataUrlToBlob(this.toDataURL(t,e))}toBlobAsync(t,e,o){this.element.toBlob(t)}toFile(t,e,o){return P.blobToFile(this.toBlob(t,e),o)}fillAliasedCircle(t,e,o,i){if(!(o<=0)){for(var s=this.context().getImageData(0,0,this.width(),this.height()),r=o*o,n=Math.max(0,Math.floor(t-o)),a=Math.min(this.width()-1,Math.ceil(t+o)),l=Math.max(0,Math.floor(e-o)),c=Math.min(this.height()-1,Math.ceil(e+o)),p=l;p<=c;p++)for(var u=n;u<=a;u++)if((u+.5-t)*(u+.5-t)+(p+.5-e)*(p+.5-e)<=r){var h=4*(p*this.width()+u);s.data[h]=i[0],s.data[h+1]=i[1],s.data[h+2]=i[2],s.data[h+3]=i[3]}this.context().putImageData(s,0,0)}}}!function(t){function e(t){let e=$(document).scrollTop();const o=document.createElement("textarea");o.value=t,o.setAttribute("readonly",""),o.style.position="absolute",o.style.left="-9999px",document.body.appendChild(o);const i=document.getSelection().rangeCount>0?document.getSelection().getRangeAt(0):void 0;o.select();let s=document.execCommand("copy");return document.body.removeChild(o),i&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(i)),$(document).scrollTop(e),s}t.copyTextToClipboardWithExecCommand=e,t.copyTextToClipboard=function(t,o,i){e(t)?o():window.navigator&&window.navigator.clipboard&&window.navigator.clipboard.writeText?window.navigator.clipboard.writeText(t).then(()=>{o()},()=>{i()}):i()};const o=new RegExp("mobile|ip(hone|od|ad)|android|blackberry|iemobile|kindle|netfront|silk-accelerated|(hpw|web)os|fennec|minimo|opera m(obi|ini)|blazer|dolfin|dolphin|skyfire|zune");function i(t,e,o){navigator.clipboard.write([new ClipboardItem({[t.type]:t})]).then(()=>{e()},()=>{o()})}t.copyImageToClipboard=function(t,e,o){It.fromHTMLImageElement(t).toBlobAsync(t=>i(t,e,o))},t.copyImageBlobToClipboard=i,t.isMobile=function(){return!!(navigator&&navigator.userAgent&&navigator.userAgent.length>0)&&o.test(navigator.userAgent.toLowerCase())};const s=/\<svg[^\>]+viewBox\s*=\s*"\s*([\d\.]+)\s+([\d\.]+)\s+([\d\.]+)\s+([\d\.]+)\s*"/,r=/\<svg[^\>]+width\s*=\s*"\s*([\d\.]+)/,n=/\<svg[^\>]+height\s*=\s*"\s*([\d\.]+)/;function a(t,e,o){let i=new Image;i.onload=function(){URL.revokeObjectURL(i.src),o(i)},i.onerror=e,i.src=t}t.loadImageFromSvgString=function(e,o,i){a(t.svgStringToDataUrl(function(t){let e=r.exec(t),o=n.exec(t);if(e&&2==e.length&&isFinite(parseInt(e[1]))&&o&&2==o.length&&isFinite(parseInt(o[1])))return t;{let e=s.exec(t);if(5==e.length){parseInt(e[1]),parseInt(e[2]);let o=parseInt(e[3]),i=parseInt(e[4]);if(isFinite(o)&&isFinite(i)){let e=150,s=Math.ceil(i/o*e);return t.replace("<svg",`<svg width="${e}" height="${s}"`)}}}return t}(e)),o,i)},t.loadImageFromDataUrl=a,t.loadImageFromUrl=function(t,e,o){let i=new Image;i.onload=()=>o(i),i.onerror=e,i.src=t},t.loadImageFromBlob=function(t,e,o){a(URL.createObjectURL(t),e,o)},t.loadFileFromUrl=function(e,o,i){let s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="blob",s.onload=function(s){if(200==this.status){let s=this.response,r=e.split("/");o||(o=r[r.length-1]),i(t.blobToFile(s,o))}},s.send()},t.gaTrack=function(t,e,o,i){ga("send","event",t,e,o,i,{nonInteraction:!0})},t.gaSetPageAndSendPageview=function(t){ga("set","page",t||location.pathname),ga("send","pageview")},t.modal=function(t,e=!1,o=!1){var i="string"==typeof t?$(t):t.$();e?i.modal({backdrop:!o,keyboard:!0}):i.modal({backdrop:"static",keyboard:!1});var s=$(".modal-backdrop"),r=1040+2*(s.length-1);s.last().css("z-index",r),i.css("z-index",r+1)},t.blink=function(t,e=200,o=3){var i="string"==typeof t?$(t):t.$();function s(){i.fadeIn(e,r)}function r(){--o>0&&i.fadeOut(e,s)}i.fadeOut(e,s)},t.makeElement=function(t,e){var o=$(document.createElement(t));return o.text(e),o},t.formatXhrError=function(e,o){const i=e.responseURL||"[Unknown URL]";if(t.gaTrack("XhrError",i,e.status+", "+(o||"[unknown]")),0===e.status)return p.s("Failed to connect to the server.")+"\n"+p.s("Please verify your network connection.")+"\n";{const i=t.elide(e.responseText.toString(),200);return e.status<200||299<e.status?e.statusText+" ["+e.status+"]\n"+i:"parsererror"===o?p.s("Failed to parse JSON response.")+" ["+o+"]\n"+i:"timeout"===o?p.s("Request time out.")+" ["+o+"]":"abort"===o?p.s("Request aborted by the server.")+" ["+o+"]":"empty"===o?p.s("Server gave an empty response."):p.s("Unknown error.")+"\n"+i}}}(P||(P={})),function(t){t.initialize=function(t,e){t.$().click((function(){let t=prompt(p.s("Please enter the image URL to upload:"));return t&&(t=t.trim(),t.length>4&&e(t)),!1}))}}(C||(C={})),function(t){t.isCommandOrCtrl=function(t){return 17==t||224==t||91==t||93==t},t.isShift=function(t){return 16==t}}(y||(y={})),function(t){const e=".FileDropper";var o,i=!0;let s,r;!function(t){t[t.Dropped=0]="Dropped",t[t.Picked=1]="Picked",t[t.Pasted=2]="Pasted",t[t.Url=3]="Url"}(s=t.InputMethod||(t.InputMethod={})),function(t){t[t.NoBrowserSupport=0]="NoBrowserSupport",t[t.NonFileInput=1]="NonFileInput",t[t.NonImageInput=2]="NonImageInput"}(r=t.ErrorCode||(t.ErrorCode={})),t.initialize=function(t){var n=!1,a=$.extend({},{hover_class_on:t.monitor_drag,focusPasteOnCtrlV:!!t.monitor_paste,afterPaste:t=>{}},t);function l(t,e,o){a.afterPaste(!1),a.error(t,e,o)}function c(){i=!1,a.monitor_drag&&a.hover_class_on&&a.hover_class&&a.monitor_drag.$().off(e),a.monitor_file_input&&a.monitor_file_input.$().off(e),a.monitor_paste&&a.monitor_paste.$().off(e),a.focusPasteOnCtrlV&&$(window).off(e)}function u(t,e,o){i&&(t&&t.length>0?("Pasted"==e&&a.afterPaste(!0),a.beforeDrop&&a.beforeDrop(),o==s.Dropped&&a.hideDurationMs?setTimeout(()=>{a.drop.call(this,t,o),a.dropOnce&&c()},a.hideDurationMs):(a.drop.call(this,t,o),a.dropOnce&&c())):l(p.s(e+" a non-file input"),o,r.NonFileInput))}function h(t,e){clearTimeout(o),t.stopImmediatePropagation(),t.preventDefault();let i=!1;try{let e=t.originalEvent.dataTransfer;if(e){let t=e.types;for(let e=0;e<t.length;e++){if("Files"==t[e]){i=!0;break}}}}catch(t){i=!0}let s=a.hover_class_on.$().hasClass(a.hover_class.name()),r=e&&i;return s&&!r?(a.beforeHide&&a.beforeHide(),a.hideDurationMs?setTimeout(()=>a.hover_class_on.$().removeClass(a.hover_class.name()),a.hideDurationMs):a.hover_class_on.$().removeClass(a.hover_class.name()),a.afterHide&&a.afterHide()):!s&&r&&(a.beforeShow&&a.beforeShow(),a.hover_class_on.$().addClass(a.hover_class.name())),i}function d(){a.pastedUrl?l(p.s("Pasted something that wasn't an image or URL?"),s.Pasted,r.NonImageInput):l(p.s("Pasted something that wasn't an image?"),s.Pasted,r.NonImageInput)}function g(t){let e=new Blob([t],{type:t.type});return e.lastModified=t.lastModified,e.name=function(){function t(t){return("0"+t).slice(-2)}let e=new Date;return"Pasted-"+e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+"-"+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())}(),e}return a.monitor_drag&&a.hover_class_on&&a.hover_class&&a.monitor_drag.$().on("drop"+e,(function(t){return h(t,!1)&&u(t.originalEvent.dataTransfer.files,"Dropped",s.Dropped),!1})).on("dragenter"+e,(function(t){h(t,!0),a.onDragEnter&&a.onDragEnter(t)})).on("dragover"+e,(function(t){let e=h(t,!0);t.originalEvent.dataTransfer.dropEffect=i&&e?"copy":"none",a.onDragOver&&a.onDragOver(t)})).on("dragleave"+e,(function(t){o=setTimeout(()=>{h(t,!1),a.onDragLeave&&a.onDragLeave(t)},100)})),a.monitor_file_input&&a.monitor_file_input.$().on("change"+e,t=>{let e=t.originalEvent.target;return u(e.files,"Picked",s.Picked),e.value=null,!1}),a.monitor_paste&&(a.monitor_paste.$().on("paste"+e,(function(t){if(!i)return;const e=t.originalEvent.clipboardData;if(e&&e.files&&e.files.length>0)1==e.files.length&&"image.png"==e.files[0].name?u([g(e.files[0])],"Pasted",s.Pasted):u(e.files,"Pasted",s.Pasted);else if(e&&!e.items)l(p.s("Terribly sorry, it seems like your browser doesn't fully support pasting of images yet?")+"\n\n"+p.s("Paste should work in at least Chrome, Firefox, and Microsoft Edge. "),s.Pasted,r.NoBrowserSupport);else if(e&&e.items&&e.items.length>0&&e.types&&e.types.length==e.items.length){const t=[];let o=!1,i=0;for(let s=0;s<e.items.length;s++)if("Files"==e.types[s]){let o=e.items[s].getAsFile();o&&(t[i]=g(o),i++)}else"text/plain"==e.types[s]&&a.pastedUrl&&(o=!0,e.items[s].getAsString((function(t){(t=t.trim()).length>5e3||t.length<=4||t.indexOf("\n")>=0||t.indexOf("\r")>=0||t.indexOf(" ")>=0||t.indexOf(".")<0?d():a.pastedUrl(t)})));i>0?u(t,"Pasted",s.Pasted):o||d()}else d();n&&(n=!1,a.monitor_paste.$().blur()),t.preventDefault()})),a.focusPasteOnCtrlV&&$(window).on("keydown"+e,t=>{(t.ctrlKey||t.metaKey)&&86==t.keyCode&&($(document.activeElement).is("input")||(a.monitor_paste.$().focus(),n=!0))})),{disable:c}};try{XMLHttpRequest.prototype.hasOwnProperty("sendAsBinary")||a.set(XMLHttpRequest.prototype,"sendAsBinary",(function(t){var e=Array.prototype.map.call(t,(function(t){return 255&t.charCodeAt(0)})),o=new Uint8Array(e);this.send(o.buffer)}))}catch(t){}}(b||(b={})),function(t){t[t.Trying=0]="Trying",t[t.Success=1]="Success",t[t.FailureSilent=2]="FailureSilent",t[t.FailureShown=3]="FailureShown",t[t.Stopped=4]="Stopped"}(v||(v={}));class Bt{constructor(t){this.opts=t,this.tries=0,this.triesEver=0,this.lastErrorMessage="",this.isTrying=!1,this.state=v.Trying,this.timeout=0,this.executionStopped=()=>{this.state=v.Stopped,this.isTrying=!1,this.tries=0,this.lastErrorMessage="",A.deregister(this)},this.executionSuccess=()=>{this.state=v.Success,this.isTrying=!1,this.tries=0,this.lastErrorMessage="",this.opts.success(),A.deregister(this)},this.executionError=t=>{this.isTrying=!1,this.lastErrorMessage=t.substr(0,200),this.tries<this.opts.numberOfSilentRetriesBeforeShowingErrorToUser?(this.state=v.FailureSilent,this.clearTimeout(),this.timeout=setTimeout(this.tryExecute,this.opts.millisBetweenSilentRetries)):this.opts.giveUpAfterSilentRetries?this.state=v.FailureSilent:(this.state=v.FailureShown,A.register(this))},this.executionPunt=()=>{this.isTrying=!1,this.state=v.FailureSilent,this.clearTimeout(),this.timeout=setTimeout(this.tryExecute,100)},this.tryExecute=()=>{if(this.clearTimeout(),!this.isTrying){this.state=v.Trying,this.isTrying=!0,this.tries+=1,this.triesEver+=1;try{this.opts.execute(this.executionSuccess,this.executionError)}catch(t){this.tries=Math.max(this.tries,this.opts.numberOfSilentRetriesBeforeShowingErrorToUser),setTimeout(()=>{this.executionError(t.toString())},0)}return!0}return!1}}start(){return this.tryExecute(),this}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=0)}makeHtmlRow(){let t=$(document.createElement("tr"));return t.append(P.makeElement("td",this.opts.label)),t.append(P.makeElement("td",this.lastErrorMessage)),t}toString(){return`RetryInstance(${this.opts.label}, tries: ${this.tries} (${this.triesEver}), err: '${this.lastErrorMessage}', isTrying: ${this.isTrying}, state: ${v[this.state]})`}}!function(t){setTimeout((function(){!0}),0);var e=[],o=null,i=0,s=5e3,r=!1;function n(){var t=D.RetryDialog.Body.$();t.empty();var o=$(document.createElement("tr"));o.append(P.makeElement("th",p.s("Task"))),o.append(P.makeElement("th",p.s("Error"))),t.append(o);for(var i=0;i<e.length;i++)t.append(e[i].makeHtmlRow())}function a(){i=Date.now(),null!=o&&(clearInterval(o),o=null),(s*=2)>36e5&&(s=36e5),D.RetryDialog.Countdown.$().text(p.s("Retrying now..."));for(var t=0;t<e.length;t++)e[t].tryExecute()}function l(){var t=Date.now(),e=Math.round((i+s-t)/1e3);e<=0?a():D.RetryDialog.Countdown.$().text(p.s("Retrying in {0} {0,plural,one{second}other{seconds}}...",e)),n()}t.register=function(t){e.indexOf(t)<0&&(P.gaTrack("ErrorShown",t.opts.label,t.lastErrorMessage,null),e.push(t),n()),P.modal(D.RetryDialog.Dialog.css()),r=!0,null==o&&(i=Date.now(),o=setInterval(l,1e3))},t.deregister=function(t){var o=e.indexOf(t);o>=0&&(e.splice(o,1),n()),s=5e3,i=Date.now(),0==e.length&&r&&D.RetryDialog.Dialog.$().modal("hide")},$(()=>{D.RetryDialog.RetryNowButton.$().click(()=>{a(),s=5e3})})}(A||(A={})),function(t){let e={label:"Unknown",url:"",tries:3,paramname:"file",withCredentials:!1,data:{},headers:{},progress:t=>{},success:()=>{},giveUpAfterSilentRetries:!1,timeout:3e4};function o(t,o,i,s){i.data={acl:o.acl||"private",key:o.key,policy:o.policy,success_action_status:201,"x-amz-algorithm":"AWS4-HMAC-SHA256","x-amz-credential":o.credential,"x-amz-date":o.date,"x-amz-signature":o.signature,"Content-Type":t.type,"Cache-Control":i.maxAge?"max-age="+i.maxAge:"no-cache"},o.token&&(i.data["x-amz-security-token"]=o.token),function(t,o,i){let s=$.extend({},e,o),r=new XMLHttpRequest,n=r.upload,a=new FormData;function l(){r.abort()}$.each(s.headers,(function(t,e){r.setRequestHeader(t,e)})),$.each(s.data,(function(t,e){a.append(t,e)})),a.append(s.paramname,t);let c=setTimeout(l,s.timeout),p=0;n.onprogress=function(t){if(clearTimeout(c),c=setTimeout(l,s.timeout),t.lengthComputable){let e=Math.round(100*t.loaded/t.total);p!==e&&(p=e,s.progress(p))}},n.onerror=function(t){i.errorHandler(P.formatXhrError(r,void 0))},n.onabort=function(t){i.errorHandler(P.formatXhrError(r,"abort"))},n.onloadend=function(t){clearTimeout(c)},r.onload=function(){clearTimeout(c),r.responseText?r.status<200||r.status>299?i.errorHandler(P.formatXhrError(r,"onload")):(s.progress(100),i.successHandler(r.responseText)):i.errorHandler(P.formatXhrError(r,"empty"))},r.withCredentials=!!s.withCredentials,r.open("POST",s.url,!0),r.send(a)}(t,i,s)}function i(t,i,s){const r=s.url,n=s.backupUrl;let a="",l=$.extend({},e,s);const c=t.size>i.maxBytes;return new Bt({label:l.label,execute:function(e,s){c?s(p.s("The file is too large to upload. ")+p.s("Please pick a file smaller than {0} {0,plural,one{byte}other{bytes}}. ",i.maxBytes)):(l.url=a=a==r&&n?n:r,o(t,i,l,{errorHandler:s,successHandler:e}))},success:function(){l.success()},numberOfSilentRetriesBeforeShowingErrorToUser:c?0:l.tries,millisBetweenSilentRetries:1e3,giveUpAfterSilentRetries:l.giveUpAfterSilentRetries}).start()}t.uploadS3WithRetry=i,t.uploadS3JsonWithRetry=function(t,e,o){return i(new Blob([JSON.stringify(t)],{type:"application/json"}),e,o)}}(k||(k={}));class Ot{constructor(){this.a11=1,this.a12=0,this.a13=0,this.a21=0,this.a22=1,this.a23=0,this.a31=0,this.a32=0,this.a33=1}static from(t){var e=new Ot;return e.set(t.a11,t.a21,t.a31,t.a12,t.a22,t.a32,t.a13,t.a23,t.a33),e}pretty(){return"\n["+this.a11.toFixed(3)+", "+this.a21.toFixed(3)+", "+this.a31.toFixed(3)+"]\n["+this.a12.toFixed(3)+", "+this.a22.toFixed(3)+", "+this.a32.toFixed(3)+"]\n["+this.a13.toExponential(3)+", "+this.a23.toExponential(3)+", "+this.a33.toFixed(3)+"]\n"}set(t,e,o,i,s,r,n,a,l){this.a11=t,this.a12=i,this.a13=n,this.a21=e,this.a22=s,this.a23=a,this.a31=o,this.a32=r,this.a33=l}timesEquals(t){this.set(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)}adjointSelf(){this.set(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}normalize(){var t=1/this.a33;this.a11*=t,this.a12*=t,this.a13*=t,this.a21*=t,this.a22*=t,this.a23*=t,this.a31*=t,this.a32*=t,this.a33=1}apply(t,e){var o=t.x,i=t.y,s=this.a13*o+this.a23*i+this.a33;e.x=(this.a11*o+this.a21*i+this.a31)/s,e.y=(this.a12*o+this.a22*i+this.a32)/s}applyWithGuard(t,e){var o=t.x,i=t.y,s=this.a13*o+this.a23*i+this.a33;return 0!=s&&(e.x=(this.a11*o+this.a21*i+this.a31)/s,e.y=(this.a12*o+this.a22*i+this.a32)/s,!0)}applyToQuad(t,e){this.apply(t.p0,e.p0),this.apply(t.p1,e.p1),this.apply(t.p2,e.p2),this.apply(t.p3,e.p3)}setSquareToQuadrilateral(t,e,o,i,s,r,n,a){var l=t-o+s-n,c=e-i+r-a;if(0==l&&0==c)this.set(o-t,s-o,t,i-e,r-i,e,0,0,1);else{var p=o-s,u=n-s,h=i-r,d=a-r,g=p*d-u*h,m=(l*d-u*c)/g,f=(p*c-l*h)/g;this.set(o-t+m*o,n-t+f*n,t,i-e+m*i,a-e+f*a,e,m,f,1)}}setQuadrilateralToSquare(t,e,o,i,s,r,n,a){this.setSquareToQuadrilateral(t,e,o,i,s,r,n,a),this.adjointSelf()}setQuadrilateralToQuadrilateral(t,e){this.setQuadrilateralToQuadrilateralRaw(t.p0.x,t.p0.y,t.p1.x,t.p1.y,t.p2.x,t.p2.y,t.p3.x,t.p3.y,e.p0.x,e.p0.y,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.p3.x,e.p3.y)}setQuadrilateralToQuadrilateralRaw(t,e,o,i,s,r,n,a,l,c,p,u,h,d,g,m){Ot.dummy.setQuadrilateralToSquare(t,e,o,i,s,r,n,a),this.setSquareToQuadrilateral(l,c,p,u,h,d,g,m),this.timesEquals(Ot.dummy),this.normalize()}setRotationAbout(t,e){var o=e.x,i=e.y,s=Math.cos(t),r=Math.sin(t);this.set(s,-r,o*(1-s)+i*r,r,s,i*(1-s)-o*r,0,0,1)}}Ot.dummy=new Ot;class Lt{constructor(t,e){this.p0=t,this.p1=e}lengthSqr(){return this.p0.distanceSqrTo(this.p1)}direction(){return this.p1.minus(this.p0)}interpolate(t){return this.p0.interpolate(this.p1,t)}snapTo(t){let e=P.clamp(t.minus(this.p0).dot(this.direction())/this.lengthSqr(),0,1),o=this.interpolate(e);return{pp:o,t:e,distance:o.distanceTo(t)}}distSqrTo(t){let e=P.clamp(t.minus(this.p0).dot(this.direction())/this.lengthSqr(),0,1),o=this.interpolate(e);return{pp:o,t:e,distanceSqr:o.distanceSqrTo(t)}}}class zt{constructor(t){this.points=t}head(){return this.points[0]}last(){return this.points[this.points.length-1]}bounds(){return Et.fromPoints(this.points)}snapTo(t){var e=this.points.length;if(0==e)return null;if(1==e)return{pp:this.points[0].dup(),t:0,distance:this.points[0].distanceTo(t)};for(var o=null,i=new Lt(null,null),s=0;s<e-1;s++){i.p0=this.points[s],i.p1=this.points[s+1];var r=i.snapTo(t);(null==o||r.distance<o.distance)&&(o=r)}return o}rotateAndOffsetY(t,e,o){const i=Math.sin(t),s=Math.cos(t);return new zt(this.points.map(t=>{var r=t.x-e.x,n=t.y-e.y;return new Pt(e.x+s*r-i*n,e.y+i*r+s*n+o)}))}nonEmpty(){return this.points.length>0}isEmpty(){return 0==this.points.length}}class $t{constructor(t){this.loops=t}contains(t,e){for(var o=!1,i=0;i<this.loops.length;i++)o=this.loops[i].contains(t,e,o);return o}}class Ut{constructor(t){this.points=t}contains(t,e,o=!1){var i=o;const s=this.points.length;for(var r=0;r<s;r++){var n=this.points[r],a=this.points[(r+1)%s];(a.y<e&&n.y>=e||n.y<e&&a.y>=e)&&a.x+(e-a.y)/(n.y-a.y)*(n.x-a.x)<t&&(i=!i)}return i}}!function(t){t.nearest=new Pt(0,0);const e=new Pt(0,0),o=new Pt(0,0),i=new Pt(0,0),s=new Pt(0,0);let r,n,a;function l(l){t.distanceSqr=t.distance=Number.MAX_VALUE,e.set(r.p0).minusEquals(l);let p=2*o.dot(o)+e.dot(i),u=e.dot(o);if(c(r.p0,l,0),c(r.p2,l,1),tt.solve(n,a,p,u))for(let t=0;t<tt.numRoots;t++)tt.roots[t]>0&&tt.roots[t]<1&&(r.evalTo(tt.roots[t],s),c(s,l,tt.roots[t]));return t.distanceSqr}function c(e,o,i){let s=e.distanceSqrTo(o);s<t.distanceSqr&&(t.t=i,t.distanceSqr=s,t.nearest.set(e))}t.reset=function(t){r!=t&&(r=t,o.set(r.p1).minusEquals(r.p0),i.set(r.p2).minusEquals(r.p1).minusEquals(o),n=i.dot(i),a=3*o.dot(i))},t.distanceToSqr=l,t.distanceTo=function(e){return t.distance=Math.sqrt(l(e))}}(M||(M={}));class Gt{constructor(t,e,o){this.p0=t,this.p1=e,this.p2=o,this.mp=this.eval(.5),this.updateIsLine()}static line(t,e){return new Gt(t,t.interpolate(e,.5),e)}static throughMidpoint(t,e,o){const i=new Gt(t,e.dup(),o);return i.mp.set(e),i.updateP1FromMp(),i}length(){const t=this.p0.x-2*this.p1.x+this.p2.x,e=this.p0.y-2*this.p1.y+this.p2.y,o=2*this.p1.x-2*this.p0.x,i=2*this.p1.y-2*this.p0.y,s=4*(t*t+e*e),r=4*(t*o+e*i),n=o*o+i*i,a=2*Math.sqrt(s+r+n),l=Math.sqrt(s),c=2*s*l,p=2*Math.sqrt(n),u=r/l;return(c*a+l*r*(a-p)+(4*n*s-r*r)*Math.log((2*l+u+a)/(u+p)))/(4*c)}lengthBySampling(){let t=this.eval(0),e=0;for(let o=1;o<=100;o++){let i=this.eval(o/100);e+=t.distanceTo(i),t=i}return e}argMinDistanceSqrToPoint(t){M.reset(this),M.distanceToSqr(t)}dup(){const t=new Gt(this.p0.dup(),this.p1.dup(),this.p2.dup());return t.mp.set(this.mp),t.isLine=this.isLine,t}slice(t,e){let o=this.eval(t),i=this.eval(e),s=(t+e)/2,r=this.eval(s);return Gt.throughMidpoint(o,r,i)}reverse(){var t=new Gt(this.p2.dup(),this.p1.dup(),this.p0.dup());return t.mp.set(this.mp),t.isLine=this.isLine,t}set(t){this.p0.set(t.p0),this.p1.set(t.p1),this.p2.set(t.p2),this.mp.set(t.mp),this.isLine=t.isLine}step(t,e,o,i){this.p0.set(this.p2),this.p1.setXy(t,e),this.p2.setXy(o,i),this.mp=this.eval(.5)}eval(t){return this.evalTo(t,new Pt(0,0))}evalTo(t,e){return e.x=this.p2.x*t*t+2*this.p1.x*(1-t)*t+this.p0.x*(1-t)*(1-t),e.y=this.p2.y*t*t+2*this.p1.y*(1-t)*t+this.p0.y*(1-t)*(1-t),e}evalToNode(t,e){let o=this.eval(t);return{x:o.x,y:o.y,isCorner:e}}getPoint(t){switch(t){case 0:return this.p0;case 1:return this.mp;case 2:return this.p2;default:return}}updateIsLine(){var t=this.p2.minus(this.p0).ortho().normalize(),e=Math.abs(t.dot(this.p1.minus(this.p0)));this.isLine=e<.001&&t.length()>0}updateP1FromMp(){this.p1.x=2*this.mp.x-.5*(this.p0.x+this.p2.x),this.p1.y=2*this.mp.y-.5*(this.p0.y+this.p2.y),this.updateIsLine()}move(t,e,o){if(o){var i=this.getPoint(t),s=i.dup();o.move(0==t?2:0,e),i.set(s),this.move(t,e)}else{var r=0==t?this.p0:this.p2,n=0==t?this.p2:this.p0;switch(t){case 2:case 0:this.isLine?(r.set(e),this.p1.set(r.interpolate(n,.5))):(r.set(e),this.updateP1FromMp()),this.mp.set(this.eval(.5));break;case 1:this.mp.set(e),this.updateP1FromMp()}this.updateIsLine()}}}class Nt{constructor(t=[]){this.active=!1,this.beziers=t}reverse(){for(var t=[],e=this.beziers.length-1;e>=0;e--)t.push(this.beziers[e].reverse());return new Nt(t)}getFirstPoint(){return this.beziers[0].p0}getLastPoint(){return this.beziers[this.beziers.length-1].p2}isClosed(){return this.getFirstPoint()==this.getLastPoint()}reverseInPlace(){for(var t=this.reverse(),e=this.beziers.length,o=0;o<e;o++)this.beziers[o].set(t.beziers[o])}}class Ht{constructor(){this.polyBeziers=[]}static decode(t,e){var o,i;e.polyBeziers.length=0;try{if(t&&t.swords){var s=[];for(o=0;o<t.points.length;o++)s.push(Pt.from(t.points[o]));var r=t.swords;for(o=0;o<r.length;o++){var n=r[o],a=[];for(i=0;i<n.length;i++){var l=n[i];a.push(new Gt(s[l[0]],s[l[1]],s[l[2]]))}a.length>0&&e.polyBeziers.push(new Nt(a))}}}catch(t){}return e}encode(){var t=new Vt,e=[];function o(o){var i=e.indexOf(o);return i<0&&(e.push(o),t.points.push({x:o.x,y:o.y}),i=t.points.length-1),i}for(var i=0;i<this.polyBeziers.length;i++){var s=this.polyBeziers[i],r=[];t.swords.push(r);for(var n=0;n<s.beziers.length;n++){var a=s.beziers[n];r.push([o(a.p0),o(a.p1),o(a.p2)])}}return t}}class Vt{constructor(){this.points=[],this.swords=[]}}class Wt{constructor(t=0,e=0,o=0,i=0){this.top0=t,this.right0=e,this.bottom0=o,this.left0=i}static from(t){return new Wt(t.top0,t.right0,t.bottom0,t.left0)}dup(){return Wt.from(this)}unionWith(t){return this.left0=Math.min(this.left0,t.left0),this.top0=Math.min(this.top0,t.top0),this.right0=Math.max(this.right0,t.right0),this.bottom0=Math.max(this.bottom0,t.bottom0),this}centerX(){return(this.left0+this.right0)/2}centerY(){return(this.top0+this.bottom0)/2}width(){return this.right0-this.left0}height(){return this.bottom0-this.top0}area(){return this.width()*this.height()}isEmpty(){return 0==this.top0&&0==this.right0&&0==this.bottom0&&0==this.left0}clear(){this.top0=0,this.right0=0,this.bottom0=0,this.left0=0}equals(t){return null!=t&&this.top0==t.top0&&this.right0==t.right0&&this.bottom0==t.bottom0&&this.left0==t.left0}softEquals(t,e=.001){return Math.abs(this.top0-t.top0)<e&&Math.abs(this.right0-t.right0)<e&&Math.abs(this.bottom0-t.bottom0)<e&&Math.abs(this.left0-t.left0)<e}set(t,e,o,i){this.left0=t,this.top0=e,this.right0=o,this.bottom0=i}setFrom(t){this.top0=t.top0,this.right0=t.right0,this.bottom0=t.bottom0,this.left0=t.left0,this.normalize()}normalize(){var t;this.top0>this.bottom0&&(t=this.top0,this.top0=this.bottom0,this.bottom0=t),this.left0>this.right0&&(t=this.left0,this.left0=this.right0,this.right0=t)}rotate(t,e,o){var i=t*Math.PI/180,s=Math.round(Math.cos(i)),r=Math.round(Math.sin(i)),n=this.left0-e,a=this.top0-o,l=this.right0-e,c=this.bottom0-o,p=s*n+r*a+e,u=-r*n+s*a+o,h=s*l+r*c+e,d=-r*l+s*c+o;this.left0=Math.min(p,h),this.top0=Math.min(u,d),this.right0=Math.max(p,h),this.bottom0=Math.max(u,d)}y2x(){return this.width()/this.height()}}!function(t){t.BrushSize=20,t.MaxBrushDiameter=100,t.ClientMaskAlphaFloat=.5,t.MaxSmoothingLevel=5,t.MaxBlurLevel=6,t.MaxOffset=10,t.MaxMaxNumMegapixels=25,t.BrowserChromeUrl="https://www.google.com/chrome/",t.BrowserFirefoxUrl="https://www.mozilla.org/en-US/firefox/new/",t.BrowserSafariUrl="https://www.apple.com/safari/",t.BrowserMicrosoftEdgeUrl="https://www.microsoft.com/en-us/edge",t.DefaultMaxNumMegapixels=8,t.ThumbWidth=290,t.ThumbHeight=200,t.MaxOutputWidthOrHeight=15e3,t.MaxOutputSize=33524431,t.MinDpi=1,t.MaxDpi=4e3,t.CropObjectSizePercentPadMedium=.1,t.CropObjectSizePercentPadSmall=.2,t.DefaultCropMode="CropUnconstrained",t.DefaultCropMarginUnits="CropMarginPercent",t.DefaultCropObjectSizeE="CropSizeLarge",t.DefaultCropAlignmentE="CropAlignmentMiddle",t.DefaultCropShadowsE="CropShadowsPad",t.DefaultCropAllowEnlarging=!1,t.DefaultCropFitToResult=!1,t.DefaultCropPaddingMils=50,t.DefaultCropPaddingPixels=25,t.DefaultAutoClip=!0,t.DefaultOneClickDownloadEnabled=!0,t.DefaultUseCornerDetection=!0,t.DefaultUseLocalBlur=!0,t.DefaultUseLocalSmoothing=!0,t.DefaultGlobalSmoothingLevel=1,t.DefaultGlobalBlurLevel=1,t.DefaultGlobalOffset=0,t.BulkDownloadModeSingle="BulkDownloadModeSingle",t.BulkDownloadModeZip="BulkDownloadModeZip",t.DefaultBlurModeE="BlurModeAuto",t.BlurModeFixed="BlurModeFixed",t.BlurModeAuto="BlurModeAuto",t.BlurModeLocal="BlurModeLocal",t.DefaultCastColor=16777215,t.DefaultColorCastForegroundProtection=4,t.DefaultWhiteBalanceGrayColor=16777215,t.DefaultOutputDpi=72,t.DefaultOutputColorSpaceE="ColorSpaceSrgb",t.DefaultOpaqueFileFormatE="OpaqueFileFormatJpeg",t.DefaultPngModeE="PngModeLossless",t.DefaultJpegModeE="JpegModeMoz",t.DefaultJpegQuality=75,t.JpegQualityMin=1,t.JpegQualityMax=100,t.CropPaddingMilsMax=350,t.CropPaddingPixelsMax=250,t.MaxBlurRadius=75,t.MaxMirrorShadowHeight=800,t.MaxMirrorShadowOffset=400,t.AutoLevelsMaxNumSamples=3e4,t.AutoLevelsMaxSetting=10,t.AutoLevelsPercentile=.05,t.AutoLevelsNumBuckets=1e3,t.ImagesPerZipfile=50,t.ImagesPerClipBatch=500}(_||(_={}));class Yt{constructor(t){if(this.store={},t)for(var e in t){let o=e.toString();t.hasOwnProperty(o)&&this.put(a.cast(o),t[o])}}static from(t){for(var e=new Yt,o=0;o<t.length;o++){var i=t[o];if(2==i.length){var s=i[0],r=i[1];e.put(s,r)}}return e}getOrElse(t,e){return this.contains(t)?this.get(t):e}get(t){return this.store[t.toString()]}put(t,e){return this.store[t.toString()]=e}contains(t){return this.store.hasOwnProperty(t.toString())}remove(t){return!!this.contains(t)&&(delete this.store[t.toString()],!0)}clear(){this.store={}}}class Xt{constructor(t){if(this.store={},this.size_=0,t)for(var e=0;e<t.length;e++)this.add(t[e])}size(){return this.size_}add(t){return!this.contains(t)&&(this.size_++,this.store[t.toString()]=!0)}addAll(t){let e=!0;for(let o=0;o<t.length;o++)e=e&&this.add(t[o]);return e}remove(t){return!!this.contains(t)&&(delete this.store[t.toString()],this.size_--,!0)}contains(t){return this.store.hasOwnProperty(t.toString())}}x||(x={}),function(t){const e=[],o=new Yt;t.tic=function(){e.push(Date.now())},t.toc=function(t){Date.now(),e.pop()},t.ping=function(t){var e=Date.now();if(o.contains(t))o.get(t);o.put(t,e)}}(T||(T={})),function(t){t.UseScalpelNeighborhoodUpdate=!0,t.TransparentColor="rgba(255,255,255,0.000000)",t.MaskVersion=2,t.LoupeRadius=120,t.ScreenshotMode=window.Globals.isDev&&!1,t.IncludeOriginal=!1,t.LightProgress="light-progress",t.LightConnecting="light-connecting",t.LightUpdating="light-updating",t.LightUpdated="light-updated",t.SaveSave="Save",t.SaveSaving="Saving...",t.SaveSaved="Saved",t.JPEG="JPEG",t.PNG="PNG",t.MaxBezierSetLengthForDrawingWhilePanningOrZooming=5e3,t.MaxBezierSetLengthForDrawingWhileStroking=1e4,t.Noop="Noop",t.SetTool="SetTool",t.SetGlobal="SetGlobal",t.SetUserMask="SetUserMask",t.SetEngineMask="SetEngineMask",t.SetClientRgbHistogram="SetClientRgbHistogram",t.ServerRgbHistogramResponse="ServerRgbHistogramResponse",t.RequestFullServerMask="RequestFullServerMask",t.GenerateResult="GenerateResult",t.DrawSquare="DrawSquare",t.DrawLine="DrawLine",t.Meta="Meta",t.ImageCategory="ImageCategory",t.ServerImageCategoriesKey="ServerImageCategories",t.StatusCheck="StatusCheck",t.EngineInitializing="EngineInitializing",t.EngineInitialized="EngineInitialized",t.Panic="Panic",t.Message="Message",t.SaveServerMask="SaveServerMask",t.SetSwords="SetSwords",t.SetActiveSwords="SetActiveSwords",t.SetSwordIntersections="SetSwordIntersections",t.SetDetectedCorners="SetDetectedCorners",t.SetClientShadows="SetClientShadows",t.ColorCastEstimate="ColorCastEstimate",t.WhiteBalanceEstimate="WhiteBalanceEstimate",t.DirtiesDrawCommandsSet=new Xt([t.SetGlobal,t.SetUserMask,t.DrawSquare,t.DrawLine,t.SetSwords,t.SetClientShadows]),t.Skip="Skip",t.Exiting="Exiting",t.Exit="Exit",t.Error="Error",t.MaybeSaved="MaybeSaved",t.DocumentReady="DocumentReady",t.Booted="Booted",t.SavedAndResultReady="SavedAndResultReady",t.SavedMaskUpdated="SavedMaskUpdated",t.StickySettingsUpdated="StickySettingsUpdated",t.ServerMaskReset="ServerMaskReset",t.ServerMask="ServerMask",t.ServerMaskDone="ServerMaskDone",t.BezierSet="BezierSet",t.BezierSetDone="BezierSetDone",t.UpdateComplete="UpdateComplete",t.ResultReady="ResultReady",t.ResultPending="ResultPending",t.BoundingRect="BoundingRect",t.Highlighting="Highlighting",t.UpdateImageSpec="UpdateImageSpec",t.CropUnconstrained="CropUnconstrained",t.CropLockedAspectRatio="CropLockedAspectRatio",t.CropTargetSize="CropTargetSize",t.CropMarginPixels="CropMarginPixels",t.CropMarginPercent="CropMarginPercent",t.CropSizeSmall="CropSizeSmall",t.CropSizeMedium="CropSizeMedium",t.CropSizeLarge="CropSizeLarge",t.CropAlignmentTop="CropAlignmentTop",t.CropAlignmentMiddle="CropAlignmentMiddle",t.CropAlignmentBottom="CropAlignmentBottom",t.CropShadowsIgnore="CropShadowsIgnore",t.CropShadowsPad="CropShadowsPad",t.CropShadowsTight="CropShadowsTight",t.ColorSpaceSrgb="ColorSpaceSrgb",t.ColorSpaceAdobeRgb="ColorSpaceAdobeRgb",t.ColorSpaceAppleRgb="ColorSpaceAppleRgb",t.ColorSpaceColorMatchRgb="ColorSpaceColorMatchRgb",t.OpaqueFileFormatJpeg="OpaqueFileFormatJpeg",t.OpaqueFileFormatPng="OpaqueFileFormatPng",t.JpegModeNone="JpegModeNone",t.JpegModeMoz="JpegModeMoz",t.PngModeNone="PngModeNone",t.PngModeLossless="PngModeLossless",t.PngModeLossy="PngModeLossy",t.ViewPanesSplit="ViewPanesBoth",t.ViewPanesSingle="ViewPanesMarks",t.PricingMonthly="PricingMonthly",t.PricingAnnual="PricingAnnual",t.EllipseShadowFactoryDefaults={strength:.5,core:.25},t.DropShadowFactoryDefaults={enabled:!1,cropEnabled:!1,opacity:75,blurRadius:25,offsetX:30,offsetY:30},t.MirrorShadowFactoryDefaults={enabled:!1,opacity:50,height:200,offsetY:0,mutated:!1},t.PerspectiveShadowFactoryDefaults={enabled:!1,opacity:25,opacityScale:50,blurRadius:10,blurRadiusScale:400,mutated:!1},t.FactoryDefaults={autoLevels:a.cast(!1),brushSize:t.BrushSize,globalSmoothingLevel:t.DefaultGlobalSmoothingLevel,globalBlurLevel:t.DefaultGlobalBlurLevel,globalOffset:t.DefaultGlobalOffset,rotateAngleDeg:0,straightenAngleDeg:0,brightness:0,shadows:0,highlights:0,temperature:0,saturation:0,removeColorCast:!1,castColor:t.DefaultCastColor,colorCastForegroundProtection:t.DefaultColorCastForegroundProtection,whiteBalanceEnabled:!1,whiteBalanceGrayColor:t.DefaultWhiteBalanceGrayColor,useBrush:!0,useCornerDetection:t.DefaultUseCornerDetection,blurMode:t.DefaultBlurModeE,useLocalBlur:t.DefaultUseLocalBlur,useLocalSmoothing:t.DefaultUseLocalSmoothing,backgroundColor:null,cropMode:t.DefaultCropMode,cropMarginUnits:t.DefaultCropMarginUnits,cropObjectSize:t.DefaultCropObjectSizeE,cropVerticalAlignment:t.DefaultCropAlignmentE,cropShadows:t.DefaultCropShadowsE,cropAspectRatio:null,cropTargetSize:null,cropAllowEnlarging:t.DefaultCropAllowEnlarging,cropFitToResult:t.DefaultCropFitToResult,cropPaddingMils:t.DefaultCropPaddingMils,cropPaddingPixels:t.DefaultCropPaddingPixels,cropRect_o:null,outputDpi:t.DefaultOutputDpi,outputColorSpace:t.DefaultOutputColorSpaceE,jpegQuality:t.DefaultJpegQuality,pngMode:t.DefaultPngModeE,jpegMode:t.DefaultJpegModeE,opaqueFileFormat:t.DefaultOpaqueFileFormatE,maxNumMegapixels:t.DefaultMaxNumMegapixels,preCropEnabled:!1,preCropLockAspectRatio:!1,onlyUsePhotoMode:!0,autoClip:t.DefaultAutoClip,allowLogoMode:!0,allowScanMode:!0,autoHair:!0,oneClickDownloadEnabled:t.DefaultOneClickDownloadEnabled,viewPanesMode:t.ViewPanesSplit,ellipseShadow:t.EllipseShadowFactoryDefaults,dropShadow:t.DropShadowFactoryDefaults,mirrorShadow:t.MirrorShadowFactoryDefaults,perspectiveShadow:t.PerspectiveShadowFactoryDefaults},t.AspectRatios=[{w:1,h:1},{w:5,h:4},{w:4,h:3},{w:3,h:2},{w:1.618,h:1},{w:16,h:9}],t.TargetSizes=[{w:640,h:360},{w:851,h:315},{w:1920,h:1080},{w:2048,h:2048},{w:3e3,h:3e3}],t.LineOuterWidth=3.5,t.LineInnerWidth=2,t.isBulkLike=function(){return(window.Globals.Bulk.isIframe||window.Globals.Bulk.isApi)&&!window.Globals.Bulk.isApiSingle},t.isRegularAppMode=function(){let t=window.Globals.Bulk;return!t.isIframe&&!t.isApi},t.isBulkAppMode=function(){let t=window.Globals.Bulk;return t.isIframe&&!t.isApi},t.isBulkOrApi=function(){return window.Globals.Bulk.isIframe||window.Globals.Bulk.isApi}}(_||(_={})),function(t){let e,o,i,s,r,n,a,l,c,p,u,h,d,g,m,f,S,w,C,y,b,v,A,k,M;t.AppContent=t.id("AppContent"),t.AppOuterWrapper=t.id("AppOuterWrapper"),t.AppView=t.id("AppView"),t.AppWrapper=t.id("AppWrapper"),t.BulkLoadingErrorMessage=t.id("BulkLoadingErrorMessage"),t.BulkStatus=t.id("BulkStatus"),t.GuideLightbox=t.id("GuideLightbox"),t.GuideLightboxOuter=t.id("GuideLightboxOuter"),t.ImageColorCorrectionNotification=t.id("ImageColorCorrectionNotification"),t.ImageResizeNotification=t.id("ImageResizeNotification"),t.StickySettingsLightbox=t.id("StickySettingsLightbox"),t.SubappLightbox=t.id("subapp-lightbox"),t.TopAnimationImage=t.id("TopAnimationImage"),t.TutorialLightboxOuter=t.id("TutorialLightboxOuter"),t.UnpaidApiSubscription=t.id("UnpaidApiSubscription"),t.active=t.c("active"),t.ajax_loading=t.c("ajax-loading"),t.allow_auto_hair_checkbox=t.c("allow_auto_hair_checkbox"),t.allow_logo_mode_checkbox=t.c("allow_logo_mode_checkbox"),t.allow_scan_mode_checkbox=t.c("allow_scan_mode_checkbox"),t.app_starter=t.c("app_starter"),t.arrow=t.c("arrow"),t.autoClipDisabled=t.c("autoClipDisabled"),t.autoClipEnabled=t.c("autoClipEnabled"),t.bttn=t.c("bttn"),t.bttn_dark=t.c("bttn_dark"),t.bttn_icon_left=t.c("bttn_icon_left"),t.bttn_icon_right=t.c("bttn_icon_right"),t.bttn_short=t.c("bttn_short"),t.bttn_white=t.c("bttn_white"),t.bttn_wire=t.c("bttn_wire"),t.bttn_wire_white=t.c("bttn_wire_white"),t.bulk_download_button=t.c("bulk_download_button"),t.bulk_status_display=t.c("bulk_status_display"),t.cancel_upload=t.c("cancel_upload"),t.cannot_run_app=t.c("cannot_run_app"),t.disabled=t.c("disabled"),t.drop_ready=t.c("drop_ready"),t.dropdown_auto=t.c("dropdown_auto"),t.enable_auto_clip_checkbox=t.c("enable_auto_clip_checkbox"),t.enable_one_click_download_checkbox=t.c("enable_one_click_download_checkbox"),t.exclusive_group=t.c("exclusive-group"),t.exit_app=t.c("exit_app"),t.force_exit=t.c("force_exit"),t.guide_next_button=t.c("guide_next_button"),t.hide_bottom_toolbar=t.c("hide_bottom_toolbar"),t.modern_menu=t.c("modern_menu"),t.one_click_download_enabled=t.c("one_click_download_enabled"),t.only_use_photo_mode_checkbox=t.c("only_use_photo_mode_checkbox"),t.popover=t.c("popover"),t.popover_button=t.c("popover-button"),t.popover_dismiss=t.c("popover_dismiss"),t.popover_toolbar_no_auto_dismiss=t.c("popover_toolbar_no_auto_dismiss"),t.pre_crop_enabled_checkbox=t.c("pre_crop_enabled_checkbox"),t.returnUrlForm=t.c("returnUrlForm"),t.sticky_outline_active=t.c("sticky_outline_active"),t.sticky_settings=t.c("sticky_settings"),t.sticky_settings_close=t.c("sticky_settings_close"),t.subapp_sidebar=t.c("subapp_sidebar"),t.tabLink=t.c("tabLink"),t.video_green_lightbox=t.id("video_green_lightbox"),t.viewport_vertical=t.c("viewport_vertical"),function(e){let o,i;!function(e){let o;var i;let s;(i=o=e.Dialog||(e.Dialog={})).Dialog=t.id("Bulk-Download-Dialog-Dialog"),i.DownloadLink=t.id("Bulk-Download-Dialog-DownloadLink"),i.Empty=t.id("Bulk-Download-Dialog-Empty"),i.Error=t.id("Bulk-Download-Dialog-Error"),i.ErrorMsg=t.id("Bulk-Download-Dialog-ErrorMsg"),i.Progress=t.id("Bulk-Download-Dialog-Progress"),i.Ready=t.id("Bulk-Download-Dialog-Ready"),i.Single=t.id("Bulk-Download-Dialog-Single"),i.SingleDownloadLink=t.id("Bulk-Download-Dialog-SingleDownloadLink"),i.Waiting=t.id("Bulk-Download-Dialog-Waiting"),i.state=t.c("Bulk-Download-Dialog-state"),function(e){e.group=t.c("Bulk-Download-Mode-group"),e.single=t.c("Bulk-Download-Mode-single"),e.zip=t.c("Bulk-Download-Mode-zip")}(s=e.Mode||(e.Mode={}))}(o=e.Download||(e.Download={})),function(e){e.Dialog=t.id("Bulk-Upload-Dialog"),e.DialogBody=t.id("Bulk-Upload-DialogBody"),e.StartClippingButton=t.id("Bulk-Upload-StartClippingButton")}(i=e.Upload||(e.Upload={}))}(e=t.Bulk||(t.Bulk={})),function(e){let o,i,s,r,n,a,l,c,p,u,h,d,g,m,f,S;e.dropdown_open=t.c("CmApp-dropdown_open"),e.tool_popover_content=t.c("CmApp-tool_popover_content"),function(e){e.OriginalButton=t.id("CmApp-BackgroundApp-OriginalButton"),e.Sidebar=t.id("CmApp-BackgroundApp-Sidebar"),e.Tab=t.id("CmApp-BackgroundApp-Tab"),e.close_button=t.c("CmApp-BackgroundApp-close_button"),e.reset_button=t.c("CmApp-BackgroundApp-reset_button")}(o=e.BackgroundApp||(e.BackgroundApp={})),function(e){let o;e.ColorPicker=t.id("color-picker-ui"),e.ColorPickerPopover=t.id("color-picker-ui-popover"),e.CurrentColor=t.id("CmApp-BgColor-CurrentColor"),e.Custom=t.id("background-color-swatch-button-custom"),e.in_bg_app=t.c("CmApp-BgColor-in_bg_app"),e.in_popover=t.c("CmApp-BgColor-in_popover"),e.swatch=t.c("swatch"),function(e){e.Button=t.id("CmApp-BgColor-Popover-Button"),e.Popover=t.id("CmApp-BgColor-Popover-Popover")}(o||(o={})),e.Popover=o}(i=e.BgColor||(e.BgColor={})),function(e){let o,i;e.brush_size_button=t.c("CmApp-Brush-brush_size_button"),function(e){e.Button=t.id("CmApp-Brush-Popover-Button"),e.Popover=t.id("CmApp-Brush-Popover-Popover")}(o||(o={})),e.Popover=o,function(e){e.container=t.c("CmApp-Brush-Size-container"),e.decrease=t.c("CmApp-Brush-Size-decrease"),e.display=t.c("CmApp-Brush-Size-display"),e.increase=t.c("CmApp-Brush-Size-increase"),e.reset=t.c("CmApp-Brush-Size-reset")}(i||(i={})),e.Size=i}(s=e.Brush||(e.Brush={})),function(e){e.disableInLogoMode=t.c("CmApp-Cat-disableInLogoMode"),e.disableInScanMode=t.c("CmApp-Cat-disableInScanMode"),e.isLogoMode=t.c("CmApp-Cat-isLogoMode"),e.isPhotoMode=t.c("CmApp-Cat-isPhotoMode"),e.isScanMode=t.c("CmApp-Cat-isScanMode"),e.logoMode=t.c("CmApp-Cat-logoMode"),e.photoMode=t.c("CmApp-Cat-photoMode"),e.scanMode=t.c("CmApp-Cat-scanMode")}(r=e.Cat||(e.Cat={})),function(e){let o,i,s,r;e.OriginalButton=t.id("CmApp-ColorsApp-OriginalButton"),e.Sidebar=t.id("CmApp-ColorsApp-Sidebar"),e.Tab=t.id("CmApp-ColorsApp-Tab"),e.close_button=t.c("CmApp-ColorsApp-close_button"),e.reset_button=t.c("CmApp-ColorsApp-reset_button"),function(e){let o;e.RemovalEnabled=t.id("CmApp-ColorsApp-ColorCast-RemovalEnabled"),e.Swatch=t.id("CmApp-ColorsApp-ColorCast-Swatch"),e.controls=t.c("CmApp-ColorsApp-ColorCast-controls"),function(e){e.container=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-container"),e.decrease=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-decrease"),e.display=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-display"),e.increase=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-increase"),e.reset=t.c("CmApp-ColorsApp-ColorCast-ForegroundProtection-reset")}(o||(o={})),e.ForegroundProtection=o}(o=e.ColorCast||(e.ColorCast={})),function(e){let o,i,s,r,n;e.auto=t.c("CmApp-ColorsApp-ColorLevels-auto"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-reset"),function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-brightness-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-brightness-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-brightness-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-brightness-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-brightness-reset")}(o||(o={})),e.brightness=o,function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-highlights-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-highlights-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-highlights-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-highlights-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-highlights-reset")}(i||(i={})),e.highlights=i,function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-saturation-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-saturation-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-saturation-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-saturation-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-saturation-reset")}(s||(s={})),e.saturation=s,function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-shadows-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-shadows-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-shadows-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-shadows-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-shadows-reset")}(r||(r={})),e.shadows=r,function(e){e.container=t.c("CmApp-ColorsApp-ColorLevels-temperature-container"),e.decrease=t.c("CmApp-ColorsApp-ColorLevels-temperature-decrease"),e.display=t.c("CmApp-ColorsApp-ColorLevels-temperature-display"),e.increase=t.c("CmApp-ColorsApp-ColorLevels-temperature-increase"),e.reset=t.c("CmApp-ColorsApp-ColorLevels-temperature-reset"),e.swatch=t.c("CmApp-ColorsApp-ColorLevels-temperature-swatch")}(n||(n={})),e.temperature=n}(i=e.ColorLevels||(e.ColorLevels={})),function(e){e.AdobeRgb=t.c("CmApp-ColorsApp-ColorSpace-AdobeRgb"),e.AppleRgb=t.c("CmApp-ColorsApp-ColorSpace-AppleRgb"),e.ColorMatchRgb=t.c("CmApp-ColorsApp-ColorSpace-ColorMatchRgb"),e.SRgb=t.c("CmApp-ColorsApp-ColorSpace-SRgb"),e.button=t.c("CmApp-ColorsApp-ColorSpace-button"),e.display=t.c("CmApp-ColorsApp-ColorSpace-display")}(s=e.ColorSpace||(e.ColorSpace={})),function(e){e.Enabled=t.id("CmApp-ColorsApp-WhiteBalance-Enabled"),e.Swatch=t.id("CmApp-ColorsApp-WhiteBalance-Swatch"),e.controls=t.c("CmApp-ColorsApp-WhiteBalance-controls")}(r=e.WhiteBalance||(e.WhiteBalance={}))}(n=e.ColorsApp||(e.ColorsApp={})),function(e){let o,i,s,r,n,a,l,c,p,u,h,d,g;e.FitToResultButton=t.id("CmApp-CropApp-FitToResultButton"),e.Sidebar=t.id("CmApp-CropApp-Sidebar"),e.Tab=t.id("CmApp-CropApp-Tab"),e.allow_enlarging_result=t.c("CmApp-CropApp-allow_enlarging_result"),e.close_button=t.c("CmApp-CropApp-close_button"),e.fit_to_original_btn=t.c("CmApp-CropApp-fit_to_original_btn"),e.fit_to_result_comment=t.c("CmApp-CropApp-fit_to_result_comment"),e.fit_to_result_controls=t.c("CmApp-CropApp-fit_to_result_controls"),e.locked_aspect_ratio_display=t.c("CmApp-CropApp-locked_aspect_ratio_display"),e.output_size_display=t.c("CmApp-CropApp-output_size_display"),e.reset_button=t.c("CmApp-CropApp-reset_button"),e.target_size_display=t.c("CmApp-CropApp-target_size_display"),function(e){e.H=t.id("CmApp-CropApp-AspectRatio-H"),e.HFg=t.id("CmApp-CropApp-AspectRatio-HFg"),e.Lightbox=t.id("CmApp-CropApp-AspectRatio-Lightbox"),e.List=t.id("CmApp-CropApp-AspectRatio-List"),e.OkButton=t.id("CmApp-CropApp-AspectRatio-OkButton"),e.W=t.id("CmApp-CropApp-AspectRatio-W"),e.WFg=t.id("CmApp-CropApp-AspectRatio-WFg")}(o=e.AspectRatio||(e.AspectRatio={})),function(e){e.container=t.c("CmApp-CropApp-Dpi-container"),e.decrease=t.c("CmApp-CropApp-Dpi-decrease"),e.display=t.c("CmApp-CropApp-Dpi-display"),e.increase=t.c("CmApp-CropApp-Dpi-increase"),e.reset=t.c("CmApp-CropApp-Dpi-reset")}(i||(i={})),e.Dpi=i,function(e){e.preset300=t.c("CmApp-CropApp-DpiPresets-preset300"),e.preset72=t.c("CmApp-CropApp-DpiPresets-preset72"),e.preset96=t.c("CmApp-CropApp-DpiPresets-preset96")}(s=e.DpiPresets||(e.DpiPresets={})),function(e){e.Percent=t.c("CmApp-CropApp-MarginUnits-Percent"),e.Pixels=t.c("CmApp-CropApp-MarginUnits-Pixels"),e.group=t.c("CmApp-CropApp-MarginUnits-group")}(r=e.MarginUnits||(e.MarginUnits={})),function(e){e.LockedAspectRatio=t.c("CmApp-CropApp-Mode-LockedAspectRatio"),e.TargetSize=t.c("CmApp-CropApp-Mode-TargetSize"),e.Unconstrained=t.c("CmApp-CropApp-Mode-Unconstrained"),e.group=t.c("CmApp-CropApp-Mode-group")}(n=e.Mode||(e.Mode={})),function(e){e.Large=t.c("CmApp-CropApp-ObjectSize-Large"),e.Medium=t.c("CmApp-CropApp-ObjectSize-Medium"),e.Small=t.c("CmApp-CropApp-ObjectSize-Small"),e.group=t.c("CmApp-CropApp-ObjectSize-group")}(a=e.ObjectSize||(e.ObjectSize={})),function(e){e.container=t.c("CmApp-CropApp-PaddingPercent-container"),e.decrease=t.c("CmApp-CropApp-PaddingPercent-decrease"),e.display=t.c("CmApp-CropApp-PaddingPercent-display"),e.increase=t.c("CmApp-CropApp-PaddingPercent-increase"),e.reset=t.c("CmApp-CropApp-PaddingPercent-reset")}(l||(l={})),e.PaddingPercent=l,function(e){e.container=t.c("CmApp-CropApp-PaddingPixels-container"),e.decrease=t.c("CmApp-CropApp-PaddingPixels-decrease"),e.display=t.c("CmApp-CropApp-PaddingPixels-display"),e.increase=t.c("CmApp-CropApp-PaddingPixels-increase"),e.reset=t.c("CmApp-CropApp-PaddingPixels-reset")}(c||(c={})),e.PaddingPixels=c,function(e){e.container=t.c("CmApp-CropApp-RotateSpinner-container"),e.decrease=t.c("CmApp-CropApp-RotateSpinner-decrease"),e.display=t.c("CmApp-CropApp-RotateSpinner-display"),e.increase=t.c("CmApp-CropApp-RotateSpinner-increase"),e.reset=t.c("CmApp-CropApp-RotateSpinner-reset")}(p||(p={})),e.RotateSpinner=p,function(e){e.Ignore=t.c("CmApp-CropApp-Shadows-Ignore"),e.Pad=t.c("CmApp-CropApp-Shadows-Pad"),e.Tight=t.c("CmApp-CropApp-Shadows-Tight"),e.group=t.c("CmApp-CropApp-Shadows-group")}(u=e.Shadows||(e.Shadows={})),function(e){e.container=t.c("CmApp-CropApp-StraightenSpinner-container"),e.decrease=t.c("CmApp-CropApp-StraightenSpinner-decrease"),e.display=t.c("CmApp-CropApp-StraightenSpinner-display"),e.increase=t.c("CmApp-CropApp-StraightenSpinner-increase"),e.reset=t.c("CmApp-CropApp-StraightenSpinner-reset")}(h||(h={})),e.StraightenSpinner=h,function(e){e.H=t.id("CmApp-CropApp-TargetSize-H"),e.HFg=t.id("CmApp-CropApp-TargetSize-HFg"),e.Lightbox=t.id("CmApp-CropApp-TargetSize-Lightbox"),e.List=t.id("CmApp-CropApp-TargetSize-List"),e.OkButton=t.id("CmApp-CropApp-TargetSize-OkButton"),e.W=t.id("CmApp-CropApp-TargetSize-W"),e.WFg=t.id("CmApp-CropApp-TargetSize-WFg")}(d=e.TargetSize||(e.TargetSize={})),function(e){e.Bottom=t.c("CmApp-CropApp-VerticalAlignment-Bottom"),e.Middle=t.c("CmApp-CropApp-VerticalAlignment-Middle"),e.Top=t.c("CmApp-CropApp-VerticalAlignment-Top"),e.group=t.c("CmApp-CropApp-VerticalAlignment-group")}(g=e.VerticalAlignment||(e.VerticalAlignment={}))}(a=e.CropApp||(e.CropApp={})),function(e){e.viewport_set=t.c("CmApp-Dev-viewport_set")}(l=e.Dev||(e.Dev={})),function(e){let o;e.revert=t.c("CmApp-Ecommerce-revert"),e.set=t.c("CmApp-Ecommerce-set"),function(e){e.Button=t.id("CmApp-Ecommerce-Popover-Button"),e.Popover=t.id("CmApp-Ecommerce-Popover-Popover")}(o||(o={})),e.Popover=o}(c=e.Ecommerce||(e.Ecommerce={})),function(e){let o,i,s,r;e.BlurModeAuto=t.id("CmApp-Edges-BlurModeAuto"),e.BlurModeFixed=t.id("CmApp-Edges-BlurModeFixed"),e.BlurModeLocal=t.id("CmApp-Edges-BlurModeLocal"),e.blur_mode=t.c("CmApp-Edges-blur_mode"),function(e){e.container=t.c("CmApp-Edges-FeatheringRadius-container"),e.decrease=t.c("CmApp-Edges-FeatheringRadius-decrease"),e.display=t.c("CmApp-Edges-FeatheringRadius-display"),e.increase=t.c("CmApp-Edges-FeatheringRadius-increase"),e.reset=t.c("CmApp-Edges-FeatheringRadius-reset")}(o||(o={})),e.FeatheringRadius=o,function(e){e.container=t.c("CmApp-Edges-Offset-container"),e.decrease=t.c("CmApp-Edges-Offset-decrease"),e.display=t.c("CmApp-Edges-Offset-display"),e.increase=t.c("CmApp-Edges-Offset-increase"),e.reset=t.c("CmApp-Edges-Offset-reset")}(i||(i={})),e.Offset=i,function(e){e.Button=t.id("CmApp-Edges-Popover-Button"),e.Popover=t.id("CmApp-Edges-Popover-Popover")}(s||(s={})),e.Popover=s,function(e){e.container=t.c("CmApp-Edges-Smoothing-container"),e.decrease=t.c("CmApp-Edges-Smoothing-decrease"),e.display=t.c("CmApp-Edges-Smoothing-display"),e.increase=t.c("CmApp-Edges-Smoothing-increase"),e.reset=t.c("CmApp-Edges-Smoothing-reset")}(r||(r={})),e.Smoothing=r}(p=e.Edges||(e.Edges={})),function(e){let o;e.hovered=t.c("CmApp-Hair-hovered"),function(e){e.Button=t.id("CmApp-Hair-Popover-Button"),e.Popover=t.id("CmApp-Hair-Popover-Popover")}(o||(o={})),e.Popover=o}(u=e.Hair||(e.Hair={})),function(e){e.Button=t.id("CmApp-Help-Button"),e.Popover=t.id("CmApp-Help-Popover"),e.button=t.c("CmApp-Help-button"),e.scroll_crop=t.c("CmApp-Help-scroll_crop")}(h=e.Help||(e.Help={})),function(e){let o,i;!function(e){e.Button=t.id("CmApp-Review-Popover-Button"),e.Popover=t.id("CmApp-Review-Popover-Popover")}(o||(o={})),e.Popover=o,function(e){e.backward=t.c("CmApp-Review-Spinner-backward"),e.forward=t.c("CmApp-Review-Spinner-forward")}(i=e.Spinner||(e.Spinner={}))}(d=e.Review||(e.Review={})),function(e){let o,i,s,r;e.PreviewButton=t.id("CmApp-ShadowApp-PreviewButton"),e.ResetButton=t.id("CmApp-ShadowApp-ResetButton"),e.Sidebar=t.id("CmApp-ShadowApp-Sidebar"),e.Tab=t.id("CmApp-ShadowApp-Tab"),e.TabLink=t.id("CmApp-ShadowApp-TabLink"),e.close_button=t.c("CmApp-ShadowApp-close_button"),function(e){let o,i,s;e.CropEnabled=t.id("CmApp-ShadowApp-DropShadow-CropEnabled"),e.Enabled=t.id("CmApp-ShadowApp-DropShadow-Enabled"),e.UpdatingIndicator=t.id("CmApp-ShadowApp-DropShadow-UpdatingIndicator"),e.controls=t.c("CmApp-ShadowApp-DropShadow-controls"),e.crop_enabled=t.c("CmApp-ShadowApp-DropShadow-crop_enabled"),e.crop_enabled_display=t.c("CmApp-ShadowApp-DropShadow-crop_enabled_display"),e.offset_display=t.c("CmApp-ShadowApp-DropShadow-offset_display"),e.offset_down=t.c("CmApp-ShadowApp-DropShadow-offset_down"),e.offset_down_left=t.c("CmApp-ShadowApp-DropShadow-offset_down_left"),e.offset_down_right=t.c("CmApp-ShadowApp-DropShadow-offset_down_right"),function(e){e.down=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-down"),e.left=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-left"),e.right=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-right"),e.up=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-up"),e.zero=t.c("CmApp-ShadowApp-DropShadow-ArrowControl-zero")}(o=e.ArrowControl||(e.ArrowControl={})),function(e){e.container=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-container"),e.decrease=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-decrease"),e.display=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-display"),e.increase=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-increase"),e.reset=t.c("CmApp-ShadowApp-DropShadow-BlurRadius-reset")}(i||(i={})),e.BlurRadius=i,function(e){e.container=t.c("CmApp-ShadowApp-DropShadow-Opacity-container"),e.decrease=t.c("CmApp-ShadowApp-DropShadow-Opacity-decrease"),e.display=t.c("CmApp-ShadowApp-DropShadow-Opacity-display"),e.increase=t.c("CmApp-ShadowApp-DropShadow-Opacity-increase"),e.reset=t.c("CmApp-ShadowApp-DropShadow-Opacity-reset")}(s||(s={})),e.Opacity=s}(o=e.DropShadow||(e.DropShadow={})),function(e){let o,i;e.Container=t.id("CmApp-ShadowApp-EllipseShadow-Container"),function(e){e.container=t.c("CmApp-ShadowApp-EllipseShadow-Core-container"),e.decrease=t.c("CmApp-ShadowApp-EllipseShadow-Core-decrease"),e.display=t.c("CmApp-ShadowApp-EllipseShadow-Core-display"),e.increase=t.c("CmApp-ShadowApp-EllipseShadow-Core-increase"),e.reset=t.c("CmApp-ShadowApp-EllipseShadow-Core-reset")}(o||(o={})),e.Core=o,function(e){e.container=t.c("CmApp-ShadowApp-EllipseShadow-Strength-container"),e.decrease=t.c("CmApp-ShadowApp-EllipseShadow-Strength-decrease"),e.display=t.c("CmApp-ShadowApp-EllipseShadow-Strength-display"),e.increase=t.c("CmApp-ShadowApp-EllipseShadow-Strength-increase"),e.reset=t.c("CmApp-ShadowApp-EllipseShadow-Strength-reset")}(i||(i={})),e.Strength=i}(i=e.EllipseShadow||(e.EllipseShadow={})),function(e){let o,i,s;e.Enabled=t.id("CmApp-ShadowApp-MirrorShadow-Enabled"),e.UpdatingIndicator=t.id("CmApp-ShadowApp-MirrorShadow-UpdatingIndicator"),e.controls=t.c("CmApp-ShadowApp-MirrorShadow-controls"),function(e){e.container=t.c("CmApp-ShadowApp-MirrorShadow-Height-container"),e.decrease=t.c("CmApp-ShadowApp-MirrorShadow-Height-decrease"),e.display=t.c("CmApp-ShadowApp-MirrorShadow-Height-display"),e.increase=t.c("CmApp-ShadowApp-MirrorShadow-Height-increase"),e.reset=t.c("CmApp-ShadowApp-MirrorShadow-Height-reset")}(o||(o={})),e.Height=o,function(e){e.container=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-container"),e.decrease=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-decrease"),e.display=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-display"),e.increase=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-increase"),e.reset=t.c("CmApp-ShadowApp-MirrorShadow-OffsetY-reset")}(i||(i={})),e.OffsetY=i,function(e){e.container=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-container"),e.decrease=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-decrease"),e.display=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-display"),e.increase=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-increase"),e.reset=t.c("CmApp-ShadowApp-MirrorShadow-Opacity-reset")}(s||(s={})),e.Opacity=s}(s=e.MirrorShadow||(e.MirrorShadow={})),function(e){let o,i,s,r;e.Enabled=t.id("CmApp-ShadowApp-PerspectiveShadow-Enabled"),e.UpdatingIndicator=t.id("CmApp-ShadowApp-PerspectiveShadow-UpdatingIndicator"),e.controls=t.c("CmApp-ShadowApp-PerspectiveShadow-controls"),function(e){e.container=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-container"),e.decrease=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-decrease"),e.display=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-display"),e.increase=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-increase"),e.reset=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadius-reset")}(o||(o={})),e.BlurRadius=o,function(e){e.container=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-container"),e.decrease=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-decrease"),e.display=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-display"),e.increase=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-increase"),e.reset=t.c("CmApp-ShadowApp-PerspectiveShadow-BlurRadiusScale-reset")}(i||(i={})),e.BlurRadiusScale=i,function(e){e.container=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-container"),e.decrease=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-decrease"),e.display=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-display"),e.increase=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-increase"),e.reset=t.c("CmApp-ShadowApp-PerspectiveShadow-OpacityScale-reset")}(s||(s={})),e.OpacityScale=s,function(e){e.container=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-container"),e.decrease=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-decrease"),e.display=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-display"),e.increase=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-increase"),e.reset=t.c("CmApp-ShadowApp-PerspectiveShadow-ShadowOpacity-reset")}(r||(r={})),e.ShadowOpacity=r}(r=e.PerspectiveShadow||(e.PerspectiveShadow={}))}(g=e.ShadowApp||(e.ShadowApp={})),function(e){e.auto_clip=t.c("CmApp-Sidebar-auto_clip"),e.container=t.c("CmApp-Sidebar-container"),e.marks=t.c("CmApp-Sidebar-marks"),e.mode_container=t.c("CmApp-Sidebar-mode_container"),e.preview=t.c("CmApp-Sidebar-preview"),e.selected=t.c("CmApp-Sidebar-selected"),e.viewOriginal=t.c("CmApp-Sidebar-viewOriginal")}(m=e.Sidebar||(e.Sidebar={})),function(e){e.tab=t.c("CmApp-SubApps-tab")}(f=e.SubApps||(e.SubApps={})),function(e){e.ColorPicker=t.id("color-picker-color"),e.brush=t.c("CmApp-Tools-brush"),e.clear_all_edits=t.c("CmApp-Tools-clear_all_edits"),e.clear_user_mask_tool=t.c("CmApp-Tools-clear_user_mask_tool"),e.copy_mask_tool=t.c("CmApp-Tools-copy_mask_tool"),e.download=t.c("CmApp-Tools-download"),e.ecommerce=t.c("CmApp-Tools-ecommerce"),e.editMenu=t.c("CmApp-Tools-editMenu"),e.paste_mask_tool=t.c("CmApp-Tools-paste_mask_tool"),e.redo=t.c("CmApp-Tools-redo"),e.redoMenuItem=t.c("CmApp-Tools-redoMenuItem"),e.review=t.c("CmApp-Tools-review"),e.save=t.c("CmApp-Tools-save"),e.show_background_app_button=t.c("CmApp-Tools-show_background_app_button"),e.show_colors_app_button=t.c("CmApp-Tools-show_colors_app_button"),e.show_crop_app_button=t.c("CmApp-Tools-show_crop_app_button"),e.show_shadow_app_button=t.c("CmApp-Tools-show_shadow_app_button"),e.skip=t.c("CmApp-Tools-skip"),e.subapp_zoom_in=t.c("CmApp-Tools-subapp_zoom_in"),e.subapp_zoom_out=t.c("CmApp-Tools-subapp_zoom_out"),e.subapp_zoom_to_fit=t.c("CmApp-Tools-subapp_zoom_to_fit"),e.undo=t.c("CmApp-Tools-undo"),e.undoMenuItem=t.c("CmApp-Tools-undoMenuItem"),e.zoom_in=t.c("CmApp-Tools-zoom_in"),e.zoom_out=t.c("CmApp-Tools-zoom_out"),e.zoom_to_fit=t.c("CmApp-Tools-zoom_to_fit")}(S=e.Tools||(e.Tools={}))}(o=t.CmApp||(t.CmApp={})),function(e){let o,i,s,r,n,a;!function(e){e.group=t.c("ExportOptions-JpegOptimization-group"),e.moz=t.c("ExportOptions-JpegOptimization-moz"),e.none=t.c("ExportOptions-JpegOptimization-none")}(o=e.JpegOptimization||(e.JpegOptimization={})),function(e){e.container=t.c("ExportOptions-JpgQuality-container"),e.decrease=t.c("ExportOptions-JpgQuality-decrease"),e.display=t.c("ExportOptions-JpgQuality-display"),e.increase=t.c("ExportOptions-JpgQuality-increase"),e.reset=t.c("ExportOptions-JpgQuality-reset")}(i||(i={})),e.JpgQuality=i,function(e){e.preset100=t.c("ExportOptions-JpgQualityPresets-preset100"),e.preset25=t.c("ExportOptions-JpgQualityPresets-preset25"),e.preset50=t.c("ExportOptions-JpgQualityPresets-preset50"),e.preset75=t.c("ExportOptions-JpgQualityPresets-preset75"),e.preset90=t.c("ExportOptions-JpgQualityPresets-preset90")}(s=e.JpgQualityPresets||(e.JpgQualityPresets={})),function(e){let o,i,s,r;e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-comment"),e.emphasize=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-emphasize"),function(e){e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-ColorSpace-comment")}(o=e.ColorSpace||(e.ColorSpace={})),function(e){e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-Dpi-comment")}(i=e.Dpi||(e.Dpi={})),function(e){e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-Jpeg-comment")}(s=e.Jpeg||(e.Jpeg={})),function(e){e.comment=t.c("ExportOptions-NoColorSpaceOrDpiInOptimizedOutput-Png-comment")}(r=e.Png||(e.Png={}))}(r=e.NoColorSpaceOrDpiInOptimizedOutput||(e.NoColorSpaceOrDpiInOptimizedOutput={})),function(e){e.group=t.c("ExportOptions-OpaqueFormat-group"),e.jpg=t.c("ExportOptions-OpaqueFormat-jpg"),e.png=t.c("ExportOptions-OpaqueFormat-png")}(n=e.OpaqueFormat||(e.OpaqueFormat={})),function(e){e.group=t.c("ExportOptions-PngOptimization-group"),e.lossless=t.c("ExportOptions-PngOptimization-lossless"),e.lossy=t.c("ExportOptions-PngOptimization-lossy"),e.none=t.c("ExportOptions-PngOptimization-none")}(a=e.PngOptimization||(e.PngOptimization={}))}(i=t.ExportOptions||(t.ExportOptions={})),function(e){let o;e.Field=t.id("FileInput-Field"),e.PasteTarget=t.id("FileInput-PasteTarget"),e.click_to_upload=t.c("FileInput-click_to_upload"),function(e){e.show_dialog=t.c("FileInput-UploadFromWeb-show_dialog")}(o=e.UploadFromWeb||(e.UploadFromWeb={}))}(s=t.FileInput||(t.FileInput={})),function(e){e.admin_show_original=t.c("ImageThumbs-admin_show_original"),e.admin_show_original_button=t.c("ImageThumbs-admin_show_original_button")}(r=t.ImageThumbs||(t.ImageThumbs={})),function(e){e.active_key=t.c("MainUploadTarget-active_key"),e.ctl_key=t.c("MainUploadTarget-ctl_key"),e.jsNotInitializedYet=t.c("MainUploadTarget-jsNotInitializedYet"),e.paste_buttons=t.c("MainUploadTarget-paste_buttons"),e.pasted=t.c("MainUploadTarget-pasted"),e.v_key=t.c("MainUploadTarget-v_key"),e.wrong_shake=t.c("MainUploadTarget-wrong_shake")}(n=t.MainUploadTarget||(t.MainUploadTarget={})),function(e){e.container=t.c("MaxNumMegapixels-container"),e.decrease=t.c("MaxNumMegapixels-decrease"),e.display=t.c("MaxNumMegapixels-display"),e.increase=t.c("MaxNumMegapixels-increase"),e.reset=t.c("MaxNumMegapixels-reset")}(a||(a={})),t.MaxNumMegapixels=a,function(e){let o;!function(e){e.active=t.c("Modal-Show-active")}(o=e.Show||(e.Show={}))}(l=t.Modal||(t.Modal={})),function(e){let o;e.App=t.id("PreCrop-App"),e.ViewContainer=t.id("PreCrop-ViewContainer"),function(e){let o;e.cancel_button=t.c("PreCrop-Sidebar-cancel_button"),e.crop_button=t.c("PreCrop-Sidebar-crop_button"),e.cropped_image_aspect_ratio_display=t.c("PreCrop-Sidebar-cropped_image_aspect_ratio_display"),e.cropped_image_megapixels_display=t.c("PreCrop-Sidebar-cropped_image_megapixels_display"),e.cropped_image_size_display=t.c("PreCrop-Sidebar-cropped_image_size_display"),e.cropped_image_success=t.c("PreCrop-Sidebar-cropped_image_success"),e.cropped_image_warning=t.c("PreCrop-Sidebar-cropped_image_warning"),e.input_image_aspect_ratio_display=t.c("PreCrop-Sidebar-input_image_aspect_ratio_display"),e.input_image_megapixels_display=t.c("PreCrop-Sidebar-input_image_megapixels_display"),e.input_image_size_display=t.c("PreCrop-Sidebar-input_image_size_display"),e.lock_aspect_ratio_button=t.c("PreCrop-Sidebar-lock_aspect_ratio_button"),function(e){e.container=t.c("PreCrop-Sidebar-MaxNumMegapixels-container"),e.decrease=t.c("PreCrop-Sidebar-MaxNumMegapixels-decrease"),e.display=t.c("PreCrop-Sidebar-MaxNumMegapixels-display"),e.increase=t.c("PreCrop-Sidebar-MaxNumMegapixels-increase"),e.reset=t.c("PreCrop-Sidebar-MaxNumMegapixels-reset")}(o||(o={})),e.MaxNumMegapixels=o}(o=e.Sidebar||(e.Sidebar={}))}(c=t.PreCrop||(t.PreCrop={})),function(e){e.DefaultSettingsTab=t.id("PreferencesDialog-DefaultSettingsTab"),e.ExportOptionsTab=t.id("PreferencesDialog-ExportOptionsTab"),e.ImportOptionsTab=t.id("PreferencesDialog-ImportOptionsTab"),e.open=t.c("PreferencesDialog-open"),e.openExportOptions=t.c("PreferencesDialog-openExportOptions"),e.openImportOptions=t.c("PreferencesDialog-openImportOptions")}(p=t.PreferencesDialog||(t.PreferencesDialog={})),function(e){e.period_annual=t.c("PricingPanel-period_annual"),e.period_annual_container=t.c("PricingPanel-period_annual_container"),e.period_group=t.c("PricingPanel-period_group"),e.period_monthly=t.c("PricingPanel-period_monthly"),e.period_monthly_container=t.c("PricingPanel-period_monthly_container")}(u=t.PricingPanel||(t.PricingPanel={})),function(e){e.Body=t.id("RetryDialog-Body"),e.Countdown=t.id("RetryDialog-Countdown"),e.Dialog=t.id("RetryDialog-Dialog"),e.RetryNowButton=t.id("RetryDialog-RetryNowButton")}(h=t.RetryDialog||(t.RetryDialog={})),function(e){let o,i,s,r,n,a,l,c;!function(e){e.displayCurrent=t.c("Settings-BackgroundColor-displayCurrent"),e.displayDefault=t.c("Settings-BackgroundColor-displayDefault"),e.displayFactory=t.c("Settings-BackgroundColor-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-BackgroundColor-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-BackgroundColor-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-BackgroundColor-setStickyToCurrent")}(o||(o={})),e.BackgroundColor=o,function(e){e.displayCurrent=t.c("Settings-BrushSize-displayCurrent"),e.displayDefault=t.c("Settings-BrushSize-displayDefault"),e.displayFactory=t.c("Settings-BrushSize-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-BrushSize-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-BrushSize-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-BrushSize-setStickyToCurrent")}(i||(i={})),e.BrushSize=i,function(e){let o,i;!function(e){e.displayCurrent=t.c("Settings-Colors-AutoLevels-displayCurrent"),e.displayDefault=t.c("Settings-Colors-AutoLevels-displayDefault"),e.displayFactory=t.c("Settings-Colors-AutoLevels-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Colors-AutoLevels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Colors-AutoLevels-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Colors-AutoLevels-setStickyToCurrent")}(o||(o={})),e.AutoLevels=o,function(e){e.displayCurrent=t.c("Settings-Colors-ColorSpace-displayCurrent"),e.displayDefault=t.c("Settings-Colors-ColorSpace-displayDefault"),e.displayFactory=t.c("Settings-Colors-ColorSpace-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Colors-ColorSpace-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Colors-ColorSpace-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Colors-ColorSpace-setStickyToCurrent")}(i||(i={})),e.ColorSpace=i}(s=e.Colors||(e.Colors={})),function(e){let o,i,s,r,n,a,l,c,p,u,h,d;!function(e){e.displayCurrent=t.c("Settings-Crop-AllowEnlarging-displayCurrent"),e.displayDefault=t.c("Settings-Crop-AllowEnlarging-displayDefault"),e.displayFactory=t.c("Settings-Crop-AllowEnlarging-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-AllowEnlarging-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-AllowEnlarging-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-AllowEnlarging-setStickyToCurrent")}(o||(o={})),e.AllowEnlarging=o,function(e){e.displayCurrent=t.c("Settings-Crop-AspectRatio-displayCurrent"),e.displayDefault=t.c("Settings-Crop-AspectRatio-displayDefault"),e.displayFactory=t.c("Settings-Crop-AspectRatio-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-AspectRatio-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-AspectRatio-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-AspectRatio-setStickyToCurrent")}(i||(i={})),e.AspectRatio=i,function(e){e.displayCurrent=t.c("Settings-Crop-Dpi-displayCurrent"),e.displayDefault=t.c("Settings-Crop-Dpi-displayDefault"),e.displayFactory=t.c("Settings-Crop-Dpi-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-Dpi-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-Dpi-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-Dpi-setStickyToCurrent")}(s||(s={})),e.Dpi=s,function(e){e.displayCurrent=t.c("Settings-Crop-FitToResult-displayCurrent"),e.displayDefault=t.c("Settings-Crop-FitToResult-displayDefault"),e.displayFactory=t.c("Settings-Crop-FitToResult-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-FitToResult-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-FitToResult-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-FitToResult-setStickyToCurrent")}(r||(r={})),e.FitToResult=r,function(e){e.displayCurrent=t.c("Settings-Crop-MarginUnits-displayCurrent"),e.displayDefault=t.c("Settings-Crop-MarginUnits-displayDefault"),e.displayFactory=t.c("Settings-Crop-MarginUnits-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-MarginUnits-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-MarginUnits-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-MarginUnits-setStickyToCurrent")}(n||(n={})),e.MarginUnits=n,function(e){e.displayCurrent=t.c("Settings-Crop-Mode-displayCurrent"),e.displayDefault=t.c("Settings-Crop-Mode-displayDefault"),e.displayFactory=t.c("Settings-Crop-Mode-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-Mode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-Mode-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-Mode-setStickyToCurrent")}(a||(a={})),e.Mode=a,function(e){e.displayCurrent=t.c("Settings-Crop-ObjectSize-displayCurrent"),e.displayDefault=t.c("Settings-Crop-ObjectSize-displayDefault"),e.displayFactory=t.c("Settings-Crop-ObjectSize-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-ObjectSize-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-ObjectSize-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-ObjectSize-setStickyToCurrent")}(l||(l={})),e.ObjectSize=l,function(e){e.displayCurrent=t.c("Settings-Crop-PaddingMils-displayCurrent"),e.displayDefault=t.c("Settings-Crop-PaddingMils-displayDefault"),e.displayFactory=t.c("Settings-Crop-PaddingMils-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-PaddingMils-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-PaddingMils-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-PaddingMils-setStickyToCurrent")}(c||(c={})),e.PaddingMils=c,function(e){e.displayCurrent=t.c("Settings-Crop-PaddingPixels-displayCurrent"),e.displayDefault=t.c("Settings-Crop-PaddingPixels-displayDefault"),e.displayFactory=t.c("Settings-Crop-PaddingPixels-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-PaddingPixels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-PaddingPixels-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-PaddingPixels-setStickyToCurrent")}(p||(p={})),e.PaddingPixels=p,function(e){e.displayCurrent=t.c("Settings-Crop-Shadows-displayCurrent"),e.displayDefault=t.c("Settings-Crop-Shadows-displayDefault"),e.displayFactory=t.c("Settings-Crop-Shadows-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-Shadows-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-Shadows-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-Shadows-setStickyToCurrent")}(u||(u={})),e.Shadows=u,function(e){e.displayCurrent=t.c("Settings-Crop-TargetSize-displayCurrent"),e.displayDefault=t.c("Settings-Crop-TargetSize-displayDefault"),e.displayFactory=t.c("Settings-Crop-TargetSize-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-TargetSize-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-TargetSize-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-TargetSize-setStickyToCurrent")}(h||(h={})),e.TargetSize=h,function(e){e.displayCurrent=t.c("Settings-Crop-VerticalAlignment-displayCurrent"),e.displayDefault=t.c("Settings-Crop-VerticalAlignment-displayDefault"),e.displayFactory=t.c("Settings-Crop-VerticalAlignment-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Crop-VerticalAlignment-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Crop-VerticalAlignment-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Crop-VerticalAlignment-setStickyToCurrent")}(d||(d={})),e.VerticalAlignment=d}(r=e.Crop||(e.Crop={})),function(e){let o,i,s,r,n,a,l;!function(e){e.displayCurrent=t.c("Settings-Edge-BlurLevel-displayCurrent"),e.displayDefault=t.c("Settings-Edge-BlurLevel-displayDefault"),e.displayFactory=t.c("Settings-Edge-BlurLevel-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-BlurLevel-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-BlurLevel-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-BlurLevel-setStickyToCurrent")}(o||(o={})),e.BlurLevel=o,function(e){e.displayCurrent=t.c("Settings-Edge-BlurMode-displayCurrent"),e.displayDefault=t.c("Settings-Edge-BlurMode-displayDefault"),e.displayFactory=t.c("Settings-Edge-BlurMode-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-BlurMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-BlurMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-BlurMode-setStickyToCurrent")}(i||(i={})),e.BlurMode=i,function(e){e.displayCurrent=t.c("Settings-Edge-Offset-displayCurrent"),e.displayDefault=t.c("Settings-Edge-Offset-displayDefault"),e.displayFactory=t.c("Settings-Edge-Offset-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-Offset-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-Offset-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-Offset-setStickyToCurrent")}(s||(s={})),e.Offset=s,function(e){e.displayCurrent=t.c("Settings-Edge-SmoothingLevel-displayCurrent"),e.displayDefault=t.c("Settings-Edge-SmoothingLevel-displayDefault"),e.displayFactory=t.c("Settings-Edge-SmoothingLevel-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-SmoothingLevel-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-SmoothingLevel-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-SmoothingLevel-setStickyToCurrent")}(r||(r={})),e.SmoothingLevel=r,function(e){e.displayCurrent=t.c("Settings-Edge-UseCornerDetection-displayCurrent"),e.displayDefault=t.c("Settings-Edge-UseCornerDetection-displayDefault"),e.displayFactory=t.c("Settings-Edge-UseCornerDetection-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-UseCornerDetection-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-UseCornerDetection-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-UseCornerDetection-setStickyToCurrent")}(n||(n={})),e.UseCornerDetection=n,function(e){e.displayCurrent=t.c("Settings-Edge-UseLocalBlur-displayCurrent"),e.displayDefault=t.c("Settings-Edge-UseLocalBlur-displayDefault"),e.displayFactory=t.c("Settings-Edge-UseLocalBlur-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-UseLocalBlur-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-UseLocalBlur-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-UseLocalBlur-setStickyToCurrent")}(a||(a={})),e.UseLocalBlur=a,function(e){e.displayCurrent=t.c("Settings-Edge-UseLocalSmoothing-displayCurrent"),e.displayDefault=t.c("Settings-Edge-UseLocalSmoothing-displayDefault"),e.displayFactory=t.c("Settings-Edge-UseLocalSmoothing-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Edge-UseLocalSmoothing-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Edge-UseLocalSmoothing-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Edge-UseLocalSmoothing-setStickyToCurrent")}(l||(l={})),e.UseLocalSmoothing=l}(n=e.Edge||(e.Edge={})),function(e){let o,i,s,r;!function(e){e.displayCurrent=t.c("Settings-ExportOptions-JpegMode-displayCurrent"),e.displayDefault=t.c("Settings-ExportOptions-JpegMode-displayDefault"),e.displayFactory=t.c("Settings-ExportOptions-JpegMode-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-ExportOptions-JpegMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-ExportOptions-JpegMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-ExportOptions-JpegMode-setStickyToCurrent")}(o||(o={})),e.JpegMode=o,function(e){e.displayCurrent=t.c("Settings-ExportOptions-JpegQuality-displayCurrent"),e.displayDefault=t.c("Settings-ExportOptions-JpegQuality-displayDefault"),e.displayFactory=t.c("Settings-ExportOptions-JpegQuality-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-ExportOptions-JpegQuality-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-ExportOptions-JpegQuality-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-ExportOptions-JpegQuality-setStickyToCurrent")}(i||(i={})),e.JpegQuality=i,function(e){e.displayCurrent=t.c("Settings-ExportOptions-OpaqueFileFormat-displayCurrent"),e.displayDefault=t.c("Settings-ExportOptions-OpaqueFileFormat-displayDefault"),e.displayFactory=t.c("Settings-ExportOptions-OpaqueFileFormat-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-ExportOptions-OpaqueFileFormat-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-ExportOptions-OpaqueFileFormat-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-ExportOptions-OpaqueFileFormat-setStickyToCurrent")}(s||(s={})),e.OpaqueFileFormat=s,function(e){e.displayCurrent=t.c("Settings-ExportOptions-PngMode-displayCurrent"),e.displayDefault=t.c("Settings-ExportOptions-PngMode-displayDefault"),e.displayFactory=t.c("Settings-ExportOptions-PngMode-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-ExportOptions-PngMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-ExportOptions-PngMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-ExportOptions-PngMode-setStickyToCurrent")}(r||(r={})),e.PngMode=r}(a=e.ExportOptions||(e.ExportOptions={})),function(e){e.displayCurrent=t.c("Settings-MaxNumMegapixels-displayCurrent"),e.displayDefault=t.c("Settings-MaxNumMegapixels-displayDefault"),e.displayFactory=t.c("Settings-MaxNumMegapixels-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-MaxNumMegapixels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-MaxNumMegapixels-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-MaxNumMegapixels-setStickyToCurrent")}(l||(l={})),e.MaxNumMegapixels=l,function(e){let o,i,s,r;!function(e){let o,i,s,r,n,a;!function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-BlurRadius-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-BlurRadius-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-BlurRadius-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-BlurRadius-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-BlurRadius-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-BlurRadius-setStickyToCurrent")}(o||(o={})),e.BlurRadius=o,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-CropEnabled-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-CropEnabled-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-CropEnabled-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-CropEnabled-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-CropEnabled-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-CropEnabled-setStickyToCurrent")}(i||(i={})),e.CropEnabled=i,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-Enabled-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-Enabled-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-Enabled-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-Enabled-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-Enabled-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-Enabled-setStickyToCurrent")}(s||(s={})),e.Enabled=s,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-OffsetX-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-OffsetX-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-OffsetX-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-OffsetX-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-OffsetX-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-OffsetX-setStickyToCurrent")}(r||(r={})),e.OffsetX=r,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-OffsetY-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-OffsetY-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-OffsetY-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-OffsetY-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-OffsetY-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-OffsetY-setStickyToCurrent")}(n||(n={})),e.OffsetY=n,function(e){e.displayCurrent=t.c("Settings-Shadows-Drop-Opacity-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Drop-Opacity-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Drop-Opacity-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Drop-Opacity-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Drop-Opacity-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Drop-Opacity-setStickyToCurrent")}(a||(a={})),e.Opacity=a}(o=e.Drop||(e.Drop={})),function(e){let o,i;!function(e){e.displayCurrent=t.c("Settings-Shadows-Ellipse-Core-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Ellipse-Core-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Ellipse-Core-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Ellipse-Core-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Ellipse-Core-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Ellipse-Core-setStickyToCurrent")}(o||(o={})),e.Core=o,function(e){e.displayCurrent=t.c("Settings-Shadows-Ellipse-Strength-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Ellipse-Strength-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Ellipse-Strength-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Ellipse-Strength-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Ellipse-Strength-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Ellipse-Strength-setStickyToCurrent")}(i||(i={})),e.Strength=i}(i=e.Ellipse||(e.Ellipse={})),function(e){let o,i,s,r;!function(e){e.displayCurrent=t.c("Settings-Shadows-Mirror-Enabled-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Mirror-Enabled-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Mirror-Enabled-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Mirror-Enabled-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Mirror-Enabled-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Mirror-Enabled-setStickyToCurrent")}(o||(o={})),e.Enabled=o,function(e){e.displayCurrent=t.c("Settings-Shadows-Mirror-Height-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Mirror-Height-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Mirror-Height-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Mirror-Height-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Mirror-Height-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Mirror-Height-setStickyToCurrent")}(i||(i={})),e.Height=i,function(e){e.displayCurrent=t.c("Settings-Shadows-Mirror-OffsetY-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Mirror-OffsetY-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Mirror-OffsetY-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Mirror-OffsetY-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Mirror-OffsetY-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Mirror-OffsetY-setStickyToCurrent")}(s||(s={})),e.OffsetY=s,function(e){e.displayCurrent=t.c("Settings-Shadows-Mirror-Opacity-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Mirror-Opacity-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Mirror-Opacity-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Mirror-Opacity-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Mirror-Opacity-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Mirror-Opacity-setStickyToCurrent")}(r||(r={})),e.Opacity=r}(s=e.Mirror||(e.Mirror={})),function(e){let o,i,s,r,n;!function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-BlurRadius-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-BlurRadius-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-BlurRadius-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-BlurRadius-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-BlurRadius-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-BlurRadius-setStickyToCurrent")}(o||(o={})),e.BlurRadius=o,function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-BlurRadiusScale-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-BlurRadiusScale-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-BlurRadiusScale-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-BlurRadiusScale-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-BlurRadiusScale-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-BlurRadiusScale-setStickyToCurrent")}(i||(i={})),e.BlurRadiusScale=i,function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-Enabled-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-Enabled-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-Enabled-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-Enabled-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-Enabled-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-Enabled-setStickyToCurrent")}(s||(s={})),e.Enabled=s,function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-Opacity-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-Opacity-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-Opacity-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-Opacity-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-Opacity-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-Opacity-setStickyToCurrent")}(r||(r={})),e.Opacity=r,function(e){e.displayCurrent=t.c("Settings-Shadows-Perspective-OpacityScale-displayCurrent"),e.displayDefault=t.c("Settings-Shadows-Perspective-OpacityScale-displayDefault"),e.displayFactory=t.c("Settings-Shadows-Perspective-OpacityScale-displayFactory"),e.setCurrentAndStickyToFactory=t.c("Settings-Shadows-Perspective-OpacityScale-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("Settings-Shadows-Perspective-OpacityScale-setCurrentToDefault"),e.setStickyToCurrent=t.c("Settings-Shadows-Perspective-OpacityScale-setStickyToCurrent")}(n||(n={})),e.OpacityScale=n}(r=e.Perspective||(e.Perspective={}))}(c=e.Shadows||(e.Shadows={}))}(d=t.Settings||(t.Settings={})),function(e){let o,i,s,r,n,a,l,c,p;!function(e){e.button=t.c("SettingsGroups-All-button"),e.menu=t.c("SettingsGroups-All-menu"),e.outline=t.c("SettingsGroups-All-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-All-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-All-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-All-setStickyToCurrent")}(o||(o={})),e.All=o,function(e){e.button=t.c("SettingsGroups-BackgroundColor-button"),e.menu=t.c("SettingsGroups-BackgroundColor-menu"),e.outline=t.c("SettingsGroups-BackgroundColor-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-BackgroundColor-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-BackgroundColor-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-BackgroundColor-setStickyToCurrent")}(i||(i={})),e.BackgroundColor=i,function(e){e.button=t.c("SettingsGroups-BrushSize-button"),e.menu=t.c("SettingsGroups-BrushSize-menu"),e.outline=t.c("SettingsGroups-BrushSize-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-BrushSize-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-BrushSize-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-BrushSize-setStickyToCurrent")}(s||(s={})),e.BrushSize=s,function(e){let o,i;!function(e){e.button=t.c("SettingsGroups-Colors-AutoLevels-button"),e.menu=t.c("SettingsGroups-Colors-AutoLevels-menu"),e.outline=t.c("SettingsGroups-Colors-AutoLevels-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Colors-AutoLevels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Colors-AutoLevels-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Colors-AutoLevels-setStickyToCurrent")}(o||(o={})),e.AutoLevels=o,function(e){e.button=t.c("SettingsGroups-Colors-ColorSpace-button"),e.menu=t.c("SettingsGroups-Colors-ColorSpace-menu"),e.outline=t.c("SettingsGroups-Colors-ColorSpace-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Colors-ColorSpace-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Colors-ColorSpace-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Colors-ColorSpace-setStickyToCurrent")}(i||(i={})),e.ColorSpace=i}(r=e.Colors||(e.Colors={})),function(e){let o,i,s;!function(e){e.button=t.c("SettingsGroups-Crop-Dpi-button"),e.menu=t.c("SettingsGroups-Crop-Dpi-menu"),e.outline=t.c("SettingsGroups-Crop-Dpi-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Crop-Dpi-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Crop-Dpi-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Crop-Dpi-setStickyToCurrent")}(o||(o={})),e.Dpi=o,function(e){e.button=t.c("SettingsGroups-Crop-FitToResult-button"),e.menu=t.c("SettingsGroups-Crop-FitToResult-menu"),e.outline=t.c("SettingsGroups-Crop-FitToResult-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Crop-FitToResult-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Crop-FitToResult-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Crop-FitToResult-setStickyToCurrent")}(i||(i={})),e.FitToResult=i,function(e){e.button=t.c("SettingsGroups-Crop-Mode-button"),e.menu=t.c("SettingsGroups-Crop-Mode-menu"),e.outline=t.c("SettingsGroups-Crop-Mode-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Crop-Mode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Crop-Mode-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Crop-Mode-setStickyToCurrent")}(s||(s={})),e.Mode=s}(n=e.Crop||(e.Crop={})),function(e){e.button=t.c("SettingsGroups-Edges-button"),e.menu=t.c("SettingsGroups-Edges-menu"),e.outline=t.c("SettingsGroups-Edges-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Edges-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Edges-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Edges-setStickyToCurrent")}(a||(a={})),e.Edges=a,function(e){let o,i,s,r;!function(e){e.button=t.c("SettingsGroups-ExportOptions-JpegMode-button"),e.menu=t.c("SettingsGroups-ExportOptions-JpegMode-menu"),e.outline=t.c("SettingsGroups-ExportOptions-JpegMode-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-ExportOptions-JpegMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-ExportOptions-JpegMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-ExportOptions-JpegMode-setStickyToCurrent")}(o||(o={})),e.JpegMode=o,function(e){e.button=t.c("SettingsGroups-ExportOptions-JpegQuality-button"),e.menu=t.c("SettingsGroups-ExportOptions-JpegQuality-menu"),e.outline=t.c("SettingsGroups-ExportOptions-JpegQuality-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-ExportOptions-JpegQuality-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-ExportOptions-JpegQuality-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-ExportOptions-JpegQuality-setStickyToCurrent")}(i||(i={})),e.JpegQuality=i,function(e){e.button=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-button"),e.menu=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-menu"),e.outline=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-ExportOptions-OpaqueFileFormat-setStickyToCurrent")}(s||(s={})),e.OpaqueFileFormat=s,function(e){e.button=t.c("SettingsGroups-ExportOptions-PngMode-button"),e.menu=t.c("SettingsGroups-ExportOptions-PngMode-menu"),e.outline=t.c("SettingsGroups-ExportOptions-PngMode-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-ExportOptions-PngMode-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-ExportOptions-PngMode-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-ExportOptions-PngMode-setStickyToCurrent")}(r||(r={})),e.PngMode=r}(l=e.ExportOptions||(e.ExportOptions={})),function(e){e.button=t.c("SettingsGroups-MaxNumMegapixels-button"),e.menu=t.c("SettingsGroups-MaxNumMegapixels-menu"),e.outline=t.c("SettingsGroups-MaxNumMegapixels-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-MaxNumMegapixels-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-MaxNumMegapixels-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-MaxNumMegapixels-setStickyToCurrent")}(c||(c={})),e.MaxNumMegapixels=c,function(e){let o,i,s,r;!function(e){e.button=t.c("SettingsGroups-Shadows-Drop-button"),e.menu=t.c("SettingsGroups-Shadows-Drop-menu"),e.outline=t.c("SettingsGroups-Shadows-Drop-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Shadows-Drop-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Shadows-Drop-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Shadows-Drop-setStickyToCurrent")}(o||(o={})),e.Drop=o,function(e){e.button=t.c("SettingsGroups-Shadows-Ellipse-button"),e.menu=t.c("SettingsGroups-Shadows-Ellipse-menu"),e.outline=t.c("SettingsGroups-Shadows-Ellipse-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Shadows-Ellipse-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Shadows-Ellipse-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Shadows-Ellipse-setStickyToCurrent")}(i||(i={})),e.Ellipse=i,function(e){e.button=t.c("SettingsGroups-Shadows-Mirror-button"),e.menu=t.c("SettingsGroups-Shadows-Mirror-menu"),e.outline=t.c("SettingsGroups-Shadows-Mirror-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Shadows-Mirror-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Shadows-Mirror-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Shadows-Mirror-setStickyToCurrent")}(s||(s={})),e.Mirror=s,function(e){e.button=t.c("SettingsGroups-Shadows-Perspective-button"),e.menu=t.c("SettingsGroups-Shadows-Perspective-menu"),e.outline=t.c("SettingsGroups-Shadows-Perspective-outline"),e.setCurrentAndStickyToFactory=t.c("SettingsGroups-Shadows-Perspective-setCurrentAndStickyToFactory"),e.setCurrentToDefault=t.c("SettingsGroups-Shadows-Perspective-setCurrentToDefault"),e.setStickyToCurrent=t.c("SettingsGroups-Shadows-Perspective-setStickyToCurrent")}(r||(r={})),e.Perspective=r}(p=e.Shadows||(e.Shadows={}))}(g=t.SettingsGroups||(t.SettingsGroups={})),function(e){e.Dialog=t.id("Signon-Dialog"),e.Header=t.id("Signon-Header"),e.IframeContainer=t.id("Signon-IframeContainer"),e.LoadingIndicator=t.id("Signon-LoadingIndicator"),e.preload=t.c("Signon-preload"),e.trigger=t.c("Signon-trigger")}(m=t.Signon||(t.Signon={})),function(e){e.Id=t.id("StartupLightbox-Id"),e.Initializing=t.id("StartupLightbox-Initializing"),e.Outer=t.id("StartupLightbox-Outer"),e.Uploading=t.id("StartupLightbox-Uploading"),e.content=t.c("StartupLightbox-content"),e.single_pane=t.c("StartupLightbox-single_pane"),e.video=t.id("StartupLightbox-video"),e.video_playing=t.c("StartupLightbox-video_playing")}(f=t.StartupLightbox||(t.StartupLightbox={})),function(e){e.iframe=t.c("TutorialScreenshots-iframe"),e.wrapper=t.c("TutorialScreenshots-wrapper")}(S=t.TutorialScreenshots||(t.TutorialScreenshots={})),function(e){e.remove=t.c("UserImage-remove"),e.rename=t.c("UserImage-rename"),e.undelete=t.c("UserImage-undelete")}(w=t.UserImage||(t.UserImage={})),function(e){let o;!function(e){e.active=t.c("V2-DemoPitch-active"),e.progress_bar=t.c("V2-DemoPitch-progress_bar"),e.video_no_shadow=t.c("V2-DemoPitch-video_no_shadow"),e.video_progress_chunks=t.c("V2-DemoPitch-video_progress_chunks")}(o=e.DemoPitch||(e.DemoPitch={}))}(C=t.V2||(t.V2={})),function(e){e.both=t.c("ViewPanes-both"),e.group=t.c("ViewPanes-group"),e.marks=t.c("ViewPanes-marks")}(y=t.ViewPanes||(t.ViewPanes={})),function(e){e.Lightbox=t.id("contextMenu-Lightbox"),e.ToolbarBackgroundApp=t.id("contextMenu-ToolbarBackgroundApp"),e.ToolbarColorsApp=t.id("contextMenu-ToolbarColorsApp"),e.ToolbarMark=t.id("contextMenu-ToolbarMark"),e.ToolbarShadowApp=t.id("contextMenu-ToolbarShadowApp"),e.toolbar=t.c("contextMenu-toolbar")}(b=t.contextMenu||(t.contextMenu={})),function(e){e.connecting=t.c("lightState-connecting"),e.progress=t.c("lightState-progress"),e.updated=t.c("lightState-updated"),e.updating=t.c("lightState-updating")}(v=t.lightState||(t.lightState={})),function(e){e.AcceptTerms=t.id("merchant-AcceptTerms"),e.AcceptTermsWrapper=t.id("merchant-AcceptTermsWrapper"),e.BraintreeDropinContainer=t.id("merchant-BraintreeDropinContainer"),e.Cents=t.id("merchant-Cents"),e.CreditCardProcessorForm=t.id("merchant-CreditCardProcessorForm"),e.DefaultPaymentMethod=t.id("merchant-DefaultPaymentMethod"),e.FailedToLoadPaymentBackendJs=t.id("merchant-FailedToLoadPaymentBackendJs"),e.InitializingIndicator=t.id("merchant-InitializingIndicator"),e.PaymentError=t.id("merchant-PaymentError"),e.PaymentForm=t.id("merchant-PaymentForm"),e.PaymentMethodForm=t.id("merchant-PaymentMethodForm"),e.PaymentMethodFormSubmit=t.id("merchant-PaymentMethodFormSubmit"),e.RadioBraintree=t.id("paymentMethod_braintree"),e.RadioStripe=t.id("paymentMethod_stripe"),e.ShowWhenCreatingPm=t.id("merchant-ShowWhenCreatingPm"),e.ShowWhenMinibrowsing=t.id("merchant-ShowWhenMinibrowsing"),e.ShowWhenSubmitting=t.id("merchant-ShowWhenSubmitting"),e.StreamlexPaymentToken=t.id("merchant-StreamlexPaymentToken"),e.StripeCardElement=t.id("merchant-StripeCardElement"),e.StripeCardErrors=t.id("merchant-StripeCardErrors"),e.StripeNameElement=t.id("merchant-StripeNameElement"),e.StripeNameErrors=t.id("merchant-StripeNameErrors"),e.StripePaymentError=t.id("merchant-StripePaymentError"),e.SubmitSection=t.id("merchant-SubmitSection"),e.TaxLocationPostalCode=t.id("merchant-TaxLocationPostalCode"),e.TaxPostalCode=t.id("merchant-TaxPostalCode"),e.TaxPostalCodeFormGroup=t.id("merchant-TaxPostalCodeFormGroup"),e.TaxSection=t.id("merchant-TaxSection"),e.has_error=t.c("has-error"),e.radio_paymentMethod=t.c("radio_paymentMethod")}(A=t.merchant||(t.merchant={})),function(e){let o,i;e.Error=t.id("resultDialog-Error"),e.ErrorMsg=t.id("resultDialog-ErrorMsg"),e.Ready=t.id("resultDialog-Ready"),e.ReadyDownloadImage=t.id("resultDialog-ReadyDownloadImage"),e.ReadyShareLink=t.c("resultDialog-ReadyShareLink"),e.Waiting=t.id("resultDialog-Waiting"),e.WaitingBar=t.id("resultDialog-WaitingBar"),e.WaitingMsg=t.id("resultDialog-WaitingMsg"),e.copy_api_supported=t.c("resultDialog-copy_api_supported"),e.copy_to_clipboard=t.c("resultDialog-copy_to_clipboard"),e.download_alpha_mask_menu_item=t.c("resultDialog-download_alpha_mask_menu_item"),e.download_combo_button=t.c("resultDialog-download_combo_button"),e.download_link=t.c("resultDialog-download_link"),e.download_menu_button=t.c("resultDialog-download_menu_button"),e.download_svg_path_menu_item=t.c("resultDialog-download_svg_path_menu_item"),e.download_tiff_path_menu_item=t.c("resultDialog-download_tiff_path_menu_item"),e.hasDownloaded=t.c("resultDialog-hasDownloaded"),e.ready_download_link=t.c("resultDialog-ready_download_link"),e.ready_download_menu_item=t.c("resultDialog-ready_download_menu_item"),e.ready_download_menu_item_text=t.c("resultDialog-ready_download_menu_item_text"),e.show_copied=t.c("resultDialog-show_copied"),e.show_copying=t.c("resultDialog-show_copying"),e.show_failed=t.c("resultDialog-show_failed"),e.state=t.c("resultDialog-state"),function(e){let o,i,s,r,n;e.Row=t.id("resultDialog-SettingsSummary-Row"),function(e){e.Key=t.id("resultDialog-SettingsSummary-BackgroundApp-Key"),e.Value=t.id("resultDialog-SettingsSummary-BackgroundApp-Value")}(o||(o={})),e.BackgroundApp=o,function(e){e.Key=t.id("resultDialog-SettingsSummary-ColorsApp-Key"),e.Value=t.id("resultDialog-SettingsSummary-ColorsApp-Value")}(i||(i={})),e.ColorsApp=i,function(e){e.Key=t.id("resultDialog-SettingsSummary-CropApp-Key"),e.Value=t.id("resultDialog-SettingsSummary-CropApp-Value")}(s||(s={})),e.CropApp=s,function(e){e.Key=t.id("resultDialog-SettingsSummary-ExportOptions-Key"),e.Value=t.id("resultDialog-SettingsSummary-ExportOptions-Value")}(r||(r={})),e.ExportOptions=r,function(e){e.Key=t.id("resultDialog-SettingsSummary-ShadowsApp-Key"),e.Value=t.id("resultDialog-SettingsSummary-ShadowsApp-Value")}(n||(n={})),e.ShadowsApp=n}(o=e.SettingsSummary||(e.SettingsSummary={})),function(e){e.Row=t.id("resultDialog-UploadNext-Row"),e.Wrapper=t.id("resultDialog-UploadNext-Wrapper")}(i=e.UploadNext||(e.UploadNext={}))}(k=t.resultDialog||(t.resultDialog={})),function(e){let o,i;e.hero=t.id("video-hero"),e.main=t.id("video-main"),function(e){e.Id=t.id("video-erase-Id"),e.Tool=t.id("erase-tool"),e.show=t.c("video-erase-show")}(o||(o={})),e.erase=o,function(e){e.Id=t.id("video-green-Id"),e.Tool=t.id("green-tool"),e.show=t.c("video-green-show")}(i||(i={})),e.green=i}(M=t.video||(t.video={}))}(D||(D={}));class qt{constructor(t,e,o,i,s,r){this.btn=t,this.action=e,this.delay=o,this.firstDelayMultiplier=i,this.ondown=s,this.onup=r,this.t=void 0,this.repeat=()=>{this.action(),this.t=setTimeout(this.repeat,this.delay)},this.startHandler=t=>{this.btn.on("mouseup mouseout",this.endHandler),this.ondown&&this.ondown(),this.action(),this.t=setTimeout(this.repeat,this.delay*this.firstDelayMultiplier),t.preventDefault()},this.endHandler=t=>{this.btn.off("mouseup mouseout",this.endHandler),this.onup&&this.onup(),clearTimeout(this.t),this.t=void 0,t.preventDefault()},t.on("touchstart mousedown",this.startHandler),t.on("touchend",this.endHandler)}}!function(t){function e(e){window.Globals.Bulk.isIframe||window.Globals.Bulk.isApi?window.checkPostMessage({command:_.Error,error:{code:2e3,status:400,message:e}}):($("#fatal-error-p").text(e),t.modal("#fatal-error")),t.gaTrack("ErrorShown","Fatal",e)}function o(e){e?t.modal("#spinner-lightbox"):$("#spinner-lightbox").modal("hide")}function i(e){e?t.modal("#progress-lightbox"):$("#progress-lightbox").modal("hide")}t.addEventListener=function(t,e,o){t.each((t,i)=>{i.addEventListener(e,o)})},t.fuzzyAspectRatio=function(e){return t.fuzzyAspectRatioEx(e,_.AspectRatios)},t.imageIsReady=function(t){return null!=t&&0!=t.width()&&0!=t.height()},t.fatalError=function(s){o(!1),i(!1),e(t.stringify(s))},t.fatalErrorStr=e,t.spinner=o,t.progress=i,t.progressUpdate=function(t){$("#progress-lightbox-bar").attr("style","width:"+t+"%")},t.saveAndExit=function(e){e?t.modal("#save-and-exit-lightbox"):$("#save-and-exit-lightbox").modal("hide")},t.hoverHelper=function(e,o){t.addEventListener(e,"touchstart",t=>{o(!0),t.preventDefault()}),t.addEventListener(e,"touchend",t=>{o(!1),t.preventDefault()}),e.hover(()=>{o(!0)},()=>{o(!1)})},t.mouseDownRepeater=function(t,e,o,i,s,r){new qt(t,e,o,i,s,r)},t.LittleEndian=function(){try{var t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}catch(t){return!0}}(),t.fetchJson=function(e,o){var i={cache:!1,dataType:"json",error:(e,o,i)=>{t.fatalErrorStr(t.formatXhrError(e,o))},success:o,type:"GET"};$.ajax(e,i)},t.blink2=function(t){t.$().animate({opacity:0},0).delay(200).animate({opacity:1},0).delay(200).animate({opacity:0},0).delay(200).animate({opacity:1},0).delay(200).animate({opacity:0},0).delay(200).animate({opacity:1},0).delay(200).animate({opacity:0},0).delay(200).animate({opacity:1},0).delay(200).animate({opacity:0},0).delay(200).animate({opacity:1},0)}}(P||(P={}));class Jt{constructor(t=0,e=0,o=0,i=0){this.rf=t,this.gf=e,this.bf=o,this.af=i}static intToFloat(t){return(255&t)*Jt.IntToFloat}static isInRange(t){return t>=0&&t<=1}static transparentWhite(){return new Jt(1,1,1,0)}static empty(){return new Jt(0,0,0,0)}static fromInts(t,e,o,i){return(new Jt).fromInts(t,e,o,i)}static fromInt(t){return(new Jt).fromInt(t)}static fromCss(t){return(new Jt).fromCss(t)}fromInts(t,e,o,i){return this.af=Jt.intToFloat(t),this.rf=Jt.intToFloat(e),this.gf=Jt.intToFloat(o),this.bf=Jt.intToFloat(i),this}fromInt(t){return this.fromInts(t>>24,t>>16,t>>8,t)}fromCss(t){if(t.startsWith("rgba(")){let e=t.match(Jt.RbgaRx);if(e&&5==e.length){let t=Jt.intToFloat(parseInt(e[1])),o=Jt.intToFloat(parseInt(e[2])),i=Jt.intToFloat(parseInt(e[3])),s=parseFloat(e[4]);return new Jt(t,o,i,s).clamp()}}if(t.startsWith("rgb(")){let e=t.match(Jt.RbgRx);if(e&&4==e.length){let t=Jt.intToFloat(parseInt(e[1])),o=Jt.intToFloat(parseInt(e[2])),i=Jt.intToFloat(parseInt(e[3]));return new Jt(t,o,i,1).clamp()}}if(t.startsWith("#")){let e=t.match(Jt.Hex6Rx);if(e&&4==e.length){let t=Jt.intToFloat(parseInt(e[1],16)),o=Jt.intToFloat(parseInt(e[2],16)),i=Jt.intToFloat(parseInt(e[3],16));return new Jt(t,o,i,1).clamp()}let o=t.match(Jt.Hex3Rx);if(o&&4==o.length){let t=Jt.intToFloat(parseInt(o[1]+o[1],16)),e=Jt.intToFloat(parseInt(o[2]+o[2],16)),i=Jt.intToFloat(parseInt(o[3]+o[3],16));return new Jt(t,e,i,1).clamp()}}return Jt.transparentWhite()}dup(){return(new Jt).setArgb(this)}aInt(){return Math.round(this.af*Jt.FloatToInt)}rInt(){return Math.round(this.rf*Jt.FloatToInt)}gInt(){return Math.round(this.gf*Jt.FloatToInt)}bInt(){return Math.round(this.bf*Jt.FloatToInt)}toInt(){return(255&this.aInt())<<24|(255&this.rInt())<<16|(255&this.gInt())<<8|255&this.bInt()}toRgbCss(){return"rgb("+this.rInt()+","+this.gInt()+","+this.bInt()+")"}toRgbaCss(){return"rgba("+this.rInt()+","+this.gInt()+","+this.bInt()+","+this.af+")"}clamp(){return this.af=Math.max(0,Math.min(1,this.af)),this.rf=Math.max(0,Math.min(1,this.rf)),this.gf=Math.max(0,Math.min(1,this.gf)),this.bf=Math.max(0,Math.min(1,this.bf)),this}scale(t){return this.af*=t,this.rf*=t,this.gf*=t,this.bf*=t,this}normalize(){var t=this.norm();return t>0&&this.scale(1/t),t}normalized(){var t=this.norm();return t>0&&this.scale(1/t),this}normSqr(){return this.af*this.af+this.rf*this.rf+this.gf*this.gf+this.bf*this.bf}norm(){return Math.sqrt(this.af*this.af+this.rf*this.rf+this.gf*this.gf+this.bf*this.bf)}setArgb(t){return this.af=t.af,this.rf=t.rf,this.gf=t.gf,this.bf=t.bf,this}set(t,e,o,i){return this.af=t,this.rf=e,this.gf=o,this.bf=i,this}plusEquals(t){return this.af+=t.af,this.rf+=t.rf,this.gf+=t.gf,this.bf+=t.bf,this}minusEquals(t){return this.af-=t.af,this.rf-=t.rf,this.gf-=t.gf,this.bf-=t.bf,this}timesEquals(t){return this.af*=t,this.rf*=t,this.gf*=t,this.bf*=t,this}dot(t){return this.af*t.af+this.rf*t.rf+this.gf*t.gf+this.bf*t.bf}grayscale(){return.299*this.rf+.587*this.gf+.114*this.bf}desaturate(){var t=this.grayscale();return this.rf=this.gf=this.bf=t,this}desaturateEvenly(){var t=(this.rf+this.gf+this.bf)/3;return this.rf=this.gf=this.bf=t,this}mixWith(t,e){if(this.af+t.af==0)this.set(0,0,0,0);else{var o=this.af*e+t.af*(1-e);this.rf=(this.rf*this.af*e+t.rf*t.af*(1-e))/o,this.gf=(this.gf*this.af*e+t.gf*t.af*(1-e))/o,this.bf=(this.bf*this.af*e+t.bf*t.af*(1-e))/o,this.af=o}return this}}Jt.FloatToInt=255,Jt.IntToFloat=1/Jt.FloatToInt,Jt.RbgaRx=/rgba\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9.]+)\s*\)/,Jt.RbgRx=/rgb\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/,Jt.Hex3Rx=/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/,Jt.Hex6Rx=/([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/;class Qt{constructor(t,e,o,i,s,r,n,a,l){this.a00=t,this.a01=e,this.a02=o,this.a10=i,this.a11=s,this.a12=r,this.a20=n,this.a21=a,this.a22=l}static empty(){return new Qt(1,0,0,0,1,0,0,0,1)}static diag(t,e,o){return new Qt(e,0,0,0,e,0,0,0,o)}static buildWhiteBalancerFromGrayColorSampleBradford(t){var e=Qt.SrgbToBradford.times(t),o=Qt.SrgbToBradford.times(t.dup().desaturate()),i=Qt.diag((o.rf+Qt.Epsilon)/(e.rf+Qt.Epsilon),(o.gf+Qt.Epsilon)/(e.gf+Qt.Epsilon),(o.bf+Qt.Epsilon)/(e.bf+Qt.Epsilon));return Qt.bradfordToSrgb.dup().timesEquals(i).timesEquals(Qt.SrgbToBradford)}static buildWhiteBalancerFromGrayColorSampleXyz(t){var e=Qt.SrgbToXyz.times(t),o=Qt.SrgbToXyz.times(t.dup().desaturate()),i=Qt.diag(o.rf/e.rf,o.gf/e.gf,o.bf/e.bf);return Qt.bradfordToSrgb.dup().timesEquals(i).timesEquals(Qt.SrgbToBradford)}dup(){return new Qt(this.a00,this.a01,this.a02,this.a10,this.a11,this.a12,this.a20,this.a21,this.a22)}set(t,e,o,i,s,r,n,a,l){this.a00=t,this.a01=e,this.a02=o,this.a10=i,this.a11=s,this.a12=r,this.a20=n,this.a21=a,this.a22=l}matrixMatrixMultiply(t,e){e.set(this.a00*t.a00+this.a01*t.a10+this.a02*t.a20,this.a00*t.a01+this.a01*t.a11+this.a02*t.a21,this.a00*t.a02+this.a01*t.a12+this.a02*t.a22,this.a10*t.a00+this.a11*t.a10+this.a12*t.a20,this.a10*t.a01+this.a11*t.a11+this.a12*t.a21,this.a10*t.a02+this.a11*t.a12+this.a12*t.a22,this.a20*t.a00+this.a21*t.a10+this.a22*t.a20,this.a20*t.a01+this.a21*t.a11+this.a22*t.a21,this.a20*t.a02+this.a21*t.a12+this.a22*t.a22)}timesMatrix(t){var e=Qt.empty();return this.matrixMatrixMultiply(t,e),e}timesEquals(t){return this.matrixMatrixMultiply(t,this),this}matrixVectorMultiply(t,e){e.rf=this.a00*t.rf+this.a01*t.gf+this.a02*t.bf,e.gf=this.a10*t.rf+this.a11*t.gf+this.a12*t.bf,e.bf=this.a20*t.rf+this.a21*t.gf+this.a22*t.bf}times(t){var e=Jt.empty();return this.matrixVectorMultiply(t,e),e}}Qt.SrgbToXyz=new Qt(.4124564,.3575761,.1804375,.2126729,.7151522,.072175,.0193339,.119192,.9503041),Qt.XyzTosRgb=new Qt(3.2404542,-1.5371385,-.4985314,-.969266,1.8760108,.041556,.0556434,-.2040259,1.0572252),Qt.BradfordMa=new Qt(.8951,.2664,-.1614,-.7502,1.7135,.0367,.0389,-.0685,1.0296),Qt.BradfordMaInv=new Qt(.9869929,-.1470543,.1599627,.4323053,.5183603,.0492912,-.0085287,.0400428,.9684867),Qt.SrgbToBradford=Qt.BradfordMa.timesMatrix(Qt.SrgbToXyz),Qt.bradfordToSrgb=Qt.XyzTosRgb.timesMatrix(Qt.BradfordMaInv),Qt.Epsilon=1e-6;class jt{constructor(t,e){this.id=t,this.value=e}}class Zt{constructor(t){this.items=t}update(t){for(var e=0;e<this.items.length;e++){var o=this.items[e];o.value==t&&o.id.$().button("toggle")}}}!function(t){function e(t,e){t.id.$().click(()=>{e(t.value)})}t.registerRadioGroup=function(t,o){for(var i=0;i<t.items.length;i++)e(t.items[i],o)}}(R||(R={}));class Kt{constructor(t,e,o,i=(()=>{}),s=(()=>{})){this.action=t,this.delay=e,this.firstDelayMultiplier=o,this.ondown=i,this.onup=s,this.timer=-1}repeat(){this.action(),this.timer=setTimeout(()=>{this.repeat()},this.delay)}up(){-1!=this.timer&&(this.onup&&this.onup(),clearTimeout(this.timer),this.timer=-1)}down(){-1==this.timer&&(this.ondown&&this.ondown(),this.action(),this.timer=setTimeout(()=>{this.repeat()},this.delay*this.firstDelayMultiplier))}}function te(t,e){if(e)try{self.postMessage(t,e)}catch(e){self.postMessage(t)}else self.postMessage(t)}class ee{constructor(t,e=null,o=null,i=null){this.name=t,this.scriptUrls=e,this.workerFunction=o,this.messageListener=i,this.myMessageListener=t=>this.messageListener?this.messageListener(t):void 0}static getBasics(){return te.toString()}ensureWorker(){if(!this.worker){let t="'use strict';\n";if(t+=ee.getBasics()+";\n",this.scriptUrls&&this.scriptUrls.length>0){t+="importScripts(\n  '"+this.scriptUrls.map((function(t){return t.length>1&&"/"==t[0]&&"/"==t[1]?"https:"+t:t.length>0&&"/"==t[0]?location.protocol+"//"+location.host+t:t})).join("',\n  '")+"');\n"}this.workerFunction&&(t+="("+this.workerFunction.toString()+")();\n");let e=new Blob([t],{type:"text/javascript"}),o=URL.createObjectURL(e);this.worker=new Worker(o),this.worker.addEventListener("error",t=>{P.gaTrack("YoWorker","Error",t.filename+":"+t.lineno+":"+t.colno+", '"+t.message+"', '"+t.error+"'")}),this.worker.addEventListener("message",this.myMessageListener)}return this.worker}setMessageListener(t){this.messageListener=t}postMessage(t,e){try{try{this.ensureWorker().postMessage(t,e)}catch(e){this.worker.postMessage(t)}}catch(t){throw P.gaTrack("YoWorker","Exception",this.name+": '"+t+"', '"+t.stack+"'"),t}}terminate(){this.worker&&(this.worker.terminate(),this.worker=null)}}!function(t){let e=!0,o=0;const i=new Yt;t.ThumbnailJpegQuality=.7;class s{constructor(t,e){if(this.canvasId=t,this.spec=e,this.failSafeTimeout=void 0,this.croppedCanvas=this.spec.inputCanvas,this.spec.crop){const t=this.spec.crop,e=t.right-t.left,o=t.bottom-t.top;if(0!=t.top||0!=t.left||e!=this.spec.inputCanvas.width()||o!=this.spec.inputCanvas.height()){const i=new It(e,o);i.context().drawCanvasEx3(this.spec.inputCanvas,t.left,t.top,i.width(),i.height(),0,0,i.width(),i.height()),this.croppedCanvas=i,this.croppedCanvas.wasCropped=!0}}let o=this.croppedCanvas.width(),i=this.croppedCanvas.height();this.wOut=o,this.hOut=i;o*i>this.spec.maxNumPixels&&(this.hOut=Math.floor(Math.sqrt(this.spec.maxNumPixels*i/o)),this.wOut=Math.floor(this.spec.maxNumPixels/this.hOut))}shrinkingNeeded(){return this.wOut!=this.croppedCanvas.width()||this.hOut!=this.croppedCanvas.height()}createOutputCanvas(){return new It(this.wOut,this.hOut)}shrinkWithWorker(){try{const t=this.croppedCanvas.context().getImageData(0,0,this.croppedCanvas.width(),this.croppedCanvas.height()).data,e={canvasId:this.canvasId,wIn:this.croppedCanvas.width(),hIn:this.croppedCanvas.height(),dataIn:t,wOut:this.wOut,hOut:this.hOut};this.failSafeTimeout=setTimeout(()=>this.shrinkWithWorkerFailSafe("fail-safe timeout reached"),1e4),this.spec.worker.setMessageListener(r),this.spec.worker.postMessage(e,[t.buffer])}catch(t){this.shrinkWithWorkerFailSafe("exception in spawning worker or sending work message")}}shrinkWithWorkerResultHandler(t){if(t.success&&t.wOut==this.wOut&&t.hOut==this.hOut&&null!=t.dataOut&&t.dataOut.length>0){P.gaTrack("WebWorker","Downsample","Succeeded",1);const e=this.createOutputCanvas(),o=e.context().createImageData(e.width(),e.height());o.data.set(t.dataOut),e.context().putImageData(o,0,0),e.wasShrunk=!0,e.wasCropped=this.croppedCanvas.wasCropped,this.completed(e)}else this.shrinkWithWorkerFailSafe("Worker reports failure")}shrinkWithWorkerFailSafe(t){P.gaTrack("WebWorker","Downsample","Failed",0),e=!1,this.shrinkWithoutWorker()}shrinkWithoutWorker(){var t=this.createOutputCanvas();t.context().drawCanvasEx2(this.croppedCanvas,0,0,t.width(),t.height()),t.wasShrunk=!0,t.wasCropped=this.croppedCanvas.wasCropped,this.completed(t)}produceThumbnail(e){if(this.spec.thumbnailSize){const o=this.spec.thumbnailSize.w,i=this.spec.thumbnailSize.h,s=new It(o,i);s.context().setFillStyle("rgb(255,255,255)"),s.context().fillRect(0,0,o,i);const r=Math.min(o/e.width(),i/e.height());return s.context().context.drawImage(e.element,(o-e.width()*r)/2,(i-e.height()*r)/2,e.width()*r,e.height()*r),s.toBlob("image/jpeg",t.ThumbnailJpegQuality)}return null}completed(t){clearTimeout(this.failSafeTimeout),this.failSafeTimeout=void 0,i.remove(this.canvasId),this.spec.completed(t,t.wasShrunk||t.wasCropped,()=>this.produceThumbnail(t))}process(){this.shrinkingNeeded()?e&&this.spec.worker?this.shrinkWithWorker():this.shrinkWithoutWorker():this.completed(this.croppedCanvas)}}function r(t){const e=t.data;i.contains(e.canvasId)&&i.get(e.canvasId).shrinkWithWorkerResultHandler(e)}t.process=function(t){const e=new s("cs_"+o++,t);i.put(e.canvasId,e),e.process()}}(E||(E={}));class oe{constructor(t=32){this.pos=0,this.data=new Uint8Array(t)}ensure(t){if(t>this.data.length){for(var e=new Uint8Array(Math.max(t,2*this.data.length)),o=0;o<this.pos;o++)e[o]=this.data[o];this.data=e}}size(){return this.pos}reset(){this.pos=0}toUint8Array(){return this.data.slice(0,this.size())}writeUintVariableLength(t){(t&=oe.MaskInput)<=oe.Size0?this.writeUint8(oe.Code0|oe.MaskLower&t):t<=oe.Size1?(this.writeUint8(oe.Code1|oe.MaskLower&t>>>8),this.writeUint8(t)):t<=oe.Size2?(this.writeUint8(oe.Code2|oe.MaskLower&t>>>16),this.writeUint8(t>>>8),this.writeUint8(t)):t<=oe.Size3&&(this.writeUint8(oe.Code3|oe.MaskLower&t>>>24),this.writeUint8(t>>>16),this.writeUint8(t>>>8),this.writeUint8(t))}writeASCII(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))}writeUint8(t){this.ensure(this.pos+1),this.data[this.pos++]=255&t}writeUint16(t){this.ensure(this.pos+2),this.writeUint8(255&t>>8),this.writeUint8(255&t)}writeUint24(t){this.ensure(this.pos+3),this.writeUint8(255&t>>16),this.writeUint8(255&t>>8),this.writeUint8(255&t)}writeUint32(t){this.ensure(this.pos+4),this.writeUint8(255&t>>24),this.writeUint8(255&t>>16),this.writeUint8(255&t>>8),this.writeUint8(255&t)}writeUint16Le(t){this.ensure(this.pos+2),this.writeUint8(255&t),this.writeUint8(255&t>>8)}writeUint24Le(t){this.ensure(this.pos+3),this.writeUint8(255&t),this.writeUint8(255&t>>8),this.writeUint8(255&t>>16)}writeUint32Le(t){this.ensure(this.pos+4),this.writeUint8(255&t),this.writeUint8(255&t>>8),this.writeUint8(255&t>>16),this.writeUint8(255&t>>24)}toBase64(){return l.encode(this.data,this.pos)}}oe.Size0=63,oe.Size1=16383,oe.Size2=4194303,oe.Size3=1073741823,oe.Code0=0,oe.Code1=64,oe.Code2=128,oe.Code3=192,oe.MaskLower=63,oe.MaskInput=1073741823;class ie{constructor(){this.data=new Float32Array(ie.NumBins)}static clamp(t){return Math.max(0,Math.min(t,ie.LinearSize-1))}addWeight(t,e,o,i){var s=ie.clamp(t)*ie.SquaredSize+ie.clamp(e)*ie.LinearSize+ie.clamp(o);this.data[s]=this.data[s]+i}add(t,e,o){var i=t/ie.BinWidth,s=e/ie.BinWidth,r=o/ie.BinWidth,n=Math.floor(i-.5),a=Math.floor(s-.5),l=Math.floor(r-.5),c=i-(n+.5),p=s-(a+.5),u=r-(l+.5);this.addWeight(n,a,l,(1-c)*(1-p)*(1-u)),this.addWeight(n,a,l+1,(1-c)*(1-p)*u),this.addWeight(n,a+1,l,(1-c)*p*(1-u)),this.addWeight(n,a+1,l+1,(1-c)*p*u),this.addWeight(n+1,a,l,c*(1-p)*(1-u)),this.addWeight(n+1,a,l+1,c*(1-p)*u),this.addWeight(n+1,a+1,l,c*p*(1-u)),this.addWeight(n+1,a+1,l+1,c*p*u)}findMaxBinCenter(){for(var t=-1,e=-1,o=-1,i=-1,s=0,r=0;s<ie.LinearSize;s++)for(var n=0;n<ie.LinearSize;n++)for(var a=0;a<ie.LinearSize;a++,r++)this.data[r]>i&&(i=this.data[r],t=s,e=n,o=a);return 255<<24|(255&(t+.5)*ie.BinWidth)<<16|(255&(e+.5)*ie.BinWidth)<<8|255&(o+.5)*ie.BinWidth}printStats(){for(var t=0;t<this.data.length;t++)this.data[t]}encode(){for(var t=new oe,e=this.data,o=0,i=0;i<e.length;){for(;i<e.length&&0==Math.floor(e[i]);)i++;if(i!=e.length){var s=i-o,r=Math.floor(e[i]);s+","+r+";",t.writeUintVariableLength(s),t.writeUintVariableLength(r),o=i,i++}}return t.toBase64()}}ie.NumBitsKept=4,ie.NumBitsCleared=8-ie.NumBitsKept,ie.BinWidth=1<<ie.NumBitsCleared,ie.LinearSize=1<<ie.NumBitsKept,ie.SquaredSize=ie.LinearSize*ie.LinearSize,ie.CubedSize=ie.SquaredSize*ie.LinearSize,ie.NumBins=ie.CubedSize,function(t){t[t.Disconnected=0]="Disconnected",t[t.Connecting=1]="Connecting",t[t.Connected=2]="Connected",t[t.Error=3]="Error"}(F||(F={}));class se{constructor(t){this.state=F.Disconnected,this.websocket=null,this.arraybuffer=null,this.hasReceivedMessage=!1,this.closeReason=null,this.lastDebugUrl="unknown",this.opts=$.extend({numberOfSilentRetriesBeforeShowingErrorToUser:3,millisBetweenSilentRetries:1e3},t),this.eventHandlers={open:t=>{this.onOpen()},close:t=>{this.onClose(t)},message:t=>{this.onMessage(t)},heartbeater:()=>{this.opts.heartbeat&&null!=this.websocket&&this.websocket.readyState==WebSocket.OPEN&&this.doSend(this.opts.heartbeat.message)}},this.retryable=new Bt({label:this.opts.label,execute:(t,e)=>{this.clearWebSocket(F.Connecting),this.hasReceivedMessage=!1,this.closeReason=null;let o=this.opts.url();this.lastDebugUrl=o.split("?")[0],this.websocket=new WebSocket(o),this.websocket.binaryType="arraybuffer",this.websocket.addEventListener("open",this.eventHandlers.open),this.websocket.addEventListener("close",this.eventHandlers.close),this.websocket.addEventListener("message",this.eventHandlers.message)},success:()=>{this.opts.connectedToNewServer()},numberOfSilentRetriesBeforeShowingErrorToUser:this.opts.numberOfSilentRetriesBeforeShowingErrorToUser,millisBetweenSilentRetries:this.opts.millisBetweenSilentRetries}).start()}clearWebSocket(t){this.state=t,null!=this.websocket&&(this.websocket.removeEventListener("open",this.eventHandlers.open),this.websocket.removeEventListener("close",this.eventHandlers.close),this.websocket.removeEventListener("message",this.eventHandlers.message),this.websocket.close(),this.websocket=null),this.arraybuffer=null,this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=void 0)}onOpen(){P.gaTrack("WebSocket",this.lastDebugUrl,"connected",1),this.opts.heartbeat&&this.opts.heartbeat.millis>0&&(this.heartbeatTimer=setInterval(this.eventHandlers.heartbeater,this.opts.heartbeat.millis)),this.opts.sendOnOpen?this.doSend(this.opts.sendOnOpen):this.eventHandlers.heartbeater()}onClose(t){this.clearWebSocket(F.Disconnected);let e=t.reason;if(this.closeReason&&!e&&(e=this.closeReason.code.toString()),e){if(this.opts.puntOnCloseReason&&this.opts.puntOnCloseReason(e))return void this.retryable.executionPunt();{let t=this.opts.closeReasonToMessage(e);if(t)return this.onError(t)}}else if(!this.hasReceivedMessage)return this.onError(this.opts.unableToConnectMessage);this.opts.disconnectedFromServer()?this.onError(this.opts.unexpectedCloseMessage):this.retryable.executionStopped()}onError(t){P.gaTrack("WebSocket",this.lastDebugUrl,"error: "+t,0),this.opts.customOnError&&!this.opts.customOnError(t)||this.retryable.executionError(t)}onMessage(t){if("string"==typeof t.data){const e=JSON.parse(t.data);if(e.closeReason)return this.closeReason=e.closeReason,void this.websocket.close();!this.hasReceivedMessage&&this.doSend(this.opts.heartbeat.message)&&(this.hasReceivedMessage=!0,this.state=F.Connected,this.retryable.executionSuccess()),null!=this.arraybuffer&&(e.arraybuffer=this.arraybuffer,this.arraybuffer=null),this.opts.newMessageFromServer(e)}else this.arraybuffer=t.data}doSend(t){try{return this.websocket.send(JSON.stringify(t)),!0}catch(t){return this.clearWebSocket(F.Error),this.onError(this.opts.sendFailedMessage+"Error: "+t),!1}}send(t){return null==this.websocket||this.websocket.readyState!=WebSocket.OPEN?(null==this.websocket&&this.retryable.tryExecute(),!1):this.doSend(t)}getState(){return this.state}forceClose(){let t=this.websocket;this.clearWebSocket(F.Disconnected),t.close()}}!function(t){var e,o=0;function i(){return e.getState()==F.Connected}t.checkForceClose=function(){e&&i()&&(e.forceClose(),e=void 0)},t.isConnected=i,t.initialize=function(t){e=new se({url:function(){return U.getWorkerUrl("/api/websocket",{imageId:t.imageId.toString(),secret:t.secret,requestScanMask:t.requestScanMask.toString(),requestPhotoMask:t.requestPhotoMask.toString(),priority:o.toString()})},connectedToNewServer:function(){o=0,t.connectedToNewServer()},disconnectedFromServer:t.disconnectedFromServer,newMessageFromServer:t.newMessageFromServer,heartbeat:{millis:2e4,message:{command:_.StatusCheck}},label:p.s("Connect to worker"),puntOnCloseReason:function(t){return"-3"==t&&o++<window.Globals.NumPuntsWhenWorkersBusy},closeReasonToMessage:function(t){switch(t){case"2":return p.s("Unknown image - it may have been deleted, or you may not have the necessary credentials to access it");case"-3":return p.s("Workers overloaded. Additional workers are being spawned - they should be online in a couple of minutes. ");case"-4":return;default:return t}},unableToConnectMessage:p.s("Unable to connect to the worker. Is your firewall or proxy blocking WebSockets?"),unexpectedCloseMessage:p.s("Unexpected worker disconnection. "),sendFailedMessage:p.s("Failed to send message to worker. ")})},t.send=function(t){return e.send(t)}}(I||(I={}));class re{constructor(t,e,o,i,s,r=!1,n=!1,a=re.DefaultCursorSpec,l=1,c=1){this.key=t,this.colorBytesRgba=e,this.isEraser=o,this.needBrushes=i,this.isEyeDropper=s,this.isDeselectable=r,this.serverCares=n,this.cursorSpec=a,this.diameterScale=l,this.minDiameter=c,this.cssClass=t+"-tool",this.buttonSelector="label."+t+"-tool",this.cursorSpec=a,this.elems=null,this.needsHover=o||i,this.mask=null,this.brushCache=new Yt,this.cssColor=P.colorBytesToRgbaCss(e),this.abgr32=P.colorBytesToAbgr32(e),this.rgba32=P.colorBytesToRgba32(e),this.endian32=P.LittleEndian?this.abgr32:this.rgba32,B.addMode(this)}static createBrush(t,e){const o=new It(t,t),i=new It(t,t),s=new It(t,t),r=t/2;o.fillAliasedCircle(r,r,r,e),s.fillAliasedCircle(r,r,r,[255,255,255,255]);const n=new Uint32Array(o.context().getImageDataFull().data.buffer),a=255==e[3];if(a)i.context().drawCanvasEx(o,0,0);else{const t=e.slice();t[3]=255,i.fillAliasedCircle(r,r,r,t)}return{canvas:o,opaqueCanvas:o,mask:s,data:n,isOpaque:a}}static simple(t,e=re.DefaultCursorSpec){return new re(t,[0,0,0],!1,!1,!1,!1,!1,e)}static deselectable(t,e){return new re(t,[0,0,0],!1,!1,!1,e)}isGrab(){return this==B.Grab}isFgOrBg(){return this==B.Foreground||this==B.Background}elements(){return null==this.elems&&(this.elems=$(this.buttonSelector),this.elems.click(()=>{this.pick()})),this.elems}pick(){B.select(this)}getBrush(t){return this.needBrushes?this.brushCache.get(t)||this.brushCache.put(t,re.createBrush(t,this.colorBytesRgba)):re.EmptyBrush}drawSquare(t,e,o){this.isEraser?this.mask&&this.mask.clearSquare(t,e,o):this.mask&&this.mask.drawBrush(t,e,o,this.getBrush(o))}drawLine(t,e,o){this.isEraser?this.mask&&this.mask.clearLine(t,e,o):this.mask&&this.mask.drawBrushLine(t,e,o,this.getBrush(o))}getCursor(){return _.ScreenshotMode?(this.cursorSpec.img||(this.cursorSpec.img=new Image,this.cursorSpec.src||(this.cursorSpec.src=this.key+"-tool-icon.png"),this.cursorSpec.img.src="/assets/m/drawings/"+this.cursorSpec.src),this.cursorSpec):null}}re.DefaultCursorSpec={x:0,y:0,src:"pan-tool-icon.png"},re.EmptyBrush=re.createBrush(0,[0,0,0,0]),function(t){const e=[],o=new Yt;t.addMode=function(t){e.push(t),o.put(t.key,t)},t.getMode=function(t){return o.get(t)},t.Background=new re("red",[255,0,0,255],!1,!0,!1,!1,!0,{x:0,y:0}),t.Foreground=new re("green",[0,255,0,255],!1,!0,!1,!1,!0,{x:0,y:0}),t.Hair=new re("hair",[255,255,0,128],!1,!0,!1,!1,!0,{x:0,y:0,src:"hair-brush-icon.png"},1.5,3),t.MaskEraser=new re("erase",[0,0,255,255],!0,!1,!1,!1,!0,{x:0,y:0},1.5,3),t.BackgroundEyeDropper=new re("eyedropper-bg",[255,0,128,255],!1,!1,!0,!1,!1,{x:0,y:13}),t.GrayEyeDropper=new re("eyedropper-gray",[128,128,128,255],!1,!1,!0,!1,!1,{x:0,y:13}),t.Grab=re.simple("pan"),t.ContextMenu=re.simple("context-menu"),t.ResizeTop=re.simple("resize-top"),t.ResizeTopRight=re.simple("resize-top-right"),t.ResizeRight=re.simple("resize-right"),t.ResizeBottomRight=re.simple("resize-bottom-right"),t.ResizeBottom=re.simple("resize-bottom"),t.ResizeBottomLeft=re.simple("resize-bottom-left"),t.ResizeLeft=re.simple("resize-left"),t.ResizeTopLeft=re.simple("resize-top-left"),t.ResizeMove=re.simple("resize-move"),t.Sword=re.simple("sword",{x:1,y:1}),t.ShadowArrow=re.simple("shadow-arrow"),t.ShadowEllipse=re.simple("shadow-ellipse",{x:3,y:3,src:"shadow-ellipse-tool-cursor.png"}),t.ShadowMove=re.deselectable("shadow-move",!1),t.ShadowMirror=re.simple("shadow-mirror");var i=t.Grab,s=t.Grab,r=null,n=null;function a(t){x.App.toolModeChangeHandler(t)}function l(){return s}function c(){return n||r||s}function p(t=!1){(i!=c()||t)&&(null!=i&&(t?$(".tool-radio-button").removeClass("active"):i.elements().removeClass("active")),(i=c()).elements().button("toggle"),null!=a&&a(i))}function u(e){s&&s.key;s==e&&s.isDeselectable?(u(t.Grab),setTimeout(p,0,!0)):!function(t){return x.App.toolModeValidate(t)}(e)?setTimeout(p,0,!0):(r=null,s=e,e.mask&&e.mask.resetLast(),p())}function h(t){r=t,p()}t.buildUserMask=function(e,o){return new pe(e,o,[0,t.Background.endian32,t.Foreground.endian32,t.Hair.endian32])},t.HairLevelToEndian32=[0,t.Hair.endian32,t.Hair.endian32,t.Hair.endian32,t.Hair.endian32],t.initialize=function(){for(var t=0;t<e.length;t++)e[t].elements()},t.getSelectedMode=l,t.getVisibleMode=function(){return i},t.getTempMode=function(){return r},t.getActiveMode=c,t.update=p,t.cycle=function(t,e){u(l()==t?e:t)},t.select=u,t.is=function(t){return c()==t},t.isNot=function(t){return c()!=t},t.setTempSelect=h,t.releaseTempSelect=function(){h(null)},t.mouseDown=function(){n=c()},t.mouseUp=function(){n&&(n=null,p())},t.forceSelection=function(t,e,o){s=t,r=e,n=o,p()}}(B||(B={})),function(t){const e=[],o=[];t.sourceFunction=P.empty,t.stateUpdated=P.empty;var i=0;function s(s){s=s||t.sourceFunction(),e.push(s),e.length>100&&e.shift(),o.length=0,i=Date.now()+2e3,t.stateUpdated()}t.push=s,t.undo=function(){var i=e.pop();return o.push(t.sourceFunction()),t.stateUpdated(),i},t.redo=function(){var i=o.pop();return e.push(t.sourceFunction()),t.stateUpdated(),i},t.canUndo=function(){return e.length>0},t.canRedo=function(){return o.length>0},t.schedulePush=function(){Date.now()>i&&s()}}(O||(O={})),function(t){t.downloadUrl=function(t,e){return"/images/"+t+"/download/"+e},t.downloadParityUrl=function(t,e,o,i,s){return"/images/"+t+"/downloadParity/"+e+"/"+o+"/"+i+"/"+encodeURIComponent(s)},t.downloadAlphaGrayscaleUrl=function(t,e){return"/images/"+t+"/downloadAlphaGrayscale/"+e},t.downloadSvgPathUrl=function(t,e){return"/images/"+t+"/downloadSvgPath/"+e},t.downloadTiffPathUrl=function(t,e){return"/images/"+t+"/downloadEmbeddedClippingPath/"+e},t.shareUrl=function(t,e){return"/images/"+t+"/"+e},t.surveyUrl=function(t,e){return"/survey?id="+t+"&secret="+e},t.redirectUrl=function(t,e,o){return"/internal/redirect?url="+encodeURIComponent(t)+"&kind="+encodeURIComponent(e)+"&message="+encodeURIComponent(o)},t.fetchUrl=function(t){return"/api/fetchUrl?url="+encodeURIComponent(t)},t.userImageRemove=function(t,e){return"/api/images/delete/"+t+"?bulk="+e},t.userImageUndelete=function(t,e,o,i){return"/api/images/undelete/"+t+"?bulk="+i+"&s="+encodeURIComponent(e)+"&us="+encodeURIComponent(o)},t.userImageRename=function(t,e){return"/api/images/rename/"+t+"?bulk="+e}}(L||(L={}));class ne{constructor(t=0){this.seed=t}nextInt(){return this.seed=(ne.a*this.seed+ne.c)%ne.m,this.seed}nextDouble(){return this.nextInt()/ne.m}nextIntBounded(t){return Math.abs(this.nextInt())%t}}ne.a=1103515245,ne.c=12345,ne.m=1<<31,function(t){const e=_.AutoLevelsMaxNumSamples,o=_.AutoLevelsPercentile,i=_.AutoLevelsMaxSetting,s=_.AutoLevelsNumBuckets;t.run=function(t,r,n){let a=new ne(1e4*n+r),l=t.length/4,c=Math.min(e,l),p=c*o,u=new Uint32Array(s),h=new Uint32Array(s);for(let e=0;e<c;e++){let e=4*a.nextIntBounded(l),o=t[e]/255,i=t[e+1]/255,s=t[e+2]/255,r=0|P.clamp(Math.min(o,i,s)*h.length,0,h.length-1),n=0|P.clamp(Math.max(o,i,s)*u.length,0,u.length-1);h[r]++,u[n]++}let d=0,g=0;for(;d<h.length&&(g+=h[d],!(g>=p));d++);let m=0;for(g=0;m<u.length&&(g+=u[u.length-m-1],!(g>=p));m++);d/=h.length,m=1-m/u.length;let f=1/m,S=1/(1-d/m);return f=P.clamp(Math.floor(100*(f-1)),0,i),S=P.clamp(Math.floor(100*(S-1)),0,i),{highlights:f,shadows:S}}}(z||(z={})),function(t){function e(t){return function(e,o,i){t(P.formatXhrError(e,o))}}function o(t,e){return function(o,i,s){o.error?t(o.error):e(o)}}t.createUserImageSpec=function(t,i,s,r){c.ajax({url:"/api/images",cache:!1,data:{originalFilename:t.name,contentType:t.type,w:i.width(),h:i.height(),sizePixels:i.width()*i.height(),sizeBytes:t.size},dataType:"json",error:e(s),success:o(s,r),type:"POST"})},t.readUserImageSpec=function(t,i,s,r){$.ajax("/api/images/"+t+"/"+i,{cache:!1,dataType:"json",error:e(s),success:o(s,r),type:"GET"})},t.updateMetaData=function(t,i,s,r,n){c.ajax({url:"/api/images/"+t+"/"+i,cache:!1,data:s,dataType:"json",error:e(r),success:o(r,n),type:"POST"})},t.listImagesEx=function(t,i,s,r,n,a,l,c){$.ajax("/api/imagesEx/"+t,{cache:!1,data:{minId:i,maxId:s,maxCount:r,ids:n,q:a},dataType:"json",error:e(l),success:o(l,c),type:"GET"})},t.setStickySettings=function(t,i,s){c.ajax({url:"/api/setStickySettings?stickySettings="+encodeURIComponent(t),cache:!1,data:{},dataType:"json",error:e(i),success:o(i,s),type:"POST"})},t.modifyStickySettings=function(t,i,s){c.ajax({url:"/api/modifyStickySettings?stickySettings="+encodeURIComponent(t),cache:!1,data:{},dataType:"json",error:e(i),success:o(i,s),type:"POST"})},t.getWorkerUrl=function(t,e){let o=("http:"==location.protocol?"ws:":"wss:")+"//"+location.host+t+"?"+GlobalsShared.localeQueryParameter+"="+GlobalsShared.locale;for(let t in e)e.hasOwnProperty(t)&&(o+="&"+t+"="+e[t]);return o}}(U||(U={})),function(t){let e=null;function o(){return location.href.split("#")[0]}function i(t){const i=t.originalEvent;if(i.state&&!x.M.appHasAlreadyRun){const t=i.state;window.resumeUserImage(t.id,t.secret)}else x.M.appHasAlreadyRun&&e!=o()&&(location.replace(location.href),location.href.indexOf("#")>=0&&location.reload());e=o()}t.exitHref="/bulk",t.initialize=function(){e=o(),D.$window.on("popstate",i)},t.goTo=function(i,s){const r=location,n=r.pathname,a="/images/"+i.id+"/edit/"+i.secret,l=0===n.lastIndexOf(a,0);document.title=i.originalFilename+" - Clipping Magic",l?s&&(t.exitHref=r.protocol+"//"+r.host):(s&&(t.exitHref=r.href),history.pushState(i,"",a),P.gaSetPageAndSendPageview("/images/edit"),e=o())},t.exit=function(){const e=o();location.href=t.exitHref,t.exitHref.indexOf("#")>=0&&P.startsWith(t.exitHref,e)&&location.reload()}}(G||(G={})),function(t){let e=!1,o=null;function i(){return e?r():s(),!1}function s(){e||($("html").addClass("help-showing").removeClass("help-hidden"),D.CmApp.Help.Button.$().addClass("active"),D.CmApp.Help.Popover.$().fadeIn(),D.TutorialLightboxOuter.$().fadeIn(),o&&o.play(),e=!0)}function r(){return!!e&&($("html").removeClass("help-showing").addClass("help-hidden"),D.CmApp.Help.Button.$().removeClass("active"),D.CmApp.Help.Popover.$().slideUp(),D.TutorialLightboxOuter.$().fadeOut(),o&&o.pause(),e=!1,!0)}t.toggle=i,t.initialize=function(e){o||(D.CmApp.Help.button.$().click(i),D.TutorialLightboxOuter.$().click(r),o=D.video_green_lightbox.el()),e&&t.show()},t.show=s,t.hide=r}(N||(N={})),function(t){t.visible=!1;let e=!0;let o,i=0,s=null,r=void 0;function n(t,e){e.$().attr("style","width:"+t+"%"),e.$().toggleClass("active",.1<t&&t<99.9)}function a(t){n(t,D.StartupLightbox.Uploading)}function l(t){n(t,D.StartupLightbox.Initializing)}function c(){return D.StartupLightbox.Uploading.$().parent().parent().parent()}function p(){c().hide()}function u(){P.gaTrack("StartupProgress","timeout",r,3e4),e=!1}t.hideShadowPane=function(){D.StartupLightbox.Outer.addClass(D.StartupLightbox.single_pane)},t.showShadowPane=function(){D.StartupLightbox.Outer.removeClass(D.StartupLightbox.single_pane)},t.uploadProgress=a,t.initProgress=l,t.alreadyUploaded=p,t.track=function(t){i=Date.now(),r=t},t.show=function(e,i=!1){t.visible=!0,clearTimeout(o),o=setTimeout(u,3e4),D.StartupLightbox.content.$().attr("style",""),D.StartupLightbox.Id.$().find(".modal-content").attr("style","margin: 0 auto;"),D.StartupLightbox.Id.$().show(),D.StartupLightbox.Outer.$().show(),i||c().show(),e&&window.GlobalsEx.showTutorial?(D.StartupLightbox.Id.addClass(D.StartupLightbox.video_playing),s=D.StartupLightbox.video.el(),s&&s.play()):D.StartupLightbox.video.$().hide(),N.initialize(!1)},t.hide=function(){t.visible&&(t.visible=!1,clearTimeout(o),D.StartupLightbox.Outer.$().fadeOut(),D.StartupLightbox.Id.$().hide(),s&&(s.pause(),P.blink2(D.CmApp.Help.Button)),a(0),l(0),p(),e&&(P.gaTrack("StartupProgress","initializing",r,Date.now()-i),e=!1))}}(H||(H={})),function(t){function e(t,e,o){let i="";if(o){let t=new Date;t.setTime(t.getTime()+24*o*60*60*1e3),i="; expires="+t.toUTCString()}document.cookie=t+"="+l.encode(e||"")+i+"; path=/"}function o(t,e){let o=t+"=",i=document.cookie.split(";");for(let t=0;t<i.length;t++){let s=i[t];for(;" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(o))return l.decodeString(s.substring(o.length,s.length),e)}return e}function i(t){document.cookie=t+"=; Max-Age=-99999999;"}t.Cookie=class{constructor(t,e=365){this.name=t,this.days=e}get(t){return o(this.name,t)}set(t){return e(this.name,t,this.days)}getBoolean(){return!!this.get()}setBoolean(t){t?this.set("1"):this.erase()}erase(){i(this.name)}},t.set=e,t.get=o,t.containsKey=function(t){return!!o(t)},t.getBoolean=function(t,e){let i=o(t);return"true"==i||"false"!=i&&e},t.getInt=function(t,e){let i=o(t);if(null!=i){let t=parseInt(i);if(isFinite(t))return t}return e},t.getFloat=function(t,e){let i=o(t);if(null!=i){let t=parseFloat(i);if(isFinite(t))return t}return e},t.getJson=function(t,e){let i=o(t);try{if(null!=i)return a.cast(JSON.parse(i))}catch(t){}return e},t.setJson=function(t,o,i){e(t,JSON.stringify(o),i)},t.erase=i}(V||(V={})),function(t){const e=D.video.green.show.name()+" "+D.video.erase.show.name();var o=!1,i=null,s=!1;var r=0,n=0,a=!1,l=!1;function c(s){l=!0,o||(o=!0,D.guide_next_button.$().click(t.hide)),function(t){s=t.show,D.GuideLightbox.$().removeClass(e).addClass(s.name()),function(t){var e=p(t)-20-10+"px";D.GuideLightbox.$().css({left:e});var o=p(t)-10+"px";D.GuideLightbox.$().children(D.arrow.css()).css({left:o})}(t.Tool),o=t,i&&(i.pause(),i=null),(i=o.Id.el())&&i.play();var o;var s}(s),D.GuideLightboxOuter.$().show()}function p(t){var e=t.$(),o=e.offset(),i=e.outerWidth();return Math.max(0,i/2+o.left)}function u(){if(!x.M.settings.autoClip&&!a&&(r>=5&&0==n||0==r&&n>=5)){a=!0;let t=window.GlobalsEx.showGuides;P.gaTrack("guide","showAlternate",t.toString(),t?1:0),t&&c(D.video.green)}}t.hide=function(){l&&(l=!1,D.GuideLightboxOuter.$().hide())},t.checkShowHighlighting=function(){if(!s){s=!0;let t=window.GlobalsEx.showGuides;P.gaTrack("guide","showHighlighting",t.toString(),t?1:0),t&&c(D.video.erase)}},t.strokeGreen=function(){r++,u()},t.strokeRed=function(){n++,u()},t.strokeResume=function(){r++,n++}}(W||(W={})),function(t){t.decode=function(t,e,o,i){for(var s=new Uint8Array(t),r=0,n=0,a=0;r<s.length;){var l=s[r++],c=3&l,p=1+(l>>3&31);if(0==(4&l)?3==c||(p+=s[r++]<<5):p+=3==c?s[r++]<<5:(s[r++]<<5)+(s[r++]<<13)+(s[r++]<<21),0==c)n+=p;else if(1==c)for(a=0;a<p;a++,n++)e(4*n);else if(2==c)for(a=0;a<p;a++,n++)o(4*n);else for(a=0;a<p;a++,n++)i(4*n,s[r++],s[r++],s[r++],s[r++])}}}(Y||(Y={})),function(t){function e(){return null!=t.savedMask}t.hasSavedMaskS3=function(){return window.GlobalsEx.hasSavedMask},t.hasSavedMaskClient=e;var o=-1,i=-1,s=!1,r=null,n=-1;function a(){return e()?(null!=r&&r.width()==t.savedMask.width&&r.height()==t.savedMask.height||(r=B.buildUserMask(t.savedMask.width,t.savedMask.height)).decode(t.savedMask.userMask,t.savedMask.maskVersion),0!=n&&clearTimeout(n),n=setTimeout(l,1e4),r):null}function l(){n=-1,r=null}function c(){e()?D.CmApp.Tools.paste_mask_tool.$().removeAttr("disabled"):D.CmApp.Tools.paste_mask_tool.$().attr("disabled","disabled")}function u(){var t=Math.floor(50*i/o),e=B.buildUserMask(50,t),s=Math.floor(.8*t);e.context().setFillStyle(B.Background.cssColor),e.context().fillRect(0,0,1,s),e.context().fillRect(0,0,50,1),e.context().fillRect(49,0,1,s),h({userMask:e.encode(),maskVersion:_.MaskVersion,width:50,height:t,toolModeKey:B.Foreground.key})}function h(e){t.savedMask=e,l(),c()}function d(){var e=x.M.userMask;h({userMask:e.encode(),maskVersion:_.MaskVersion,width:e.width(),height:e.height(),toolModeKey:B.getSelectedMode().key}),window.GlobalsEx.savedMaskS3Spec&&k.uploadS3JsonWithRetry(t.savedMask,window.GlobalsEx.savedMaskS3Spec,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Storing Copied Mask"),maxAge:0,success:()=>{window.GlobalsEx.hasSavedMask=!0,x.M.sendSetGlobal(),window.Globals.Bulk.isIframe&&window.checkPostMessage({command:_.SavedMaskUpdated})},giveUpAfterSilentRetries:!0})}function g(){var e=a();if(null!=e){for(var s=e.width(),r=e.height(),n=e.context().getImageData(0,0,s,r).data,l=x.M.userMask,c=l.context().getImageData(0,0,o,i),p=c.data,u=s/o,h=r/i,d=0,g=0;d<i;d++)for(var m=Math.floor(d*h),f=0;f<o;f++,g+=4)for(var S=4*(Math.floor(f*u)+s*m),w=0;w<3;w++){var C=n[S+w];0!=C&&(p[g+w]=C,p[g+3]=255)}O.push(),l.putImageData(c),setTimeout(()=>{x.M.sendSetUserMask(!0),x.App.refreshAllViews()})}t.pasteButtonIsHovered=!1,x.App.refreshAllViews()}t.savedMask=null,t.pasteButtonIsHovered=!1,t.getMask=a,t.initializeUi=function(e,r){if(!s){if(o=e,i=r,window.GlobalsEx.savedMaskS3Spec)D.CmApp.Tools.copy_mask_tool.$().click(d),D.CmApp.Tools.paste_mask_tool.$().click(g),D.CmApp.Tools.paste_mask_tool.$().hover(()=>{t.pasteButtonIsHovered=!0,x.M.tempViewMarksToggle(!0),x.App.refreshAllViews()},()=>{t.pasteButtonIsHovered=!1,x.M.tempViewMarksToggle(!1),x.App.refreshAllViews()});else{const t=D.CmApp.Tools.copy_mask_tool.or(D.CmApp.Tools.paste_mask_tool).$().parent();if(window.Globals.Bulk.isApi)t.hide();else{const e=p.s("Please log in to copy/paste masks. ");t.addClass("disabled").attr({title:e,alt:e})}}s=!0}},t.checkFetch=function(){c(),window.GlobalsEx.hasSavedMask&&window.GlobalsEx.savedMaskS3Spec?$.ajax(window.GlobalsEx.savedMaskS3Spec.url,{cache:!1,dataType:"json",error:(t,e,o)=>{u()},success:h,type:"GET"}):u()}}(X||(X={})),function(t){let e=!1;t.doApply=function(){e=!0};const o="ClippingMagic.com";let i,s,r,n=-1,a=-1,l=[-1,-1,-1,-1];t.checkApply=function(t,c){if(e){const e=t.context();if(c&&4==c.length||(c=[0,0,e.width(),e.height()]),l[0]!=c[0]||l[1]!=c[1]||l[2]!=c[2]||l[3]!=c[3])for(n=c[2]-c[0],a=c[3]-c[1],l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],i=10,r=0;r<.65*n||r<50;)i+=2,s="bold "+i+"px sans-serif",e.setFont(s),r=e.measureText(o).width;let p=i+4,u=l[0]+(n-r)/2,h=l[1]+(a-p)/2;e.setGlobalAlpha(.25),e.setFont(s),e.setFillStyle("#fff"),e.fillText(o,u,h),e.setFillStyle("#000"),e.fillText(o,u,h),e.setStrokeStyle("#fff"),e.strokeText(o,u,h)}}}(q||(q={})),function(t){var e={showPreview:!0,showFrame:!0,showBackground:!0,title:""};var o=!1,i=!1,s=!1,r=0;const n=new Zt([new jt(D.CmApp.CropApp.MarginUnits.Pixels,_.CropMarginPixels),new jt(D.CmApp.CropApp.MarginUnits.Percent,_.CropMarginPercent)]),a=new Zt([new jt(D.CmApp.CropApp.ObjectSize.Small,_.CropSizeSmall),new jt(D.CmApp.CropApp.ObjectSize.Medium,_.CropSizeMedium),new jt(D.CmApp.CropApp.ObjectSize.Large,_.CropSizeLarge)]),l=new Zt([new jt(D.CmApp.CropApp.VerticalAlignment.Top,_.CropAlignmentTop),new jt(D.CmApp.CropApp.VerticalAlignment.Middle,_.CropAlignmentMiddle),new jt(D.CmApp.CropApp.VerticalAlignment.Bottom,_.CropAlignmentBottom)]),c=new Zt([new jt(D.CmApp.CropApp.Shadows.Ignore,_.CropShadowsIgnore),new jt(D.CmApp.CropApp.Shadows.Pad,_.CropShadowsPad),new jt(D.CmApp.CropApp.Shadows.Tight,_.CropShadowsTight)]);function u(){s=!1,h(),ut.subViewPort.refreshAllViews()}function h(){0!=r&&(clearTimeout(r),r=0)}function d(t){t.$().hover(()=>{s=!0,h(),ut.subViewPort.refreshAllViews()},()=>{h(),r=setTimeout(u,1e4)})}function g(t,e,o,i){P.mouseDownRepeater(t.decrease.$(),()=>{e(),ut.subViewPort.zoomToFit()},60,5,O.schedulePush,at.sendSetGlobal),P.mouseDownRepeater(t.increase.$(),()=>{o(),ut.subViewPort.zoomToFit()},60,5,O.schedulePush,at.sendSetGlobal),t.reset.$().click(()=>{i(),ut.subViewPort.zoomToFit()})}function m(){if(!o){o=!0,D.CmApp.CropApp.close_button.$().click(M),D.CmApp.CropApp.Mode.Unconstrained.$().click(()=>{y(_.CropUnconstrained)}),D.CmApp.CropApp.Mode.LockedAspectRatio.$().click(()=>{y(_.CropLockedAspectRatio)}),D.CmApp.CropApp.Mode.TargetSize.$().click(()=>{y(_.CropTargetSize)}),D.CmApp.CropApp.fit_to_original_btn.$().click(()=>{at.setCropFitToResult(!1,!0),at.setCropMode(_.CropUnconstrained,!0),at.setCrop_o(null,!0),ut.subViewPort.zoomToFit()}),R.registerRadioGroup(n,b),R.registerRadioGroup(a,v),R.registerRadioGroup(l,A),R.registerRadioGroup(c,k),g(D.CmApp.CropApp.PaddingPercent,at.cropPaddingDecrease,at.cropPaddingIncrease,at.cropPaddingReset),g(D.CmApp.CropApp.PaddingPixels,at.cropPaddingPixelsDecrease,at.cropPaddingPixelsIncrease,at.cropPaddingPixelsReset),g(D.CmApp.CropApp.Dpi,at.outputDpiDecrease,at.outputDpiIncrease,at.outputDpiReset),D.CmApp.CropApp.DpiPresets.preset72.$().click(()=>at.setOutputDpi(72,!0)),D.CmApp.CropApp.DpiPresets.preset96.$().click(()=>at.setOutputDpi(96,!0)),D.CmApp.CropApp.DpiPresets.preset300.$().click(()=>at.setOutputDpi(300,!0)),d(D.CmApp.CropApp.StraightenSpinner.decrease),d(D.CmApp.CropApp.StraightenSpinner.increase),D.CmApp.CropApp.FitToResultButton.$().click(()=>{at.setCropFitToResult(!at.settings.cropFitToResult,!0),ut.subViewPort.animateZoomToFit()}),D.CmApp.CropApp.reset_button.$().click(()=>{at.resetCrop(),ut.subViewPort.animateZoomToFit()}),D.CmApp.CropApp.allow_enlarging_result.$().click(()=>{at.setCropAllowEnlarging(!at.settings.cropAllowEnlarging,!0,!0),ut.subViewPort.animateZoomToFit()});var t=D.CmApp.CropApp.AspectRatio.List.$();t.empty();for(var e=0;e<_.AspectRatios.length;e++)w(t,_.AspectRatios[e]);var i=P.fuzzyAspectRatio(at.imageSize);_.AspectRatios.indexOf(i)<0&&(f(t),w(t,i)),f(t),S(t,p.s("Custom"),(function(){P.modal(D.CmApp.CropApp.AspectRatio.Lightbox.css())})),D.CmApp.CropApp.AspectRatio.OkButton.$().click(()=>{var t={w:parseFloat(D.CmApp.CropApp.AspectRatio.W.$().val()),h:parseFloat(D.CmApp.CropApp.AspectRatio.H.$().val())},e=t.w<=0||isNaN(t.w),o=t.h<=0||isNaN(t.h);o||e||(t.h/t.w>10||t.w/t.h>10)&&(e=o=!0),D.CmApp.CropApp.AspectRatio.WFg.$().toggleClass("has-error",e),D.CmApp.CropApp.AspectRatio.HFg.$().toggleClass("has-error",o),e||o||(at.setCropAspectRatio(t,!0,!0),D.CmApp.CropApp.AspectRatio.Lightbox.$().modal("hide"),ut.subViewPort.animateZoomToFit())});var s=D.CmApp.CropApp.TargetSize.List.$();s.empty();for(e=0;e<_.TargetSizes.length;e++)C(s,_.TargetSizes[e]);f(s),C(s,at.imageSize),f(s),function(t){S(t,p.s("Custom"),(function(){P.modal(D.CmApp.CropApp.TargetSize.Lightbox.css())}))}(s),D.CmApp.CropApp.TargetSize.OkButton.$().click(()=>{var t={w:parseInt(D.CmApp.CropApp.TargetSize.W.$().val()),h:parseInt(D.CmApp.CropApp.TargetSize.H.$().val())};let e=!(t.h*t.w<_.MaxOutputSize),o=t.w<1||isNaN(t.w)||t.w>_.MaxOutputWidthOrHeight||e,i=t.h<1||isNaN(t.h)||t.h>_.MaxOutputWidthOrHeight||e;D.CmApp.CropApp.TargetSize.WFg.$().toggleClass("has-error",o),D.CmApp.CropApp.TargetSize.HFg.$().toggleClass("has-error",i),o||i||(at.setCropTargetSize(t,!0,!0),D.CmApp.CropApp.TargetSize.Lightbox.$().modal("hide"),ut.subViewPort.animateZoomToFit())})}}function f(t){var e=$(document.createElement("li"));e.addClass("divider"),t.append(e)}function S(t,e,o){var i=$(document.createElement("li")),s=$(document.createElement("a"));return s.attr("href","#"),s.text(e),s.click(t=>{o(),ut.subViewPort.animateZoomToFit(),t.preventDefault()}),i.append(s),t.append(i),s}function w(t,e){S(t,P.formatAspectRatio(e),(function(){at.setCropAspectRatio(e,!0,!0)}))}function C(t,e){S(t,at.formatTargetSize(e),(function(){at.setCropTargetSize(e,!0,!0)}))}function y(t){at.setCropMode(t,!0),ut.subViewPort.zoomToFit()}function b(t){at.setCropMarginUnits(t,!0),ut.subViewPort.zoomToFit()}function v(t){at.setCropObjectSize(t,!0),ut.subViewPort.zoomToFit()}function A(t){at.setCropVerticalAlignment(t,!0),ut.subViewPort.zoomToFit()}function k(t){at.setCropShadows(t,!0),ut.subViewPort.zoomToFit()}function M(){D.CmApp.CropApp.Sidebar.$().hide(),D.SubappLightbox.$().modal("hide"),i=ut.subViewPort.showing=!1,x.App.subAppHidden(),s=!1}t.showGrid=function(){return s},t.initialize=m,t.show=function(){m(),B.Grab.pick(),D.subapp_sidebar.$().hide(),D.CmApp.CropApp.Sidebar.$().show(),D.CmApp.SubApps.tab.$().removeClass("active"),D.CmApp.CropApp.Tab.$().addClass("active"),P.modal(D.SubappLightbox.css()),ut.subViewPort.setViewConfigAndShow(e,t),i=!0,I()},t.hide=M,t.keyDownHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 27:if(dt.hide())break;M();break;case 82:t.shiftKey?x.App.straightenCounterclockwiseRepeater.down():at.rotateCounterclockwise();break;case 84:t.shiftKey?x.App.straightenClockwiseRepeater.down():at.rotateClockwise()}return!0},t.keyUpHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 82:x.App.straightenCounterclockwiseRepeater.up();break;case 84:x.App.straightenClockwiseRepeater.up()}return!0};let T={w:-1,h:-1},E="";function F(){const t=function(){let t=at.getCrop_o();if(at.settings.cropMode==_.CropTargetSize){let e=at.getCropTargetSize();if(null!=e&&(at.settings.cropAllowEnlarging||e.w<t.width()||e.h<t.height()))return e}return{w:t.width(),h:t.height()}}();return t.w==T.w&&t.h==T.h||(T=t,E=at.formatTargetSize(t)),E}function I(){if(i){var t=at.getCropAspectRatio();D.CmApp.CropApp.locked_aspect_ratio_display.$().text(P.formatAspectRatio(t));var e=at.getCropTargetSize();D.CmApp.CropApp.target_size_display.$().text(at.formatTargetSize(e));var o=at.settings.cropMode;o==_.CropUnconstrained?D.CmApp.CropApp.Mode.Unconstrained.$().prop("checked",!0):o==_.CropLockedAspectRatio?D.CmApp.CropApp.Mode.LockedAspectRatio.$().prop("checked",!0):o==_.CropTargetSize&&D.CmApp.CropApp.Mode.TargetSize.$().prop("checked",!0),n.update(at.settings.cropMarginUnits),a.update(at.settings.cropObjectSize),l.update(at.settings.cropVerticalAlignment),c.update(at.settings.cropShadows);var s=at.settings.cropMarginUnits==_.CropMarginPercent;D.CmApp.CropApp.PaddingPercent.container.$().toggle(s),D.CmApp.CropApp.PaddingPixels.container.$().toggle(!s),D.CmApp.CropApp.PaddingPercent.display.$().text((.1*at.settings.cropPaddingMils).toFixed(1)+"%"),D.CmApp.CropApp.PaddingPixels.display.$().text(at.settings.cropPaddingPixels.toFixed(0)+"px"),D.CmApp.CropApp.FitToResultButton.$().prop("checked",at.settings.cropFitToResult),D.CmApp.CropApp.fit_to_result_controls.$().toggle(at.settings.cropFitToResult),D.CmApp.CropApp.fit_to_result_comment.$().toggle(!at.settings.cropFitToResult),D.CmApp.CropApp.output_size_display.$().text(F()),D.CmApp.CropApp.allow_enlarging_result.$().prop("checked",at.settings.cropAllowEnlarging)}}t.outputSizeS=F,t.updateDisplay=I;var L=null,z=new Wt,U=!1;t.pointerInteraction=function(t){switch(t.type){case pt.InteractionType.CanvasLeave:B.releaseTempSelect();break;case pt.InteractionType.Hover:if(!ut.subViewPort.getShiftIsDown()){let t=function(){var t=ut.subViewPort.getMouse_c(),e=ut.subViewPort.getCrop_c();if(Math.abs(e.centerX()-t.x)<=20&&Math.abs(e.centerY()-t.y)<=20)return B.ResizeMove;if(t.x>e.left0-20&&t.x<e.right0+20&&t.y>e.top0-20&&t.y<e.bottom0+20){var o=t.x<e.left0+20,i=t.x>e.right0-20,s=t.y<e.top0+20,r=t.y>e.bottom0-20;if(o)return s?B.ResizeTopLeft:r?B.ResizeBottomLeft:B.ResizeLeft;if(i)return s?B.ResizeTopRight:r?B.ResizeBottomRight:B.ResizeRight;if(s)return B.ResizeTop;if(r)return B.ResizeBottom}return B.Grab}();B.setTempSelect(t)}break;case pt.InteractionType.ActionStart:B.isNot(B.Grab)&&(U=!1,L=at.getCrop_o());break;case pt.InteractionType.ActionMove:if(B.isNot(B.Grab)){let l=B.getActiveMode();U||(U=!0,at.settings.cropFitToResult?at.setCropFitToResult(!1,!0):O.push());var e=ut.subViewPort.getZoomScale(),o=ut.subViewPort.getClick_c(),i=(t.pageX-o.x)/e,s=(t.pageY-o.y)/e;if(z.setFrom(L),l==B.ResizeMove)z.left0+=i,z.right0+=i,z.top0+=s,z.bottom0+=s;else{var r=null;at.settings.cropMode==_.CropLockedAspectRatio?r=at.getCropAspectRatio():at.settings.cropMode==_.CropTargetSize&&(r=at.getCropTargetSize());var n=r?r.w/r.h:0,a=r?r.h/r.w:0;l==B.ResizeTop?(z.top0=L.top0+s,r&&(z.left0=L.left0+s*n/2,z.right0=L.right0-s*n/2)):l==B.ResizeTopRight?(z.top0=L.top0+s,z.right0=L.right0+i,r&&(z.y2x()>n?z.top0=L.top0-i*a:z.right0=L.right0-s*n)):l==B.ResizeRight?(z.right0=L.right0+i,r&&(z.top0=L.top0-i*a/2,z.bottom0=L.bottom0+i*a/2)):l==B.ResizeBottomRight?(z.bottom0=L.bottom0+s,z.right0=L.right0+i,r&&(z.y2x()>n?z.bottom0=L.bottom0+i*a:z.right0=L.right0+s*n)):l==B.ResizeBottom?(z.bottom0=L.bottom0+s,r&&(z.left0=L.left0-s*n/2,z.right0=L.right0+s*n/2)):l==B.ResizeBottomLeft?(z.bottom0=L.bottom0+s,z.left0=L.left0+i,r&&(z.y2x()>n?z.bottom0=L.bottom0-i*a:z.left0=L.left0-s*n)):l==B.ResizeLeft?(z.left0=L.left0+i,r&&(z.top0=L.top0+i*a/2,z.bottom0=L.bottom0-i*a/2)):l==B.ResizeTopLeft&&(z.top0=L.top0+s,z.left0=L.left0+i,r&&(z.y2x()>n?z.top0=L.top0+i*a:z.left0=L.left0+s*n))}at.setCrop_o(z,!1),ut.subViewPort.refreshAllViews()}break;case pt.InteractionType.ActionEnd:U&&at.sendSetGlobal()}};t.drawOver_i=function(t,e){},t.drawUnder_i=function(t,e,o,i){},t.drawUnder_c=function(t,e,o,i){},t.drawOver_c=function(t,e){t.empty(),e.setGlobalAlpha(1),e.setLineJoin("miter"),e.setLineCap("square");var o,i,s,r,n=ut.subViewPort.getCrop_c();function a(t,o,i,s,r){var n=B.is(r);e.setFillStyle("#ffffff"),e.fillRect(t+i,o+s,20*i,6*s),e.fillRect(t+i,o+s,6*i,20*s),e.setFillStyle(n?"#ff0000":"#000000"),e.fillRect(t+2*i,o+2*s,18*i,4*s),e.fillRect(t+2*i,o+2*s,4*i,18*s)}function l(t,o,i,s){var r=B.is(s);e.setFillStyle("#ffffff"),e.fillRect(t+i,o-10,6*i,20),e.setFillStyle(r?"#ff0000":"#000000"),e.fillRect(t+2*i,o-9,4*i,18)}function c(t,o,i,s){var r=B.is(s);e.setFillStyle("#ffffff"),e.fillRect(t-10,o+i,20,6*i),e.setFillStyle(r?"#ff0000":"#000000"),e.fillRect(t-9,o+2*i,18,4*i)}a(n.left0,n.top0,1,1,B.ResizeTopLeft),a(n.right0,n.top0,-1,1,B.ResizeTopRight),a(n.right0,n.bottom0,-1,-1,B.ResizeBottomRight),a(n.left0,n.bottom0,1,-1,B.ResizeBottomLeft),l(n.left0,Math.round(n.centerY()),1,B.ResizeLeft),l(n.right0,Math.round(n.centerY()),-1,B.ResizeRight),c(Math.round(n.centerX()),n.top0,1,B.ResizeTop),c(Math.round(n.centerX()),n.bottom0,-1,B.ResizeBottom),o=Math.round(n.centerX()),i=Math.round(n.centerY()),s=B.ResizeMove,r=B.is(s)?"#ff0000":"#000000",e.beginPath(),e.triangle(o,i-17.5,-Math.PI/2,2,5),e.triangle(o,i+17.5,Math.PI/2,2,5),e.triangle(o-17.5,i,Math.PI,2,5),e.triangle(o+17.5,i,0,2,5),e.strokeEx(2,"#FFF"),e.fillEx(r),e.fillCircle(o,i,12,"#FFFFFF"),e.fillCircle(o,i,11,r)}}(J||(J={})),function(t){var e=!1;function o(t=null){return e&&(e=!1,D.contextMenu.Lightbox.$().modal("hide"),null!=t&&t.preventDefault(),D.contextMenu.toolbar.$().hide()),!1}function i(t,o){return e=!0,P.modal(D.contextMenu.Lightbox.css(),!0,!0),t.preventDefault(),o.$().show().offset({left:t.clientX,top:t.clientY-30}),!1}t.dismiss=o,t.showMain=function(t){return i(t,D.contextMenu.ToolbarMark)},t.showShadowApp=function(t){return i(t,D.contextMenu.ToolbarShadowApp)},t.showColorsApp=function(t){return i(t,D.contextMenu.ToolbarColorsApp)},t.showBackgroundApp=function(t){return i(t,D.contextMenu.ToolbarBackgroundApp)},$(()=>{D.contextMenu.Lightbox.$().on("click",o).on("contextmenu",o)})}(Q||(Q={})),function(t){var e={showPreview:!0,showFrame:!0,showBackground:!0,showEyeDropperLoupe:!0,title:"",contextMenuHandler:Q.showColorsApp},o=!1;function i(){o||(o=!0,D.CmApp.ColorsApp.close_button.$().click(s),D.CmApp.ColorsApp.ColorSpace.SRgb.$().click(()=>at.setOutputColorSpace(_.ColorSpaceSrgb,!0)),D.CmApp.ColorsApp.ColorSpace.AdobeRgb.$().click(()=>at.setOutputColorSpace(_.ColorSpaceAdobeRgb,!0)),D.CmApp.ColorsApp.ColorSpace.AppleRgb.$().click(()=>at.setOutputColorSpace(_.ColorSpaceAppleRgb,!0)),D.CmApp.ColorsApp.ColorSpace.ColorMatchRgb.$().click(()=>at.setOutputColorSpace(_.ColorSpaceColorMatchRgb,!0)),P.hoverHelper(D.CmApp.ColorsApp.OriginalButton.$(),t=>{ut.subViewPort.setViewConfigs([t?rt.OrigConfig:e]),ut.subViewPort.refreshAllViews()}))}function s(){D.CmApp.ColorsApp.Sidebar.$().hide(),D.SubappLightbox.$().modal("hide"),ut.subViewPort.showing=!1,x.App.subAppHidden()}t.initialize=i,t.show=function(){try{i(),B.Grab.pick(),D.subapp_sidebar.$().hide(),D.CmApp.ColorsApp.Sidebar.$().show(),D.SubappLightbox.$().show(),D.CmApp.SubApps.tab.$().removeClass("active"),D.CmApp.ColorsApp.Tab.$().addClass("active"),P.modal("#subapp-lightbox"),ut.subViewPort.setViewConfigAndShow(e,t),!0}catch(t){}},t.hide=s,t.keyDownHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 27:if(dt.hide())break;s()}return!0},t.keyUpHandler=function(t){return!(t.ctrlKey||t.altKey||t.metaKey)&&(t.keyCode,!0)},t.mouseDownHandler=function(t){var e=B.getVisibleMode();if(e.isEyeDropper&&0==t){var o=ut.subViewPort.getMouse_ii(),i=at.getOriginalPixel(o.x,o.y);e==B.BackgroundEyeDropper?at.setCastColor(i,!0,!0):e==B.GrayEyeDropper&&at.setWhiteBalanceGrayColor(i,!0,!0)}},t.mouseMoveHandler=function(t,e,o){},t.mouseUpHandler=function(t){B.getSelectedMode().isEyeDropper&&B.Grab.pick()},t.mouseDoubleClickHandler=function(t){},t.touchEndHandler=function(){},t.mouseWheelHandler=function(t){},t.pointerInteraction=function(t){switch(t.type){case pt.InteractionType.ActionEnd:let t=B.getVisibleMode();if(t.isEyeDropper){var e=ut.subViewPort.getMouse_ii(),o=at.getOriginalPixel(e.x,e.y);t==B.BackgroundEyeDropper?at.setCastColor(o,!0,!0):t==B.GrayEyeDropper&&at.setWhiteBalanceGrayColor(o,!0,!0)}B.getSelectedMode().isEyeDropper&&B.Grab.pick()}},t.drawUnder_c=function(t,e,o,i){},t.drawOver_i=function(t,e){},t.drawUnder_i=function(t,e,o,i){},t.drawOver_c=function(t,e){}}(j||(j={})),function(t){var e={showPreview:!0,showFrame:!0,showBackground:!0,showEyeDropperLoupe:!0,title:"",contextMenuHandler:Q.showBackgroundApp},o=!1;function i(){o||(o=!0,D.CmApp.BackgroundApp.close_button.$().click(s),P.hoverHelper(D.CmApp.BackgroundApp.OriginalButton.$(),t=>{ut.subViewPort.setViewConfigs([t?rt.OrigConfig:e]),ut.subViewPort.refreshAllViews()}))}function s(){D.CmApp.BackgroundApp.Sidebar.$().hide(),D.SubappLightbox.$().modal("hide"),ut.subViewPort.showing=!1,x.App.subAppHidden()}t.initialize=i,t.show=function(){try{i(),B.Grab.pick(),D.subapp_sidebar.$().hide(),D.CmApp.BackgroundApp.Sidebar.$().show(),D.SubappLightbox.$().show(),D.CmApp.SubApps.tab.$().removeClass("active"),D.CmApp.BackgroundApp.Tab.$().addClass("active"),P.modal("#subapp-lightbox"),ut.subViewPort.setViewConfigAndShow(e,t),!0}catch(t){}},t.hide=s,t.keyDownHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 27:if(dt.hide())break;s();break;case 66:at.stepBackgroundColor(t.shiftKey);break;case 71:at.jumpToLastBackgroundColor()}return!0},t.keyUpHandler=function(t){return!(t.ctrlKey||t.altKey||t.metaKey)&&(t.keyCode,!0)},t.mouseDownHandler=function(t){},t.mouseMoveHandler=function(t,e,o){},t.mouseUpHandler=function(t){},t.mouseDoubleClickHandler=function(t){},t.touchEndHandler=function(){},t.mouseWheelHandler=function(t){},t.pointerInteraction=function(t){},t.drawUnder_c=function(t,e,o,i){},t.drawOver_i=function(t,e){},t.drawUnder_i=function(t,e,o,i){},t.drawOver_c=function(t,e){}}(Z||(Z={})),function(t){const e=2-(1+Math.sqrt(5))/2;function o(t,o){return t+e*(o-t)}function i(t,o){return o-e*(o-t)}function s(t,e,s,r){let n=e,a=s,l=o(n,a),c=i(n,a),p=t(n),u=t(l),h=t(c),d=t(a);for(;a-n>r;)h<u?(n=l,p=u,l=c,u=h,c=i(n,a),h=t(c)):(a=c,d=h,c=l,h=u,l=o(n,a),u=t(l));return p<=u&&p<=h&&p<=d?{t:n,f:p}:u<=h&&u<=d?{t:l,f:u}:h<=d?{t:c,f:h}:{t:a,f:d}}t.findArgMaxGoldenSection=function(t,e,s,r){let n=e,a=s,l=o(n,a),c=i(n,a),p=t(n),u=t(l),h=t(c),d=t(a);for(;a-n>r;)h>u?(n=l,p=u,l=c,u=h,c=i(n,a),h=t(c)):(a=c,d=h,c=l,h=u,l=o(n,a),u=t(l));return p>=u&&p>=h&&p>=d?{t:n,f:p}:u>=h&&u>=d?{t:l,f:u}:h>=d?{t:c,f:h}:{t:a,f:d}},t.findArgMinGoldenSection=s,t.findArgMinSamplingThenGoldenSection=function(t,e,o,i,r){let n=Number.MAX_VALUE,a=-1;for(let i=0;i<r.length;i++){let s=t(e+(o-e)*i/(r.length-1));r[i]=s,s<=n&&(n=s,a=i)}let l=e;for(let t=a-1;t>=0;t--)r[t]>n&&(l=e+(o-e)*t/(r.length-1));let c=o;for(let t=a+1;t<r.length;t++)r[t]>n&&(c=e+(o-e)*t/(r.length-1));return s(t,l,c,i)}}(K||(K={})),function(t){t.roots=new Float64Array(3),t.numRoots=0;const e=Math.cbrt?Math.cbrt:function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e};t.solve=function(o,i,s,r){if(Math.abs(o)<1e-6)if(Math.abs(i)<1e-6)Math.abs(s)<1e-6?t.numRoots=0:(t.roots[0]=-r/s,t.numRoots=1);else{let e=s*s-4*i*r;e>1e-6?(t.roots[0]=(-s+e)/(2*i),t.roots[1]=(-s-e)/(2*i),t.numRoots=2):e<-1e-6?t.numRoots=0:(t.numRoots=1,t.roots[0]=-s/(2*i))}else{i/=o,s/=o,r/=o,o=1;let n=i/3,a=i*i,l=(3*s-a)/9,c=(9*i*s-27*r-2*i*a)/54,p=l*l*l,u=p+c*c;if(u>0){t.numRoots=1;let o=Math.sqrt(u),i=e(c+o),s=e(c-o);t.roots[0]=i+s-n,t.roots[1]=t.roots[2]=NaN}else if(u<0){t.numRoots=3;let e=Math.acos(c/Math.sqrt(-p)),o=Math.sqrt(-l);t.roots[0]=2*o*Math.cos(e/3)-n,t.roots[1]=2*o*Math.cos((e+2*Math.PI)/3)-n,t.roots[2]=2*o*Math.cos((e+4*Math.PI)/3)-n}else{t.numRoots=3;let o=e(c);t.roots[0]=2*o-n,t.roots[2]=t.roots[1]=-o-n}}return t.numRoots>0}}(tt||(tt={})),function(t){class e{constructor(t,o,i){this.mouse_i=t,this.zoomScale=o,this.isTouch=i;const s=i?1.5:1;this.innerRadius_c=P.clamp(8*Math.log(o),6,10)*s,this.outerRadius_c=5*this.innerRadius_c,this.innerRadius_i=this.innerRadius_c/o,this.outerRadius_i=this.outerRadius_c/o,this.innerRadiusSqr_i=this.innerRadius_i*this.innerRadius_i,this.outerRadiusSqr_i=this.outerRadius_i*this.outerRadius_i,this.unscaled=i?new e(t,o,!1):this}static forDrawing(t){return new e(null,t.getZoomScale(),pt.lastUserInteractionWasTouch)}}const o=new class{constructor(){this.pEval=new Pt(0,0),this.testLine=new Lt(new Pt(0,0),new Pt(0,0))}set(t,e){this.p0=t.p0,this.p1=t.controlNext,this.p2=e.controlPrev,this.p3=e.p0}eval(t){return this.pEval.x=this.p3.x*t*t*t+3*this.p2.x*(1-t)*t*t+3*this.p1.x*(1-t)*(1-t)*t+this.p0.x*(1-t)*(1-t)*(1-t),this.pEval.y=this.p3.y*t*t*t+3*this.p2.y*(1-t)*t*t+3*this.p1.y*(1-t)*(1-t)*t+this.p0.y*(1-t)*(1-t)*(1-t),this.pEval}distanceSqrToLines(t,e){let o=0;this.testLine.p0.set(this.eval(o));let i=null;for(let s=1;s<=e;s++){let r=s/e;this.testLine.p1.set(this.eval(r));let n=this.testLine.distSqrTo(t);(null==i||n.distanceSqr<i.distanceSqr)&&(i=n,i.t=o+i.t/e),this.testLine.p0.set(this.testLine.p1),o=r}return i}distanceSqrTo(t,e){let o=this.distanceSqrToLines(t,10);return o.distanceSqr<2*e?this.distanceSqrToLines(t,100):o}},i=(new Float64Array(20),new Pt(0,0));const s=new class{p1c(t){return this.pc.minus(this.p0.times((1-t)*(1-t))).minus(this.p2.times(t*t)).times(1/Math.max(1e-6,2*t*(1-t)))}fitGoldenSection(t,e,o){this.p0=t,this.pc=e,this.p2=o;let s=P.safeDiv(.1,t.distanceTo(e)+e.distanceTo(o)),r=K.findArgMinGoldenSection(s=>(i.setInterpolated(t,o,s).minusEquals(e),P.sqr(1/(s*(1-s)))*i.lengthSqr()),.001,.999,s);this.tc=r.t,this.p1=this.p1c(this.tc)}fit(t,e,o){this.p0=t,this.pc=e,this.p2=o;let i=t.lengthSqr(),s=t.dot(e),r=e.lengthSqr(),n=t.dot(o),a=e.dot(o),l=-2*(2*s-i-r),c=-2*(3*i-5*s+2*r-n+a),p=-2*(-3*i+3*s+3*n-3*a),u=-2*(i-2*n+o.lengthSqr());if(this.tc=.5,tt.solve(u,p,c,l))for(let t=0;t<tt.numRoots;t++){let e=tt.roots[t];e>=0&&e<=1&&(this.tc=e)}this.p1=this.p1c(this.tc)}tangent(t){let e=2*(1-t),o=2*t;return new Pt(e*(this.p1.x-this.p0.x)+o*(this.p2.x-this.p1.x),e*(this.p1.y-this.p0.y)+o*(this.p2.y-this.p1.y)).normalize()}};function r(t,e,o,i,s,r){t.setLineWidth(1);let n=i.unscaled.innerRadius_c;if(r){let i=Math.round(.785*n);t.fillSquare(e,o,i,s),t.strokeSquare(e,o,i,"#000000")}else t.fillCircle(e,o,n,s),t.strokeCircle(e,o,n,"#000000")}class n{constructor(t){this._isCorner=!1,this.p0=new Pt(t.x,t.y),this._isCorner=!!t.isCorner}toString(){return"Node("+this.p0.x+", "+this.p0.y+")"}move(t){this.p0.set(t),_.UseScalpelNeighborhoodUpdate?this.updateControlPointsInNeighborhood():this.cut.updateAllControlPoints()}deleteNode(){this.cut.isLoop()?this.cut.cutLoopAt(this):(this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.cut.nodeDeleted(this))}setIsCorner(t){this._isCorner=t,_.UseScalpelNeighborhoodUpdate?this.updateControlPointsInNeighborhood():this.cut.updateAllControlPoints()}toggleSmooth(){this.setIsCorner(!this._isCorner)}canSnapTo(t){return this.isEndNode()&&t.isEndNode()&&this!=t&&(this.cut!=t.cut||this.cut.getNodeCount()>3)}updateControlPointsInNeighborhood(){this.prev&&(this.prev.prev&&this.prev.prev.updateControlPoints(),this.prev.updateControlPoints()),this.updateControlPoints(),this.next&&(this.next.updateControlPoints(),this.next.next&&this.next.next.updateControlPoints())}updateControlPoints(){if(this._isCorner||this.isEndNode()){if(this.next)if(this.next.next&&!this.next._isCorner){s.fit(this.p0,this.next.p0,this.next.next.p0);let t=s.tangent(0).timesEquals(1/3);this.controlNext=this.p0.plus(t.times(this.p0.distanceTo(this.next.p0)))}else{let t=this.next.p0.minus(this.p0).timesEquals(1/3);this.controlNext=this.p0.plus(t),this.next.controlPrev=this.next.p0.minus(t)}else this.controlNext=null;if(this.prev){if(this.prev.prev&&!this.prev._isCorner){s.fit(this.p0,this.prev.p0,this.prev.prev.p0);let t=s.tangent(0).timesEquals(1/3);this.controlPrev=this.p0.plus(t.times(this.p0.distanceTo(this.prev.p0)))}}else this.controlPrev=null}else{s.fit(this.prev.p0,this.p0,this.next.p0);let t=s.tangent(s.tc).timesEquals(1/3);this.controlNext=this.p0.plus(t.times(this.p0.distanceTo(this.next.p0))),this.controlPrev=this.p0.minus(t.times(this.prev.p0.distanceTo(this.p0)))}}encode(){return{x:this.p0.x,y:this.p0.y,isCorner:this.isCorner()}}xc(t){return t.o2cX(this.p0.x)}yc(t){return t.o2cY(this.p0.y)}cPrevX(t){return t.o2cX(this.controlPrev.x)}cPrevY(t){return t.o2cY(this.controlPrev.y)}cNextX(t){return t.o2cX(this.controlNext.x)}cNextY(t){return t.o2cY(this.controlNext.y)}isCorner(){return this._isCorner}hoveringNearNode(){return!p&&this==w.node&&2!=w.zone}isOverNode(){return this==w.node&&3==w.zone}isEndNode(){return!this.prev||!this.next}withinHitRadius(t){return this.withinHitRadiusSqr(t.mouse_i,t.outerRadiusSqr_i)}withinHitRadiusSqr(t,e){return this.isEndNode()||(e*=3.4/5*(3.4/5)),this.distanceToSqr(t)<e}withinNodeRadius(t){return this.distanceToSqr(t.mouse_i)<t.innerRadiusSqr_i}distanceToSqr(t){return this.p0.distanceSqrTo(t)}hitTest(t){let e=t.innerRadius_i,o=this.p0.distanceTo(t.mouse_i),i=e*Math.SQRT2*(this.isEndNode()?2:1.2),s=new l(6,this,this.cut);return s.deletePoint=this.p0.offset(i,-i),s.toggleCornerPoint=this.p0.offset(-i,-i),o<=e?s.zone=3:this.isEndNode()&&o<=3*e?s.zone=1:s.deletePoint.distanceTo(t.mouse_i)<=e?s.zone=4:s.toggleCornerPoint.distanceTo(t.mouse_i)<=e&&(s.zone=5),1!=s.zone&&(s.mouseOffset_i=this.p0.minus(t.mouse_i)),s}drawDelete(t,e,o,i,s){let r=o.unscaled.innerRadius_c/3;e.withGlobalAlpha(1,()=>{let n=o.unscaled.innerRadius_c,a=.8*n*Math.SQRT1_2,l=t.o2cX(i.x),c=t.o2cY(i.y);e.fillCircle(l,c,n,s?"#cc0000":"rgb(120,60,60)"),e.beginPath(),e.moveTo(l-a,c-a),e.lineTo(l+a,c+a),e.moveTo(l-a,c+a),e.lineTo(l+a,c-a),e.strokeEx(r,s?"#FFFFFF":"#DDDDDD")})}drawToggle(t,e,o,i,s){let r=o.unscaled.innerRadius_c/3;e.withGlobalAlpha(1,()=>{let n=o.unscaled.innerRadius_c,a=.8*n,l=t.o2cX(i.x),c=t.o2cY(i.y);if(e.fillCircle(l,c,n,s?"#5377cc":"#405b8a"),e.context.lineWidth=r,e.context.strokeStyle=s?"#FFFFFF":"#DDDDDD",e.context.lineJoin="miter",e.context.beginPath(),this._isCorner){let t=.866*a,o=.5*a,i=.5*a;e.context.moveTo(l-t,c+o),e.context.quadraticCurveTo(l-i,c-i,l,c-.33*a),e.context.quadraticCurveTo(l+i,c-i,l+t,c+o)}else{let t=.866*a,o=.33*a;e.context.moveTo(l-t,c+o),e.context.lineTo(l,c-.5*a),e.context.lineTo(l+t,c+o)}e.context.stroke()})}drawButtonsAndExtendsZone(t,e,o){w.deletePoint&&(this.drawDelete(t,e,o,w.deletePoint,4==w.zone),this.drawToggle(t,e,o,w.toggleCornerPoint,5==w.zone));let i=this.xc(t),s=this.yc(t);this.isEndNode()&&e.withGlobalAlpha(1==w.zone?.25:.125,()=>{let t=3*o.innerRadius_c;e.fillCircle(i,s,t,"#FFFFFF"),e.strokeEx(1,"#000000")})}drawNodeExtendPreview(t,e,o){let i=t.getMouse_c();if(i.x>de.OffScreen&&i.y>de.OffScreen){let i=t.getMouse_i(),s=t.o2c(i);e.beginPath(),e.moveTo(this.xc(t),this.yc(t)),e.lineTo(s.x,s.y),e.strokeEx(_.LineOuterWidth,"#000000"),e.strokeEx(_.LineInnerWidth,"#00cc00"),r(e,s.x,s.y,o,"#00cc00",this.isCorner())}}drawControlPoints(t,e){e.withGlobalAlpha(1,()=>{let o=this.xc(t),i=this.yc(t);if(this.controlPrev){let s=t.o2c(this.controlPrev);e.strokeLine(o,i,s.x,s.y,1,"#00ffff")}if(this.controlNext){let s=t.o2c(this.controlNext);e.strokeLine(o,i,s.x,s.y,1,"#00ffff")}})}draw(t,e,o,i){let s=i||(this.cut.isActive?"#E67A00":"#888888");B.getActiveMode()==B.Sword&&(this.hoveringNearNode()?(this.drawButtonsAndExtendsZone(t,e,o),1==w.zone&&this.drawNodeExtendPreview(t,e,o)):p&&p.node==this&&(2!=m&&f||this.drawButtonsAndExtendsZone(t,e,o)),i||(this.isOverNode()?s=1==m&&f?"rgba(255,255,255,0.25)":"#FFFFFF":this.hoveringNearNode()&&(s=this.cut.isActive?"#FFB866":"#bbbbbb"))),r(e,this.xc(t),this.yc(t),o,s,this.isCorner())}}class a{constructor(t,e,o){this.nodeFirst=t,this.nodeLast=e,this.nodeCount=o,this.isActive=!1,this.setCut(this),this.updateAllControlPoints()}static fromPoint(t){return a.fromPoints(t,t)}static fromPoints(t,e){let o=new n(t),i=new n(e);return o.next=i,i.prev=o,new a(o,i,2)}static decode(t){const e=t.nodes.map((function(t){return new n(t)}));for(let t=1;t<e.length;t++){const o=e[t-1],i=e[t];o.next=i,i.prev=o}let o=new a(e[0],e[e.length-1],e.length);return t.isLoop&&o.closeLoopLastToFirst(),o}encode(){const t=[];for(let e=this.nodeFirst,o=0;o<this.nodeCount;e=e.next,o++)t.push(e.encode());return{nodes:t,isLoop:this.isLoop()}}closeLoopLastToFirst(){this.nodeLast.next=this.nodeFirst,this.nodeFirst.prev=this.nodeLast,this.nodeLast=this.nodeFirst,this.updateAllControlPoints()}getNodeCount(){return this.nodeCount}dup(){return a.decode(this.encode())}isLoop(){return this.nodeFirst==this.nodeLast}findNode(t){for(let e=this.nodeFirst,o=0;o<this.nodeCount;e=e.next,o++)if(e.p0.equals(t))return e;return null}toString(){let t="Cut(";for(let e=this.nodeFirst,o=0;o<this.nodeCount;e=e.next,o++)t+=e.p0.x+","+e.p0.y+"; ";return t+=")",t}iterateNodePairs(t){for(let e=this.nodeFirst,o=1;o<this.nodeCount;e=e.next,o++)t(e,e.next)}samplePoints(t,e){for(let i=this.nodeFirst,s=1;s<this.nodeCount;i=i.next,s++){o.set(i,i.next);for(let s=1;s<t;s++){let r=s/t;e(o.eval(r),i.next)}}}appendToPolyBezierSet(t){let e=t.points.length,o=[];t.swords.push(o);for(let i=this.nodeFirst,s=this.isLoop()?0:1;s<this.nodeCount;i=i.next,s++){let s=i.p0,r=i.controlNext,n=i.next.controlPrev;i.next.p0;t.points.push(s,r,n),o.push([e++,e++,e++,e])}t.points.push(this.nodeLast.p0)}setCut(t){for(let e=this.nodeFirst,o=0;o<this.nodeCount;e=e.next,o++)e.cut=t}reverseInPlace(){for(let t=this.nodeFirst,e=0;e<this.nodeCount;e++){const e=t.next;t.next=t.prev,t.prev=e,t=e}const t=this.nodeFirst;this.nodeFirst=this.nodeLast,this.nodeLast=t}joinCutsByNodes(t,e){if(this!=t.cut)throw"Must call on lion!";if(this==e.cut)this.nodeFirst.prev=this.nodeLast.prev,this.nodeLast.prev.next=this.nodeFirst,this.nodeLast=this.nodeFirst,this.nodeCount--;else{const o=e.cut;o.setCut(this),t==this.firstNode()&&this.reverseInPlace(),e==o.lastNode()&&o.reverseInPlace(),t.next=e.next,e.next.prev=t,t.setIsCorner(t.isCorner()||e.isCorner()),this.nodeLast=o.nodeLast,this.nodeCount+=o.getNodeCount()-1,o.deleteCut()}this.updateAllControlPoints()}firstNode(){return this.nodeFirst}lastNode(){return this.nodeLast}extend(t,e){let o=new n(e);return o.setIsCorner(t.isCorner()),o.cut=this,t==this.nodeLast?(t.next=o,o.prev=t,this.nodeLast=o):(t.prev=o,o.next=t,this.nodeFirst=o),this.nodeCount++,_.UseScalpelNeighborhoodUpdate?o.updateControlPointsInNeighborhood():this.updateAllControlPoints(),o}updateAllControlPoints(){for(let t=this.nodeFirst,e=0;e<this.nodeCount;t=t.next,e++)t.updateControlPoints()}cutLoopAt(t){this.isLoop()&&(this.nodeFirst=t.next,this.nodeFirst.prev=null,this.nodeLast=t.prev,this.nodeLast.next=null,this.nodeCount--,this.updateAllControlPoints())}nodeDeleted(t){this.isLoop()||(this.nodeCount--,t==this.nodeFirst?this.nodeFirst=this.nodeFirst.next:t==this.nodeLast&&(this.nodeLast=this.nodeLast.prev),this.nodeFirst==this.nodeLast?this.deleteCut():this.updateAllControlPoints())}deleteCut(){t.cutSet.deleteCut(this)}addNode(t,e,o){let i=new n(e.plus(o));return i.cut=this,i.prev=t.prev,i.prev.next=i,i.next=t,t.prev=i,this.nodeCount++,_.UseScalpelNeighborhoodUpdate?i.updateControlPointsInNeighborhood():this.updateAllControlPoints(),i}hitTestNodesOnly(t){for(let e=this.nodeLast,o=0;o<this.nodeCount;e=e.prev,o++)if(e.withinNodeRadius(t))return e.hitTest(t);return null}hitTest(t){for(let e=this.nodeLast,o=0;o<this.nodeCount;e=e.prev,o++)if(e.withinHitRadius(t))return e.hitTest(t);const e=t.innerRadiusSqr_i;for(let i=this.nodeLast,s=this.isLoop()?0:1;s<this.nodeCount;i=i.prev,s++){o.set(i.prev,i);const s=o.distanceSqrToLines(t.mouse_i,100);if(s.distanceSqr<e)return new l(2,i,this,s.pp.minusEquals(t.mouse_i))}return null}draw(t,e,o,i){let s=i||(this.isActive?"#E67A00":"#888888");e.beginPath(),e.moveTo(this.nodeFirst.xc(t),this.nodeFirst.yc(t));for(let o=this.nodeFirst.next,i=this.isLoop()?0:1;i<this.nodeCount;o=o.next,i++){let i=o.prev;e.bezierCurveTo(i.cNextX(t),i.cNextY(t),o.cPrevX(t),o.cPrevY(t),o.xc(t),o.yc(t))}if(e.strokeEx(_.LineOuterWidth,"#000000"),e.strokeEx(_.LineInnerWidth,s),B.getSelectedMode()==B.Sword)for(let s=this.nodeFirst,r=0;r<this.nodeCount;s=s.next,r++)w.node!=s&&s.draw(t,e,o,i);if(B.getActiveMode()==B.Sword&&2==w.zone&&w.cut==this){let i=t.getMouse_i().plusEquals(w.getMouseOffset_i()),s=t.o2c(i);r(e,s.x,s.y,o,"#00cc00",!1)}}}class l{constructor(t,e,o,i,s){this.zone=t,this.node=e,this.cut=o,this.mouseOffset_i=i,this.interactionIdentifier=s}getMouseOffset_i(){return this.mouseOffset_i?this.mouseOffset_i:Pt.empty()}dup(){return new l(this.zone,this.node,this.cut,this.mouseOffset_i,this.interactionIdentifier)}}t.cutSet=new class{constructor(){this.cuts=[]}decode(t){this.cuts=t.cuts.map(a.decode)}encode(){return{cuts:this.cuts.map((function(t){return t.encode()}))}}encodedPolyBezierSet(){let t=new Vt;for(let e of this.cuts)e.appendToPolyBezierSet(t);return t}setActiveSwords(t){if(t.length==this.cuts.length)for(let e=0;e<t.length;e++)this.cuts[e].isActive=t[e]}checkClear(){return this.cuts.length>0&&(this.cuts.length=0,!0)}hitTest(t){if(w.node&&w.node.withinHitRadius(t)){let e=w.node.hitTest(t);switch(e.zone){case 3:case 5:case 4:return e}}for(let e=this.cuts.length-1;e>=0;e--){let o=this.cuts[e].hitTestNodesOnly(t);if(o)return o}if(w.node&&w.node.withinHitRadius(t))return w.node.hitTest(t);for(let e=this.cuts.length-1;e>=0;e--){let o=this.cuts[e].hitTest(t);if(o)return o}return new l(0,null,null)}addCut(t){let e=a.fromPoint(t);return this.cuts.push(e),e}deleteCut(t){const e=this.cuts.indexOf(t);e>=0&&this.cuts.splice(e,1)}snapToNodeOrNull(t,e){const o=1.5*t.innerRadiusSqr_i*1.5;for(let e=this.cuts.length-1;e>=0;e--){const i=this.cuts[e];if(p.node.canSnapTo(i.lastNode())&&i.lastNode().withinHitRadiusSqr(t.mouse_i,o))return i.lastNode();if(p.node.canSnapTo(i.firstNode())&&i.firstNode().withinHitRadiusSqr(t.mouse_i,o))return i.firstNode()}return null}draw(t,o){const i=e.forDrawing(t);pt.lastUserInteractionWasTouch||!w.node||5!=w.zone&&4!=w.zone||o.withGlobalAlpha(.5,()=>{if(5==w.zone&&(w.node.toggleSmooth(),w.node.cut.draw(t,o,i,"#00cc00"),w.node.toggleSmooth()),4==w.zone){let e=w.node.cut;if(!e.isLoop()&&e.getNodeCount()>2){let s=e.dup();s.findNode(w.node.p0).deleteNode(),s.draw(t,o,i,"#00cc00")}}}),o.withGlobalAlpha(1,()=>{for(let e of this.cuts)e.draw(t,o,i);if(w.node&&w.node.draw(t,o,i),w.snapTo){const e=w.snapTo;r(o,e.xc(t),e.yc(t),i,"#FFFFFF",e.isCorner())}}),o.withGlobalAlpha(1,()=>{if(this.cuts.length>0)for(let e=0;e<g.length;e++){let s=g[e],r=t.o2cX(s.x),n=t.o2cY(s.y),a=1.5*i.innerRadius_c;o.strokeCircle(r,n,a,"#FF0000"),o.strokeCircle(r,n,a-1,"#880000")}})}};let c,p,u=null,h=!1,d=0,g=[],m=0,f=!1;const S=new l(0,null,null,null);let w=S;function C(){m=0,c=null,p=null,f=!1}function y(){h&&(h=!1,d=x.M.sendSetSword())}function b(){u=null,h=!0}t.clearDownState=C,t.pointerInteraction=function o(i,s,r){const n=new e(s,r,i.isTouch);switch(i.type){case pt.InteractionType.Hover:let e=t.cutSet.hitTest(n);e.interactionIdentifier=w.node&&w.node==e.node?w.interactionIdentifier:i.interactionIdentifier,w=e;break;case pt.InteractionType.Tap:w.interactionIdentifier!=i.interactionIdentifier&&(o(i.dup(pt.InteractionType.ActionStart),s,r),o(i.dup(pt.InteractionType.ActionEnd),s,r));break;case pt.InteractionType.ActionStart:switch(C(),w.zone){case 0:O.push(),w.cut=t.cutSet.addCut(s),w.node=w.cut.lastNode(),w.zone=3,m=1,b();break;case 1:w.interactionIdentifier!=i.interactionIdentifier&&(O.push(),w.node=w.node.cut.extend(w.node,s),w.zone=3,m=1,b());break;case 2:O.push(),w.node=w.cut.addNode(w.node,s,w.getMouseOffset_i()),w.zone=3,m=1,b();break;case 3:O.push(),m=1,b();break;case 4:case 5:m=2;break;case 6:m=0}c=s,p=w.dup();break;case pt.InteractionType.ActionMove:switch(m){case 1:p.node.isEndNode()&&(w.snapTo=t.cutSet.snapToNodeOrNull(n,p.node.cut))?p.node.move(w.snapTo.p0):p.node.move(s.plus(p.getMouseOffset_i())),b();break;case 2:w=w.node.hitTest(n)}f=f||!s.equals(c);break;case pt.InteractionType.ActionEnd:if(1==m)w.snapTo&&p.node.cut.joinCutsByNodes(p.node,w.snapTo),w=S,w=t.cutSet.hitTest(n);else if(p&&w&&2==m&&p.zone==w.zone&&p.node==w.node&&w.interactionIdentifier!=i.interactionIdentifier)switch(p.zone){case 4:O.push(),p.node.deleteNode(),w=S,w=t.cutSet.hitTest(n),b();break;case 5:O.push(),p.node.toggleSmooth(),b()}C(),y();break;case pt.InteractionType.DoubleClick:w&&3==w.zone&&(O.push(),w.node.toggleSmooth(),b(),C(),y(),w=t.cutSet.hitTest(n))}};function v(e){u=e,t.cutSet.decode(e),w=new l(0,null,null),C()}t.decodeSword=function(t){P.tic();let e=Ht.decode(t,new Ht).polyBeziers.map((function(t){let e=[];for(let i of t.beziers)if(i.isLine)e.push(i.evalToNode(0,!0));else{let t=a.fromPoints(i.p0,i.p2);t.firstNode().toggleSmooth();let s=new Yt;s.put(t.firstNode(),0),s.put(t.lastNode(),1);let r=0,n=new Pt(0,0),l=t.lastNode(),c=0,p=0;do{if(r>.25){let e=t.addNode(l,n.dup(),Pt.empty());s.put(e,c),r=0}t.iterateNodePairs((function(t,e){let a=(s.get(t)+s.get(e))/2,p=i.eval(a);o.set(t,e);let u=o.distanceSqrTo(p,r);u.distanceSqr>r&&(r=u.distanceSqr,n.set(p),l=e,c=a)})),p+=1}while(r>.25&&p<10);for(let o=t.firstNode(),i=0,s=t.getNodeCount()-1;i<s;o=o.next,i++)e.push(o.encode())}let i=t.beziers[t.beziers.length-1];return e.push(i.evalToNode(1,!0)),{nodes:e}}));P.toc("Decoded sword"),v({cuts:e})},t.decode=v,t.encode=function(){return null==u&&(u=t.cutSet.encode()),u},t.clear=function(){t.cutSet.checkClear()&&(b(),y())},t.clearHoverState=function(){w=S},t.setSwordIntersections=function(t){g.length=0;for(let e=0;e<t.length;e++)g.push(t[e])},t.setActiveSwords=function(e,o){o>=d&&!h&&t.cutSet.setActiveSwords(e)}}(et||(et={})),function(t){t.attachToLink=function(t,e){t.off("dragstart.DragUrl").on("dragstart.DragUrl",(function(t){var o=e();o&&t.originalEvent.dataTransfer.setData("DownloadURL",o+":"+this.href)}))},t.attachDecorated=function(){$("a[data-dragurl]").on("dragstart",(function(t){var e=$(this).data("dragurl");e&&t.originalEvent.dataTransfer.setData("DownloadURL",e)}))}}(ot||(ot={})),function(t){var e=/%([0-9A-Fa-f]{2})/g,o=/[^\x20-\x7e\xa0-\xff]/g,i=/\\([\u0000-\u007f])/g,s=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,r=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+\-\.^_`|~])+)$/,n=/^([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *(?:$|;)/;function a(t){var i=r.exec(t);if(!i)throw new TypeError("invalid extended field value");var s,n=i[1].toLowerCase(),a=i[2].replace(e,l);switch(n){case"iso-8859-1":s=String(a).replace(o,"?");break;case"utf-8":s=decodeURIComponent(escape(a));break;default:throw new TypeError("unsupported charset in extended field")}return s}function l(t,e){return String.fromCharCode(parseInt(e,16))}t.parse=function(t){if(t&&"string"==typeof t){var e=n.exec(t);if(e){var o,r,l=e[0].length,c=(e[1].toLowerCase(),[]),p={};try{for(l=s.lastIndex=";"===e[0].substr(-1)?l-1:l;e=s.exec(t);){if(e.index!==l)throw new TypeError("invalid parameter format");if(l+=e[0].length,o=e[1].toLowerCase(),r=e[2],-1!==c.indexOf(o))throw new TypeError("invalid duplicate parameter");c.push(o),o.indexOf("*")+1!==o.length?"string"!=typeof p[o]&&('"'===r[0]&&(r=r.substr(1,r.length-2).replace(i,"$1")),p[o]=r):(o=o.slice(0,-1),r=a(r),p[o]=r)}if(-1!==l&&l!==t.length)throw new TypeError("invalid parameter format")}catch(t){}return p.filename}}}}(it||(it={})),function(t){const e={url:"",progress:P.empty,error:P.empty,success:P.empty,withCredentials:!1,contentType:null};function o(t,e){return P.blobToFile(t,e||"FetchedFromUrl_"+Date.now())}t.download=function(t){let i=$.extend({},e,t),s=P.dataUrlToBlob(i.url)||P.dataUrlToBlob(i.displayUrl);if(s)setTimeout((function(){i.success(o(s))}),0);else{let t=new XMLHttpRequest,e=0;i.progress!=P.empty&&(t.onprogress=t=>{if(t.lengthComputable){let o=Math.round(100*t.loaded/t.total);e!==o&&(e=o,i.progress(e))}}),t.onerror=e=>{i.error(P.formatXhrError(t,void 0))},t.onabort=e=>{i.error(P.formatXhrError(t,"abort"))},t.withCredentials=!!i.withCredentials,t.onload=e=>{if(t.response)if(t.status<200||t.status>299){let e=String.fromCharCode.apply(null,new Uint8Array(t.response));i.error(p.s('Failed to fetch "{0}"',i.displayUrl||i.url)+"\n"+e)}else{let e=i.contentType||t.getResponseHeader("Content-Type"),s=it.parse(t.getResponseHeader("Content-Disposition")),r=t.response,n=o(new Blob([r],{type:e}),s);i.success(n)}},t.open("GET",i.url,!0),t.responseType="arraybuffer",t.send()}}}(st||(st={})),function(t){t.OrigConfig={title:"Original",showOriginal:!0,showHoverTool:!0,contextMenuHandler:Q.showMain},t.MarkConfig={title:"Original + Marks",showOriginal:!0,showUserMask:!0,showSword:!0,showBeziers:!0,showHoverTool:!0,showReviewCursor:!0,contextMenuHandler:Q.showMain},t.PreviewConfig={title:"Preview",showPreview:!0,showFrame:!0,showBackground:!0,showHairLoupe:!0,clip:!0,panModeOnly:!0,showHoverTool:!_.ScreenshotMode,showReviewCursor:!0,contextMenuHandler:Q.showMain,showSize:!0},t.NormalSplit=[t.MarkConfig,t.PreviewConfig];const e=t.NormalSplit,o=[t.OrigConfig,t.OrigConfig],i=[t.NormalSplit,e,o],s=[t.MarkConfig];t.PreviewSingle=[t.PreviewConfig];const r=[t.OrigConfig],n=[s,t.PreviewSingle,r];t.get=function(t,e){return(t?i:n)[e]};let a=!1;t.translateTitles=function(e){a||(t.OrigConfig.title=p.s(t.OrigConfig.title),t.MarkConfig.title=p.s(t.MarkConfig.title),t.PreviewConfig.title=p.s(t.PreviewConfig.title),a=!0),t.OrigConfig.filename=t.MarkConfig.filename=e}}(rt||(rt={})),function(t){let e=!1;const o=[D.CmApp.Brush.Popover,D.CmApp.BgColor.Popover,D.CmApp.Edges.Popover,D.CmApp.Hair.Popover,D.CmApp.Review.Popover,D.CmApp.Ecommerce.Popover];var i,s,r=null,l=0,c=0,u=null,h=null,d=!1;t.ViewPanesGroup=new Zt([new jt(D.ViewPanes.marks,_.ViewPanesSingle),new jt(D.ViewPanes.both,_.ViewPanesSplit)]),t.hide=function(){};function g(t,e,o,i,s){t.reset.$().click(e),P.mouseDownRepeater(t.decrease.$(),o,30,5,O.push,s),P.mouseDownRepeater(t.increase.$(),i,30,5,O.push,s)}function m(t,e,o,i){t.reset.$().click(e),t.decrease.$().click((function(){o(-i)})),t.increase.$().click((function(){o(i)}))}function f(t,e,o,i){g(t,e,o,i,()=>{at.updateColorLevels(),at.sendSetGlobal()})}function S(){$("#result-dialog").modal("hide")}function w(){u=Z,k(),Z.show()}function C(){u=j,k(),j.show()}function y(){u=J,k(),J.show()}function b(){u=ht,k(),ht.show()}let v=-1;function A(t){$("#result-dialog").toggleClass(D.resultDialog.hasDownloaded.name(),t)}function k(){ut.subViewPort.initialize({image:r,canvasDiv:$("#subapp-view"),showGrid:J.showGrid,viewConfigs:rt.PreviewSingle})}function M(){O.canUndo()?D.CmApp.Tools.undo.$().removeAttr("disabled"):D.CmApp.Tools.undo.$().attr("disabled","disabled"),D.CmApp.Tools.undoMenuItem.$().toggleClass("disabled",!O.canUndo()),O.canRedo()?D.CmApp.Tools.redo.$().removeAttr("disabled"):D.CmApp.Tools.redo.$().attr("disabled","disabled"),D.CmApp.Tools.redoMenuItem.$().toggleClass("disabled",!O.canRedo())}t.imageUpdated=function(){D.CmApp.tool_popover_content.$().find(".dropdown").on("show.bs.dropdown",(function(t){const e=t.target.closest(D.CmApp.tool_popover_content.css());e.classList.add(D.CmApp.dropdown_open.name()),e.style.right=3+e.scrollWidth-window.innerWidth+"px",D.$window.on("resize.positioner",()=>{e.style.right=3+e.scrollWidth-window.innerWidth+"px"})})).on("hide.bs.dropdown",(function(t){const e=t.target.closest(D.CmApp.tool_popover_content.css());e.classList.remove(D.CmApp.dropdown_open.name()),e.style.removeProperty("right"),D.$window.off("resize.positioner")}));let p=rt.NormalSplit;_.IncludeOriginal&&p.unshift(rt.OrigConfig),$(".navbar").hide(),$(".footer").hide(),$(".container >").hide(),D.AppOuterWrapper.$().show(),D.AppWrapper.$().show(),$("html").addClass("html-app-mode").toggleClass(D.hide_bottom_toolbar.name(),window.GlobalsEx.hideBottomToolbar),ut.main.showing=!0,r=at.imageCanvas,l=r.width(),c=r.height(),h=$(".canvas-view"),_.IncludeOriginal&&D.AppView.$().css("width","1138px"),_.ScreenshotMode&&($("#viewport-debug-group").show(),D.CmApp.Dev.viewport_set.$().click(()=>{ut.main.fromString($("#viewport-setting").val())})),ut.main.initialize({image:r,canvasDiv:D.AppView.$(),viewConfigs:p,app:t}),rt.translateTitles(at.getFilename()),function(){if(!e){D.$window.keydown(z),D.$window.keyup(I),D.$window.resize(()=>{window.innerWidth<=768&&at.setViewPanesMode(_.ViewPanesSingle)});var r=ut.main.repeaterDelay;P.mouseDownRepeater(D.CmApp.Tools.zoom_in.$(),ut.main.animateZoomInAboutCenter,r,1),P.mouseDownRepeater(D.CmApp.Tools.zoom_out.$(),ut.main.animateZoomOutAboutCenter,r,1),D.CmApp.Tools.zoom_to_fit.$().click(t=>{t.shiftKey?ut.main.zoomToFitTight():ut.main.animateZoomToFit()}),P.mouseDownRepeater(D.CmApp.Tools.subapp_zoom_in.$(),ut.subViewPort.animateZoomInAboutCenter,r,1),P.mouseDownRepeater(D.CmApp.Tools.subapp_zoom_out.$(),ut.subViewPort.animateZoomOutAboutCenter,r,1),D.CmApp.Tools.subapp_zoom_to_fit.$().click(t=>{t.shiftKey?ut.subViewPort.zoomToFitTight():ut.subViewPort.animateZoomToFit()}),D.CmApp.Tools.clear_user_mask_tool.$().click(()=>{at.clearUserMask(),B.is(B.Sword)&&B.Grab.pick()}),D.CmApp.Tools.clear_all_edits.$().click(()=>{at.clearAllEdits(),B.Grab.pick()});for(var p=0;p<o.length;p++){var u=o[p].Button;u.$().click(T(u,o[p].Popover))}D.CmApp.Tools.save.$().click(()=>at.checkSaveDrawCommands()),D.CmApp.Tools.download.$().click((function(t){t.preventDefault(),at.updateResultParitySalt(),U();let e=at.sendGenerateResult(),o=_.isRegularAppMode()&&at.oneClickDownloadEnabledAndAllowed(),i=_.isBulkAppMode()&&window.bulkDownloadMode==_.BulkDownloadModeSingle;if(!o&&!i||at.isOutOfCredits())A(!1);else{A(!0);let t=e?!at.resultParity:at.resultParity,o=at.downloadParityUrl(t),i=document.createElement("a");i.href=o,i.download="",i.click()}at.updateSettingsSummary(),_.isBulkLike()?setTimeout(P.modal,500,"#result-dialog"):P.modal("#result-dialog",!0)})),D.CmApp.Tools.skip.$().click(at.skip),D.CmApp.Tools.undo.$().click(at.tryUndo),D.CmApp.Tools.redo.$().click(at.tryRedo),D.resultDialog.SettingsSummary.ExportOptions.Key.$().click(()=>(S(),dt.show(D.PreferencesDialog.ExportOptionsTab),!1)),D.resultDialog.SettingsSummary.ColorsApp.Key.$().click(()=>{S(),C()}),D.resultDialog.SettingsSummary.BackgroundApp.Key.$().click(()=>{S(),w()}),D.resultDialog.SettingsSummary.CropApp.Key.$().click(()=>{S(),y()}),D.resultDialog.SettingsSummary.ShadowsApp.Key.$().click(()=>{S(),b()}),D.resultDialog.download_link.$().click(()=>{A(!0)}),D.resultDialog.ReadyDownloadImage.$().mousedown(()=>{A(!0)}),D.resultDialog.copy_to_clipboard.$().click(t=>{if(!D.resultDialog.copy_to_clipboard.$().hasClass("disabled")){let t=D.resultDialog.copy_to_clipboard.$(),o=D.resultDialog.show_copied.name(),i=D.resultDialog.show_copying.name(),s=D.resultDialog.show_failed.name();t.removeClass(i),t.removeClass(o),t.removeClass(s);let r=a.cast(D.resultDialog.ReadyDownloadImage.$().get(0));It.fromHTMLImageElement(r).toBlob("image/png");function e(){-1!=v&&clearTimeout(v),v=setTimeout(()=>{t.removeClass(i),t.removeClass(o),t.removeClass(s),v=-1},3e3)}t.addClass(i),P.copyImageToClipboard(r,()=>{t.removeClass(i),t.addClass(o),e()},()=>{t.removeClass(i),t.addClass(s),e()}),A(!0)}}),at.hasUser()?(D.enable_one_click_download_checkbox.$().click(at.toggleEnableOneClickDownload),D.pre_crop_enabled_checkbox.$().click(at.toggleEnablePreCrop),D.only_use_photo_mode_checkbox.$().click(at.toggleOnlyUsePhotoMode),D.enable_auto_clip_checkbox.$().click(at.toggleDefaultToAutoClip),D.allow_logo_mode_checkbox.$().click(at.toggleAllowLogoMode),D.allow_scan_mode_checkbox.$().click(at.toggleAllowScanMode),D.allow_auto_hair_checkbox.$().click(at.toggleAllowAutoHair),m(D.MaxNumMegapixels,at.resetMaxNumMegapixels,at.incrementMaxNumMegapixels,1)):(D.enable_one_click_download_checkbox.$().addClass("disabled").attr("disabled","disabled").parent().addClass("gray"),D.pre_crop_enabled_checkbox.$().addClass("disabled").attr("disabled","disabled").parent().addClass("gray"),D.only_use_photo_mode_checkbox.$().addClass("disabled").attr("disabled","disabled").parent().addClass("gray"),D.enable_auto_clip_checkbox.$().addClass("disabled").attr("disabled","disabled").parent().addClass("gray"),D.MaxNumMegapixels.increase.$().toggleClass("disabled",!0),D.MaxNumMegapixels.decrease.$().toggleClass("disabled",!0),D.MaxNumMegapixels.reset.$().toggleClass("disabled",!0)),m(D.CmApp.CropApp.RotateSpinner,at.rotateReset,at.incrementRotateAngleDeg,-90),g(D.CmApp.CropApp.StraightenSpinner,at.straightenReset,at.straightenCounterclockwise,at.straightenClockwise,at.straightenCommit),t.straightenClockwiseRepeater=new Kt(at.straightenClockwise,30,5,O.push,at.straightenCommit),t.straightenCounterclockwiseRepeater=new Kt(at.straightenCounterclockwise,30,5,O.push,at.straightenCommit),D.CmApp.ColorsApp.ColorCast.RemovalEnabled.$().click(at.toggleColorCast),D.CmApp.ColorsApp.ColorCast.controls.$().toggle(at.settings.removeColorCast),D.CmApp.ColorsApp.WhiteBalance.Enabled.$().click(at.toggleWhiteBalanceEnabled),D.CmApp.ColorsApp.WhiteBalance.controls.$().toggle(at.settings.whiteBalanceEnabled),f(D.CmApp.ColorsApp.ColorLevels.brightness,at.brightnessReset,at.brightnessDecrement,at.brightnessIncrement),f(D.CmApp.ColorsApp.ColorLevels.shadows,at.shadowsReset,at.shadowsDecrement,at.shadowsIncrement),f(D.CmApp.ColorsApp.ColorLevels.highlights,at.highlightsReset,at.highlightsDecrement,at.highlightsIncrement),f(D.CmApp.ColorsApp.ColorLevels.temperature,at.temperatureReset,at.temperatureDecrement,at.temperatureIncrement),f(D.CmApp.ColorsApp.ColorLevels.saturation,at.saturationReset,at.saturationDecrement,at.saturationIncrement),f(D.CmApp.ColorsApp.ColorCast.ForegroundProtection,at.colorCastForegroundProtectionReset,at.colorCastForegroundProtectionDecrement,at.colorCastForegroundProtectionIncrement),m(D.CmApp.Edges.Smoothing,at.resetGlobalSmoothingLevel,at.stepGlobalSmoothingLevel,.5),m(D.CmApp.Edges.FeatheringRadius,at.resetGlobalBlurLevel,at.stepGlobalBlurLevel,.5),m(D.CmApp.Edges.Offset,at.resetGlobalOffset,at.stepGlobalOffset,.25),g(D.ExportOptions.JpgQuality,at.jpegQualityReset,at.jpegQualityDecrease,at.jpegQualityIncrease,at.sendSetGlobal),D.ExportOptions.JpgQualityPresets.preset25.$().click(()=>at.setJpegQuality(25,!0)),D.ExportOptions.JpgQualityPresets.preset50.$().click(()=>at.setJpegQuality(50,!0)),D.ExportOptions.JpgQualityPresets.preset75.$().click(()=>at.setJpegQuality(75,!0)),D.ExportOptions.JpgQualityPresets.preset90.$().click(()=>at.setJpegQuality(90,!0)),D.ExportOptions.JpgQualityPresets.preset100.$().click(()=>at.setJpegQuality(100,!0)),R.registerRadioGroup(at.OpaqueFileFormatGroup,t=>at.setOpaqueFileFormat(t,!0)),R.registerRadioGroup(at.PngModeGroup,t=>at.setPngMode(t,!0)),R.registerRadioGroup(at.JpegModeGroup,t=>at.setJpegMode(t,!0)),D.PreferencesDialog.openExportOptions.$().click(()=>(S(),dt.show(D.PreferencesDialog.ExportOptionsTab),!1)),D.PreferencesDialog.openImportOptions.$().click(()=>(S(),dt.show(D.PreferencesDialog.ImportOptionsTab),!1)),D.CmApp.ColorsApp.ColorLevels.auto.$().click(at.colorLevelsAuto),D.CmApp.ColorsApp.reset_button.$().click(at.colorLevelsResetAll),D.CmApp.ColorsApp.ColorLevels.reset.$().click(at.colorLevelsResetLevels),D.CmApp.Tools.review.$().click(()=>{L(),D.CmApp.Review.Popover.Popover.$().addClass(n.active.name()),at.Review.start()}),D.CmApp.Tools.ecommerce.$().click(()=>{L(),D.CmApp.Ecommerce.Popover.Popover.$().addClass(n.active.name())}),D.popover_dismiss.$().click(t=>{L(),t.preventDefault()}),P.mouseDownRepeater(D.CmApp.Review.Spinner.backward.$(),at.Review.back,30,2,P.empty,P.empty),P.mouseDownRepeater(D.CmApp.Review.Spinner.forward.$(),at.Review.forward,30,2,P.empty,P.empty),D.CmApp.Ecommerce.set.$().click(dt.Settings.Ecommerce.set),D.CmApp.Ecommerce.revert.$().click(dt.Settings.Ecommerce.revert),D.PreferencesDialog.open.$().click(()=>dt.show(null)),D.sticky_settings.$().click(()=>dt.show()),D.sticky_settings_close.$().click(dt.hide),D.CmApp.Tools.show_crop_app_button.$().click(y),D.CmApp.Tools.show_shadow_app_button.$().click(b),D.CmApp.Tools.show_colors_app_button.$().click(C),D.CmApp.Tools.show_background_app_button.$().click(w),M();function h(t,e){P.addEventListener(t.$(),"touchstart",t=>{e(!0),t.preventDefault()}),P.addEventListener(t.$(),"touchend",t=>{e(!1),t.preventDefault()}),t.$().hover(()=>{e(!0)},()=>{e(!1)})}D.CmApp.Brush.brush_size_button.$().click(t=>{at.setBrushSize(parseInt($(t.currentTarget).data("size")),!0)}),P.mouseDownRepeater(D.CmApp.Brush.Size.decrease.$(),at.decrementBrushSize,30,5,O.push),P.mouseDownRepeater(D.CmApp.Brush.Size.increase.$(),at.incrementBrushSize,30,5,O.push),i=new Kt(at.decrementBrushSize,30,5,O.push),s=new Kt(at.incrementBrushSize,30,5,O.push),$(".global-smoothing-level-button").click(t=>{at.setGlobalSmoothingLevel(parseInt($(t.currentTarget).data("level")),!0)}),$(".global-blur-level-button").click(t=>{at.setGlobalBlurLevel(parseInt($(t.currentTarget).data("level")),!0)}),$(".background-color-swatch-button").click(t=>{let e=$(t.currentTarget).data("color"),o=Jt.fromInt(e);at.setBackgroundColor(o.toRgbaCss(),!0)}),$(".global-offset-button").click(t=>{at.setGlobalOffset(parseFloat($(t.currentTarget).data("offset")),!0)}),$(".use-corner-detection-button").click(t=>{at.setUseCornerDetection($(t.currentTarget).data("usecornerdetection"),!0)}),D.CmApp.Edges.blur_mode.$().click(t=>{at.setBlurMode($(t.currentTarget).data("blurmode"),!0)}),$(".use-local-smoothing-button").click(t=>{at.setUseLocalSmoothing($(t.currentTarget).data("uselocalsmoothing"),!0)}),D.CmApp.Sidebar.auto_clip.$().click(t=>{at.setAutoClip(!at.settings.autoClip,!0,!0)}),R.registerRadioGroup(t.ViewPanesGroup,at.setViewPanesMode),h(D.CmApp.Sidebar.preview,at.tempPreviewViewPaneToggle),h(D.CmApp.Sidebar.viewOriginal,at.tempViewOriginalToggle),h(D.CmApp.Sidebar.marks,at.tempViewMarksToggle),at.setBrushSize(at.defaultSettings.brushSize,!1),window.Globals.Bulk.isApi||X.initializeUi(l,c),dt.ensureInitialized(),e=!0}}(),u&&(u.hide(),u=null),L(),B.Background.mask=at.userMask,B.Foreground.mask=at.userMask,B.Hair.mask=at.userMask,B.MaskEraser.mask=at.userMask,"create"!=at.entryPoint||at.settings.autoClip?(B.Grab.pick(),B.update(!0),at.checkUpdateTempPreviewPaneToggle()):B.Foreground.pick(),ut.main.zoomToFit(!1),ut.main.updateSize(),ut.main.zoomToFit(!0),ut.subViewPort.zoomToFit(!1),ut.subViewPort.updateSize(),ut.subViewPort.zoomToFit(!0)},t.subAppHidden=function(){B.releaseTempSelect(),B.Grab.pick(),u=null},t.updateUndoRedoState=M,O.stateUpdated=M;function x(){at.Review.reset(),D.popover_button.removeClass(D.active),D.exclusive_group.and(D.popover).removeClass(D.active),d=!1,D.$window.off("mousedown.popoverToolbar"),D.AppContent.$().off("mousedown.popoverToolbar"),D.popover_toolbar_no_auto_dismiss.$().off("mousedown.popoverToolbar")}function T(t,e){return()=>{const o=t.hasClass(D.active);if(x(),!o){const i=!o;t.addClass(D.active),e.addClass(D.active),t!=D.CmApp.Hair.Popover.Button&&t!=D.CmApp.Review.Popover.Button&&(D.$window.on("mousedown.popoverToolbar",()=>{d||x(),d=!1}),D.AppContent.$().on("mousedown.popoverToolbar",()=>{B.getActiveMode()==B.Grab&&(d=!0)}),D.popover_toolbar_no_auto_dismiss.$().on("mousedown.popoverToolbar",()=>{d=!0})),i&&t==D.CmApp.Review.Popover.Button&&at.Review.start()}return ut.main.refreshAllViews(),!1}}var E="";function F(t){return $(t.target).is("input")}function I(e){if(F(e))return!0;if(u)return ut.subViewPort.keyUpHandler(e)||u.keyUpHandler(e),!0;switch(ut.main.keyUpHandler(e),e.keyCode){case 82:t.straightenCounterclockwiseRepeater.up();break;case 84:t.straightenClockwiseRepeater.up();break;case 87:at.tempPreviewViewPaneToggle(!1);break;case 81:at.tempViewOriginalToggle(!1);break;case 219:i.up();break;case 221:s.up()}return!0}function L(){Q.dismiss(),x(),et.clearDownState(),ut.refreshAllViews(),N.hide(),W.hide(),dt.hide(),at.Review.reset(),S()}function z(e){if(F(e))return!0;if(e.altKey||e.metaKey)return!0;if(u){if(ut.subViewPort.keyDownHandler(e))return!0;if(u.keyDownHandler(e))return!0}if(ut.main.keyDownHandler(e))return!0;if(e.ctrlKey)return!0;switch(e.keyCode){case 27:L();break;case 49:at.setViewPanesMode(_.ViewPanesSingle);break;case 50:at.setViewPanesMode(_.ViewPanesSplit);break;case 68:at.Review.back();break;case 70:at.Review.forward();break;case 112:N.toggle(),e.preventDefault();break;case 32:B.cycle(B.Background,B.Foreground),e.preventDefault();break;case 88:B.cycle(B.MaskEraser,B.Grab);break;case 66:at.stepBackgroundColor(e.shiftKey);break;case 71:at.jumpToLastBackgroundColor();break;case 67:B.cycle(B.Grab,B.MaskEraser);break;case 86:2!=at.imageCategory.user&&B.cycle(B.Hair,B.Grab);break;case 82:e.shiftKey?t.straightenCounterclockwiseRepeater.down():at.rotateCounterclockwise();break;case 84:e.shiftKey?t.straightenClockwiseRepeater.down():at.rotateClockwise();break;case 87:at.tempPreviewViewPaneToggle(!0);break;case 81:at.tempViewOriginalToggle(!0);break;case 219:i.down();break;case 221:s.down();break;case 83:B.select(B.getSelectedMode()==B.Sword?B.Grab:B.Sword)}return!0}function U(t="Requesting result generation. ",e=5){D.resultDialog.WaitingMsg.$().text(t),D.resultDialog.WaitingBar.$().css("width",e+"%"),D.resultDialog.state.$().hide(),D.resultDialog.Waiting.$().show(),D.resultDialog.copy_to_clipboard.$().addClass("disabled"),D.resultDialog.ReadyDownloadImage.$().attr("src","")}t.toolModeValidate=function(t){return!0},t.toggleAllCanvasViewsClass=function(t,e){h.toggleClass(t,e)},t.toolModeChangeHandler=function(t){h.removeClass(E).addClass(E=t.cssClass),at.sendSetTool(),ut.main.refreshAllViews()},t.keyUpHandler=I,t.keyDownHandler=z,t.pointerInteraction=function(t){switch(t.type){case pt.InteractionType.ActionStart:if(B.getActiveMode().needsHover){let t=ut.main.getMouse_ii();at.drawSquare(t.x,t.y,ut.main.diameter())}B.is(B.Foreground)&&W.strokeGreen(),B.is(B.Background)&&W.strokeRed();break;case pt.InteractionType.ActionMove:if(B.getActiveMode().needsHover){let t=ut.main.getMouse_ii();at.drawLine(t.x,t.y,ut.main.diameter())}break;case pt.InteractionType.PanZoom:et.clearHoverState()}B.is(B.Sword)&&et.pointerInteraction(t,ut.main.getMouse_i(),ut.main.getZoomScale())},t.drawUnder_c=function(t,e,o,i){},t.drawOver_c=function(t,e){},t.drawOver_i=function(t,e){},t.drawUnder_i=function(t,e,o,i){},t.setSaveState=function(t){const e=D.CmApp.Tools.save;t==_.SaveSave?e.removeClass(D.disabled):(t==_.SaveSaving||t==_.SaveSaved)&&e.addClass(D.disabled)},t.setLightState=function(t){t==_.LightUpdated?D.CmApp.Tools.download.$().removeAttr("disabled"):D.CmApp.Tools.download.$().attr("disabled","disabled"),D.lightState.progress.$().toggle(t==_.LightProgress),D.lightState.connecting.$().toggle(t==_.LightConnecting),D.lightState.updating.$().toggle(t==_.LightUpdating),D.lightState.updated.$().toggle(t==_.LightUpdated),D.AppView.$().toggleClass("busy",t!=_.LightUpdated)},t.resultPending=U,t.resultReady=function(t,e){if(D.resultDialog.state.$().hide(),t){let t=at.downloadParityUrl(at.resultParity);D.resultDialog.ready_download_menu_item.$().attr("href",t),D.resultDialog.ready_download_menu_item_text.$().text(p.s("Result ("+at.exportFileFormat()+")"));var o=D.resultDialog.ready_download_link.$().attr("href",t);ot.attachToLink(o,(function(){var t=at.result.filename;return t?"image/"+t.substr(t.lastIndexOf(".")+1)+":"+t:null}));let e=D.resultDialog.ReadyDownloadImage.$();e.on("load",()=>{D.resultDialog.copy_to_clipboard.$().removeClass("disabled")}),e.attr("src",t),D.resultDialog.download_alpha_mask_menu_item.$().attr("href",at.downloadAlphaGrayscaleUrl()),D.resultDialog.download_svg_path_menu_item.$().attr("href",at.downloadSvgPathUrl()),D.resultDialog.download_tiff_path_menu_item.$().attr("href",at.downloadTiffPathUrl()),D.resultDialog.Ready.$().show()}else D.resultDialog.ErrorMsg.$().text(e),D.resultDialog.Error.$().show()},t.refreshAllViews=function(){ut.refreshAllViews()}}(nt||(nt={})),function(t){O.sourceFunction=Ht;t.hasServerRgbHistogramResponse=!1,t.appHasAlreadyRun=!1;let e=!1;t.imageCanvas=null,t.previewCanvas=null,t.userMask=null;let o,i=void 0,s=void 0,r=void 0,a=void 0,l=!1,c=!1;function u(){return{autoLevels:null,autoClip:null,brushSize:_.BrushSize,globalSmoothingLevel:0,globalBlurLevel:1,globalOffset:0,rotateAngleDeg:0,straightenAngleDeg:0,brightness:0,shadows:0,highlights:0,temperature:0,removeColorCast:!1,castColor:16777215,colorCastForegroundProtection:4,whiteBalanceEnabled:!1,whiteBalanceGrayColor:16777215,useBrush:!0,useCornerDetection:!0,blurMode:void 0,useLocalBlur:!0,useLocalSmoothing:!0,backgroundColor:null,cropMode:_.CropUnconstrained,cropMarginUnits:_.CropMarginPercent,cropObjectSize:_.CropSizeLarge,cropVerticalAlignment:_.CropAlignmentMiddle,cropShadows:_.CropShadowsPad,cropAspectRatio:null,cropTargetSize:null,cropAllowEnlarging:!1,cropFitToResult:!1,cropPaddingMils:50,cropPaddingPixels:25,cropRect_o:new Wt,outputDpi:72,outputColorSpace:_.ColorSpaceSrgb,jpegQuality:92,pngMode:_.PngModeNone,jpegMode:_.JpegModeNone,opaqueFileFormat:_.OpaqueFileFormatJpeg,maxNumMegapixels:null,preCropEnabled:!1,preCropLockAspectRatio:!1,viewPanesMode:_.ViewPanesSplit}}t.settings=u(),t.entryPoint=null,t.boundingRect=null,t.shadowsRect=null,t.result={ready:!1,success:!1,msg:null,shown:!1,posted:!1,filename:"unknown.png"},t.imageSize=null,t.imageAspectRatio=null,t.stickySettings=null,t.defaultSettings=null,t.resultParitySalt=Date.now().toString(),t.bezierSet=[],t.bezierSetLength=0;let h=[];t.detectedCorners=[];let d=0,g=0,m=0,f=0,S=Pt.empty(),w=!1,C=255,y=255,b=255,v=0,A=new Wt;t.resultParity=!1;let M=!1,T=!1,R=!1,E=!1,F=null,V=null,Q=!1,j=!1,Z=null,K=null,tt=0,ot=0,it=null,st=!1,at=null;t.previewCanvasData=null;let ct=null,pt=null,gt=!1,mt=function(t,e,o,i,s){!function(t,e,o,i,s){pt[t]=o,pt[t+1]=i,pt[t+2]=s,pt[t+3]=e}(t,e,o,i,s)},ft=null,St=null,wt=null,Ct=!0,yt=null,bt=null,vt=null,At={hasImage:0,hasDrawCommands:0};t.imageCategory={user:0,server:0},t.serverImageCategories={preferred:0,allowPhoto:!1,allowLogo:!1,allowScan:!1},t.hasUser=function(){return!!window.GlobalsEx.email};let kt=null,Mt=!1;function xt(){const t=Bt();Mt&&!t&&Ft(!0),Tt(t),Li(),Gi({command:_.MaybeSaved})}function Tt(t){t?D.resultDialog.download_link.$().attr("target","_blank"):D.resultDialog.download_link.$().removeAttr("target")}function Dt(){$(window).off("beforeunload")}function Rt(){N.hide()||(window.Globals.Bulk.isIframe&&Gi({command:_.Exiting}),Bt()?(P.saveAndExit(!0),Mt=!0,Nt()):(window.Globals.Bulk.isIframe&&!window.Globals.Bulk.isApiSingle&&P.saveAndExit(!0),Ft(!0)))}function Ft(t=!1){return Dt(),window.Globals.Bulk.isIframe?Gi({command:_.Exit,isNice:!!t}):G.exit(),!1}function Bt(){return M||Q||0==At.hasImage||At.hasDrawCommands!=t.hasDrawCommands||t.imageCategory.server!=t.imageCategory.user}function Ot(t,e,o,i,s){t.decrease.$().toggleClass("disabled",e==o),t.increase.$().toggleClass("disabled",e==i),t.reset.$().toggleClass("disabled",e==s)}function Lt(t){return t.w.toFixed(0)+" x "+t.h.toFixed(0)+"px ("+P.formatAspectRatio(P.fuzzyAspectRatio(t))+")"}function zt(){let e;e=0==t.hasImage?_.LightProgress:ot==tt?_.LightUpdated:I.isConnected()?_.LightUpdating:_.LightConnecting,K!=e&&(K=e,x.App.setLightState(e))}function $t(){let t;t=Q||j?_.SaveSaving:M?_.SaveSave:_.SaveSaved,Z!=t&&(Z=t,x.App.setSaveState(t))}function Ut(e){t.appHasAlreadyRun&&Bt()?t.checkSaveDrawCommands(e):e&&setTimeout(e,0)}function Nt(e){function o(){clearTimeout(F),F=setTimeout(()=>t.checkSaveDrawCommands(),5e3),$t(),xt(),e&&e()}if(clearTimeout(F),Q)j=!0;else if(M){M=!1;let e=Vt();if(V!=e){Q=!0,Tt(!0),$t();let i=new Blob([e],{type:"application/json"});k.uploadS3WithRetry(i,it.drawCommands,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Saving edits"),maxAge:0,success:()=>{V=e,Q=!1,0==t.hasDrawCommands&&(t.hasDrawCommands=1,Mi()),j?(j=!1,Nt()):o()}})}else o()}else o()}function Ht(){switch(t.imageCategory.user){case 0:i=t.userMask.encodeEx();break;case 1:s=t.userMask.encodeEx();break;case 2:r=t.userMask.encodeEx();break;case 3:a=t.userMask.encodeEx()}let e={userMask:!!s||!!r||!!a?void 0:i.data,maskVersion:_.MaskVersion,photoMask:s,logoMask:r,scanMask:a,duplicateState:{imageCategory:t.imageCategory.user,serverImageCategories:t.serverImageCategories},hasReceivedInitialScanMask:l,hasReceivedInitialPhotoMask:c,scalpel:et.encode(),shadowApp:ht.encode()};window.Globals.isDev&&(e.exampleSword=et.cutSet.encodedPolyBezierSet());let o=$.extend(!0,e,t.settings);return t.settings.cropFitToResult?delete o.cropRect_o:o.cropRect_o=t.settings.cropRect_o.dup(),o}function Vt(){return JSON.stringify(Ht())}function Yt(){let e=2==t.imageCategory.user,o=1==t.imageCategory.user,i=3==t.imageCategory.user;D.AppOuterWrapper.toggleClass(D.CmApp.Cat.isLogoMode,e).toggleClass(D.CmApp.Cat.isScanMode,i).toggleClass(D.CmApp.Cat.isPhotoMode,o),D.CmApp.Cat.logoMode.$().toggleClass("active",e).toggleClass("disabled",!t.serverImageCategories.allowLogo).toggle(t.serverImageCategories.allowLogo),D.CmApp.Cat.scanMode.$().toggleClass("active",i).toggleClass("disabled",!t.serverImageCategories.allowScan).toggle(t.serverImageCategories.allowScan),D.CmApp.Cat.photoMode.$().toggleClass("active",o).toggleClass("disabled",0==t.imageCategory.server),D.CmApp.Cat.disableInLogoMode.or(D.CmApp.Cat.disableInScanMode).removeClass(D.disabled).removeAttr("disabled"),e&&D.CmApp.Cat.disableInLogoMode.addAttr("disabled").addClass(D.disabled),i&&D.CmApp.Cat.disableInScanMode.addAttr("disabled").addClass(D.disabled);let s=D.CmApp.Sidebar.mode_container.$(),r=s.hasClass(n.active.name()),a=t.serverImageCategories.allowLogo||t.serverImageCategories.allowScan;a!=r&&s.toggle(200),s.toggleClass(n.active.name(),a),e&&B.is(B.Hair)&&B.Grab.pick()}function Xt(e){0==t.imageCategory.server||2==e&&!t.serverImageCategories.allowLogo||3==e&&!t.serverImageCategories.allowScan||t.imageCategory.user!=e&&(t.imageCategory.user=e,t.imageCategory.server,H.show(!1,!0),xi(),Yt(),le())}function qt(t){let e=D.CmApp.Tools.ColorPicker.$(),o=D.CmApp.BgColor.ColorPickerPopover.$();function i(){let i=e.position(),s=o.hasClass(D.CmApp.BgColor.in_bg_app.name()),r=window.innerWidth>768,n=s;if(o.toggleClass("bottom",n).toggleClass("top",!n),s)o.css({top:e.outerHeight()+i.top,left:i.left+(e.outerWidth()-o.outerWidth())/2,right:"auto",bottom:"auto"}).show();else if(r||t)o.css({bottom:e.outerHeight()+i.top+6,left:i.left+(e.outerWidth()-o.outerWidth())/2,right:"auto"}).show();else{const t=o.closest(D.CmApp.tool_popover_content.css());t.addClass(D.CmApp.dropdown_open.name()),t.css({right:3+t[0].scrollWidth-window.innerWidth}),o.css({bottom:"100%",left:"auto",right:10}).show()}}wt=$.farbtastic(D.CmApp.BgColor.ColorPicker.css(),D.CmApp.Tools.ColorPicker.css(),e=>{let o=Jt.fromCss(e);D.CmApp.BgColor.Custom.$().data("color",o.toInt()),D.CmApp.BgColor.Custom.anscestorOf(D.CmApp.BgColor.swatch).$().css("background-color",e),D.CmApp.Tools.ColorPicker.$().css("background-color",e),Ct&&!t&&(clearTimeout(yt),yt=setTimeout(()=>{Ve(e,!0)},100))}),e.blur(()=>{o.hide();o.closest(D.CmApp.tool_popover_content.css()).removeClass(D.CmApp.dropdown_open.name())}).focus(i).keydown(t=>{t.stopPropagation()}),D.$window.resize(()=>{e.blur()}),t&&i()}function Kt(){t.defaultSettings.autoLevels&&hi(),null==t.settings.autoClip&&ue(t.defaultSettings.autoClip,!1,!0)}function te(t){void 0===t.blurMode&&void 0!==t.useLocalBlur&&(t.blurMode=t.useLocalBlur?_.BlurModeLocal:_.BlurModeFixed),t.useLocalBlur=void 0}function ee(e,o){if("string"==typeof e)try{"object"!=typeof(e=JSON.parse(e))&&(e={})}catch(t){e={}}te(e),o&&U.setStickySettings(JSON.stringify(e),(function(t){P.gaTrack("ErrorShown","Failed to save sticky settings",t),alert(p.s("Sorry, failed to save your sticky settings:")+" "+t+"\n\n"+p.s("Please try again and let us know if the error persists!"))}),(function(){window.Globals.Bulk.isIframe&&window.checkPostMessage({command:_.StickySettingsUpdated,settings:e})})),t.stickySettings=$.extend({dropShadow:{},mirrorShadow:{},perspectiveShadow:{},ellipseShadow:{}},e),t.defaultSettings=$.extend(!0,{},_.FactoryDefaults,t.stickySettings),t.defaultSettings.ellipseShadow=$.extend(!0,{},_.FactoryDefaults.ellipseShadow,t.stickySettings.ellipseShadow),t.defaultSettings.dropShadow=$.extend(!0,{},_.FactoryDefaults.dropShadow,t.stickySettings.dropShadow),t.defaultSettings.mirrorShadow=$.extend(!0,{},_.FactoryDefaults.mirrorShadow,t.stickySettings.mirrorShadow),t.defaultSettings.perspectiveShadow=$.extend(!0,{},_.FactoryDefaults.perspectiveShadow,t.stickySettings.perspectiveShadow),Be(),oe()}function oe(){D.CmApp.Edges.Smoothing.reset.$().toggleClass("disabled",t.settings.globalSmoothingLevel==t.defaultSettings.globalSmoothingLevel),D.CmApp.Edges.FeatheringRadius.reset.$().toggleClass("disabled",t.settings.globalBlurLevel==t.defaultSettings.globalBlurLevel),D.CmApp.Edges.Offset.reset.$().toggleClass("disabled",t.settings.globalOffset==t.defaultSettings.globalOffset),ao(),go(),bo(),si(),we(),me(),ye(),ve(),xe(),De(),ke(),Ee(),Ge(),J.updateDisplay(),ht.updateDisplay()}function se(n,w,C){o=$.extend(!0,{},C),T=!1,st=!1,kt=null,t.result={ready:!1,success:!1,msg:null,shown:!1,posted:!1,filename:"unknown.png"},e||(qt(!1),Ne(He())),d=n.width(),g=n.height(),A.right0=d,A.bottom0=g,t.boundingRect=null,t.imageSize={w:d,h:g},t.imageAspectRatio=P.fuzzyAspectRatio(t.imageSize),m=d/2,f=g/2,S.setXy(m,f),t.imageCanvas=n,it=w,t.previewCanvas=new It(d,g),t.previewCanvas.context().drawCanvasEx(t.imageCanvas,0,0),at=t.previewCanvas.context().getImageData(0,0,d,g),t.previewCanvasData=at.data,ct=at,pt=t.previewCanvasData,ft=t.imageCanvas.context().getImageData(0,0,d,g),St=ft.data,i=s=r=a=void 0,"create"==t.entryPoint?C.hasReceivedInitialPhotoMask=!t.defaultSettings.autoClip:"resume"==t.entryPoint?it.hasDrawCommands>0?void 0===C.hasReceivedInitialPhotoMask&&(C.hasReceivedInitialPhotoMask=!0):C.hasReceivedInitialPhotoMask=!!C.hasReceivedInitialPhotoMask||!t.defaultSettings.autoClip||!t.defaultSettings.autoHair:C.hasReceivedInitialPhotoMask=!0,l=!!C.hasReceivedInitialScanMask,c=!!C.hasReceivedInitialPhotoMask||!t.defaultSettings.autoHair,window.Globals.Bulk.isIframe||G.goTo(it,!t.appHasAlreadyRun),t.appHasAlreadyRun||(D.$window.on("beforeunload",e=>t.hasUnsavedChanges()?(e.preventDefault(),p.s("There are unsaved changes.")):void 0),D.force_exit.$().click(Ft),D.exit_app.$().click(Rt).removeAttr("disabled"),$(document).on("mouseleave",()=>Ut()),t.appHasAlreadyRun=!0),D.resultDialog.ReadyShareLink.$(!0).attr("href",t.shareUrl()),I.initialize({imageId:it.id,secret:it.secret,requestScanMask:!l,requestPhotoMask:!c,newMessageFromServer:Ci,connectedToNewServer:yi,disconnectedFromServer:bi}),ot=0,tt=0,t.userMask=B.buildUserMask(t.imageCanvas.width(),t.imageCanvas.height()),t.bezierSet=[],h=[],t.bezierSetLength=0,t.settings=u(),ht.updateImage(),et.clear(),ce(C,!1),"duplicate"==t.entryPoint?(M=!0,V=null):(M=!1,V=Vt()),Nt(),T=!0,w.hasDrawCommands?null==t.settings.autoClip&&ue(!1,!1,!0):Kt(),x.App.imageUpdated(),zt(),window.Globals.Bulk.isApi||X.checkFetch(),lt.initialized&&null!=lt.maxNumMegapixels&&(lt.maxNumMegapixels==t.stickySettings.maxNumMegapixels&&lt.lockAspectRatio==t.stickySettings.preCropLockAspectRatio||(Re(lt.maxNumMegapixels,!1),t.stickySettings.preCropLockAspectRatio=lt.lockAspectRatio,dt.commitSticky(!0))),Ge(),Le(),e||(D.CmApp.Cat.logoMode.$().click((function(){Xt(2)})),D.CmApp.Cat.scanMode.$().click((function(){Xt(3)})),D.CmApp.Cat.photoMode.$().click((function(){Xt(1)})),e=!0),oe(),Gi({command:_.Booted})}function re(e){P.loadImageFromDataUrl(e,t=>{},e=>{e.width==t.imageCanvas.width()&&e.height==t.imageCanvas.height()&&function(e){let o=t.imageCanvas.context();o.drawImage(e,0,0),ft=o.getImageData(0,0,d,g),St=ft.data;for(let e=0;e<t.previewCanvasData.length;e+=4)255==t.previewCanvasData[e+3]&&(t.previewCanvasData[e+0]=St[e+0],t.previewCanvasData[e+1]=St[e+1],t.previewCanvasData[e+2]=St[e+2]);ki(),vi(),D.ImageColorCorrectionNotification.$().show().click((function(){$(this).hide()})),setTimeout(()=>{D.ImageColorCorrectionNotification.$().hide()},2e4),zi({command:_.RequestFullServerMask}),ut.refreshAllViews()}(e)})}function ne(t){return!function(t){return null==t}(t)}function ae(t,e,o){return ne(t)?t:ne(e)?e:o}function le(){switch(t.imageCategory.user){case 0:t.userMask.decodeFrom(i);break;case 1:t.userMask.decodeFrom(s||i);break;case 2:t.userMask.decodeFrom(r||i);break;case 3:t.userMask.decodeFrom(a||i)}}function ce(e,o){te(e),e.hasOwnProperty("photoMask")&&(s=e.photoMask),e.hasOwnProperty("logoMask")&&(r=e.logoMask),e.hasOwnProperty("scanMask")&&(a=e.scanMask),e.hasOwnProperty("userMask")&&(i={data:e.userMask,version:e.maskVersion}),le(),e.hasReceivedInitialScanMask&&(l=!0),e.hasReceivedInitialPhotoMask&&(c=!0);let n=t.defaultSettings;de(ae(e.brushSize,n.brushSize),!1),Ve(ae(e.backgroundColor,n.backgroundColor),!1),Xe(ae(e.globalBlurLevel,n.globalBlurLevel),!1),Ye(ae(e.globalSmoothingLevel,n.globalSmoothingLevel),!1),qe(ae(e.globalOffset,n.globalOffset),!1),Je(ae(e.useCornerDetection,n.useCornerDetection),!1),Qe(ae(e.blurMode,n.blurMode),!1),je(ae(e.useLocalSmoothing,n.useLocalSmoothing),!1),Lo(ae(e.rotateAngleDeg,0),!1),Uo(ae(e.straightenAngleDeg,0)),E=!0,Yo(ae(e.brightness,0)),qo(ae(e.shadows,0)),Qo(ae(e.highlights,0)),Zo(ae(e.temperature,0)),ti(ae(e.saturation,0)),ai(ae(e.removeColorCast,n.removeColorCast),!1),li(ae(e.castColor,n.castColor),!1),ci(ae(e.colorCastForegroundProtection,n.colorCastForegroundProtection)),ri(ae(e.whiteBalanceEnabled,n.whiteBalanceEnabled),!1),ni(ae(e.whiteBalanceGrayColor,n.whiteBalanceGrayColor),!1),oi(ae(e.outputColorSpace,n.outputColorSpace),!1),ue(ae(e.autoClip,null),!1,!1),E=!1,R=!0,e.cropRect_o&&to(Wt.from(e.cropRect_o),!1),eo(ae(e.cropMode,n.cropMode),!1),oo(ae(e.cropMarginUnits,n.cropMarginUnits),!1),io(ae(e.cropObjectSize,n.cropObjectSize),!1),so(ae(e.cropVerticalAlignment,n.cropVerticalAlignment),!1),ro(ae(e.cropShadows,n.cropShadows),!1),Fo(ae(e.cropAspectRatio,n.cropAspectRatio,t.settings.cropAspectRatio),!1,!1),Bo(ae(e.cropTargetSize,n.cropTargetSize,t.settings.cropTargetSize),!1,!1),no(ae(e.cropPaddingMils,n.cropPaddingMils),!1),co(ae(e.cropPaddingPixels,n.cropPaddingPixels),!1),Do(ae(e.cropFitToResult,n.cropFitToResult),!1),Po(ae(e.cropAllowEnlarging,n.cropAllowEnlarging),!1,!1),uo(ae(e.outputDpi,n.outputDpi),!1),mo(ae(e.jpegQuality,n.jpegQuality),!1),So(ae(e.opaqueFileFormat,n.opaqueFileFormat),!1),wo(ae(e.pngMode,n.pngMode),!1),Co(ae(e.jpegMode,n.jpegMode),!1),R=!1,Wo(Vo()),xo(),mi(),Ze(),e.scalpel?et.decode(e.scalpel):e.sword&&et.decodeSword(e.sword),e.shadowApp&&ht.decode(e.shadowApp),o&&(Di(!0),Ri(),Ii(),Bi(),Pi(!0),ut.main.refreshAllViews()),x.StickySettings.updateDisplay()}function pe(e=!0){e&&O.push(),t.userMask.clearAll(),setTimeout(()=>{Pi(!0),et.clear(),ut.main.refreshAllViews()},0)}function ue(e,o,i){return D.body.toggleClass(D.autoClipEnabled,e).toggleClass(D.autoClipDisabled,!e),e!=t.settings.autoClip&&(o&&O.push(),t.settings.autoClip=e,he(),i&&Ri(),!0)}function he(){D.CmApp.Sidebar.auto_clip.$().toggleClass(D.active.name(),t.settings.autoClip)}function de(e,o){return(e=P.clamp(e,1,40))!=t.settings.brushSize&&(o&&O.push(),t.settings.brushSize=e,D.CmApp.Brush.Size.display.$().text(e+"px"),Ot(D.CmApp.Brush.Size,e,1,40,0),ut.main.refreshAllViews(),!0)}function ge(e,o){e!=t.defaultSettings.oneClickDownloadEnabled&&(t.stickySettings.oneClickDownloadEnabled=e,me(),o&&dt.commitSticky(!0))}function me(){D.enable_one_click_download_checkbox.$().prop("checked",t.defaultSettings.oneClickDownloadEnabled);let e=fe();$("#result-dialog").toggleClass(D.one_click_download_enabled.name(),e),D.resultDialog.download_combo_button.$().toggle(!e),D.resultDialog.download_menu_button.$().toggle(e)}function fe(){return t.defaultSettings.oneClickDownloadEnabled&&!P.isMobile()}function Se(e,o){e!=t.stickySettings.preCropEnabled&&(t.stickySettings.preCropEnabled=e,we(),o&&dt.commitSticky(!0))}function we(){D.pre_crop_enabled_checkbox.$().prop("checked",t.stickySettings.preCropEnabled)}function Ce(e,o){e!=t.stickySettings.onlyUsePhotoMode&&(t.defaultSettings.onlyUsePhotoMode=t.stickySettings.onlyUsePhotoMode=e,ye(),De(),xe(),o&&dt.commitSticky(!0),e&&2==t.imageCategory.user&&Xt(1))}function ye(){D.only_use_photo_mode_checkbox.$().prop("checked",t.stickySettings.onlyUsePhotoMode)}function be(e,o){e!=t.defaultSettings.autoClip&&(t.defaultSettings.autoClip=t.stickySettings.autoClip=e,ve(),o&&dt.commitSticky(!0))}function ve(){D.enable_auto_clip_checkbox.$().prop("checked",t.defaultSettings.autoClip),D.allow_auto_hair_checkbox.toggleClass(D.disabled,!t.defaultSettings.autoClip).toggleAttr("disabled",!t.defaultSettings.autoClip)}function Ae(e,o){e!=t.defaultSettings.autoHair&&(t.defaultSettings.autoHair=t.stickySettings.autoHair=e,ke(),o&&dt.commitSticky(!0))}function ke(){D.allow_auto_hair_checkbox.$().prop("checked",t.defaultSettings.autoHair)}function Me(e,o){e!=Te()&&(e&&t.stickySettings.onlyUsePhotoMode&&(t.defaultSettings.onlyUsePhotoMode=t.stickySettings.onlyUsePhotoMode=!1,t.defaultSettings.allowScanMode=t.stickySettings.allowScanMode=!1),t.defaultSettings.allowLogoMode=t.stickySettings.allowLogoMode=e,xe(),ye(),o&&dt.commitSticky(!0))}function xe(){D.allow_logo_mode_checkbox.$().prop("checked",Te())}function Te(){return!t.stickySettings.onlyUsePhotoMode&&t.defaultSettings.allowLogoMode}function _e(e,o){e!=Pe()&&(e&&t.stickySettings.onlyUsePhotoMode&&(t.defaultSettings.onlyUsePhotoMode=t.stickySettings.onlyUsePhotoMode=!1,t.defaultSettings.allowLogoMode=t.stickySettings.allowLogoMode=!1),t.defaultSettings.allowScanMode=t.stickySettings.allowScanMode=e,De(),ye(),o&&dt.commitSticky(!0))}function De(){D.allow_scan_mode_checkbox.$().prop("checked",Pe())}function Pe(){return!t.stickySettings.onlyUsePhotoMode&&t.defaultSettings.allowScanMode}function Re(e,o){return(e=P.clamp(e,1,_.MaxMaxNumMegapixels))!=t.stickySettings.maxNumMegapixels&&(t.stickySettings.maxNumMegapixels=e,Ee(),o&&dt.commitSticky(!0),ut.main.refreshAllViews(),!0)}function Ee(){const e=p.s("{0} {0,plural,one{megapixel}other{megapixels}}",t.stickySettings.maxNumMegapixels||_.FactoryDefaults.maxNumMegapixels);D.MaxNumMegapixels.display.$().text(e),Ot(D.MaxNumMegapixels,t.stickySettings.maxNumMegapixels,1,_.MaxMaxNumMegapixels,4)}t.unhookBeforeunload=Dt,t.hasUnsavedChanges=Bt,t.formatTargetSize=Lt,t.setBulkImagesRemaining=function(t,e,o,i){D.bulk_status_display.$().text(p.s("{0} / {1} left",i,t)).attr("title",t+" total, "+e+" done, "+i+" remaining, "+o+" skipped")},t.updateSettingsSummary=function(){let e=t.getCrop_o(),o=t.getCropTargetSize(),i=null;function s(t,e){return e?"<b>"+t+"</b>":t}function r(t,e){return s(t,null!=e&&t!=e)}function n(t,e){const o=255==Jt.fromCss(t.backgroundColor||_.TransparentColor).aInt()?p.s("opaque background"):p.s("transparent background");let i=yo(e),s=i==_.JPEG?p.s("quality level {0}",t.jpegQuality):"",r=ii()+" "+p.s("color space"),n=t.outputDpi+" DPI";const a=p.s("not web optimized");let l=a;return i==_.PNG?t.pngMode==_.PngModeLossy?l=p.s("lossy optimization"):t.pngMode==_.PngModeLossless&&(l=p.s("lossless optimization")):t.jpegMode==_.JpegModeMoz&&(l=p.s("web optimized")),l!=a&&(r=p.s("default color space"),n=p.s("default DPI")),{opaque:o,fileFormat:i,qualityLevel:s,optimized:l,colorSpace:r,dpi:n}}i=t.settings.cropMode==_.CropTargetSize&&null!=o&&(t.settings.cropAllowEnlarging||o.w<e.width()||o.h<e.height())?Lt(o):Lt({w:e.width(),h:e.height()}),D.CmApp.CropApp.output_size_display.$().text(i);const a=n(t.defaultSettings,t.settings.backgroundColor),l=n(t.settings,t.settings.backgroundColor),c=r(l.fileFormat,a.fileFormat),u=0==l.qualityLevel.length?c:p.s("{0} ({1})",c,r(l.qualityLevel,a.qualityLevel));D.resultDialog.SettingsSummary.ExportOptions.Value.$().html(p.commaList([r(l.opaque,a.opaque),u,r(l.optimized,a.optimized),r(l.colorSpace,a.colorSpace),r(l.dpi,a.dpi)]));const h=0==t.settings.brightness&&0==t.settings.shadows&&0==t.settings.highlights&&0==t.settings.temperature&&0==t.settings.saturation,d=h?p.s("levels not adjusted"):p.s("levels adjusted"),g=p.s("white balance")+" "+(t.settings.whiteBalanceEnabled?p.s("enabled"):p.s("disabled")),m=p.s("color cast removal")+" "+(t.settings.removeColorCast?p.s("enabled"):p.s("disabled"));function f(t){let e=p.s("unconstrained");return t.cropMode==_.CropLockedAspectRatio?e=p.s("locked aspect ratio: {0}",P.formatAspectRatio(Eo())):t.cropMode==_.CropTargetSize&&(e=p.s("fixed size: {0}",Lt(Io()))),e}function S(t){return t.cropFitToResult?p.s("fit to result"):p.s("manual crop")}D.resultDialog.SettingsSummary.ColorsApp.Value.$().html(p.commaList([s(d,!h),s(g,t.settings.whiteBalanceEnabled),s(m,t.settings.removeColorCast)]));let w=[r(S(t.settings),S(t.defaultSettings)),r(f(t.settings),f(t.defaultSettings))];if(t.settings.cropFitToResult){const e=dt.Settings.Crop;t.settings.cropMarginUnits==_.CropMarginPercent?w.push(e.PaddingMils.getSummaryDisplay("margin")):w.push(e.PaddingPixels.getSummaryDisplay("margin")),w.push(e.ObjectSize.getSummaryDisplay("object")),w.push(e.VerticalAlignment.getSummaryDisplay("alignment")),w.push(e.Shadows.getSummaryDisplay("shadows"))}let C=t.settings.rotateAngleDeg+t.settings.straightenAngleDeg;w.push(s(p.s("rotated {0}&deg;",P.signedNumber(C)),0!=C)),D.resultDialog.SettingsSummary.CropApp.Value.$().html(p.commaList(w));const y=ht.getNumEllipseShadows();let b=p.s("no oval shadows");1==y?b=p.s("1 oval shadow"):y>1&&(b=y+" "+p.s("oval shadows")),b=s(b,0!=y);const v=dt.Settings.Shadows,A=ht.dropShadow,k=v.Drop;let M=k.Enabled.getSummaryEnabledDisplay("drop shadow");A.enabled&&(M+=" ("+p.commaList([k.BlurRadius.getSummaryDisplay("blur radius"),k.Opacity.getSummaryDisplay("opacity"),k.CropEnabled.getSummaryEnabledDisplay("clipping")])+")");const x=ht.mirrorShadow,T=v.Mirror;let R=T.Enabled.getSummaryEnabledDisplay("reflection");x.enabled&&(R+=" ("+p.commaList([T.Opacity.getSummaryDisplay("opacity"),T.Height.getSummaryDisplay("height"),T.OffsetY.getSummaryDisplay("offset")])+")");const E=ht.perspectiveShadow,F=v.Perspective;let I=F.Enabled.getSummaryEnabledDisplay("cast shadow");E.enabled&&(I+=" ("+p.commaList([F.Opacity.getSummaryDisplay("opacity"),F.OpacityScale.getSummaryDisplay("opacity scale"),F.BlurRadius.getSummaryDisplay("blur radius"),F.BlurRadiusScale.getSummaryDisplay("blur scale")])+")"),D.resultDialog.SettingsSummary.ShadowsApp.Value.$().html(p.commaList([b,M,R,I]))},t.checkSaveChanges=Ut,t.checkSaveDrawCommands=Nt,t.create=function(e,o,i,s,r){H.show(!(s&&s.userMask)),t.entryPoint=r?"create":"duplicate",t.hasImage=0,t.hasDrawCommands=0,M=!1,T=!1;let n=Date.now();if(I.checkForceClose(),k.uploadS3WithRetry(e,i.image,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Uploading original image"),maxAge:31536e3,progress:t=>{D.lightState.progress.$().text(p.s("Uploading... {0}",p.percent(t))),H.uploadProgress(t)},success:()=>{t.hasImage=o.wasShrunk?2:1,zt(),Mi(),P.gaTrack("StartupProgress","uploadedImage",void 0,Date.now()-n)}}),o.wasShrunk&&(t.stickySettings.preCropEnabled||(D.ImageResizeNotification.$().show().click((function(){$(this).hide()})),setTimeout(()=>{D.ImageResizeNotification.$().hide()},2e4))),t.imageCategory={user:0,server:0},t.serverImageCategories={preferred:0,allowPhoto:!1,allowLogo:!1,allowScan:!1},"duplicate"==t.entryPoint&&s.duplicateState){let e=s.duplicateState;t.imageCategory.user=t.imageCategory.server=e.imageCategory,t.serverImageCategories=e.serverImageCategories}se(o,i,s)},t.resume=function(e,o,i){H.alreadyUploaded(),H.show(!1,!0),W.strokeResume(),t.entryPoint="resume",At.hasImage=t.hasImage=o.hasImage,At.hasDrawCommands=t.hasDrawCommands=o.hasDrawCommands,t.imageCategory.user=t.imageCategory.server=o.userCategory,t.serverImageCategories=o.serverCategories,Yt(),V=JSON.stringify(i),se(e,o,i)},t.initializeFarbtastic=qt,t.bulkSetStickySettings=function(t){ee(t,!1),ht.clear(!1),ce(o,!1),it.hasDrawCommands||Kt()},t.setStickySettings=ee,t.tryUndo=function(){O.canUndo()&&ce(O.undo(),!0)},t.tryRedo=function(){O.canRedo()&&ce(O.redo(),!0)},t.getOriginalPixel=function(e,o){if(e=Math.floor(e),o=Math.floor(o),e>=0&&e<d&&e>=0&&o<g){let i=t.imageCanvas.context().getImageData(e,o,1,1).data;return(255&i[0])<<16|(255&i[1])<<8|255&i[2]}return null},t.drawSquare=function(t,e,o){let i=B.getActiveMode();O.schedulePush(),i.drawSquare(t,e,o),Ei(_.DrawSquare,t,e,0,0,o)},t.drawLine=function(t,e,o){let i=B.getActiveMode();if(i.mask)if(O.schedulePush(),null==i.mask.lastX||null==i.mask.lastY)i.drawSquare(t,e,o),Ei(_.DrawSquare,t,e,0,0,o);else{let s=i.mask.lastX,r=i.mask.lastY;i.drawLine(t,e,o),Ei(_.DrawLine,s,r,t,e,o)}},t.clearAllEdits=function(){O.push(),pe(!1),Oo(!1),ht.clear(!1),ui(!1),ce(t.defaultSettings,!0)},t.clearUserMask=pe,t.setAutoClip=ue,t.updateAutoClipDisplay=he,t.setBrushSize=de,t.decrementBrushSize=function(){de(t.settings.brushSize-1,!1)},t.incrementBrushSize=function(){de(t.settings.brushSize+1,!1)},t.setEnableOneClickDownload=ge,t.oneClickDownloadEnabledAndAllowed=fe,t.toggleEnableOneClickDownload=function(){ge(!t.defaultSettings.oneClickDownloadEnabled,!0)},t.setEnablePreCrop=Se,t.toggleEnablePreCrop=function(){Se(!t.stickySettings.preCropEnabled,!0)},t.setOnlyUsePhotoMode=Ce,t.toggleOnlyUsePhotoMode=function(){Ce(!t.stickySettings.onlyUsePhotoMode,!0)},t.setDefaultToAutoClip=be,t.toggleDefaultToAutoClip=function(){be(!t.defaultSettings.autoClip,!0)},t.setAllowAutoHair=Ae,t.toggleAllowAutoHair=function(){Ae(!t.defaultSettings.autoHair,!0)},t.setAllowLogoMode=Me,t.toggleAllowLogoMode=function(){Me(!Te(),!0)},t.setAllowScanMode=_e,t.toggleAllowScanMode=function(){_e(!Pe(),!0)},t.initializeMaxNumMegapixels=function(){Re(t.stickySettings.maxNumMegapixels||_.FactoryDefaults.maxNumMegapixels,!1)},t.setMaxNumMegapixels=Re,t.getMaxNumPixels=function(){return 1024*(t.stickySettings.maxNumMegapixels||_.FactoryDefaults.maxNumMegapixels)*1024},t.incrementMaxNumMegapixels=function(e){Re(t.stickySettings.maxNumMegapixels+e,!0)},t.resetMaxNumMegapixels=function(){Re(_.FactoryDefaults.maxNumMegapixels,!0)};let Fe="",Ie=0;function Be(){if(""==Fe){Ue($(window).innerWidth()>768?t.stickySettings.viewPanesMode||_.ViewPanesSplit:_.ViewPanesSingle,!1)}}function Oe(){return Fe==_.ViewPanesSingle&&B.getActiveMode().isGrab()&&Ni.currentCenter_i.isNaN()}function Le(){Fe==_.ViewPanesSingle&&ze(!1)}function ze(t){$e(t!==Oe()?1:0),D.CmApp.Sidebar.preview.toggleClass(D.CmApp.Sidebar.selected,t)}function $e(t){t!=Ie&&(Ie=t,Ge())}function Ue(e,o=!0){Fe!=e&&(Fe=e,Ge(),Le(),o&&(t.stickySettings.viewPanesMode=e,dt.commitSticky(!0)))}function Ge(){const t=ut.main;if(null!=t&&t.isInitialized()){nt.ViewPanesGroup.update(Fe);let e=Fe==_.ViewPanesSplit;D.CmApp.Sidebar.preview.toggleClass(D.active,!e&&!Oe()),D.CmApp.Sidebar.marks.toggleClass(D.active,!e&&Oe()),e?H.showShadowPane():H.hideShadowPane(),t.setViewConfigs(rt.get(e,Ie))}}function Ne(t){Ct=!1,wt.setColor(t),Ct=!0,window.myLocalStorage.customColor=t;let e=Jt.fromCss(t);D.CmApp.BgColor.Custom.$().data("color",e.toInt()),D.CmApp.BgColor.Custom.anscestorOf(D.CmApp.BgColor.swatch).$().css("background-color",t),D.CmApp.Tools.ColorPicker.$().css("background-color",t)}function He(){return window.myLocalStorage.customColor||"#338855"}function Ve(e,o){e=e||_.TransparentColor;let i=Jt.fromCss(e).toInt(),s=$('.background-color-swatch-button[data-color="'+i+'"]'),r=D.CmApp.BgColor.Custom.$();return 0!=s.length&&r.data("color")!=i||(s=r,Ne(e)),s.button("toggle"),D.CmApp.BgColor.CurrentColor.$().css("background-color",e),e!=t.settings.backgroundColor?(o&&O.push(),bt=t.settings.backgroundColor,t.settings.backgroundColor=e,o&&(Ri(),ut.main.refreshAllViews()),vo(),!0):(vo(),!1)}function We(t,e,o,i,s,r,n){return e=P.clamp(P.roundTo(e,n),i,s),t.display.$().text(e+o),Ot(t,e,i,s,r),e}function Ye(e,o){return(e=We(D.CmApp.Edges.Smoothing,e,"",0,_.MaxSmoothingLevel,t.defaultSettings.globalSmoothingLevel,1))!=t.settings.globalSmoothingLevel&&(o&&O.push(),t.settings.globalSmoothingLevel=e,Ze(),o&&Ri(),!0)}function Xe(e,o){return(e=We(D.CmApp.Edges.FeatheringRadius,e,"px",0,_.MaxBlurLevel,t.defaultSettings.globalBlurLevel,1))!=t.settings.globalBlurLevel&&(o&&O.push(),t.settings.globalBlurLevel=e,Ze(),o&&Ri(),!0)}function qe(e,o){return(e=We(D.CmApp.Edges.Offset,e,"px",0,_.MaxOffset,t.defaultSettings.globalOffset,2))!=t.settings.globalOffset&&(o&&O.push(),t.settings.globalOffset=e,Ze(),o&&Ri(),!0)}function Je(e,o){return $("#use-corner-detection-button-"+e).button("toggle"),e!=t.settings.useCornerDetection&&(o&&O.push(),t.settings.useCornerDetection=e,o&&Ri(),!0)}function Qe(e,o){return $("#CmApp-Edges-"+e).button("toggle"),e!=t.settings.blurMode&&(o&&O.push(),t.settings.blurMode=e,o&&Ri(),!0)}function je(e,o){return $("#use-local-smoothing-button-"+e).button("toggle"),e!=t.settings.useLocalSmoothing&&(o&&O.push(),t.settings.useLocalSmoothing=e,o&&Ri(),!0)}function Ze(){let e=" "+t.settings.globalSmoothingLevel+", "+t.settings.globalBlurLevel+", "+t.settings.globalOffset;$("#blur-offset-smooth-button-label").text(e)}function Ke(){return(t.settings.cropRect_o.isEmpty()?A:t.settings.cropRect_o).dup()}function to(e,o){if(null!=e||t.settings.cropRect_o.isEmpty()){if(null!=e&&!t.settings.cropRect_o.equals(e))return o&&O.push(),t.settings.cropRect_o.setFrom(e),xo(),ht.updatePerspectiveShadowCanvas(),o&&Ri(),!0}else o&&O.push(),t.settings.cropRect_o.set(0,0,0,0),xo(),ht.updatePerspectiveShadowCanvas(),o&&Ri();return!1}function eo(e,o){return e!=t.settings.cropMode&&(o&&O.push(),t.settings.cropMode=e,xo(),o&&Ri(),!0)}function oo(e,o){return e!=t.settings.cropMarginUnits&&(o&&O.push(),t.settings.cropMarginUnits=e,xo(),o&&Ri(),!0)}function io(e,o){return e!=t.settings.cropObjectSize&&(o&&O.push(),t.settings.cropObjectSize=e,xo(),o&&Ri(),!0)}function so(e,o){return e!=t.settings.cropVerticalAlignment&&(o&&O.push(),t.settings.cropVerticalAlignment=e,xo(),o&&Ri(),!0)}function ro(e,o){return e!=t.settings.cropShadows&&(o&&O.push(),t.settings.cropShadows=e,xo(),o&&Ri(),!0)}function no(e,o){return(e=Math.round(P.clamp(e,0,_.CropPaddingMilsMax)))!=t.settings.cropPaddingMils&&(o&&O.push(),t.settings.cropPaddingMils=e,ao(),xo(),o&&Ri(),!0)}function ao(){Ot(D.CmApp.CropApp.PaddingPercent,t.settings.cropPaddingMils,0,_.CropPaddingMilsMax,t.defaultSettings.cropPaddingMils),Ot(D.CmApp.CropApp.PaddingPixels,t.settings.cropPaddingPixels,0,_.CropPaddingPixelsMax,t.defaultSettings.cropPaddingPixels)}function lo(e){no(t.settings.cropPaddingMils+e,!1)}function co(e,o){return(e=Math.round(P.clamp(e,0,_.CropPaddingPixelsMax)))!=t.settings.cropPaddingPixels&&(o&&O.push(),t.settings.cropPaddingPixels=e,ao(),xo(),o&&Ri(),!0)}function po(e){co(t.settings.cropPaddingPixels+e,!1)}function uo(e,o){return(e=Math.round(P.clamp(e,_.MinDpi,_.MaxDpi)))!=t.settings.outputDpi&&(o&&O.push(),t.settings.outputDpi=e,go(),bo(),o&&Ri(),!0)}function ho(e){uo(t.settings.outputDpi+e,!1)}function go(){D.CmApp.CropApp.Dpi.display.$().text(t.settings.outputDpi+" DPI"),Ot(D.CmApp.CropApp.Dpi,t.settings.outputDpi,_.MinDpi,_.MaxDpi,t.defaultSettings.outputDpi)}function mo(e,o){return(e=Math.round(P.clamp(e,_.JpegQualityMin,_.JpegQualityMax)))!=t.settings.jpegQuality&&(o&&O.push(),t.settings.jpegQuality=e,bo(),o&&Ri(),!0)}function fo(e){mo(t.settings.jpegQuality+e,!1)}function So(e,o){return e!=t.settings.opaqueFileFormat&&(o&&O.push(),t.settings.opaqueFileFormat=e,bo(),o&&Ri(),!0)}function wo(e,o){return e!=t.settings.pngMode&&(o&&O.push(),t.settings.pngMode=e,bo(),o&&Ri(),!0)}function Co(e,o){return e!=t.settings.jpegMode&&(o&&O.push(),t.settings.jpegMode=e,bo(),o&&Ri(),!0)}function yo(e=t.settings.backgroundColor){return e!=_.TransparentColor&&null!=e?t.settings.opaqueFileFormat==_.OpaqueFileFormatPng?_.PNG:_.JPEG:_.PNG}function bo(){D.ExportOptions.JpgQuality.display.$().text(t.settings.jpegQuality),Ot(D.ExportOptions.JpgQuality,t.settings.jpegQuality,_.JpegQualityMin,_.JpegQualityMax,t.defaultSettings.jpegQuality),t.OpaqueFileFormatGroup.update(t.settings.opaqueFileFormat),t.PngModeGroup.update(t.settings.pngMode),t.JpegModeGroup.update(t.settings.jpegMode),vo()}function vo(){let e=t.settings.pngMode!=_.PngModeNone,o=t.settings.jpegMode!=_.JpegModeNone,i=e||o,s=D.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.emphasize.name(),r=t.settings.outputColorSpace!=_.ColorSpaceSrgb;D.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.Jpeg.comment.$().toggleClass(s,o),D.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.Png.comment.$().toggleClass(s,e),D.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.Dpi.comment.$().toggleClass(s,i),D.ExportOptions.NoColorSpaceOrDpiInOptimizedOutput.ColorSpace.comment.$().toggleClass(s,i&&r)}function Ao(e,o){return Math.abs(e-o)<=1+t.settings.globalOffset}function ko(){return Et.fromCropRect(A)}function Mo(){let e=t.boundingRect;return null!=e?new Et(e[0],e[1],e[2],e[3]):ko()}function xo(){if(!R){var e=t.settings.cropRect_o.dup();if(t.settings.cropFitToResult&&t.boundingRect){var o=Et.fromBoundingRect(t.boundingRect),i=Et.fromBoundingRect(t.shadowsRect),s=Et.empty();t.settings.cropShadows!=_.CropShadowsIgnore&&(s.left=Math.max(0,o.left-i.left),s.top=Math.max(0,o.top-i.top),s.right=Math.max(0,i.right-o.right),s.bottom=Math.max(0,i.bottom-o.bottom),t.settings.cropShadows==_.CropShadowsPad&&(s.left=s.right=Math.max(s.left,s.right))),s.left=Math.min(s.left,t.imageSize.w),s.top=Math.min(s.top,t.imageSize.h),s.right=Math.min(s.right,t.imageSize.w),s.bottom=Math.min(s.bottom,t.imageSize.h);var r=o.width(),n=o.height(),a=0,l=0;t.settings.cropMarginUnits==_.CropMarginPercent?(a=r*t.settings.cropPaddingMils*.001,l=n*t.settings.cropPaddingMils*.001):l=a=t.settings.cropPaddingPixels;var c=new Et(Ao(o.left,A.left0)?0:a,Ao(o.top,A.top0)?0:l,Ao(o.right,A.right0)?0:a,Ao(o.bottom,A.bottom0)?0:l);c.left=Math.max(c.left,s.left),c.top=Math.max(c.top,s.top),c.right=Math.max(c.right,s.right),c.bottom=Math.max(c.bottom,s.bottom);var p=0,u=0;switch(t.settings.cropObjectSize){case _.CropSizeSmall:p=n*_.CropObjectSizePercentPadSmall,u=r*_.CropObjectSizePercentPadSmall*.5;break;case _.CropSizeMedium:p=n*_.CropObjectSizePercentPadMedium,u=r*_.CropObjectSizePercentPadMedium*.5;break;case _.CropSizeLarge:}switch(t.settings.cropVerticalAlignment){case _.CropAlignmentTop:c.left+=u,c.right+=u,c.bottom+=p;break;case _.CropAlignmentMiddle:c.left+=u,c.top+=.5*p,c.right+=u,c.bottom+=.5*p;break;case _.CropAlignmentBottom:c.left+=u,c.top+=p,c.right+=u}t.settings.cropRect_o.left0=o.left-c.left,t.settings.cropRect_o.right0=o.right+c.right,t.settings.cropRect_o.top0=o.top-c.top,t.settings.cropRect_o.bottom0=o.bottom+c.bottom}t.settings.cropMode==_.CropLockedAspectRatio?_o(Eo()):t.settings.cropMode==_.CropTargetSize&&_o(Io()),function(){let e=t.settings.cropMode==_.CropLockedAspectRatio?Eo():t.settings.cropMode==_.CropTargetSize?Io():{w:t.settings.cropRect_o.width(),h:t.settings.cropRect_o.height()},o=e.w/e.h;t.settings.cropRect_o;if(t.settings.cropRect_o.width()>_.MaxOutputWidthOrHeight){let e=.5*(t.settings.cropRect_o.width()-_.MaxOutputWidthOrHeight),i=0;t.settings.cropMode!=_.CropUnconstrained&&(i=.5*(t.settings.cropRect_o.height()-_.MaxOutputWidthOrHeight/o)),To(e,i)}if(t.settings.cropRect_o.height()>_.MaxOutputWidthOrHeight){let e=0;t.settings.cropMode!=_.CropUnconstrained&&(e=.5*(t.settings.cropRect_o.width()-_.MaxOutputWidthOrHeight*o));let i=.5*(t.settings.cropRect_o.height()-_.MaxOutputWidthOrHeight);To(e,i)}if(t.settings.cropRect_o.area()>_.MaxOutputSize){let e=Math.sqrt(_.MaxOutputSize/t.settings.cropRect_o.area()),o=t.settings.cropRect_o.width()*(1-e)*.5,i=t.settings.cropRect_o.height()*(1-e)*.5;To(o,i)}}();var h=!e.softEquals(t.settings.cropRect_o,.001);!t.settings.cropFitToResult&&h&&(M=!0,$t(),zt()),h&&ht.updatePerspectiveShadowCanvas(),J.updateDisplay(),ut.refreshAllViews()}}function To(e,o){if(0!=e&&(t.settings.cropRect_o.left0+=e,t.settings.cropRect_o.right0-=e),0!=o)switch(t.settings.cropVerticalAlignment){case _.CropAlignmentTop:t.settings.cropRect_o.bottom0-=2*o;break;case _.CropAlignmentMiddle:t.settings.cropRect_o.top0+=o,t.settings.cropRect_o.bottom0-=o;break;case _.CropAlignmentBottom:t.settings.cropRect_o.top0+=2*o}}function _o(e){var o=e.w/e.h,i=t.settings.cropRect_o;i.isEmpty()&&(i.right0=t.imageSize.w,i.bottom0=t.imageSize.h);var s=i.width(),r=i.height();if(o>s/r){var n=(r*o-s)/2;t.settings.cropRect_o.left0-=n,t.settings.cropRect_o.right0+=n}else{var a=(s/o-r)/2;switch(t.settings.cropVerticalAlignment){case _.CropAlignmentTop:t.settings.cropRect_o.bottom0+=2*a;break;case _.CropAlignmentMiddle:t.settings.cropRect_o.top0-=a,t.settings.cropRect_o.bottom0+=a;break;case _.CropAlignmentBottom:t.settings.cropRect_o.top0-=2*a}}}function Do(e,o){return e!=t.settings.cropFitToResult&&(o&&O.push(),t.settings.cropFitToResult=e,xo(),o&&Ri(),!0)}function Po(e,o,i){return!!(e!=t.settings.cropAllowEnlarging||i&&t.settings.cropMode!=_.CropTargetSize)&&(o&&O.push(),t.settings.cropAllowEnlarging=e,i&&(t.settings.cropMode=_.CropTargetSize),xo(),o&&Ri(),!0)}function Ro(t,e){return null==t?null==e:null!=e&&(t.h==e.h&&t.w==e.w)}function Eo(){return null!=t.settings.cropAspectRatio?t.settings.cropAspectRatio:{w:t.imageAspectRatio.w,h:t.imageAspectRatio.h}}function Fo(e,o,i){return!(Ro(Eo(),e)&&(!i||t.settings.cropMode==_.CropLockedAspectRatio))&&(o&&O.push(),t.settings.cropAspectRatio=e?{w:e.w,h:e.h}:null,i&&(t.settings.cropMode=_.CropLockedAspectRatio),xo(),o&&Ri(),!0)}function Io(){return null!=t.settings.cropTargetSize?t.settings.cropTargetSize:{w:d,h:g}}function Bo(e,o,i){return!(Ro(Io(),e)&&(!i||t.settings.cropMode==_.CropTargetSize))&&(o&&O.push(),t.settings.cropTargetSize=e?{w:e.w,h:e.h}:null,i&&(t.settings.cropMode=_.CropTargetSize),xo(),o&&Ri(),!0)}function Oo(e=!0){var o=O.sourceFunction(),i=t.defaultSettings,s=Do(i.cropFitToResult,!1),r=eo(i.cropMode,!1),n=Po(i.cropAllowEnlarging,!1,!1),a=no(i.cropPaddingMils,!1),l=co(i.cropPaddingPixels,!1),c=!i.cropFitToResult&&to(i.cropRect_o,!1),p=oo(i.cropMarginUnits,!1),u=io(i.cropObjectSize,!1),h=so(i.cropVerticalAlignment,!1),d=ro(i.cropShadows,!1);(s||r||n||a||l||c||p||u||h||d)&&(e&&O.push(o),Ri())}function Lo(e,o){var i=Vo();e=P.minMod(e,360),t.settings.rotateAngleDeg!=e&&(o&&O.push(),t.settings.rotateAngleDeg=e,Wo(i),o&&Ri(),xo(),ut.subViewPort.refreshAllViews())}function zo(e){var o=Vo();O.push(),t.settings.rotateAngleDeg=P.minMod(t.settings.rotateAngleDeg+e,360),Wo(o),t.settings.cropMode!=_.CropUnconstrained||t.settings.cropFitToResult||t.settings.cropRect_o.isEmpty()||(t.settings.cropRect_o.rotate(e,m,f),xo()),Ri()}function $o(){return t.settings.rotateAngleDeg*Math.PI/180}function Uo(e){var o=Vo();t.settings.straightenAngleDeg!=e&&(t.settings.straightenAngleDeg=parseFloat(e.toFixed(1)),Wo(o,!1))}function Go(e){Uo(P.clamp(t.settings.straightenAngleDeg+e,-45,45))}function No(){return t.settings.straightenAngleDeg*Math.PI/180}function Ho(){return(t.settings.rotateAngleDeg+t.settings.straightenAngleDeg)*Math.PI/180}function Vo(){return-Ho()}function Wo(e,o=!0){var i=No(),s=d,r=g,n=g>d;n&&(r=d,s=g);var a=r/Math.sqrt(s*s+r*r),l=Math.acos(a)-Math.abs(i),c=Math.cos(l)/a,p=s*c,u=r*c,h=(s-p)/2,S=(r-u)/2,w=h,C=S,y=h+p,b=S+u;n&&(w=S,C=h,y=S+u,b=h+p);var v=$o(),k=Math.sin(v),M=Math.cos(v),x=w-m,T=C-f,_=y-m,P=b-f,R=M*x-k*T+m,E=k*x+M*T+f,F=M*_-k*P+m,I=k*_+M*P+f;A.left0=Math.min(R,F),A.right0=Math.max(R,F),A.top0=Math.min(E,I),A.bottom0=Math.max(E,I),D.CmApp.CropApp.StraightenSpinner.reset.$().toggleClass("disabled",0==t.settings.straightenAngleDeg),D.CmApp.CropApp.RotateSpinner.reset.$().toggleClass("disabled",0==t.settings.rotateAngleDeg),D.CmApp.CropApp.StraightenSpinner.display.$().html(t.settings.straightenAngleDeg.toFixed(1)+"&deg;"),D.CmApp.CropApp.RotateSpinner.display.$().html(t.settings.rotateAngleDeg+"&deg;"),o&&ht.updateMirrorShadowCanvas(),ut.main.rotationCropUpdated(e,Vo()),ut.subViewPort.rotationCropUpdated(e,Vo()),ut.refreshAllViews()}function Yo(e){t.settings.brightness=Math.round(P.clamp(e,-100,100)),gi()}function Xo(e){Yo(t.settings.brightness+e)}function qo(e){t.settings.shadows=Math.round(P.clamp(e,-100,100)),gi()}function Jo(e){qo(t.settings.shadows+e)}function Qo(e){t.settings.highlights=Math.round(P.clamp(e,-100,100)),gi()}function jo(e){Qo(t.settings.highlights+e)}function Zo(e){t.settings.temperature=Math.round(P.clamp(e,-100,100)),gi()}function Ko(e){Zo(t.settings.temperature+e)}function ti(e){t.settings.saturation=Math.round(P.clamp(e,-100,100)),gi()}function ei(e){ti(t.settings.saturation+e)}function oi(e,o){return t.settings.outputColorSpace!=e&&(o&&O.push(),t.settings.outputColorSpace=e,si(),bo(),o&&Ri(),!0)}function ii(){var e="sRGB";switch(t.settings.outputColorSpace){case _.ColorSpaceSrgb:e="sRGB";break;case _.ColorSpaceAdobeRgb:e="Adobe RGB (1998)";break;case _.ColorSpaceAppleRgb:e="Apple RGB";break;case _.ColorSpaceColorMatchRgb:e="ColorMatch RGB"}return e}function si(){D.CmApp.ColorsApp.ColorSpace.display.$().text(ii())}function ri(e,o){t.settings.whiteBalanceEnabled!=e&&(o&&O.push(),t.settings.whiteBalanceEnabled=e,mi(),o&&Ri())}function ni(e,o,i=!1){t.settings.whiteBalanceGrayColor!=e&&(o&&O.push(),t.settings.whiteBalanceGrayColor=e,i&&!t.settings.whiteBalanceEnabled&&(t.settings.whiteBalanceEnabled=!0),mi(),o&&Ri()),mi()}function ai(e,o){if(t.settings.removeColorCast!=e){if(o&&O.push(),t.settings.removeColorCast=e,e&&t.settings.castColor==_.FactoryDefaults.castColor&&t.userMask){for(var i=B.Background.colorBytesRgba,s=new ie,r=t.userMask.context().getImageData(0,0,d,g).data,n=0,a=0;a<St.length;a+=4)r[a+0]==i[0]&&r[a+1]==i[1]&&r[a+2]==i[2]&&r[a+3]==i[3]&&(s.add(St[a+0],St[a+1],St[a+2]),n++);n>0&&li(s.findMaxBinCenter(),!1)}mi(),o&&Ri()}}function li(e,o,i=!1){t.settings.castColor!=e&&(o&&O.push(),t.settings.castColor=e,i&&!t.settings.removeColorCast&&(t.settings.removeColorCast=!0),mi(),o&&Ri()),mi()}function ci(e){t.settings.colorCastForegroundProtection=P.roundTo(P.clamp(e,0,20),1),gi()}function pi(e){ci(t.settings.colorCastForegroundProtection+e)}function ui(e=!0){0==t.settings.brightness&&0==t.settings.shadows&&0==t.settings.highlights&&0==t.settings.temperature&&0==t.settings.saturation&&t.settings.castColor==t.defaultSettings.castColor&&t.settings.colorCastForegroundProtection==t.defaultSettings.colorCastForegroundProtection&&t.settings.removeColorCast==t.defaultSettings.removeColorCast&&t.settings.whiteBalanceEnabled==t.defaultSettings.whiteBalanceEnabled&&t.settings.whiteBalanceGrayColor==t.defaultSettings.whiteBalanceGrayColor||(e&&O.push(),t.settings.brightness=0,t.settings.shadows=0,t.settings.highlights=0,t.settings.temperature=0,t.settings.saturation=0,t.settings.castColor=t.defaultSettings.castColor,t.settings.colorCastForegroundProtection=t.defaultSettings.colorCastForegroundProtection,t.settings.removeColorCast=t.defaultSettings.removeColorCast,t.settings.whiteBalanceEnabled=t.defaultSettings.whiteBalanceEnabled,t.settings.whiteBalanceGrayColor=t.defaultSettings.whiteBalanceGrayColor,mi(),Ri())}function hi(){null==vt&&(vt=z.run(St,ft.width,ft.height)),t.settings.highlights==vt.highlights&&t.settings.shadows==vt.shadows||(O.push(),t.settings.shadows=vt.shadows,t.settings.highlights=vt.highlights,mi(),Ri())}function di(){return gt?ct:at}function gi(){function e(t,e,o,i,s){Ot(t,e,o,i,s),t.display.$().html(P.signedNumber(e))}!function(){var e=-t.settings.temperature/100,o=(e<0?6600+5100*e:6600+8400*e)/100;w=0!=t.settings.temperature,C=255,y=255,b=255,o<66?(y=P.clamp(99.4708025861*Math.log(o)-161.1195681661,0,255),b=o<=19?0:P.clamp(138.5177312231*Math.log(o-10)-305.0447927307,0,255)):o>66&&(C=P.clamp(329.698727446*Math.pow(o-60,-.1332047592),0,255),y=P.clamp(288.1221695283*Math.pow(o-60,-.0755148492),0,255));v=.5*t.settings.temperature}(),e(D.CmApp.ColorsApp.ColorLevels.brightness,t.settings.brightness,-100,100,0),e(D.CmApp.ColorsApp.ColorLevels.shadows,t.settings.shadows,-100,100,0),e(D.CmApp.ColorsApp.ColorLevels.highlights,t.settings.highlights,-100,100,0),e(D.CmApp.ColorsApp.ColorLevels.temperature,t.settings.temperature,-100,100,0),e(D.CmApp.ColorsApp.ColorLevels.saturation,t.settings.saturation,-100,100,0),e(D.CmApp.ColorsApp.ColorCast.ForegroundProtection,t.settings.colorCastForegroundProtection,0,20,t.defaultSettings.colorCastForegroundProtection),D.CmApp.ColorsApp.ColorLevels.temperature.swatch.$().css("background-color",Jt.fromInts(255,C,y,b).toRgbaCss()),D.CmApp.ColorsApp.ColorCast.RemovalEnabled.$().prop("checked",t.settings.removeColorCast),D.CmApp.ColorsApp.ColorCast.Swatch.$().css("background-color",Jt.fromInt(t.settings.castColor).toRgbCss()),D.CmApp.ColorsApp.ColorCast.controls.$().toggle(t.settings.removeColorCast),D.CmApp.ColorsApp.WhiteBalance.Enabled.$().prop("checked",t.settings.whiteBalanceEnabled),D.CmApp.ColorsApp.WhiteBalance.Swatch.$().css("background-color",Jt.fromInt(t.settings.whiteBalanceGrayColor).toRgbCss()),D.CmApp.ColorsApp.WhiteBalance.controls.$().toggle(t.settings.whiteBalanceEnabled);var o=0==t.settings.brightness,i=0==t.settings.shadows,s=0==t.settings.highlights,r=0==t.settings.temperature,n=0==t.settings.saturation,a=!t.settings.removeColorCast,l=!t.settings.whiteBalanceEnabled;gt=!(o&&i&&s&&r&&n&&a&&l),D.CmApp.ColorsApp.ColorLevels.reset.$().toggleClass("disabled",o&&i&&s&&r&&n)}function mi(){E||(gi(),gt&&pt==t.previewCanvasData&&(ct=t.previewCanvas.context().getImageData(0,0,d,g),pt=ct.data),mt=function(){for(var e=t.settings.brightness,o=1+t.settings.shadows/100,i=1+t.settings.highlights/100,s=-t.settings.saturation/100,r=t.settings.removeColorCast,n=t.settings.colorCastForegroundProtection,a=0;a<256;a++)fi[a]=P.clamp(255-(255-(a+e)*i)*o,0,255);var l=null,c=t.settings.whiteBalanceEnabled;c&&(l=Qt.buildWhiteBalancerFromGrayColorSampleBradford(Jt.fromInt(t.settings.whiteBalanceGrayColor)));var p=Jt.fromInt(t.settings.castColor),u=p.dup().desaturateEvenly().minusEquals(p).normalized(),h=new Jt,d=new Jt,g=new Jt,m=new Jt;return function(t,e,o,i,a){if(c&&(h.fromInts(e,o,i,a),l.matrixVectorMultiply(h,d),d.clamp(),o=d.rInt(),i=d.gInt(),a=d.bInt()),r){h.fromInts(e,o,i,a),g.setArgb(h).desaturateEvenly();var p=m.setArgb(g).minusEquals(h).normalize(),f=m.dot(u);if(f>0){var S=P.clamp(f,0,1)*P.clamp(1-n*p*p,0,1);g.mixWith(h,S),o=g.rInt(),i=g.gInt(),a=g.bInt()}}if(0!=s){var C=.299*o+.587*i+.114*a;o=Si(s*C+(1-s)*o),i=Si(s*C+(1-s)*i),a=Si(s*C+(1-s)*a)}if(o=fi[o],i=fi[i],a=fi[a],w){let t=wi(o,i,a),e=wi(o=P.clamp(o+v,0,255),i,a=P.clamp(a-v,0,255)),s=e>0?t/e:1;o=P.clamp(o*s,0,255),i=P.clamp(i*s,0,255),a=P.clamp(a*s,0,255)}pt[t]=o,pt[t+1]=i,pt[t+2]=a,pt[t+3]=e}}(),ki(),vi(),ht.updateMirrorShadowCanvas(),ut.refreshAllViews())}t.initializeViewPanesMode=Be,t.checkUpdateTempPreviewPaneToggle=Le,t.tempPreviewViewPaneToggle=ze,t.tempViewOriginalToggle=function(t){$e(t?2:Oe()?1:0),D.CmApp.Sidebar.viewOriginal.toggleClass(D.CmApp.Sidebar.selected,t)},t.tempViewMarksToggle=function(t){$e(t?0:Oe()?1:0),D.CmApp.Sidebar.marks.toggleClass(D.CmApp.Sidebar.selected,t)},t.setViewPanesMode=Ue,t.updateViewPanesModeDisplay=Ge,t.stepBackgroundColor=function(e){let o=Jt.fromCss(t.settings.backgroundColor),i=window.Globals.BackgroundColorInts.indexOf(o.toInt());if(i<0)Ve(window.Globals.BackgroundColors[e?1:2],!0);else if(1==i&&!e||2==i&&e)Ve(He(),!0);else{let t=window.Globals.BackgroundColors.length;i=e?(i+t-1)%t:(i+1)%t,Ve(window.Globals.BackgroundColors[i],!0)}},t.jumpToLastBackgroundColor=function(){Ve(bt||window.Globals.BackgroundColors[7],!0)},t.setBackgroundColor=Ve,t.resetGlobalSmoothingLevel=function(){Ye(t.defaultSettings.globalSmoothingLevel,!0)},t.stepGlobalSmoothingLevel=function(e){Ye(t.settings.globalSmoothingLevel+e,!0)},t.setGlobalSmoothingLevel=Ye,t.resetGlobalBlurLevel=function(){Xe(t.defaultSettings.globalBlurLevel,!0)},t.stepGlobalBlurLevel=function(e){Xe(t.settings.globalBlurLevel+e,!0)},t.setGlobalBlurLevel=Xe,t.resetGlobalOffset=function(){qe(t.defaultSettings.globalOffset,!0)},t.stepGlobalOffset=function(e){qe(t.settings.globalOffset+e,!0)},t.setGlobalOffset=qe,t.setUseCornerDetection=Je,t.setBlurMode=Qe,t.setUseLocalSmoothing=je,t.getCrop_o=Ke,t.getViewCrop_o=function(){let e=A.dup();return t.settings.cropRect_o.isEmpty()||e.unionWith(t.settings.cropRect_o),e},t.setCrop_o=to,t.setCropMode=eo,t.setCropMarginUnits=oo,t.setCropObjectSize=io,t.setCropVerticalAlignment=so,t.setCropShadows=ro,t.setCropPadding=no,t.updateCropPaddingResetEnabled=ao,t.cropPaddingDecrease=function(){lo(-1)},t.cropPaddingIncrease=function(){lo(1)},t.cropPaddingReset=function(){no(t.defaultSettings.cropPaddingMils,!1)},t.setCropPaddingPixels=co,t.cropPaddingPixelsDecrease=function(){po(-1)},t.cropPaddingPixelsIncrease=function(){po(1)},t.cropPaddingPixelsReset=function(){co(t.defaultSettings.cropPaddingPixels,!1)},t.setOutputDpi=uo,t.outputDpiDecrease=function(){ho(-1)},t.outputDpiIncrease=function(){ho(1)},t.outputDpiReset=function(){uo(t.defaultSettings.outputDpi,!1)},t.setJpegQuality=mo,t.jpegQualityDecrease=function(){fo(-1)},t.jpegQualityIncrease=function(){fo(1)},t.jpegQualityReset=function(){mo(t.defaultSettings.jpegQuality,!1)},t.OpaqueFileFormatGroup=new Zt([new jt(D.ExportOptions.OpaqueFormat.jpg,_.OpaqueFileFormatJpeg),new jt(D.ExportOptions.OpaqueFormat.png,_.OpaqueFileFormatPng)]),t.setOpaqueFileFormat=So,t.PngModeGroup=new Zt([new jt(D.ExportOptions.PngOptimization.none,_.PngModeNone),new jt(D.ExportOptions.PngOptimization.lossless,_.PngModeLossless),new jt(D.ExportOptions.PngOptimization.lossy,_.PngModeLossy)]),t.JpegModeGroup=new Zt([new jt(D.ExportOptions.JpegOptimization.none,_.JpegModeNone),new jt(D.ExportOptions.JpegOptimization.moz,_.JpegModeMoz)]),t.setPngMode=wo,t.setJpegMode=Co,t.exportFileFormat=yo,t.getRotationCrop_o=ko,t.getBoundingRect_o=Mo,t.getBoundingQuad_i=function(t){return Mo().pad(t).toQuad().rotateInPlace(Ho(),S)},t.updateCrop=xo,t.setCropFitToResult=Do,t.setCropAllowEnlarging=Po,t.getCropAspectRatio=Eo,t.setCropAspectRatio=Fo,t.getCropTargetSize=Io,t.setCropTargetSize=Bo,t.resetCrop=Oo,t.setRotateAngleDeg=Lo,t.incrementRotateAngleDeg=zo,t.rotateClockwise=function(){zo(-90)},t.rotateCounterclockwise=function(){zo(90)},t.rotateReset=function(){Lo(t.defaultSettings.rotateAngleDeg,!0)},t.rotateAngleRad=$o,t.setStraightenAngleDeg=Uo,t.straightenClockwise=function(){Go(-.1)},t.straightenCounterclockwise=function(){Go(.1)},t.straightenReset=function(){0!=t.settings.straightenAngleDeg&&(O.push(),Uo(0),Ri(),ht.updateMirrorShadowCanvas(),ht.updatePerspectiveShadowCanvas())},t.straightenAngleRad=No,t.straightenCommit=function(){ht.updateMirrorShadowCanvas(),ht.updatePerspectiveShadowCanvas(),t.sendSetGlobal()},t.totalRotationAngleRad_o2i=Ho,t.totalRotationAngleRad_i2o=Vo,t.setBrightness=Yo,t.brightnessReset=function(){0!=t.settings.brightness&&(O.push(),Yo(0),mi(),Ri())},t.brightnessDecrement=function(){Xo(-1)},t.brightnessIncrement=function(){Xo(1)},t.setShadows=qo,t.shadowsReset=function(){0!=t.settings.shadows&&(O.push(),qo(0),mi(),Ri())},t.shadowsDecrement=function(){Jo(-1)},t.shadowsIncrement=function(){Jo(1)},t.setHighlights=Qo,t.highlightsReset=function(){0!=t.settings.highlights&&(O.push(),Qo(0),mi(),Ri())},t.highlightsDecrement=function(){jo(-1)},t.highlightsIncrement=function(){jo(1)},t.setTemperature=Zo,t.temperatureReset=function(){0!=t.settings.temperature&&(O.push(),Zo(0),mi(),Ri())},t.temperatureDecrement=function(){Ko(-1)},t.temperatureIncrement=function(){Ko(1)},t.setSaturation=ti,t.saturationReset=function(){0!=t.settings.saturation&&(O.push(),ti(0),mi(),Ri())},t.saturationDecrement=function(){ei(-1)},t.saturationIncrement=function(){ei(1)},t.setOutputColorSpace=oi,t.setWhiteBalanceEnabled=ri,t.toggleWhiteBalanceEnabled=function(){ri(!t.settings.whiteBalanceEnabled,!0)},t.setWhiteBalanceGrayColor=ni,t.whiteBalanceGrayColorReset=function(){t.settings.whiteBalanceGrayColor!=t.defaultSettings.whiteBalanceGrayColor&&ni(t.defaultSettings.whiteBalanceGrayColor,!0)},t.setRemoveColorCast=ai,t.toggleColorCast=function(){ai(!t.settings.removeColorCast,!0)},t.setCastColor=li,t.castColorReset=function(){t.settings.castColor!=t.defaultSettings.castColor&&li(t.defaultSettings.castColor,!0)},t.setColorCastForegroundProtection=ci,t.colorCastForegroundProtectionReset=function(){t.settings.colorCastForegroundProtection!=t.defaultSettings.colorCastForegroundProtection&&(O.push(),ci(t.defaultSettings.colorCastForegroundProtection),mi(),Ri())},t.colorCastForegroundProtectionDecrement=function(){pi(-.1)},t.colorCastForegroundProtectionIncrement=function(){pi(.1)},t.colorLevelsResetLevels=function(){0==t.settings.brightness&&0==t.settings.shadows&&0==t.settings.highlights&&0==t.settings.temperature&&0==t.settings.saturation||(O.push(),t.settings.brightness=0,t.settings.shadows=0,t.settings.highlights=0,t.settings.temperature=0,t.settings.saturation=0,mi(),Ri())},t.colorLevelsResetAll=ui,t.colorLevelsAuto=hi,t.previewCanvasImageDataSmart=di,t.updateColorLevels=mi;var fi=new Float32Array(256);function Si(t){return Math.floor(Math.max(0,Math.min(t,255)))}function wi(t,e,o){return(Math.max(t,e,o)+Math.min(t,e,o))*(.5/255)}function Ci(e){switch(void 0!==e.rp&&(t.resultParity=e.rp),e.response){case _.ServerMaskReset:!function(){if(void 0===t.previewCanvasData.set)for(var e=0,o=St.length;e<o;e++)t.previewCanvasData[e]=St[e];else t.previewCanvasData.set(St,0)}(),ki();break;case _.ServerMask:"ControlByte"==(r=e).mode?Y.decode(r.arraybuffer,(function(e){!function(e,o){t.previewCanvasData[e+3]=o,gt&&(pt[e+3]=o)}(e,0)}),(function(t){Ai(t,255,St[t],St[t+1],St[t+2])}),Ai):P.fatalErrorStr("Received unknown server response type: '"+r.mode+"'. ");break;case _.ServerMaskDone:ht.updateDropShadowCanvas(),ht.updateMirrorShadowCanvas(),ht.updatePerspectiveShadowCanvas(),vi();break;case _.BezierSet:!function(e){var o=new _t(e.arraybuffer),i=(o.length()-10)/2+2,s=new Float32Array(i),r=o.readInt16(),n=o.readInt32()/r,a=o.readInt32()/r,l=0;0==h.length&&(t.bezierSetLength=0);for(s[l++]=n,s[l++]=a;l<i;l+=2)n=s[l]=o.readSignedInt16()/r+n,a=s[l+1]=o.readSignedInt16()/r+a;t.bezierSetLength+=i,h.push(s)}(e);break;case _.BezierSetDone:t.bezierSet=h,h=[],Ni.reset();break;case _.BoundingRect:var o=t.boundingRect;if(t.boundingRect=e.boundingRect,t.shadowsRect=e.shadowsRect,xo(),o&&4==o.length&&t.boundingRect&&4==t.boundingRect.length){for(var i=0,s=0;s<t.boundingRect.length;s++)i=Math.max(i,Math.abs(t.boundingRect[s]-o[s]));i>.1&&(ht.updatePerspectiveShadowCanvas(),ht.initializeMirrorShadow(),ht.initializePerspectiveShadow())}else ht.updatePerspectiveShadowCanvas(),ht.initializeMirrorShadow(),ht.initializePerspectiveShadow();break;case _.UpdateComplete:ut.main.refreshAllViews();break;case _.EngineInitializing:H.initProgress(e.percent);break;case _.EngineInitialized:H.hide();break;case _.SetEngineMask:switch(e.imageCategory){case 0:break;case 1:c||(t.userMask.decode(e.engineMask,_.MaskVersion),ut.main.refreshAllViews(),Pi(!0),c=!0);break;case 2:break;case 3:l||(t.userMask.decode(e.engineMask,_.MaskVersion),ut.main.refreshAllViews(),Pi(!0),l=!0)}break;case _.SetActiveSwords:et.setActiveSwords(e.activeSwords,e.index);break;case _.SetSwordIntersections:et.setSwordIntersections(e.swordIntersections);break;case _.SetDetectedCorners:t.detectedCorners=e.detectedCorners;break;case _.ResultPending:x.App.resultPending(e.msg,e.percent);break;case _.ResultReady:st=!1,t.result.ready=!0,t.result.shown=!1,t.result.posted=!1,t.result.success=e.success,t.result.msg=e.msg,t.result.filename=e.resultFilename,Li();break;case _.Meta:At=e.meta,xt();break;case _.ServerImageCategoriesKey:t.serverImageCategories=e.serverImageCategories;break;case _.ImageCategory:(0==t.imageCategory.user||t.imageCategory.user!=t.imageCategory.server&&t.imageCategory.user==e.imageCategory.user)&&(t.imageCategory.user=t.imageCategory.server=e.imageCategory.user),Yt(),xt();break;case _.ServerRgbHistogramResponse:t.hasServerRgbHistogramResponse=!0,e.dataUrl&&re(e.dataUrl);break;case _.Panic:P.gaTrack("ErrorShown","Panic",e.message),alert(p.s("Terribly sorry, but an unrecoverable server error has occurred:")+"\n\n"+e.message+"\n\n"+p.s("Please try again, or try another image.")),Ft();break;case _.Message:alert(e.message);break;case _.Highlighting:W.checkShowHighlighting();break;case _.UpdateImageSpec:if(e.userImageSpec){let t=e.userImageSpec;it.drawCommands=t.drawCommands}break;case _.ColorCastEstimate:li(e.castColor,!0);break;case _.WhiteBalanceEstimate:ni(e.whiteBalanceGrayColor,!0);break;case _.Noop:e.dwm&&q.doApply();break;default:P.fatalErrorStr("Received unknown server response: '"+e.response+"'. ")}var r;e.hasOwnProperty("index")&&(ot=e.index),zt()}function yi(){T=!1,Di(!0),Ri(),Ii(),Bi(),Pi(!1),xi(),Mi(),Ti(),st&&Fi(),zt(),T=!0}function bi(){return zt(),tt!=ot||st||H.visible||!(At.hasImage>=t.hasImage&&At.hasDrawCommands>=t.hasDrawCommands)||t.imageCategory.user!=t.imageCategory.server}function vi(){t.previewCanvas.context().putImageData(di(),0,0),it.isPaid||q.checkApply(t.previewCanvas,t.boundingRect)}function Ai(e,o,i,s,r){t.previewCanvasData[e]=i,t.previewCanvasData[e+1]=s,t.previewCanvasData[e+2]=r,t.previewCanvasData[e+3]=o,gt&&mt(e,o,i,s,r)}function ki(){if(gt){for(var e=0,o=t.previewCanvasData.length;e<o;e+=4){var i=t.previewCanvasData[e+3];0==i?pt[e+3]=0:mt(e,i,t.previewCanvasData[e],t.previewCanvasData[e+1],t.previewCanvasData[e+2])}ht.updateMirrorShadowCanvas()}}function Mi(){zi({command:_.Meta,hasImage:t.hasImage,hasDrawCommands:t.hasDrawCommands,w:d,h:g})}function xi(){zi({command:_.ImageCategory,user:t.imageCategory.user})}function Ti(){if(!t.hasServerRgbHistogramResponse){for(var e=new ie,o=0;o<St.length;o+=4)e.add(St[o+0],St[o+1],St[o+2]);zi({command:_.SetClientRgbHistogram,data:e.encode()})}}t.sendImageHistogram=Ti;var _i=null;function Di(t=!1){var e=B.getActiveMode();(t||e.serverCares&&e!=_i)&&(_i=e,zi({command:_.SetTool,toolMode:e.key})),Fe==_.ViewPanesSingle&&Le()}function Pi(e){zi({command:_.SetUserMask,data:t.userMask.encode(),version:_.MaskVersion,isDirtying:e})}function Ri(){zi($.extend({command:_.SetGlobal,serverCropRect_o:Ke(),hasSavedMask:X.hasSavedMaskS3()},t.settings,{cropTargetSize:Io(),cropAspectRatio:Eo()}))}function Ei(t,e,o,i,s,r){zi({command:t,x0:e,y0:o,x1:i,y1:s,d:r})}function Fi(){Gi({command:_.GenerateResult});const e=Vt()+"\nImCat:"+t.imageCategory.user;let o=!1;return e==kt&&t.result.ready&&t.result.success?Ci({response:_.ResultReady,success:!0,msg:null,resultFilename:t.result.filename}):(kt=e,t.result.ready=!1,o=!0,Ri(),zi({command:_.GenerateResult})),Nt(),o}function Ii(){return zi({command:_.SetSwords,swords:et.cutSet.encodedPolyBezierSet()}),tt}function Bi(){return zi({command:_.SetClientShadows,shadows:ht.encode()}),tt}function Oi(){return!it.isPaid&&!window.GlobalsEx.hasCreditsLeft}function Li(){var e=Bt();if(t.result.ready){t.result.posted||e||(t.result.posted=!0,Gi({command:_.SavedAndResultReady,success:t.result.success,msg:t.result.msg}));const o=Oi(),i=!e;t.result.shown||!i&&o||(t.result.shown=!0,t.result.success?window.Globals.Bulk.isApi||(o?top.location.href=$i():window.Globals.Bulk.isIframe||x.App.resultReady(t.result.success,t.result.msg)):x.App.resultReady(t.result.success,t.result.msg))}}function zi(t){var e=!!_.DirtiesDrawCommandsSet.contains(t.command);e&&tt++,e&&T&&(t.command!=_.SetUserMask||t.isDirtying)&&(M=!0),t.index=tt,I.send(t),t.command==_.GenerateResult&&(st=!0),e&&($t(),zt())}function $i(){return L.downloadUrl(it.id,it.secret)+(t.result.filename?"/"+t.result.filename:"")}function Ui(){let t="unknown",e=yo().toLowerCase();return it.originalFilename&&(t=P.dropExtension(it.originalFilename)),t+"_clipped."+e}function Gi(t){t.image={id:it.id,secret:it.secret},t.saved=!Bt(),window.checkPostMessage(t)}let Ni;t.sendSetTool=Di,t.sendSetUserMask=Pi,t.sendSetGlobal=Ri,t.sendGenerateResult=Fi,t.skip=function(){Gi({command:_.Skip}),Nt()},t.sendSaveServerMask=function(){zi({command:_.SaveServerMask})},t.sendSetSword=Ii,t.sendSetShadows=Bi,t.isOutOfCredits=Oi,t.downloadUrl=$i,t.updateResultParitySalt=function(){t.resultParitySalt=Date.now().toString()},t.downloadParityUrl=function(e,o){return o||(o=Ui()),L.downloadParityUrl(it.id,it.secret,e,t.resultParitySalt,o)},t.downloadAlphaGrayscaleUrl=function(){return L.downloadAlphaGrayscaleUrl(it.id,it.secret)},t.downloadSvgPathUrl=function(){return L.downloadSvgPathUrl(it.id,it.secret)},t.downloadTiffPathUrl=function(){return L.downloadTiffPathUrl(it.id,it.secret)},t.shareUrl=function(){return L.shareUrl(it.id,it.secret)},t.surveyUrl=function(){return L.surveyUrl(it.id,it.secret)},t.getFilename=function(){return it.originalFilename||"Unknown Filename"},t.getResultFilename=Ui,t.savedMaskUpdated=function(){window.Globals.Bulk.isApi||(window.GlobalsEx.hasSavedMask=!0,X.checkFetch())},function(e){var o=-1,i=-1;e.currentCenter_i=Pt.nan();var s=new Gt(Pt.empty(),Pt.empty(),Pt.empty());function r(){var r=ut.main.getViewCenter_i();if(null!=r){var n=1e9;function a(t,s,a){!function(t,s,a){var l=r.distanceSqrTo(t);l<n&&(n=l,o=s,i=a,e.currentCenter_i.set(t))}(t.p0,s,a)}o=-1,i=-1;for(var l=0;l<t.bezierSet.length;l++){var c=t.bezierSet[l];if(c.length>=6){s.p2.setXy(c[0],c[1]);for(var p=0;p<c.length-5;p+=4)s.step(c[p+2],c[p+3],c[p+4],c[p+5]),a(s,l,p)}}-1!=o&&-1!=i&&ut.main.animateTo_i(e.currentCenter_i,4)}Le()}e.start=r,e.reset=function(){o=-1,i=-1,e.currentCenter_i.setNan(),Le()},e.back=function(){if(-1!=o&&-1!=i){var s=t.bezierSet[o];i>4?i-=4:(o=(o+t.bezierSet.length-1)%t.bezierSet.length,s=t.bezierSet[o],i=Math.max(0,s.length-2)),e.currentCenter_i.setXy(s[i],s[i+1]),ut.main.animateTo_i(e.currentCenter_i,4),Le()}else r()},e.forward=function(){if(-1!=o&&-1!=i){var s=t.bezierSet[o];i<s.length-5?i+=4:(o=(o+1)%t.bezierSet.length,s=t.bezierSet[o],i=0),e.currentCenter_i.setXy(s[i],s[i+1]),ut.main.animateTo_i(e.currentCenter_i,4),Le()}else r()}}(Ni=t.Review||(t.Review={}))}(at||(at={}));class ae{constructor(){this.ary=new Uint8Array(1024),this.pos=0}resize(t){for(var e=new Uint8Array(Math.max(t,2*this.ary.length)),o=0;o<this.pos;o++)e[o]=this.ary[o];this.ary=e}reset(){this.pos=0}push(t,e){this.ary.length<this.pos+4&&this.resize(this.pos+4);var o=7&t|(15&(e-=1))<<4;(e>>=4)<256?(this.ary[this.pos++]=o,this.ary[this.pos++]=e):(this.ary[this.pos++]=8|o,this.ary[this.pos++]=255&e,e>>=8,this.ary[this.pos++]=255&e,e>>=8,this.ary[this.pos++]=255&e)}toString(){return l.encode(this.ary,this.pos)}static decode(t,e){try{for(var o,i,s,r,n=l.decode(t),a=0;a<n.length;)i=7&(o=n[a++]),r=8&o,s=o>>4&15,s+=n[a++]<<4,0!=r&&(s+=n[a++]<<12,s+=n[a++]<<20),e(i,s+=1)}catch(t){}}}class le{constructor(){this.ary=[]}reset(){this.ary.length=0}push(t,e){this.ary.push(t+":"+e)}toString(){return this.ary.join(";")}static decode(t,e){P.spliterate(t,";",t=>{var o=t.split(":"),i=0|parseInt(o[0]),s=0|parseInt(o[1]);e(i,s)})}}function ce(){class t{constructor(t,e,o,i,s){this.dataIn=t,this.wIn=e,this.hIn=o,this.wOut=i,this.hOut=s,this.dataOut=new Uint8ClampedArray(i*s*4),this.outToInX=this.wIn/this.wOut,this.outToInY=this.hIn/this.hOut}reset(){this.rSum=0,this.gSum=0,this.bSum=0,this.wSum=0}accumulate(t,e,o){const i=4*(t+this.wIn*e);this.rSum+=this.dataIn[i+0]*o,this.gSum+=this.dataIn[i+1]*o,this.bSum+=this.dataIn[i+2]*o,this.wSum+=o}populate(t,e){this.reset();const o=t*this.outToInX,i=e*this.outToInY,s=Math.min(o+this.outToInX,this.wIn),r=Math.min(i+this.outToInY,this.hIn),n=Math.floor(o),a=Math.floor(i),l=Math.ceil(s)-1,c=Math.ceil(r)-1,p=Math.ceil(o),u=Math.ceil(i),h=l,d=c,g=p-o,m=u-i,f=s-h,S=r-d;this.accumulate(n,a,g*m),this.accumulate(n,c,g*S);for(var w=p;w<h;w++)this.accumulate(w,a,m),this.accumulate(w,c,S);this.accumulate(l,a,f*m),this.accumulate(l,c,f*S);for(var C=u;C<d;C++){this.accumulate(n,C,g);for(w=p;w<h;w++)this.accumulate(w,C,1);this.accumulate(l,C,f)}const y=4*(t+e*this.wOut);this.dataOut[y+0]=this.rSum/this.wSum,this.dataOut[y+1]=this.gSum/this.wSum,this.dataOut[y+2]=this.bSum/this.wSum,this.dataOut[y+3]=255}shrink(){for(var t=0,e=0;t<this.hOut;t++)for(var o=0;o<this.wOut;o++,e++)this.populate(o,t);return this.dataOut}}var e=[];function o(o){e.push(Date.now());const i=(s=o.dataIn,r=o.wIn,n=o.hIn,a=o.wOut,l=o.hOut,new t(s,r,n,a,l).shrink());var s,r,n,a,l;return Date.now(),e.pop(),i}self.addEventListener("message",t=>{try{var e=t.data;const i=o(e);te({canvasId:e.canvasId,success:!0,wOut:e.wOut,hOut:e.hOut,dataOut:i},[i.buffer])}catch(t){te({canvasId:e.canvasId,success:!1,wOut:0,hOut:0,dataOut:null})}})}!function(t){let e;t.isMac=navigator.platform.toUpperCase().indexOf("MAC")>=0,t.zoomDelta=function(t,e=1.2,o=!0){let i=o?t.deltaY:t.deltaY*t.deltaFactor/100;return Math.pow(e,i)},function(t){t[t.CanvasEnter=0]="CanvasEnter",t[t.CanvasLeave=1]="CanvasLeave",t[t.Hover=2]="Hover",t[t.Tap=3]="Tap",t[t.ActionStart=4]="ActionStart",t[t.ActionMove=5]="ActionMove",t[t.ActionEnd=6]="ActionEnd",t[t.PanZoom=7]="PanZoom",t[t.DoubleClick=8]="DoubleClick",t[t.MomentumTranslate=9]="MomentumTranslate"}(e=t.InteractionType||(t.InteractionType={}));class o{constructor(t,e,o,i,s,r,n,a,l){this.type=t,this.interactionIdentifier=e,this.referenceInteraction=o,this.pageX=i,this.pageY=s,this.zoomTo=r,this.canvas=n,this.isTouch=a,this.isFirstPan=l,this.numTouches=0,o||(this.referenceInteraction=this),this.timestamp=Date.now()}dup(t){return new o(t,this.interactionIdentifier,this.referenceInteraction,this.pageX,this.pageY,this.zoomTo,this.canvas,this.isTouch,this.isFirstPan)}getReferenceBefore(t){let e=this.timestamp-t,o=this.referenceInteraction;for(;o.referenceInteraction.timestamp>e&&o!=o.referenceInteraction;)o=o.referenceInteraction;return o}getMostRecentTwoTouch(t){let e=this.timestamp-t,o=this.referenceInteraction;for(;o.numTouches<2&&o.referenceInteraction.timestamp>e&&o!=o.referenceInteraction;)o=o.referenceInteraction;return 2==o.numTouches?o:void 0}isMousePanEnd(){return this.type==e.ActionEnd&&this.referenceInteraction.type==e.ActionMove}shouldStopMouseMomentumPan(){return this.type==e.ActionStart||this.type==e.ActionMove||this.type==e.DoubleClick||this.type==e.Tap||this.type==e.PanZoom}isTouchPanEnd(){return!!!this.getMostRecentTwoTouch(500)&&this.type==e.CanvasLeave&&this.referenceInteraction.type==e.PanZoom}shouldStopTouchMomentumPan(){return this.type==e.ActionStart||this.type==e.ActionMove||this.type==e.DoubleClick||this.type==e.Tap||this.type==e.CanvasEnter}}t.Interaction=o;class i{constructor(t,e,o){this.identifier=t,this.pageX=e,this.pageY=o}static from(t){return new i(t.identifier,t.pageX,t.pageY)}find(t){for(let e=0;e<t.length;e++){const o=t.item(e);if(o.identifier==this.identifier)return o}return null}distanceSqrTo(t){const e=this.pageX-t.pageX,o=this.pageY-t.pageY;return e*e+o*o}distanceTo(t){return Math.max(1,Math.sqrt(this.distanceSqrTo(t)))}isNull(){return this==t.NullTouch}}t.YoTouch=i,t.TouchSpaceRadiusPx=10,t.TouchSpaceRadiusSqrPx=t.TouchSpaceRadiusPx*t.TouchSpaceRadiusPx,t.TouchTimeBoxMs=300,t.DoubleTapRadiusPx=20,t.DoubleTapTimeMs=300,t.NullTouch=new i(null,0,0);let s=!1;try{let t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("test",null,t)}catch(t){}t.AddEventListenerThirdArgForTouch=!!s&&{passive:!1}}(pt||(pt={})),function(t){t.initialized=!1;var e=null;t.lockAspectRatio=!1,t.maxNumMegapixels=4;var o=0,i=0;const s=Pt.empty();var r=1,n=null,a=null,l=0,c=0,p=0,u=0;const h=Et.empty();var d=1,g=1,m=0,f=0;const w=Pt.empty(),C=Pt.empty(),y=Pt.empty(),b=Pt.empty();var v=!1;const A=Pt.empty(),k=Et.empty(),M=Et.empty();class x{constructor(t,e){this.key=t,this.anchor=e,this.oppositeAnchor=S.opposite(this.anchor)}}var T=null;const _=new x("resize-top",S.Top),R=new x("resize-top-right",S.TopRight),E=new x("resize-right",S.Right),F=new x("resize-bottom-right",S.BottomRight),I=new x("resize-bottom",S.Bottom),B=new x("resize-bottom-left",S.BottomLeft),O=new x("resize-left",S.Left),L=new x("resize-top-left",S.TopLeft),z=new x("resize-move",S.Center);function U(t,o,i,s,r){i.$().text(t.toFixed(0)+" x "+o.toFixed(0)+" px"),s.$().text(P.formatAspectRatio(P.fuzzyAspectRatioEx({w:t,h:o},e.aspectRatios))),r.$().text((t*o/1048576).toFixed(1))}function G(){D.PreCrop.Sidebar.MaxNumMegapixels.display.$().text(t.maxNumMegapixels+" megapixels"),U(Math.round(M.width()),Math.round(M.height()),D.PreCrop.Sidebar.cropped_image_size_display,D.PreCrop.Sidebar.cropped_image_aspect_ratio_display,D.PreCrop.Sidebar.cropped_image_megapixels_display),D.PreCrop.Sidebar.lock_aspect_ratio_button.$().prop("checked",t.lockAspectRatio);const e=M.width()*M.height()/1048576>t.maxNumMegapixels;D.PreCrop.Sidebar.cropped_image_warning.$().toggle(e),D.PreCrop.Sidebar.cropped_image_success.$().toggle(!e),D.PreCrop.Sidebar.cropped_image_megapixels_display.$().attr("style",e?"color:red;":"")}function N(){t.lockAspectRatio=!t.lockAspectRatio,et(),G()}function H(){t.maxNumMegapixels=Math.min(t.maxNumMegapixels+1,e.maxMaxNumMegapixels),G()}function V(){t.maxNumMegapixels=Math.max(1,t.maxNumMegapixels-1),G()}function W(){$(window).off("beforeunload"),location.reload(!0)}function Y(){const t=M.width(),o=M.height();t>0&&o>0&&null!=e.completed&&(e.completed(M),D.PreCrop.App.$().hide())}function X(t,e){if(null!=t&&null!=e){w.set(y),C.set(b);var o=$(a.element).offset();return y.setXy(t-o.left,e-o.top),i=y,b.setXy((i.x-h.left)*g,(i.y-h.top)*g),w.notEquals(y)||C.notEquals(b)}var i;return!1}function q(){const t=20*g,e=Math.abs(b.x-M.left)<t,o=Math.abs(b.y-M.top)<t,i=Math.abs(b.x-M.right)<t,s=Math.abs(b.y-M.bottom)<t,r=M.center(),n=Math.abs(b.x-r.x)<t&&Math.abs(b.y-r.y)<t;var a=null;b.x>M.left-t&&b.x<M.right+t&&b.y>M.top-t&&b.y<M.bottom+t&&(e?a=o?L:s?B:O:i?a=o?R:s?F:E:o?a=_:s?a=I:n&&(a=z)),J(a)}function J(t){T=t,null==t?$(a.element).attr("class","canvas-view"):$(a.element).attr("class",T.key+"-tool canvas-view"),gt()}function Q(t){const e=t.touches.item(0);tt(e.pageX,e.pageY),it(e.pageX,e.pageY),t.preventDefault()}function j(t){const e=t.touches.item(0);tt(e.pageX,e.pageY),t.preventDefault()}function Z(t){rt(-1e5,-1e5),t.preventDefault()}function K(t){tt(t.pageX,t.pageY)}function tt(t,e){const s=X(t,e);if(v){if(null!=T&&s){M.setFrom(k),M.moveAnchor(T.anchor,b.minus(A)),M.normalize(),M.left=Math.max(M.left,0),M.top=Math.max(M.top,0),M.right=Math.min(M.right,o),M.bottom=Math.min(M.bottom,i),M.round();Math.round(Math.max(0,100-M.width())),Math.round(Math.max(0,100-M.height()));M.moveAnchorToMinSize(T.anchor,100,100),M.round(),et(),G(),gt()}}else q()}function et(){if(t.lockAspectRatio){var e=S.Center;if(null!=T&&(e=T.oppositeAnchor),M.forceAspectRatio(r,e),M.width()>o||M.height()>i)M.set(0,0,o,i);else{const t=Math.max(0,-M.left)+Math.min(0,o-M.right),e=Math.max(0,-M.top)+Math.min(0,i-M.bottom);M.translate(t,e)}M.round(),gt()}}function ot(t){it(t.pageX,t.pageY),$(window).on("mouseup",st),$(window).on("mousemove",K)}function it(t,e){v=!0,A.set(b),k.setFrom(M),X(t,e)}function st(t){rt(t.pageX,t.pageY),$(window).off("mouseup",st),$(window).off("mousemove",K)}function rt(t,e){v=!1,$(window).off("mouseup",st),$(window).off("mousemove",K),X(t,e),q()}function nt(t){v||J(null)}function at(t){v||(X(t.pageX,t.pageY),q())}function lt(){null!=n&&null!=a&&(l=n.outerWidth(),c=n.outerHeight(),a.width()==l&&a.height()==c||a.setSize(l,c),(u=c-20)/(p=l-20)>i/o?(h.left=10,f=i/o*(m=p),h.top=10+.5*(u-f)):(h.top=10,m=o/i*(f=u),h.left=10+.5*(p-m)),h.right=h.left+m,h.bottom=h.top+f,g=1/(d=m/o)),G(),gt()}function ct(t){return new Pt(h.left+t.x*d,h.top+t.y*d)}function ut(t,e,o,i,s){const r=T==s,n=ct(e);t.setFillStyle("#ffffff"),t.fillRect(n.x+o,n.y+i,20*o,6*i),t.fillRect(n.x+o,n.y+i,6*o,20*i),t.setFillStyle(r?"#ff0000":"#000000"),t.fillRect(n.x+2*o,n.y+2*i,18*o,4*i),t.fillRect(n.x+2*o,n.y+2*i,4*o,18*i)}function ht(t,e,o,i){const s=T==i,r=ct(e);t.setFillStyle("#ffffff"),t.fillRect(r.x+o,r.y-10,6*o,20),t.setFillStyle(s?"#ff0000":"#000000"),t.fillRect(r.x+2*o,r.y-9,4*o,18)}function dt(t,e,o,i){const s=T==i,r=ct(e);t.setFillStyle("#ffffff"),t.fillRect(r.x-10,r.y+o,20,6*o),t.setFillStyle(s?"#ff0000":"#000000"),t.fillRect(r.x-9,r.y+2*o,18,4*o)}function gt(){if(null!=e.inputCanvas&&null!=a&&0!=l&&0!=c){const i=a.context();i.clearRect(0,0,l,c),i.drawCanvasEx2(e.inputCanvas,h.left,h.top,m,f),i.setStrokeStyle("#000000"),i.setGlobalAlpha(.4),i.setLineWidth(1);const s=Math.round((o=M.left,h.left+o*d))+.5,r=Math.round((t=M.top,h.top+t*d))+.5,n=Math.round(M.width()*d)-1,p=Math.round(M.height()*d)-1;i.strokeRect(s,r,n,p),i.setGlobalAlpha(1),ut(i,M.topLeft(),1,1,L),ut(i,M.topRight(),-1,1,R),ut(i,M.bottomRight(),-1,-1,F),ut(i,M.bottomLeft(),1,-1,B),ht(i,M.leftCenter(),1,O),ht(i,M.rightCenter(),-1,E),dt(i,M.topCenter(),1,_),dt(i,M.bottomCenter(),-1,I),function(t,e,o){var i=T==o?"#ff0000":"#000000";const s=ct(e);t.beginPath(),t.triangle(s.x,s.y-17.5,-Math.PI/2,2,5),t.triangle(s.x,s.y+17.5,Math.PI/2,2,5),t.triangle(s.x-17.5,s.y,Math.PI,2,5),t.triangle(s.x+17.5,s.y,0,2,5),t.strokeEx(2,"#FFF"),t.fillEx(i),t.fillCircle(s.x,s.y,12,"#FFFFFF"),t.fillCircle(s.x,s.y,11,i)}(i,M.center(),z)}var t,o}t.show=function(l){o=(e=l).inputCanvas.width(),i=e.inputCanvas.height(),s.setXy(.5*o,.5*i),M.set(0,0,o,i),r=i/o,t.lockAspectRatio=!!e.lockAspectRatio,t.maxNumMegapixels=e.maxNumMegapixels,t.initialized||(t.initialized=!0,n=D.PreCrop.ViewContainer.$(),a=new It(n.outerWidth(),n.outerHeight()),n.append(a.element),$(a.element).mousedown(ot).mouseup(st).mousemove(K).hover(at,nt),a.element.addEventListener("touchstart",Q,pt.AddEventListenerThirdArgForTouch),a.element.addEventListener("touchmove",j,pt.AddEventListenerThirdArgForTouch),a.element.addEventListener("touchend",Z,pt.AddEventListenerThirdArgForTouch),D.PreCrop.Sidebar.crop_button.$().click(Y),D.PreCrop.Sidebar.cancel_button.$().click(W),D.PreCrop.Sidebar.lock_aspect_ratio_button.$().click(N),e.maxMaxNumMegapixels?(D.PreCrop.Sidebar.MaxNumMegapixels.decrease.$().click(V),D.PreCrop.Sidebar.MaxNumMegapixels.increase.$().click(H)):(D.PreCrop.Sidebar.MaxNumMegapixels.decrease.$().hide(),D.PreCrop.Sidebar.MaxNumMegapixels.increase.$().hide()),$(window).resize(lt)),U(o,i,D.PreCrop.Sidebar.input_image_size_display,D.PreCrop.Sidebar.input_image_aspect_ratio_display,D.PreCrop.Sidebar.input_image_megapixels_display),G(),D.PreCrop.App.$().show(),setTimeout(lt,0)}}(lt||(lt={})),function(t){const e=new ee("Downsampler",null,ce);t.loadImageShrinkAndThumbnail=function(o,i,s,r,n){t.loadCheckRotateFlattenImage(i,s,s=>{let a=at.getMaxNumPixels();function l(o){E.process({inputCanvas:s,crop:o,maxNumPixels:a,thumbnailSize:{w:_.ThumbWidth,h:_.ThumbHeight},worker:n?e:void 0,completed:(e,o,s)=>{if(o||t.needsReencoding(i.type)){let o=t.recodeCanvasFile(i,e);r(o,e,s)}else r(i,e,s)}})}if(s.width()*s.height()>a&&at.stickySettings.preCropEnabled&&!o){const t=_.MaxMaxNumMegapixels||_.FactoryDefaults.maxNumMegapixels;lt.show({inputFile:i,inputCanvas:s,lockAspectRatio:at.stickySettings.preCropLockAspectRatio,maxNumMegapixels:at.stickySettings.maxNumMegapixels||t,maxMaxNumMegapixels:t,aspectRatios:_.AspectRatios,completed:t=>{a=1024*lt.maxNumMegapixels*1024,l(t)}})}else l()})}}(ct||(ct={}));class pe extends It{constructor(t,e,o){super(t,e),this.levelToEndian32=o,this.endian32ToLevel=new Yt,this.maskEncoder=2==_.MaskVersion?new ae:new le;for(var i=0;i<this.levelToEndian32.length;i++)this.endian32ToLevel.put(0|this.levelToEndian32[i],i);this.resetLast()}getLevelAt(t,e){let o=this.context().getImageData(t,e,1,1).data,i=0|new Uint32Array(o.buffer)[0];return 0|this.endian32ToLevel.get(i)}hasHairAt(t,e){return this.lastHairAtX==t&&this.lastHairAtY==e||(this.lastHairAtX=t,this.lastHairAtY=e,this.lastHairAt=3==this.getLevelAt(t,e)),this.lastHairAt}clearAll(){this.context().clearRect(0,0,this.width(),this.height()),this.encodeCache=null}clearSquare(t,e,o){this.clearSquarePrivate(t,e,o),this.setLast(t,e,o)}drawBrush(t,e,o,i){this.currentBrush=i,this.drawBrushPrivate(t,e,o),this.setLast(t,e,o)}drawSquare(t,e,o,i){this.context().setFillStyle(i),this.drawSquarePrivate(t,e,o),this.setLast(t,e,o)}drawLine(t,e,o,i){this.context().setFillStyle(i),this.drawOrClearLine(t,e,o,this.drawSquarePrivate),this.setLast(t,e,o)}drawBrushLine(t,e,o,i){this.currentBrush=i,this.drawOrClearLine(t,e,o,this.drawBrushPrivate),this.setLast(t,e,o)}clearLine(t,e,o){this.drawOrClearLine(t,e,o,this.clearSquarePrivate),this.setLast(t,e,o)}resetLast(){this.setLast(null,null,null)}putImageData(t){t&&t.width==this.width()&&t.height==this.height()&&(this.context().putImageData(t,0,0),this.encodeCache=null)}encodeEx(){return{data:this.encode(),version:_.MaskVersion}}encode(){if(null!=this.encodeCache)return this.encodeCache;var t=this.context().getImageData(0,0,this.width(),this.height()).data,e=new Int32Array(t.buffer),o=e[0],i=0|this.endian32ToLevel.get(o),s=1,r=t.length/4,n=1;this.maskEncoder.reset();for(var a=(t,r)=>{for(var n=t;n<r;n++){var a=e[n];if(o==a)s++;else{o=a;var l=0|this.endian32ToLevel.get(o);l==i?s++:(this.maskEncoder.push(i,s),s=1,i=l)}}};n<r-4+1;n+=4)o==e[n]&&o==e[n+1]&&o==e[n+2]&&o==e[n+3]?s+=4:a(n,n+4);return a(n,r),this.maskEncoder.push(i,s),this.encodeCache=this.maskEncoder.toString(),this.encodeCache}decodeFrom(t){t?this.decode(t.data,t.version):this.clearAll()}decode(t,e){t?2===e?this.decodeInner(t,ae.decode):this.decodeInner(t,le.decode):this.clearAll()}decodeInner(t,e){var o=this.context().getImageData(0,0,this.width(),this.height()),i=o.data,s=new Uint32Array(i.buffer),r=0;let n=!1;e(t,(t,e)=>{for(var o=0|this.levelToEndian32[t],i=0;i<e&&r<s.length;i++,r++)s[r]=o,n=!0}),this.context().putImageData(o,0,0),this.encodeCache=null}patch(t,e,o){2===o?this.patchInner(t,e,ae.decode):this.patchInner(t,e,le.decode)}patchInner(t,e,o){var i=this.context().getImageData(0,0,this.width(),this.height()),s=i.data,r=new Uint32Array(s.buffer),n=0;let a=!1;o(t,(t,o)=>{const i=0|e[t];for(let t=0;t<o&&n<r.length;t++,n++)0==r[n]&&(r[n]=i,a=!0)}),this.context().putImageData(i,0,0),this.encodeCache=null}setLast(t,e,o){this.lastX=t,this.lastY=e,this.lastD=o,this.encodeCache=null}clearSquarePrivate(t,e,o){var i=Math.floor(o/2);this.context().clearRect(t-i,e-i,o,o)}drawSquarePrivate(t,e,o){var i=Math.floor(o/2);this.context().fillRect(t-i,e-i,o,o)}drawBrushPrivate(t,e,o){const i=Math.floor(o/2),s=t-i,r=e-i;this.currentBrush.isOpaque||(this.context().context.globalCompositeOperation="destination-out",this.context().drawCanvasEx(this.currentBrush.mask,s,r),this.context().context.globalCompositeOperation="source-over"),this.context().drawCanvasEx(this.currentBrush.canvas,s,r)}drawOrClearLine(t,e,o,i){var s=null==this.lastX?t:this.lastX,r=null==this.lastY?e:this.lastY,n=t-s,a=e-r,l=Math.abs(n),c=Math.abs(a),p=Math.max(l,c);if(0==p)i.call(this,t,e,o);else for(var u=0;u<=p;u++){var h=Math.round(s+u*n/p),d=Math.round(r+u*a/p);i.call(this,h,d,o)}}}!function(t){t.lastUserInteractionWasTouch=i(),t.hasSeenTouchEvents=!1,t.hasSeenMouseEvents=!1,t.hasSeenWheelEvents=!1;class e{constructor(e,i){this.handler=e,this.canvases=i,this.interactionIdentifier=0,this.mouseIsDown=!1,this.isMiddleButtonGrab=!1,this.touchQueue=[],this.currentNumTouches=0,this.lastTouchStartAt=0,this.lastTapAt=0,this.lastTapOn=t.NullTouch,this.countWheelDeltaMod120IsZero=void 0,this.countDeltaYisNotInteger=void 0,this.isDiscreteDevice=!0,this.mightBeDiscreteDevice=!0,this.panAnimatorHandler=(e,o)=>{if(Number.isFinite(e)&&Number.isFinite(o))if(0==e&&0==o)ut.main.refreshAllViews();else{let i=new t.Interaction(t.InteractionType.MomentumTranslate,this.interactionIdentifier++,void 0,e,o,void 0,void 0,!1,!1);this.handler.pointerInteraction(i)}},this.mouseIn=e=>{this.fireMouse(t.InteractionType.CanvasEnter,e.currentTarget,e)},this.mouseOut=e=>{this.fireMouse(t.InteractionType.CanvasLeave,e.currentTarget,e)},this.mouseDown=e=>{this.mouseIsDown||0!=e.button&&1!=e.button||(this.mouseIsDown=!0,this.mouseButton=e.button,1==this.mouseButton&&B.isNot(B.Grab)&&(this.isMiddleButtonGrab=!0,B.setTempSelect(B.Grab)),B.mouseDown(),this.activeCanvas=e.currentTarget,D.$window.on("mouseup",this.mouseUp),D.$window.on("mousemove",this.mouseMoveWindow),this.fireMouse(t.InteractionType.Hover,this.activeCanvas,e),this.fireMouse(t.InteractionType.ActionStart,this.activeCanvas,e))},this.mouseMoveCanvas=t=>{null==this.activeCanvas&&this.mouseMoveWindow(t)},this.mouseMoveWindow=e=>{t.hasSeenMouseEvents=!0,this.mouseIsDown?this.fireMouse(t.InteractionType.ActionMove,this.activeCanvas,e):this.fireMouse(t.InteractionType.Hover,e.currentTarget,e)},this.mouseUp=e=>{this.mouseIsDown&&this.mouseButton==e.button&&(this.fireMouse(t.InteractionType.ActionMove,this.activeCanvas,e),this.mouseIsDown=!1,this.fireMouse(t.InteractionType.ActionEnd,this.activeCanvas,e),this.activeCanvas=null,D.$window.off("mouseup",this.mouseUp),D.$window.off("mousemove",this.mouseMoveWindow),this.isMiddleButtonGrab&&(this.isMiddleButtonGrab=!1,B.releaseTempSelect()),B.mouseUp())},this.mouseDblClick=e=>{this.fireMouse(t.InteractionType.DoubleClick,e.currentTarget,e)},this.mouseWheel=e=>{t.hasSeenWheelEvents=!0;let o=a.cast(e.originalEvent);if(this.updateIsDiscrete(o),!this.mouseIsDown){let o=1.2;e.shiftKey&&(o=Math.pow(o,1/4));let i=t.zoomDelta(e,o,this.isDiscreteDevice)*this.handler.getZoomScale();this.fireMouse(t.InteractionType.PanZoom,e.currentTarget,e,i),this.fireMouse(t.InteractionType.Hover,e.currentTarget,e)}},this.touchStart=e=>{switch(t.hasSeenTouchEvents=!0,e.preventDefault(),this.updateCurrentNumTouches(e),this.touchState){case 0:e.targetTouches.length>0&&(this.interactionIdentifier++,this.lastTouchStartAt=Date.now(),this.touchAt=Date.now(),this.touch0=t.YoTouch.from(e.targetTouches.item(0)),this.activeCanvas=e.currentTarget,this.fireTouch(t.InteractionType.CanvasEnter,this.touch0),this.isFirstPan=!0,e.targetTouches.length>1?this.touchCommitPinchZoom(e.targetTouches.item(1)):(this.fireTouch(t.InteractionType.Hover,this.touch0),B.is(B.Grab)?this.touchCommitPinchZoom(null):(this.touchState=1,this.touchTimer=setTimeout(this.touchTimeout,t.TouchTimeBoxMs))));break;case 1:this.touchCommitPinchZoom(e.changedTouches.item(0));break;case 2:break;case 3:this.touch1.isNull()&&(this.isFirstPan=!0,this.touchCommitPinchZoom(e.changedTouches.item(0)))}},this.touchMove=e=>{t.hasSeenTouchEvents=!0,e.preventDefault(),this.updateCurrentNumTouches(e);const o=this.touch0.find(e.touches);if(null!=o)switch(this.touchState){case 0:break;case 1:const i=this.touch0.distanceSqrTo(o);t.TouchSpaceRadiusSqrPx<=i?(this.touchCommitSwipe(),this.touchMove(e)):this.queueTouch(o);break;case 2:this.fireTouch(t.InteractionType.ActionMove,o);break;case 3:const s=this.touch1.find(e.touches);if(this.touch0=t.YoTouch.from(o),s){this.touch1=t.YoTouch.from(s);const e=this.touch0.distanceTo(this.touch1)/this.pinchInitialDistance,o=this.pinchInitialZoom*e;this.fireTouchEx(t.InteractionType.PanZoom,(this.touch0.pageX+this.touch1.pageX)/2,(this.touch0.pageY+this.touch1.pageY)/2,o)}else this.fireTouchEx(t.InteractionType.PanZoom,this.touch0.pageX,this.touch0.pageY,void 0)}},this.touchEnd=e=>{t.hasSeenTouchEvents=!0,e.preventDefault(),this.updateCurrentNumTouches(e);let o=e.changedTouches.item(0);switch(this.touchState){case 0:break;case 1:B.getActiveMode().needsHover?(this.touchCommitSwipe(),this.touchEnd(e)):(this.fireTouch(t.InteractionType.Tap,o),this.checkDoubleTap(o),this.touchClear(o));break;case 2:this.fireTouch(t.InteractionType.ActionEnd,o),this.touchClear(o);break;case 3:null!=this.touch1.find(e.changedTouches)&&(this.isFirstPan=!0,this.touch1=t.NullTouch),null!=this.touch0.find(e.changedTouches)&&(this.isFirstPan=!0,this.touch0=this.touch1,this.touch1=t.NullTouch),this.touch0.isNull()&&(this.checkDoubleTap(o),this.touchClear(o),B.releaseTempSelect())}},this.touchTimeout=()=>{this.touchTimer=void 0,1==this.touchState&&this.touchCommitSwipe()};for(let e of i)e.$element.mousedown(this.mouseDown).mouseup(this.mouseUp).mousemove(this.mouseMoveCanvas).hover(this.mouseIn,this.mouseOut).dblclick(this.mouseDblClick).mousewheel(this.mouseWheel),e.element.addEventListener("touchstart",this.touchStart,t.AddEventListenerThirdArgForTouch),e.element.addEventListener("touchmove",this.touchMove,t.AddEventListenerThirdArgForTouch),e.element.addEventListener("touchend",this.touchEnd,t.AddEventListenerThirdArgForTouch);this.touchClear(null),this.panAnimator=new o(this.panAnimatorHandler)}checkMousePanAnimator(){B.is(B.Grab)&&this.lastMouseAction.isMousePanEnd()?(ut.main.setIsZoomingOrPanning(!0),this.panAnimator.start(this.lastMouseAction)):this.lastMouseAction.shouldStopMouseMomentumPan()&&this.panAnimator.stop()}fireMouse(e,o,i,s){t.lastUserInteractionWasTouch=!1,e==t.InteractionType.Hover&&(this.lastMouseAction=void 0);this.lastMouseAction=new t.Interaction(e,this.interactionIdentifier++,this.lastMouseAction,i.pageX,i.pageY,s,o,!1,!0);this.checkMousePanAnimator(),this.handler.pointerInteraction(this.lastMouseAction)}updateIsDiscrete(o){let i=o.wheelDelta||o.wheelDeltaY||o.wheelDeltaX,s=o.deltaY||o.deltaX||o.deltaZ,r=o.deltaMode;if(void 0!==s){let t=!Number.isInteger(s);void 0===this.countDeltaYisNotInteger?this.countDeltaYisNotInteger=t?e.ThreshDeltaIsNotInteger:0:t?this.countDeltaYisNotInteger++:this.countDeltaYisNotInteger=0}if(void 0===i){let t=0===r;this.mightBeDiscreteDevice=this.isDiscreteDevice=!t}else{let o=Math.abs(i)%120==0;void 0===this.countWheelDeltaMod120IsZero?this.countWheelDeltaMod120IsZero=o?e.ThreshWheelDeltaMod120IsZero:0:o?this.countWheelDeltaMod120IsZero++:this.countWheelDeltaMod120IsZero=0,this.countWheelDeltaMod120IsZero>=e.ThreshWheelDeltaMod120IsZero?this.mightBeDiscreteDevice=this.isDiscreteDevice=!0:t.isMac?this.mightBeDiscreteDevice=this.isDiscreteDevice=this.countDeltaYisNotInteger>=e.ThreshDeltaIsNotInteger:(this.isDiscreteDevice=!1,this.mightBeDiscreteDevice=o)}}updateCurrentNumTouches(t){this.currentNumTouches=t.touches.length}fireTouch(t,e){this.fireTouchEx(t,e.pageX,e.pageY,void 0)}fireTouchEx(e,o,i,s){t.lastUserInteractionWasTouch=!0;let r=this.lastTouchAction=new t.Interaction(e,this.interactionIdentifier,this.lastTouchAction,o,i,s,this.activeCanvas,!0,this.isFirstPan);r.numTouches=this.currentNumTouches,e==t.InteractionType.PanZoom&&(this.isFirstPan=!1),this.checkTouchPanAnimator(),this.handler.pointerInteraction(r)}checkTouchPanAnimator(){this.lastTouchAction.numTouches>1?this.panAnimator.stop():B.is(B.Grab)&&this.lastTouchAction.isTouchPanEnd()&&1==this.lastTouchAction.referenceInteraction.numTouches?(ut.main.setIsZoomingOrPanning(!0),this.panAnimator.start(this.lastTouchAction)):this.lastTouchAction.shouldStopTouchMomentumPan()&&this.panAnimator.stop()}queueTouch(e){this.touchQueue.push(t.YoTouch.from(e))}checkDoubleTap(e){Date.now()<this.lastTapAt+t.DoubleTapTimeMs&&this.lastTapOn.distanceTo(e)<t.DoubleTapRadiusPx?(this.fireTouch(t.InteractionType.DoubleClick,e),this.clearDoubleTap()):(this.lastTapAt=this.lastTouchStartAt,this.lastTapOn=t.YoTouch.from(e))}clearDoubleTap(){this.lastTapAt=0}touchCommitPinchZoom(e){clearTimeout(this.touchTimer),B.setTempSelect(B.Grab),this.touchQueue.length>0&&(this.touch0=this.touchQueue[this.touchQueue.length-1],this.touchQueue.length=0),this.touchState=3,e&&(this.touch1=t.YoTouch.from(e),this.pinchInitialDistance=this.touch0.distanceTo(this.touch1),this.pinchInitialZoom=this.handler.getZoomScale(),this.clearDoubleTap())}touchCommitSwipe(){clearTimeout(this.touchTimer),this.touchState=2,this.fireTouch(t.InteractionType.ActionStart,this.touch0);for(let e of this.touchQueue)this.fireTouch(t.InteractionType.ActionMove,e);this.touchQueue.length=0}touchClear(e){e&&this.fireTouch(t.InteractionType.CanvasLeave,e),clearTimeout(this.touchTimer),this.touchState=0,this.touchAt=0,this.touchTimer=0,this.touch0=t.NullTouch,this.touch1=t.NullTouch,this.pinchInitialDistance=1,this.pinchInitialZoom=1,this.touchQueue.length=0,this.isFirstPan=!1,this.currentNumTouches=0}}e.ThreshWheelDeltaMod120IsZero=3,e.ThreshDeltaIsNotInteger=3,t.Manager=e;class o{constructor(t){this.callback=t,this.panPxPerMs=Pt.zero(),this.frame=()=>{if(!this.hasSpeed())return;this.timerId=void 0;let t=Date.now(),e=t-this.lastPanFrameAt;if(this.lastPanFrameAt=t,this.callback(this.panPxPerMs.x*e,this.panPxPerMs.y*e),t-this.lastPanInteraction.timestamp>150){let t=.003*e/this.panPxPerMs.length();t>=1?(this.panPxPerMs.setXy(0,0),this.sendDone()):(this.panPxPerMs.plusEqualsScaled(-t,this.panPxPerMs),this.trigger())}else this.trigger()}}start(t){this.lastPanInteraction=t;let e=t.getReferenceBefore(100),o=Math.max(10,t.timestamp-e.timestamp),i=Math.sqrt(window.devicePixelRatio||1);this.panPxPerMs.setXy((t.pageX-e.pageX)/o,(t.pageY-e.pageY)/o).capLength(1.75*Math.sqrt(i)),this.hasSpeed()&&(this.lastPanFrameAt=Date.now(),this.trigger())}stop(){this.timerId&&(clearTimeout(this.timerId),this.timerId=void 0,this.lastPanFrameAt=void 0,this.panPxPerMs.setXy(0,0),this.lastPanInteraction=void 0,this.sendDone())}isAnimating(){return this.hasSpeed()}sendDone(){this.callback(0,0)}trigger(){this.timerId||(this.timerId=setTimeout(this.frame,10))}hasSpeed(){return 0!=this.panPxPerMs.lengthSqr()}}function i(){return"ontouchstart"in document.documentElement}t.deviceHasTouch=i}(pt||(pt={}));class ue{constructor(){this.startOffsetX=null,this.startOffsetY=null,this.startZoom=null,this.targetOffsetX=null,this.targetOffsetY=null,this.targetZoom=null,this.startTime=null,this.id=null,this.ignoreClear=!1}}class he extends It{constructor(t,e,o){super(t,e,o),this.isVisible=!0,this.borderRight=!1,this.borderLeft=!1}}class de{constructor(t){this.name=t,this.highDpiRatio=1,this.uiIsInitialized=!1,this.opts=null,this.canvasContainers=[],this.canvases=[],this.imageWidth=null,this.imageHeight=null,this.imageCenterX_i=0,this.imageCenterY_i=0,this.imageCenter_i=new Pt(0,0),this.imageCenterX_o=null,this.imageCenterY_o=null,this.zoomScale=null,this.animation=new ue,this.mouseX_i=de.OffScreen,this.mouseY_i=de.OffScreen,this.mouseX_ii=de.OffScreen,this.mouseY_ii=de.OffScreen,this.mouseX_c=0,this.mouseY_c=0,this.mouseX_o=0,this.mouseY_o=0,this.imageLeft_c=0,this.imageTop_c=0,this.imageWidth_c=0,this.imageHeight_c=0,this.imageCenterX_c=0,this.imageCenterY_c=0,this.crop_c=new Wt,this.mouseIsDown=!1,this.mouseButton=null,this.shiftIsDown=!1,this.overPanCanvas=!1,this.isZoomingOrPanning=!1,this.isZoomingOrPanningTimeoutId=-1,this.isTinyHairBrush=!1,this.clickX_c=null,this.clickY_c=null,this.clickX_o=null,this.clickY_o=null,this.clickImageCenterX_o=null,this.clickImageCenterY_o=null,this.pinchIsActive=!1,this.pinchInitialDistance=1,this.pinchInitialZoom=1,this.currentApp=null,this.activeCanvas=null,this.hoveredCanvas=null,this.pointerManager=null,this.repeaterDelay=de.animationDuration/2,this.showing=!1,this.contextMenuHandler=t=>this.canvases[0].config&&this.canvases[0].config.contextMenuHandler?this.canvases[0].config.contextMenuHandler(t):(t.preventDefault(),!1),this.keyDownHandler=t=>{switch(t.keyCode){case 16:return this.shiftIsDown||(this.shiftIsDown=!0,this.updatePanTempSelect()),!0;case 37:return this.moveLeft(t.shiftKey),!0;case 38:return this.moveUp(t.shiftKey),!0;case 39:return this.moveRight(t.shiftKey),!0;case 40:return this.moveDown(t.shiftKey),!0;case 33:return this.animateZoomInAboutCenter(),!0;case 34:return this.animateZoomOutAboutCenter(),!0;case 36:return this.animateZoomToFit(),!0;case 89:return x.M.tryRedo(),!0;case 90:return t.shiftKey?x.M.tryRedo():x.M.tryUndo(),!0;case 79:return!0;case 80:if(_.ScreenshotMode){var e=this.opts.canvasDiv;const t=e.css("width"),i=["1350px","1350px","auto"],s=["675px","450px","auto"];var o=(i.indexOf(t)+1)%i.length;e.css({width:i[o],height:s[o]}),this.updateSize()}return!0}return!1},this.keyUpHandler=t=>{switch(t.keyCode){case 16:return this.shiftIsDown&&(this.shiftIsDown=!1,this.updatePanTempSelect()),!0}return!1},this.lastRefreshAt=-1,this.refreshIntervalId=-1,this.refreshAllViewsImpl=()=>{if(this.canvases)for(let t=0;t<this.canvases.length;t++)this.canvases[t].isVisible&&this.refreshView(this.canvases[t]);const t=Date.now();this.lastRefreshAt=t,this.refreshIntervalId=-1},this.refreshAllViews=()=>{this.refreshAllViewsImpl()},this.animateZoomInAboutCenter=()=>{this.animate(0,0,de.zoomStep)},this.animateZoomOutAboutCenter=()=>{this.animate(0,0,de.inverseZoomStep)},this._isHorizontal=!0,this.updateSize=()=>{if(this.opts){this.highDpiRatio=window.devicePixelRatio||1;const e=this.isHorizontalSideBySide(!0);this.canvases.length>1&&D.body.$().toggleClass(D.viewport_vertical.name(),!e);var t=!1;let o=this.hoveredCanvas;for(let e=0;e<this.canvases.length;e++){let i=this.canvasContainers[e],s=this.canvases[e];if(s.isVisible){let e=i.clientWidth,o=i.clientHeight;t=!0,s.setSize(e,o,this.highDpiRatio),s.left=i.offsetLeft,s.top=i.offsetTop}o!=s.element&&this.updateCoords(null,null,s.element)}return null!=o&&this.updateCoords(null,null,o),this.refreshAllViews(),t}return!1},window.Globals.isDev||setInterval(()=>{this.updateSize()},2e3)}isInitialized(){return this.uiIsInitialized}initialize(t){if(this.opts=t,this.imageWidth=this.opts.image.width(),this.imageHeight=this.opts.image.height(),this.imageCenterX_i=this.imageWidth/2,this.imageCenterY_i=this.imageHeight/2,this.imageCenter_i.setXy(this.imageCenterX_i,this.imageCenterY_i),this.imageCenterX_o=this.imageWidth/2,this.imageCenterY_o=this.imageHeight/2,this.currentApp=this.opts.app,this.zoomScale=1,!this.uiIsInitialized){this.uiIsInitialized=!0;for(let t=0;t<this.opts.viewConfigs.length;t++){let e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.flexGrow="1",e.style.position="relative";let o=new he(1,1,this.highDpiRatio);o.config=this.opts.viewConfigs[t],o.element.style.left="0",o.element.style.top="0",o.left=0,o.top=0,o.highDpiRatio=this.highDpiRatio,this.canvasContainers[t]=e,this.canvases[t]=o,e.appendChild(o.element),this.opts.canvasDiv.append(e)}this.updateBorders(),this.pointerManager=new pt.Manager(this,this.canvases),this.hoveredCanvas=this.canvases[0].element;for(let t of this.canvases)t.element.toDataURL=t=>document.createElement("canvas").toDataURL(t),t.element.toBlob=(t,e,...o)=>{document.createElement("canvas").toBlob(t,e,...o)};for(var e=0;e<this.opts.viewConfigs.length;e++)$(this.canvases[e].element).on("contextmenu",this.contextMenuHandler);$(window).resize(()=>{this.updateSize()})}}setViewConfigs(t){this.canvases[0].config=t[0];let e=!!t[1];e&&(this.canvases[1].config=t[1]),this.setVisible(1,e),this.updateSize(),this.refreshAllViews()}setViewConfigAndShow(t,e){this.currentApp=e,this.canvases[0].config=t,this.updateSize(),this.zoomToFit(!0),this.showing=!0,this.refreshAllViews()}viewportCanvasFromCanvasElement(t){return P.find(this.canvases,e=>e.element==t)}pointerInteraction(t){let e=e=>{let o=this.viewportCanvasFromCanvasElement(t.canvas);null!=o&&o.config.panModeOnly&&this.overPanCanvas!==e&&(this.overPanCanvas=e,this.updatePanTempSelect())};switch(t.type){case pt.InteractionType.CanvasEnter:this.currentApp.pointerInteraction(t),e(!0);break;case pt.InteractionType.CanvasLeave:this.currentApp.pointerInteraction(t),e(!1),this.mouseX_c=this.mouseX_c=this.mouseX_i=this.mouseY_i=this.mouseX_ii=this.mouseY_ii=de.OffScreen,this.refreshAllViews();break;case pt.InteractionType.Hover:this.updateCoords(t.pageX,t.pageY,t.canvas),this.currentApp.pointerInteraction(t),this.refreshAllViews();break;case pt.InteractionType.Tap:this.currentApp.pointerInteraction(t);break;case pt.InteractionType.ActionStart:x.App.toggleAllCanvasViewsClass("drag",!0),this.clearAnimation(),this.clickX_c=t.pageX,this.clickY_c=t.pageY,this.clickImageCenterX_o=this.imageCenterX_o,this.clickImageCenterY_o=this.imageCenterY_o,this.updateCoords(t.pageX,t.pageY,this.activeCanvas),this.currentApp.pointerInteraction(t),this.refreshAllViews();break;case pt.InteractionType.ActionMove:if(this.clearAnimation(),this.updateCoords(t.pageX,t.pageY,t.canvas),this.currentApp.pointerInteraction(t),B.is(B.Grab)){this.setIsZoomingOrPanning(!0);let e=this.clickImageCenterX_o-(t.pageX-this.clickX_c)/this.zoomScale,o=this.clickImageCenterY_o-(t.pageY-this.clickY_c)/this.zoomScale;this.setView(e,o,null,!0),x.M.Review.reset()}this.refreshAllViews();break;case pt.InteractionType.MomentumTranslate:this.setIsZoomingOrPanning(!0),this.clearAnimation();let o=this.imageCenterX_o-t.pageX/this.zoomScale,i=this.imageCenterY_o-t.pageY/this.zoomScale;this.setView(o,i,null,!0),this.refreshAllViews();break;case pt.InteractionType.ActionEnd:x.App.toggleAllCanvasViewsClass("drag",!1),this.clearAnimation(),this.currentApp.pointerInteraction(t);break;case pt.InteractionType.PanZoom:this.setIsZoomingOrPanning(!0),this.clearAnimation(),this.updateCoords(t.pageX,t.pageY,t.canvas),t.isFirstPan&&(this.clickX_o=this.mouseX_o,this.clickY_o=this.mouseY_o);let s=P.clamp(t.zoomTo||this.zoomScale,de.minZoomScale,de.maxZoomScale),r=this.mouseX_c-this.canvas0LogicalWidth()/2,n=this.mouseY_c-this.canvas0LogicalHeight()/2,a=this.imageCenterX_o+r/this.zoomScale-r/s-(this.mouseX_o-this.clickX_o),l=this.imageCenterY_o+n/this.zoomScale-n/s-(this.mouseY_o-this.clickY_o);this.setView(a,l,s,!0),this.updateCoords(t.pageX,t.pageY,t.canvas),this.currentApp.pointerInteraction(t),x.M.Review.reset(),this.refreshAllViews();break;case pt.InteractionType.DoubleClick:B.is(B.Grab)?this.animateZoomToFit():this.currentApp.pointerInteraction(t)}}setIsZoomingOrPanning(t){this.isZoomingOrPanning=t,-1!=this.isZoomingOrPanningTimeoutId&&clearTimeout(this.isZoomingOrPanningTimeoutId),t?this.isZoomingOrPanningTimeoutId=setTimeout(()=>this.setIsZoomingOrPanning(!1),100):this.refreshAllViews()}updatePanTempSelect(){this.shiftIsDown||this.overPanCanvas?B.setTempSelect(B.Grab):B.releaseTempSelect()}updateIsTinyHairBrush(){const t=B.getVisibleMode(),e=t.isFgOrBg()&&t.mask.hasHairAt(this.mouseX_ii,this.mouseY_ii);this.isTinyHairBrush;this.pointerManager.mouseIsDown||(this.isTinyHairBrush=e)}o2cX(t){return this.imageLeft_c+t*this.zoomScale}o2cY(t){return this.imageTop_c+t*this.zoomScale}o2c(t){return new Pt(this.o2cX(t.x),this.o2cY(t.y))}c2oX(t){return(t-this.imageLeft_c)/this.zoomScale}c2oY(t){return(t-this.imageTop_c)/this.zoomScale}c2o(t){return new Pt(this.c2oX(t.x),this.c2oY(t.y))}getViewPortCanvasExFor(t){for(let e of this.canvases)if(e.element==t)return e;return null}updateCoords(t,e,o){if(null==o)return;let i=this.getViewPortCanvasExFor(o);if(null!=i){var s=x.M.totalRotationAngleRad_o2i();if(null!=t&&null!=e){var r=$(o).offset();this.mouseX_c=t-r.left,this.mouseY_c=e-r.top}this.mouseX_o=(this.mouseX_c-i.logicalWidth()/2)/this.zoomScale+this.imageCenterX_o,this.mouseY_o=(this.mouseY_c-i.logicalHeight()/2)/this.zoomScale+this.imageCenterY_o;var n=this.mouseX_o-this.imageCenterX_i,a=this.mouseY_o-this.imageCenterY_i;this.mouseX_i=n*Math.cos(s)-a*Math.sin(s)+this.imageCenterX_i,this.mouseY_i=n*Math.sin(s)+a*Math.cos(s)+this.imageCenterY_i,this.mouseX_ii=Math.floor(this.mouseX_i),this.mouseY_ii=Math.floor(this.mouseY_i),this.updateCanvasCoords(i),this.hoveredCanvas=o,this.updateIsTinyHairBrush()}}tx_i2o(t,e){var o=x.M.totalRotationAngleRad_i2o();t.rotateInto(Math.cos(o),Math.sin(o),this.imageCenterX_i,this.imageCenterY_i,e)}getViewCenter_i(){if(null!=this.imageCenterX_o){var t=this.imageCenterX_o-this.imageCenterX_i,e=this.imageCenterY_o-this.imageCenterY_i,o=x.M.totalRotationAngleRad_o2i(),i=t*Math.cos(o)-e*Math.sin(o)+this.imageCenterX_i,s=t*Math.sin(o)+e*Math.cos(o)+this.imageCenterY_i;return new Pt(i,s)}return null}updateCanvasCoords(t){this.imageLeft_c=t.logicalWidth()/2-this.imageCenterX_o*this.zoomScale,this.imageTop_c=t.logicalHeight()/2-this.imageCenterY_o*this.zoomScale,this.imageWidth_c=this.imageWidth*this.zoomScale,this.imageHeight_c=this.imageHeight*this.zoomScale,this.imageCenterX_c=this.imageLeft_c+this.imageWidth_c/2,this.imageCenterY_c=this.imageTop_c+this.imageHeight_c/2;var e=x.M.getCrop_o();this.crop_c.left0=Math.floor(this.o2cX(e.left0)),this.crop_c.right0=Math.ceil(this.o2cX(e.right0)),this.crop_c.top0=Math.floor(this.o2cY(e.top0)),this.crop_c.bottom0=Math.ceil(this.o2cY(e.bottom0))}getCrop_c(){return this.crop_c}getMouse_c(){return new Pt(this.mouseX_c,this.mouseY_c)}getClick_c(){return new Pt(this.clickX_c,this.clickY_c)}getMouse_i(){return new Pt(this.mouseX_i,this.mouseY_i)}getMouse_ii(){return new Pt(this.mouseX_ii,this.mouseY_ii)}getImageCenter_c(){return new Pt(this.imageCenterX_c,this.imageCenterY_c)}getImageCenter_i(){return new Pt(this.imageCenterX_i,this.imageCenterY_i)}getMouseIsDown(){return this.mouseIsDown}getZoomScale(){return this.zoomScale}getShiftIsDown(){return this.shiftIsDown}isStroking(){return this.pointerManager.mouseIsDown&&B.getActiveMode().needsHover}diameter(){const t=B.getVisibleMode();return this.isTinyHairBrush?1:P.clamp(Math.floor(t.diameterScale*x.M.settings.brushSize/this.zoomScale),t.minDiameter,_.MaxBrushDiameter)}rotationCropUpdated(t,e){var o=new Pt(this.imageCenterX_o,this.imageCenterY_o);o.rotateInPlace(e-t,this.imageCenter_i),this.setView(o.x,o.y,this.zoomScale,!0)}setView(t,e,o,i=!1,s=!1){null==o&&(o=this.zoomScale);var r=x.M.getViewCrop_o(),n=P.clamp(t,r.left0,r.right0),a=P.clamp(e,r.top0,r.bottom0),l=P.clamp(o,de.minZoomScale,de.maxZoomScale);n==this.imageCenterX_o&&a==this.imageCenterY_o&&l==this.zoomScale||(this.imageCenterX_o=n,this.imageCenterY_o=a,this.zoomScale=l,s||this.updateCoords(null,null,this.hoveredCanvas),i||this.refreshAllViews(),_.ScreenshotMode&&$("#viewport-setting").val(this.toString()))}toString(){return this.imageCenterX_o+","+this.imageCenterY_o+","+this.zoomScale}fromString(t){try{var e=t.split(",");this.setView(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]))}catch(t){}}moveLeft(t){this.animate(-(t?1:de.moveStep)/this.zoomScale,0,1)}moveRight(t){this.animate((t?1:de.moveStep)/this.zoomScale,0,1)}moveUp(t){this.animate(0,-(t?1:de.moveStep)/this.zoomScale,1)}moveDown(t){this.animate(0,(t?1:de.moveStep)/this.zoomScale,1)}canvas0LogicalWidth(){return this.canvases[0].logicalWidth()}canvas0LogicalHeight(){return this.canvases[0].logicalHeight()}animateZoomToFit(){this.clearAnimation(),this.animation.ignoreClear=!0;var t=x.M.getCrop_o(),e=Math.min(this.canvas0LogicalWidth()/t.width(),(this.canvas0LogicalHeight()-72)/t.height())*de.zoomToFitBackOff/this.zoomScale;this.animate(t.centerX()-this.imageCenterX_o,t.centerY()-this.imageCenterY_o,e)}zoomAboutBy(t,e,o){this.zoomAboutTo_c(t,e,this.zoomScale*o)}zoomToFit(t=!0){if(this.uiIsInitialized){var e=x.M.getCrop_o(),o=Math.min(this.canvas0LogicalWidth()/e.width(),this.canvas0LogicalHeight()/e.height())*de.zoomToFitBackOff;this.setView(e.centerX(),e.centerY(),o),t&&this.refreshAllViews()}}zoomToFitTight(t=!0){var e=x.M.getCrop_o(),o=Math.max(this.canvas0LogicalWidth()/e.width(),this.canvas0LogicalHeight()/e.height());this.setView(e.centerX(),e.centerY(),o),t&&this.refreshAllViews()}isHorizontalSideBySide(t){function e(t){return Math.min(8e3,Math.max(100,0|t))}if(t){let t=e(this.opts.canvasDiv.outerHeight()-88),o=e(this.opts.canvasDiv.outerWidth()),i=o/2/t,s=o/(t/2),r=e(this.imageHeight),n=e(this.imageWidth)/r,a=Math.abs(n-i),l=Math.abs(n-s);this._isHorizontal=a<=l}return this._isHorizontal}numVisibleCanvases(){for(var t=0,e=0;e<this.canvases.length;e++)this.canvases[e].isVisible&&t++;return t}setVisible(t,e){if(t>=0&&t<this.canvases.length){this.canvasContainers[t].style.display=e?"block":"none";this.canvases[t].isVisible=e,this.updateBorders()}}updateBorders(){let t=this.canvases.filter((function(t){return t.isVisible}));for(let e=0;e<t.length;e++)t[e].borderLeft=e>0,t[e].borderRight=e<t.length-1}zoomAboutTo_c(t,e,o){if(o!==this.zoomScale){o=P.clamp(o,de.minZoomScale,de.maxZoomScale);let i=t-this.canvas0LogicalWidth()/2,s=e-this.canvas0LogicalHeight()/2,r=this.imageCenterX_o+i/this.zoomScale-i/o,n=this.imageCenterY_o+s/this.zoomScale-s/o;this.setView(r,n,o)}}zoomAboutTo_o(t,e,o){let i=this.o2cX(t),s=this.o2cY(e);this.zoomAboutTo_c(i,s,o)}animate(t,e,o){var i=this,s=i.animation;s.startOffsetX=i.imageCenterX_o,s.startOffsetY=i.imageCenterY_o,s.startZoom=i.zoomScale,s.startTime=Date.now(),null==s.id&&(s.targetOffsetX=i.imageCenterX_o,s.targetOffsetY=i.imageCenterY_o,s.targetZoom=i.zoomScale,s.id=setInterval(()=>{i.offsetAnimationStep()},de.animationInterval)),s.targetOffsetX+=t,s.targetOffsetY+=e,s.targetZoom*=o,x.M.Review.reset()}animateTo_o(t,e,o){var i=this,s=i.animation;s.startOffsetX=i.imageCenterX_o,s.startOffsetY=i.imageCenterY_o,s.startZoom=i.zoomScale,s.startTime=Date.now(),null==s.id&&(s.targetOffsetX=i.imageCenterX_o,s.targetOffsetY=i.imageCenterY_o,s.targetZoom=i.zoomScale,s.id=setInterval(()=>{i.offsetAnimationStep()},de.animationInterval)),s.targetOffsetX=t,s.targetOffsetY=e,s.targetZoom=o}animateTo_i(t,e){var o=Pt.empty();this.tx_i2o(t,o),this.animateTo_o(o.x,o.y,Math.max(e,this.zoomScale))}offsetAnimationStep(){var t=this.animation,e=(Date.now()-t.startTime)/de.animationDuration,o=P.clamp(e,0,1),i=t.startOffsetX+o*(t.targetOffsetX-t.startOffsetX),s=t.startOffsetY+o*(t.targetOffsetY-t.startOffsetY),r=Math.exp(Math.log(t.startZoom)+o*(Math.log(t.targetZoom)-Math.log(t.startZoom)));o>=1&&this.clearAnimation(!0),this.setView(i,s,r,!1,this.mouseX_ii==de.OffScreen)}clearAnimation(t=!1){var e=this.animation;!t&&e.ignoreClear||(e.id&&clearInterval(e.id),e.startOffsetX=null,e.startOffsetY=null,e.startZoom=null,e.targetOffsetX=null,e.targetOffsetY=null,e.targetZoom=null,e.startTime=null,e.id=null,e.ignoreClear=!1)}refreshView(t){if(t&&this.showing){this.updateIsTinyHairBrush();var e=t.context(),o=t.config;if(e.setGlobalAlpha(1),e.clearRect(0,0,t.width(),t.height()),P.imageIsReady(this.opts.image)){this.updateCanvasCoords(t),e.setGlobalAlpha(1),o.showBackground&&x.M.settings.backgroundColor&&""!=x.M.settings.backgroundColor&&x.M.settings.backgroundColor!=window.Globals.BackgroundColors[0]&&(e.setFillStyle(x.M.settings.backgroundColor),e.fillRect(this.crop_c.left0,this.crop_c.top0,this.crop_c.width(),this.crop_c.height()));var i=this.getCrop_c();if(e.clipBlock(o.clip,i.left0,i.top0,i.right0,i.bottom0,()=>{this.drawClipped(t,e,o)}),!o.showFrame&&0==x.M.settings.straightenAngleDeg||_.ScreenshotMode||(e.setStrokeStyle("#000000"),e.setGlobalAlpha(.4),e.setLineWidth(1),e.strokeRect(this.crop_c.left0+.5,this.crop_c.top0+.5,this.crop_c.width()-1,this.crop_c.height()-1),e.setGlobalAlpha(1)),this.currentApp.drawOver_c(t,e),_.ScreenshotMode||(o.title&&e.drawCenteredText(o.title,81),o.filename&&e.drawCenteredText(o.filename,t.logicalHeight()-63),o.showSize&&e.drawCenteredText(J.outputSizeS(),t.logicalHeight()-63)),this.opts.showGrid&&this.opts.showGrid()){e.setGlobalAlpha(.2),e.setStrokeStyle("#000000"),e.setLineWidth(1);for(var s=t.logicalWidth(),r=t.logicalHeight(),n=0;n<s/2;n+=100)c(s/2+n,0,s/2+n,r),c(s/2-n,0,s/2-n,r);for(var a=0;a<r/2;a+=100)c(0,r/2+a,s,r/2+a),c(0,r/2-a,s,r/2-a)}if(!_.ScreenshotMode){let o=t.height(),i=t.width(),s="#222",r="#777",n="#bbb",a=1,l=1;if(e.setGlobalAlpha(1),this.isHorizontalSideBySide(!1)){if(t.borderLeft&&(e.setFillStyle(r),e.fillRect(0,0,l,o),e.setFillStyle(s),e.fillRect(l,0,a,o)),t.borderRight){let i=t.width()-a-l;e.setFillStyle(r),e.fillRect(i+a,0,l,o),e.setFillStyle(n),e.fillRect(i,0,a,o)}}else if(t.borderLeft&&(e.setFillStyle(r),e.fillRect(0,0,i,l),e.setFillStyle(s),e.fillRect(0,l,i,a)),t.borderRight){let o=t.height()-a-l;e.setFillStyle(r),e.fillRect(0,o+a,i,l),e.setFillStyle(n),e.fillRect(0,o,i,a)}}if(_.ScreenshotMode&&(o.showHoverTool||1==this.canvases.length)){var l=B.getActiveMode().getCursor();l&&(e.setGlobalAlpha(1),e.drawImage(l.img,this.mouseX_c-l.x,this.mouseY_c-l.y))}}}function c(t,o,i,s){e.beginPath(),e.moveTo(Math.floor(t)+.5,Math.floor(o)+.5),e.lineTo(Math.floor(i)+.5,Math.floor(s)+.5),e.stroke()}}drawClipped(t,e,o){var i=this;o.showPreview&&ut.ShadowApp&&ut.ShadowApp.drawUnder_c(t,e,this,(function(t,o,s,r){if(t){e.setGlobalAlpha(o);var n=t.width(),a=t.height();e.drawCanvasEx3(t,0,0,n,a,i.imageLeft_c+s*i.zoomScale,i.imageTop_c+r*i.zoomScale,n*i.zoomScale,a*i.zoomScale)}})),e.rotatedFrame(-x.M.totalRotationAngleRad_o2i(),this.getImageCenter_c(),()=>{i.drawRotated(t,e,o)})}drawRotated(t,e,o){var i=this;function s(t,o,s){e.setGlobalAlpha(o),e.drawCanvasEx3(t,0,0,i.imageWidth,i.imageHeight,i.imageLeft_c,i.imageTop_c,i.imageWidth_c,i.imageHeight_c)}function r(t,o){e.setStrokeStyle(t),e.setLineWidth(o),e.stroke()}if(o.showPreview&&ut.ShadowApp&&ut.ShadowApp.drawUnder_i(t,e,this,(function(t,o,s,r){if(t){e.setGlobalAlpha(o);var n=t.width(),a=t.height();e.drawCanvasEx3(t,0,0,n,a,i.imageLeft_c+s*i.zoomScale,i.imageTop_c+r*i.zoomScale,n*i.zoomScale,a*i.zoomScale)}})),o.showOriginal&&s(i.opts.image,1),o.showPreview&&s(x.M.previewCanvas,1),o.showUserMask&&s(x.M.userMask,1),o.showBeziers){let t=!0;if((3==x.M.imageCategory.user||this.isZoomingOrPanning&&x.M.bezierSetLength>_.MaxBezierSetLengthForDrawingWhilePanningOrZooming||this.isStroking()&&x.M.bezierSetLength>_.MaxBezierSetLengthForDrawingWhileStroking)&&(t=!1),t){e.setGlobalAlpha(1),e.setLineJoin("bevel"),e.beginPath();for(let t of x.M.bezierSet){e.moveTo(i.o2cX(t[0]),i.o2cY(t[1]));for(let o=2;o<t.length;o+=4)e.quadraticCurveTo(i.o2cX(t[o]),i.o2cY(t[o+1]),i.o2cX(t[o+2]),i.o2cY(t[o+3]))}e.setLineDash([]),r("#000000",_.LineOuterWidth),e.setLineDash([7,3]),r("#FFFF66",_.LineInnerWidth),e.setLineDash([]),e.setFillStyle("#000");for(var n=0;n<x.M.detectedCorners.length;n++){var a=x.M.detectedCorners[n];e.fillCircle(i.o2cX(a.x),i.o2cY(a.y),_.LineOuterWidth/2)}}}if(o.showSword&&3!=x.M.imageCategory.user&&et.cutSet.draw(i,e),o.showReviewCursor){var l=x.M.Review.currentCenter_i;if(isFinite(l.x)&&isFinite(l.y)){var c=i.o2cX(l.x),p=i.o2cY(l.y);e.fillCircle(c,p,_.LineOuterWidth,"#F00")}}if(o.showEyeDropperLoupe&&B.getActiveMode().isEyeDropper&&i.hoveredCanvas==t.element){e.setGlobalAlpha(1);let t=Math.round(_.LoupeRadius/i.zoomScale),o=Math.max(0,i.mouseX_ii-t),s=Math.min(i.imageWidth,i.mouseX_ii+t)-o,n=Math.max(0,i.mouseY_ii-t),a=Math.min(i.imageHeight,i.mouseY_ii+t)-n;a>0&&s>0&&(e.drawCanvasEx3(i.opts.image,o,n,s,a,i.o2cX(o),i.o2cY(n),s*i.zoomScale,a*i.zoomScale),e.beginPath(),e.rect(i.o2cX(o),i.o2cY(n),s*i.zoomScale,a*i.zoomScale),r("#FFFF66",2))}let u=o.showHairLoupe&&this.isTinyHairBrush;if(u){e.setGlobalAlpha(1);let t=Math.max(i.zoomScale,8),o=Math.round(_.LoupeRadius/t),s=Math.max(0,i.mouseX_ii-o),n=Math.max(0,i.mouseY_ii-o),a=Math.min(i.imageWidth,i.mouseX_ii+o)-s,l=Math.min(i.imageHeight,i.mouseY_ii+o)-n,c=a*t,p=l*t,u=i.o2cX(i.mouseX_ii)-.5*c,d=i.o2cY(i.mouseY_ii)-.5*p;if(l>0&&a>0)if(e.drawCanvasEx3(i.opts.image,s,n,a,l,u,d,c,p),e.beginPath(),e.rect(u,d,c,p),r("#FFFF66",2),(h=B.getActiveMode()).needsHover){e.setGlobalAlpha(.5),e.setFillStyle(h.cssColor);let o=i.o2cX(i.mouseX_ii),s=i.o2cY(i.mouseY_ii);e.fillRect(o,s,t,t)}}var h;if(B.isNot(B.Grab)&&o.showHoverTool&&!u&&(h=B.getActiveMode()).needsHover){e.setGlobalAlpha(.5),e.setFillStyle(h.cssColor);let t=i.diameter(),o=Math.floor(t/2),s=t-o,r=Math.round(i.imageLeft_c+(i.mouseX_ii-o)*i.zoomScale),n=Math.round(i.imageTop_c+(i.mouseY_ii-o)*i.zoomScale),a=Math.round(i.imageLeft_c+(i.mouseX_ii+s)*i.zoomScale),l=Math.round(i.imageTop_c+(i.mouseY_ii+s)*i.zoomScale);if(h.isEraser)e.fillRect(r,n,a-r,l-n);else{var d=h.getBrush(t);e.drawCanvasEx2(d.opaqueCanvas,r,n,a-r,l-n)}}if(!window.Globals.Bulk.isApi&&o.showUserMask&&X.pasteButtonIsHovered){var g=X.getMask();null!=g&&(e.setGlobalAlpha(.5*_.ClientMaskAlphaFloat),e.drawCanvasEx3(g,0,0,g.width(),g.height(),i.imageLeft_c,i.imageTop_c,i.imageWidth_c,i.imageHeight_c))}i.currentApp.drawOver_i(t,e)}}function ge(){var t=!1,e=null,o=null;function i(t,e,o,i){var s=i;const r=t.length;for(var n=0;n<r;n++){var a=t[n],l=t[(n+1)%r];(l.y<o&&a.y>=o||a.y<o&&l.y>=o)&&l.x+(o-l.y)/(a.y-l.y)*(a.x-l.x)<e&&(s=!s)}return s}function s(t,e,o){for(var s=!1,r=0;r<t.length;r++)s=i(t[r],e,o,s);return s}function r(t,e,o,i,s,r){for(var n,a,l=0;l<3;l++){n=0;for(var c=0;c<s;c++)n+=t[c];for(var p=0;p<i;p++)e[p+o]=n*r,n-=t[p],n+=t[p+s];a=t,t=e,e=a}return t}self.addEventListener("message",i=>{try{var n=i.data;!function(i,s){if(!t){var r=Math.max(i,s)+450;e=new Uint8Array(r),o=new Uint8Array(r),t=!0}}(n.w,n.h),function(t){for(var e=0;e<t.length;e++)t[e]=0}(n.alphas);var a=n.w-450,l=n.h-450;!function(t,e,o,i,r,n,a){if(a.length>0)for(var l=0,c=3;l<i;l++)for(var p=0;p<o;p++,c+=4)s(a,p+.5,l+.5)&&(t[(l+225)*r+p+225]=e[c]);else for(l=0,c=3;l<i;l++)for(p=0;p<o;p++,c+=4)t[(l+225)*r+p+225]=e[c]}(n.alphas,n.result,a,l,n.w,n.h,n.polygonPoints),function(t,e,o,i,s,n){for(var a,l=0|o,c=2*l+1|0,p=1/c,u=t+l|0,h=e+l|0,d=0;d<l;d++)s[d]=0,s[t+l+d]=0,n[d]=0,n[t+l+d]=0;for(var g=0;g<e;g++){for(var m=0,f=(d=l,g*t);d<u;d++,f++)C=i[f],m+=C,s[d]=C;a=m>0?r(s,n,l,t,c,p):s;for(d=l,f=g*t;d<t;d++,f++)i[f]=a[d]}for(var S=0;S<l;S++)s[S]=0,s[e+l+S]=0,n[S]=0,n[e+l+S]=0;for(var w=0;w<t;w++){for(m=0,S=l,f=w;S<h;S++,f+=t){var C=i[f];m+=C,s[S]=C}a=m>0?r(s,n,l,e,c,p):s;for(S=l,f=w;S<h;S++,f+=t)i[f]=a[S]}}(n.w,n.h,n.blurRadius,n.alphas,e,o),te({alphas:n.alphas,blurRadius:n.blurRadius},[n.alphas.buffer]),n.alphas=null}catch(i){te({alphas:null,blurRadius:null,exception:i})}})}function me(){self.addEventListener("message",r=>{try{var n=r.data;!function(s){t=s.bufferSize.w,e=s.bufferSize.h,o=new Uint8ClampedArray(t*e*4),(!i||i.length<t)&&(i=new Float32Array(2*t))}(n),function(t){for(var e=0,o=t.points,s=o[0],r=o[o.length-1],n=0;n<t.bufferSize.w;n++){var a=t.bounds_o.left+n+.5,l=0;if(a<=s.x)l=s.y;else if(a>=r.x)l=r.y;else{for(;e<o.length-1&&a>o[e+1].x;)e++;var c=o[e],p=o[e+1],u=(a-c.x)/(p.x-c.x);l=c.y+u*(p.y-c.y)}i[n]=l}}(n),function(r){var n=r.imageCenter,a=r.angleRad,l=Math.sin(a),c=Math.cos(a),p=r.result,u=r.bounds_o,h=r.imageSize.w,d=r.imageSize.h,g=r.height;function m(t){return Math.max(0,Math.min(t,h-1))}function f(t){return Math.max(0,Math.min(t,d-1))}for(var S=0,w=0;S<e;S++)for(var C=u.top+S+.5,y=0;y<t;y++,w+=4){var b=i[y];if(C>b){var v=u.left+y+.5-n.x,A=2*b-C-n.y,k=n.x+c*v-l*A,M=n.y+l*v+c*A,x=Math.floor(k-.5),T=Math.floor(M-.5);if(k>=0&&k<h&&M>=0&&M<d){var _=255-(B=255*(C-b)/g,O=0,L=255,Math.max(O,Math.min(L,B))),D=4*(f(T)*h+m(x)),P=4*(f(T)*h+m(x+1)),R=4*(f(T+1)*h+m(x)),E=4*(f(T+1)*h+m(x+1)),F=k-(x+.5),I=M-(T+.5);o[w+0]=s(F,I,p,D,P,R,E,0),o[w+1]=s(F,I,p,D,P,R,E,1),o[w+2]=s(F,I,p,D,P,R,E,2),o[w+3]=_*(s(F,I,p,D,P,R,E,3)/255)}else o[w+3]=0}else o[w+3]=0}var B,O,L}(n),te(a={buffer:o,bufferSize:n.bufferSize,index:n.index},[a.buffer.buffer])}catch(r){var a;te(a={buffer:null,bufferSize:null,index:null,exception:r})}});var t=0,e=0,o=null,i=null;function s(t,e,o,i,s,r,n,a){return o[i+a]*((1-t)*(1-e))+o[s+a]*(t*(1-e))+o[r+a]*((1-t)*e)+o[n+a]*(t*e)}}de.OffScreen=-1e4,de.animationInterval=10,de.animationDuration=100,de.moveStep=50,de.zoomStep=1.2,de.inverseZoomStep=1/de.zoomStep,de.zoomToFitBackOff=.95,de.maxZoomScale=64,de.minZoomScale=1/16,de.TargetIntervalMs=1e3/60,function(t){t.SwordActiveRed="#cc0000",t.SwordInactiveRed="rgb(120,60,60)",t.checkerPng=new Image,t.checkerPng.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEX////19fVC0XEuAAAAAHRSTlM2uXDMAAAAEElEQVR42mNg+M+AFeEQBgB+vw/xeaW7jwAAAABJRU5ErkJggg==",t.main=new de("main"),t.subViewPort=new de("subapp"),t.ShadowApp=null,t.refreshAllViews=function(){t.main.refreshAllViews(),t.subViewPort.refreshAllViews()}}(ut||(ut={})),function(t){const e=Math.SQRT2,o=_.MaxBlurRadius,i=3*o,s=_.MaxMirrorShadowHeight,r=_.MaxMirrorShadowOffset,n=2*o;class l{constructor(){this.handles=[],this.xr=0,this.yr=0}updateLocalCoords(t){this.xr=t.x,this.yr=t.y}autoHideControls(){return!1}hitShadow(t){return this.updateLocalCoords(t),!0}hitHandle(){let t=null;for(var e=0;e<this.handles.length;e++)this.handles[e].hitTest()&&(t||(t=this.handles[e]));return t}drawHandles(t){if(!this.autoHideControls()||w&&w.shadows&&w.shadows.indexOf(this)>=0)for(var e=w.handle,o=this.handles.length-1;o>=0;o--){var i=this.handles[o];i.drawWrapper(t,i==e)}}drawShadow(t,e){}drawControls(t){}}class c extends l{constructor(){super(),this.handles.push(new Ft(this))}drawControls(t){this.drawHandles(t)}}class u extends l{constructor(t){super();for(var e=0;e<t.length;e++)this.handles.push(new Bt(Pt.from(t[e]),this))}static fromRect(t){return new u([new Pt(t.left0,t.top0),new Pt(t.right0,t.top0),new Pt(t.right0,t.bottom0),new Pt(t.left0,t.bottom0)])}static decode(t){return new u(t.points)}getPolyLoop(){return new Ut(this.handles.map((t,e,o)=>t.getV()))}drawControls(t){t.setGlobalAlpha(1),t.setLineWidth(4),t.setStrokeStyle("#000"),t.beginPath(),t.moveTo(yt(this.handles[0].getX()),yt(this.handles[0].getY())),this.handles.forEach((e,o,i)=>t.lineTo(yt(e.getX()),yt(e.getY()))),t.closePath(),t.stroke(),t.setLineWidth(2),t.setStrokeStyle("#0FF"),t.stroke(),this.drawHandles(t)}encode(){return{points:this.getPolyLoop().points}}}var h={title:"",showPreview:!0,showFrame:!0,showBackground:!0,clip:!1,contextMenuHandler:Q.showShadowApp};ut.ShadowApp=t;var d=null,g=[],m=null,f=new class{constructor(){this.loops=[]}nonEmpty(){return this.loops.length>0}isEmpty(){return 0==this.loops.length}clear(){this.loops.length=0}fromRect(t){this.clear(),this.loops.push(new u([new Pt(t.left0,t.top0),new Pt(t.right0,t.top0),new Pt(t.right0,t.bottom0),new Pt(t.left0,t.bottom0)]))}decode(t){this.clear(),t&&t.loops&&t.loops.forEach(t=>this.loops.push(new u(t.points)))}getPolygon(){return new $t(this.loops.map((t,e,o)=>t.getPolyLoop()))}getPolygonPoints(){return this.loops.map((t,e,o)=>t.getPolyLoop().points)}encode(){return{loops:this.loops.map(t=>t.encode())}}},S={v0:null,v2:null,downState:null,firstMove:!1};let w={shadows:[],shadow:null,handle:null,ellipse:null,interactionIdentifier:void 0},C=w;function y(){return x.M.defaultSettings.ellipseShadow}function b(){return x.M.defaultSettings.dropShadow}function v(){return x.M.defaultSettings.mirrorShadow}function A(){return x.M.defaultSettings.perspectiveShadow}t.getNumEllipseShadows=function(){return g.length},t.getSelectedEllipseShadow=function(){return null==d?$.extend({},y()):d};class k{constructor(t){this.indicatorId=t,this.indexSent=0,this.indexReceived=0,this.calledFor=!1}incrementIndexSentAndShowIndicator(){this.indexSent++,this.indicatorId.$().show()}setIndexReceived(t){this.indexReceived=t,this.indicatorId.$().hide()}readyToResubmit(){return this.inSync()&&this.calledFor}inSync(){return this.indexSent==this.indexReceived}outOfSync(){return!this.inSync()}callFor(){this.calledFor=!0}resetCalledFor(){this.calledFor=!1}}let M=null;t.dropShadow=null;let T=-1,R=-1,E=-1,F=null,I=null,L=null,z=null,U=null,G=null;t.mirrorShadow=null;let N=null,H=null,V=null,W=new k(D.CmApp.ShadowApp.MirrorShadow.UpdatingIndicator),Y=null,X=null;t.perspectiveShadow=null;let q=-1,J=-1,j=null,Z=Et.empty(),K=new k(D.CmApp.ShadowApp.PerspectiveShadow.UpdatingIndicator),tt=!1,et=!1,ot=-1,it=-1,st=-1,rt=!1,nt=null,at=!1,lt=0,ct=0,ht=0,gt=0,mt=0,ft=0,St=0,wt=0,Ct=0;function yt(t){return t*ut.subViewPort.getZoomScale()}function bt(t){return t/ut.subViewPort.getZoomScale()}t.onhide=P.empty;class vt extends l{constructor(t,e,o,i,s,r){super(),this.sin=0,this.cos=1,this.shadowType="ellipse",this.center=t.dup(),this.radiusX_i=Math.abs(e),this.radiusY_i=Math.abs(o),this.angleRad=i,this.strength=s,this.core=0===r||r?r:y().core,this.sin=Math.sin(this.angleRad),this.cos=Math.cos(this.angleRad),this.topLeft=new Gt(this,"topLeft",-1,-1),this.topRight=new Gt(this,"topRight",1,-1),this.bottomRight=new Gt(this,"bottomRight",1,1),this.bottomLeft=new Gt(this,"bottomLeft",-1,1),this.sliderCore=new Nt(this),this.move=new Ht(this),this.remove=new Vt(this),this.rotator=new Wt(this),this.sliderStrength=new Xt(this),this.handles=[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft,this.sliderCore,this.move,this.remove,this.sliderStrength,this.rotator]}color(){return d==this?"#FB0":w.ellipse==this?"#FD0":"#FF0"}oppositeCorner(t){switch(t.name){case"topLeft":return this.bottomRight;case"topRight":return this.bottomLeft;case"bottomRight":return this.topLeft;case"bottomLeft":return this.topRight}return null}radiusX_c(){return yt(this.radiusX_i)}radiusY_c(){return yt(this.radiusY_i)}angleDeg(){return 180*this.angleRad/Math.PI}rotateX(t,e){return t*this.cos+e*this.sin}rotateY(t,e){return-t*this.sin+e*this.cos}derotateX(t,e){return t*this.cos-e*this.sin}derotateY(t,e){return t*this.sin+e*this.cos}setAngleRad(t){this.angleRad=t,this.sin=Math.sin(t),this.cos=Math.cos(t)}autoHideControls(){return!0}hitCircle(t,e,o){return P.sqr(this.xr-t)+P.sqr(this.yr-e)<o*o}setRect(t,e){this.center.x=(t.x+e.x)/2,this.center.y=(t.y+e.y)/2;let o=(e.x-t.x)/2,i=(e.y-t.y)/2;this.radiusX_i=Math.max(10,Math.abs(this.rotateX(o,i))),this.radiusY_i=Math.max(10,Math.abs(this.rotateY(o,i)))}updateLocalCoords(t){let e=t.x-this.center.x,o=t.y-this.center.y;this.xr=this.rotateX(e,o),this.yr=this.rotateY(e,o)}hitShadow(t){this.updateLocalCoords(t);let e=-this.radiusX_i-Ct,o=+this.radiusX_i+St,i=-this.radiusY_i-ft,s=+this.radiusY_i+wt;return e<=this.xr&&this.xr<=o&&i<=this.yr&&this.yr<=s}drawShadow(t,e){if(this.radiusX_i>0&&this.radiusY_i>0){let o=1,i=this.radiusY_i/this.radiusX_i,s=e.getZoomScale()*this.radiusX_i,r=t.createRadialGradient(0,0,0,0,0,s);r.addColorStop(0,"rgba(0,0,0,"+this.strength.toFixed(3)+")"),r.addColorStop(this.core,"rgba(0,0,0,"+this.strength.toFixed(3)+")");for(let t=0;t<=10;t++){let e=t/10,o=1-e,i=P.clamp(this.strength*(-2*o*o*o+3*o*o),0,1);r.addColorStop(this.core+e*(1-this.core),"rgba(0,0,0,"+i.toFixed(3)+")")}t.setGlobalAlpha(1),t.setFillStyle(r),t.scale(o,i),t.fillCircle(0,0,s)}}drawControls(t){t.setGlobalAlpha(1),t.setLineWidth(4),t.setStrokeStyle("#000"),t.strokeRect(-yt(this.radiusX_i),-yt(this.radiusY_i),yt(2*this.radiusX_i),yt(2*this.radiusY_i)),t.setLineWidth(2),t.setStrokeStyle(this.color()),t.strokeRect(-yt(this.radiusX_i),-yt(this.radiusY_i),yt(2*this.radiusX_i),yt(2*this.radiusY_i)),this.drawHandles(t)}encode(){return{centerX_i:this.center.x,centerY_i:this.center.y,radiusX_i:this.radiusX_i,radiusY_i:this.radiusY_i,angleRad:this.angleRad,strength:this.strength,core:this.core}}}class At{constructor(t,e=1){this.container=t,this.handleRadiusScale=e,this.isVisible=!0}getToolMode(){return B.ShadowArrow}getX(){return 0}getY(){return 0}getV(){return new Pt(this.getX(),this.getY())}getHitRadius_i(){return this.handleRadiusScale*lt*1.5}mayGrabWhenInvisible(){return!1}hitTest(){let t=this.getHitRadius_i();return P.sqr(this.container.xr-this.getX())+P.sqr(this.container.yr-this.getY())<t*t}drawWrapper(t,e){this.isVisible&&this.draw(t,e,this.getX(),this.getY())}draw(t,e,o,i){}drawTranslateHandle(t,e,o,i,s,r){let n=yt(o),a=yt(i);t.beginPath(),t.triangle(n,a-10.5,-Math.PI/2,2,5),t.triangle(n,a+10.5,Math.PI/2,2,5),t.triangle(n-10.5,a,Math.PI,2,5),t.triangle(n+10.5,a,0,2,5),t.strokeEx(2,"#000"),t.fillEx(e?r:s),qt(t,e,o,i,s,r,1)}mouseDrag(t){}mouseDown(t){}mouseUp(t){}}class kt extends At{constructor(t,e,o=1){super(e,o),this.p_i=t,this.dp_i=new Pt(0,0)}getX(){return this.p_i.x}getY(){return this.p_i.y}mayGrabWhenInvisible(){return!0}mouseDrag(t){this.p_i.set(t).plusEquals(this.dp_i)}mouseDown(t){this.mouseDownPos_i=t.dup(),this.mouseDownTime=Date.now(),this.dp_i=this.p_i.minus(t)}}class Mt extends l{constructor(){super(),this.isInitialized=!1,this.geometryIsValid=!1,this.c1=new xt(new Pt(10,0),this,!0,[],.7),this.p1=new xt(new Pt(0,0),this,!1,[this.c1]),this.c0=new xt(new Pt(0,0),this,!0,[],.7),this.p0=new xt(new Pt(10,0),this,!1,[this.p1,this.c0]),this.quadDst_i=Rt.empty(),this.quadSrc_o=Rt.empty(),this.quadDst_o=Rt.empty(),this.quadSrcClip_i=Rt.empty(),this.quadSrcClip_o=Rt.empty(),this.quadDstClip_o=Rt.empty(),this.transformSrcToDst_o=new Ot,this.transformDstToSrc_o=new Ot,this.transformDstToSrc_o2i=new Ot,this.clipBoundsSrc_o=Et.empty(),this.clipBoundsSrcPad_o=Et.empty(),this.clipBoundsDstPad_o=Et.empty(),this.canvasRect_o=Et.empty(),this.cropRect_o=Et.empty(),this.handles.push(this.p0,this.c0,this.p1,this.c1)}clear(){this.initialize(!0)}initialize(e=!1){if(!t.perspectiveShadow.mutated||!this.isInitialized||e){this.isInitialized=!0;let t=x.M.getBoundingRect_o(),e=x.M.totalRotationAngleRad_o2i(),o=ut.main.getImageCenter_i();t&&(this.p0.p_i.set(t.bottomLeft().rotateInPlace(e,o)),this.c0.p_i.set(t.bottomRight().rotateInPlace(e,o)),this.p1.p_i.set(t.interpolate(1,.4).rotateInPlace(e,o)),this.c1.p_i.set(t.interpolate(1.75,.4).rotateInPlace(e,o)),this.updateGeometry())}}computeQuadsRayShoot(t,e,o){let i=x.M.getBoundingRect_o().pad(t),s=x.M.totalRotationAngleRad_i2o(),r=ut.main.getImageCenter_i(),n=this.p0.p_i.rotate(s,r),a=this.c0.p_i.rotate(s,r),l=this.p1.p_i.rotate(s,r),c=this.c1.p_i.rotate(s,r),p=(a.y-n.y)/(a.x-n.x),u=n.y+p*(i.left-n.x),h=n.y+p*(i.right-n.x);e.p0.setXy(i.left,i.top),e.p1.setXy(i.right,i.top),e.p2.setXy(i.right,h),e.p3.setXy(i.left,u),o&&(o.p0.set(l),o.p1.set(c),o.p2.setXy(i.right,h),o.p3.setXy(i.left,u))}computeQuads(t,e,o){let i=x.M.getBoundingRect_o().pad(t),s=x.M.totalRotationAngleRad_i2o(),r=ut.main.getImageCenter_i(),n=this.p0.p_i.rotate(s,r),a=this.c0.p_i.rotate(s,r),l=this.p1.p_i.rotate(s,r),c=this.c1.p_i.rotate(s,r);e.p0.setXy(n.x,i.top),e.p1.setXy(a.x,i.top),e.p2.set(a),e.p3.set(n),o.p0.set(l),o.p1.set(c),o.p2.set(a),o.p3.set(n)}isValid(){return this.quadDst_i.p0.set(this.p1.p_i),this.quadDst_i.p1.set(this.c1.p_i),this.quadDst_i.p2.set(this.c0.p_i),this.quadDst_i.p3.set(this.p0.p_i),this.quadDst_i.isConvex()&&this.cropRect_o.width()>0&&this.cropRect_o.height()>0}updateGeometry(){if(this.isInitialized){this.computeQuads(0,this.quadSrc_o,this.quadDst_o),this.computeQuadsRayShoot(0,this.quadSrcClip_o,null),this.quadSrcClip_i.set(this.quadSrcClip_o).rotateInPlace(x.M.totalRotationAngleRad_o2i(),ut.main.getImageCenter_i()),this.transformSrcToDst_o.setQuadrilateralToQuadrilateral(this.quadSrc_o,this.quadDst_o),this.transformDstToSrc_o.setQuadrilateralToQuadrilateral(this.quadDst_o,this.quadSrc_o),this.transformDstToSrc_o2i.setRotationAbout(x.M.totalRotationAngleRad_o2i(),ut.main.getImageCenter_i()),this.transformDstToSrc_o2i.timesEquals(this.transformDstToSrc_o),this.transformSrcToDst_o.applyToQuad(this.quadSrcClip_o,this.quadDstClip_o),this.clipBoundsSrc_o.setFrom(Et.fromQuad(this.quadSrcClip_o)),this.clipBoundsSrcPad_o.setFrom(this.clipBoundsSrc_o).pad(n),this.clipBoundsDstPad_o.setNull();let t=this.clipBoundsSrcPad_o.sampleGrid(10,10),e=Pt.empty();for(let o=0;o<t.length;o++)this.transformSrcToDst_o.applyWithGuard(t[o],e)&&this.clipBoundsDstPad_o.addPointSafe(e);this.cropRect_o.fromCropRect(x.M.getCrop_o()).snap(),this.canvasRect_o.setFrom(this.cropRect_o).pad(200).intersectionWith(this.clipBoundsDstPad_o).snap(),this.geometryIsValid=this.isValid()}}drawControls(t){let e=ut.main.getImageCenter_i(),o=x.M.totalRotationAngleRad_o2i();!function(e,o="#0f0"){t.setStrokeStyle(o),t.setGlobalAlpha(1),t.setLineWidth(.25),t.beginPath(),t.moveTo(yt(e.p0.x),yt(e.p0.y)),t.lineTo(yt(e.p1.x),yt(e.p1.y)),t.lineTo(yt(e.p2.x),yt(e.p2.y)),t.lineTo(yt(e.p3.x),yt(e.p3.y)),t.closePath(),t.stroke()}(this.quadDstClip_o.rotate(o,e),"#0f0");t.beginPath();this.p0.p_i.interpolate(this.c0.p_i,.5),this.p1.p_i.interpolate(this.c1.p_i,.5);t.moveTo(yt(this.p0.p_i.x),yt(this.p0.p_i.y)),t.lineTo(yt(this.c0.p_i.x),yt(this.c0.p_i.y)),t.moveTo(yt(this.p1.p_i.x),yt(this.p1.p_i.y)),t.lineTo(yt(this.c1.p_i.x),yt(this.c1.p_i.y)),t.setGlobalAlpha(1),t.setLineWidth(4),t.setStrokeStyle("#000"),t.stroke(),t.setLineWidth(2),t.setStrokeStyle(this.geometryIsValid?"#0F0":"#F00"),t.stroke();this.drawHandles(t)}decode(t){t&&(t.p0&&this.p0.p_i.set(t.p0),t.c0&&this.c0.p_i.set(t.c0),t.p1&&this.p1.p_i.set(t.p1),t.c1&&this.c1.p_i.set(t.c1),t.isInitialized&&(this.isInitialized=!0),this.updateGeometry())}encode(){return{isInitialized:this.isInitialized,p0:this.p0.p_i.dup(),c0:this.c0.p_i.dup(),p1:this.p1.p_i.dup(),c1:this.c1.p_i.dup()}}}class xt extends kt{constructor(t,e,o,i,s=1){super(t,e,s),this.p_i=t,this.perspective=e,this.isControlPoint=o,this.children=i}draw(t,e,o,i){this.isControlPoint?function(t,e,o,i,s,r,n){let a=yt(o),l=yt(i);t.fillSquare(a,l,6*n,"#000"),t.fillSquare(a,l,6*n-1,e?r:s)}(t,e,this.getX(),this.getY(),"#0F0","#080",this.handleRadiusScale):qt(t,e,this.getX(),this.getY(),"#0F0","#080",this.handleRadiusScale)}translate(e){t.perspectiveShadow.mutated=!0,this.p_i.plusEquals(e);for(let t=0;t<this.children.length;t++)this.children[t].translate(e);this.perspective.updateGeometry()}mouseDrag(t){this.translate(t.dup().plusEquals(this.dp_i).minus(this.p_i))}}class Tt extends l{constructor(){super(...arguments),this.polyLine=new zt([]),this.candidatePoint=null}getPolyLine_o(t){return this.polyLine.rotateAndOffsetY(-x.M.totalRotationAngleRad_o2i(),ut.main.getImageCenter_i(),.5*t)}isEmpty(){return 0==this.handles.length}nonEmpty(){return this.handles.length>0}clear(){this.handles.length=0,this.updatePolyLine()}hitShadow(t){this.updateLocalCoords(t);let e=this.polyLine.snapTo(t);return null!=e&&(this.candidatePoint=yt(e.distance)<Tt.MaxDistance_c?e:null),!0}add(t){let e=new _t(t,this);return this.handles.push(e,e.deleteHandle),this.updatePolyLine(),je(),e}remove(t){let e=this.handles.indexOf(t);-1!=e&&(O.push(),this.handles.splice(e,2)),this.isEmpty()&&Ie(!1,!0),this.updatePolyLine(),je()}getMirrorHandles(){return this.handles.filter(t=>t instanceof _t)}updatePolyLine(){if(this.handles.length>0){let t=-x.M.totalRotationAngleRad_o2i(),e=ut.subViewPort.getImageCenter_i(),o=Math.sin(t),i=Math.cos(t),s=new Yt,r=[];this.getMirrorHandles().forEach(t=>{let e=t.getV();s.contains(e.x)||(r.push(e),s.put(e.x,e))}),r.sort((function(t,e){return i*t.x-o*t.y-(i*e.x-o*e.y)}));let n=x.M.getCrop_o(),a=r[0],l=r[r.length-1],c=a.rotate(t,e),p=l.rotate(t,e);c.x=n.left0,p.x=n.right0,r.unshift(c.rotate(-t,e)),r.push(p.rotate(-t,e)),this.polyLine.points=r}else this.polyLine.points=[]}drawControls(t){if(this.polyLine.nonEmpty()){t.setGlobalAlpha(1),t.setLineWidth(4),t.setStrokeStyle("#000"),t.beginPath();let e=this.polyLine.head();t.moveTo(yt(e.x),yt(e.y)),this.polyLine.points.forEach(e=>t.lineTo(yt(e.x),yt(e.y))),t.stroke(),t.setLineWidth(2),t.setStrokeStyle("#F0F"),t.stroke()}if(this.drawHandles(t),null==w.handle&&null!=this.candidatePoint){let e=this.candidatePoint;t.setGlobalAlpha(.4),qt(t,!1,e.pp.x,e.pp.y,"#F0F","#F0F",1),t.setGlobalAlpha(1)}}decode(t){this.clear(),t&&t.forEach(t=>this.add(Pt.from(t)))}encode(){return this.getMirrorHandles().map(t=>t.getV())}}Tt.MaxDistance_c=6;class _t extends kt{constructor(t,e,o=1){super(t,e,o),this.p_i=t,this.mirror=e,this.deleteHandle=new Dt(this)}hitTest(){let t=this.getHitRadius_i(),e=Math.sqrt(P.sqr(this.container.xr-this.getX())+P.sqr(this.container.yr-this.getY()));return this.deleteHandle.isVisible=e<3.5*t,e<t}draw(t,e,o,i){qt(t,e,this.getX(),this.getY(),"#F0F","#80F",this.handleRadiusScale)}mouseDrag(e){super.mouseDrag(e),t.mirrorShadow.mutated=!0,this.mirror.updatePolyLine()}}class Dt extends At{constructor(t,e=1){super(t.container,e),this.parentHandle=t,this.isVisible=!1}getX(){return this.parentHandle.getX()+e*this.getHitRadius_i()}getY(){return this.parentHandle.getY()-e*this.getHitRadius_i()}draw(t,e,o,i){let s=yt(this.getX()),r=yt(this.getY());t.fillCircle(s,r,6,e?ut.SwordActiveRed:ut.SwordInactiveRed);let n=6*.8/Math.sqrt(2);t.strokeLine(s-n,r-n,s+n,r+n,1,e?"#FFF":"#DDD"),t.strokeLine(s+n,r-n,s-n,r+n)}mouseUp(t){this.hitTest()&&this.parentHandle.mirror.remove(this.parentHandle)}}class Ft extends At{constructor(t,e=2){super(t,e),this.dp_i=new Pt(0,0)}getX(){return ot/2+t.dropShadow.offsetX}getY(){return it/2+t.dropShadow.offsetY}mouseDrag(t){let e=new Pt(t.x-ot/2,t.y-it/2).plusEquals(this.dp_i);_e(e.x,e.y)}mouseDown(t){this.mouseDownPos_i=t.dup(),this.mouseDownTime=Date.now(),this.dp_i=this.getV().minus(t)}draw(t,e,o,i){this.drawTranslateHandle(t,e,o,i,"#0FF","#08F")}}class Bt extends kt{constructor(t,e,o=1){super(t,e,o),this.p_i=t,this.polygon=e}draw(t,e,o,i){qt(t,e,this.getX(),this.getY(),"#0FF","#08F",this.handleRadiusScale)}}class Lt extends At{constructor(t,e,o=1){super(t,o),this.ellipse=t,this.name=e,this.dp_i=new Pt(0,0)}getV(){let t=this.getX(),e=this.getY();return new Pt(this.ellipse.center.x+this.ellipse.derotateX(t,e),this.ellipse.center.y+this.ellipse.derotateY(t,e))}hitTest(){return this.ellipse.hitCircle(this.getX(),this.getY(),this.getHitRadius_i())}mouseDown(t){Eo(this.ellipse),this.dp_i=this.getV().minus(t)}}class Gt extends Lt{constructor(t,e,o,i){super(t,e,1),this.sx=o,this.sy=i}getX(){return this.sx*this.ellipse.radiusX_i}getY(){return this.sy*this.ellipse.radiusY_i}mayGrabWhenInvisible(){return!0}draw(t,e,o,i){qt(t,e,this.getX(),this.getY(),this.ellipse.color(),"#F80",this.handleRadiusScale)}mouseDrag(t){this.ellipse.setRect(t.plus(this.dp_i),this.ellipse.oppositeCorner(this).getV())}}class Nt extends Lt{constructor(t){super(t,"sliderCore",1)}getX(){return this.ellipse.radiusX_i*this.ellipse.core}getY(){return 0}hitTest(){let t=this.getX()-lt,e=t+2*lt,o=1.5*-lt,i=1.5*+lt;return t<=this.ellipse.xr&&this.ellipse.xr<=e&&o<=this.ellipse.yr&&this.ellipse.yr<=i}draw(t,e,o,i){t.setGlobalAlpha(1),t.strokeLine(0,0,.999*this.ellipse.radiusX_c(),0,4,"#000"),t.strokeLine(1,0,.999*this.ellipse.radiusX_c()-1,0,2,"#FFF");let s=yt(this.getX())-6;t.setFillStyle("#000"),t.fillRect(s,-9,12,18),t.setFillStyle(e?"#F80":this.ellipse.color()),t.fillRect(s+1,-8,10,16)}mouseDrag(t){if(this.ellipse.radiusX_i>0){let e=t.plus(this.dp_i),o=this.ellipse.rotateX(e.x-this.ellipse.center.x,e.y-this.ellipse.center.y);this.ellipse.core=P.clamp(P.roundTo(o/this.ellipse.radiusX_i,2),0,.999),Io()}}}class Ht extends Lt{constructor(t){super(t,"move",2)}getX(){return 0}getY(){return-this.ellipse.radiusY_i-(ct+lt)}draw(t,e,o,i){this.drawTranslateHandle(t,e,o,i,this.ellipse.color(),"#F80")}mouseDrag(t){let e=this.getV(),o=t.plus(this.dp_i);this.ellipse.center.x+=o.x-e.x,this.ellipse.center.y+=o.y-e.y}}class Vt extends Lt{constructor(t){super(t,"remove",1)}getX(){return+this.ellipse.radiusX_i+e*this.getHitRadius_i()}getY(){return-this.ellipse.radiusY_i-e*this.getHitRadius_i()}draw(t,e,o,i){let s=yt(o),r=yt(i);t.fillCircle(s,r,6,e?ut.SwordActiveRed:ut.SwordInactiveRed);let n=6*.8/Math.sqrt(2);t.strokeLine(s-n,r-n,s+n,r+n,1,e?"#FFF":"#DDD"),t.strokeLine(s+n,r-n,s-n,r+n)}mouseUp(t){if(this.hitTest()){let t=g.indexOf(this.ellipse);t>=0&&(O.push(),d==this.ellipse&&Eo(null),g.splice(t,1),_o(),$o())}}}class Wt extends Lt{constructor(t){super(t,"rotator",2)}getX(){return this.ellipse.radiusX_i+(ct+lt)}getY(){return 0}draw(t,e,o,i){let s=e?"#F80":this.ellipse.color(),r=yt(o),n=yt(i),a=Math.PI/3;t.beginPath(),t.arc(r,n,12,-a,a),t.strokeEx(4,"#000"),t.beginPath();let l=r+12*Math.cos(a),c=12*Math.sin(a);t.triangle(l,n+c,a+Math.PI/2,4,4),t.triangle(l,n-c,-a-Math.PI/2,4,4),t.strokeEx(2,"#000"),t.fillEx(s),t.beginPath(),t.arc(r,n,12,-a,a),t.strokeEx(2,s),qt(t,e,o,i,this.ellipse.color(),"#F80",1)}mouseDrag(t){let e=t.plus(this.dp_i);this.ellipse.setAngleRad(Math.atan2(e.y-this.ellipse.center.y,e.x-this.ellipse.center.x))}}class Xt extends Lt{constructor(t){super(t,"sliderStrength",1)}hitTest(){let t=this.minX_i(),e=t+mt,o=this.ellipse.radiusY_i+ct,i=o+gt;return t<=this.ellipse.xr&&e>=this.ellipse.xr&&o<=this.ellipse.yr&&i>=this.ellipse.yr}minX_i(){return this.ellipse.radiusX_i-mt-lt}minX_c(){return this.ellipse.radiusX_c()-60-6}draw(t,e,o,i){let s=this.minX_c(),r=this.ellipse.radiusY_c()+6;t.setFillStyle("#000"),t.setGlobalAlpha(1),t.fillRect(s-1,r-1,62,16);let n=t.createLinearGradient(s,0,s+60,0);n.addColorStop(0,"#FFF"),n.addColorStop(1,"#000"),t.setFillStyle(n),t.fillRect(s,r,60,14);let a=s+60*this.ellipse.strength;t.strokeLine(a,r-2,a,r+14+2,2,"#C00")}mouseDrag(t){this.ellipse.updateLocalCoords(t),this.ellipse.strength=P.clamp(P.roundTo((this.ellipse.xr-this.minX_i())/mt,2),0,1),Io(),_o()}mouseDown(t){Eo(this.ellipse),this.mouseDrag(t)}}function qt(t,e,o,i,s,r,n){let a=yt(o),l=yt(i);t.fillCircle(a,l,6*n,"#000"),t.fillCircle(a,l,6*n-1,e?r:s)}function Jt(){if(!tt){tt=!0,U=D.CmApp.ShadowApp.DropShadow.UpdatingIndicator.$(),D.CmApp.ShadowApp.close_button.$().click(To),D.CmApp.ShadowApp.ResetButton.$().click(Vo),P.hoverHelper(D.CmApp.ShadowApp.PreviewButton.$(),t=>{rt=t,ut.subViewPort.refreshAllViews()}),D.CmApp.ShadowApp.PreviewButton.$().hide();let i=50;function e(t,e,o,s,r=null){P.mouseDownRepeater(t.$(),o,i,5,O.push,()=>{r&&r(),Wo()}),P.mouseDownRepeater(e.$(),s,i,5,O.push,()=>{r&&r(),Wo()})}function o(t,o,i,s,r=null){e(t.decrease,t.increase,i,s,r),o&&t.reset.$().click(o)}o(D.CmApp.ShadowApp.EllipseShadow.Core,ie,se,re),o(D.CmApp.ShadowApp.EllipseShadow.Strength,Zt,Kt,te),o(D.CmApp.ShadowApp.DropShadow.Opacity,pe,ue,he),o(D.CmApp.ShadowApp.DropShadow.BlurRadius,Se,we,Ce,Pe),D.CmApp.ShadowApp.DropShadow.Enabled.$().click(()=>{ne(!t.dropShadow.enabled,!0)}),D.CmApp.ShadowApp.DropShadow.offset_down_left.$().click(()=>{_e(-2*t.dropShadow.blurRadius,2*t.dropShadow.blurRadius),Wo(),ut.refreshAllViews()}),D.CmApp.ShadowApp.DropShadow.offset_down.$().click(()=>{_e(0,2*t.dropShadow.blurRadius),Wo(),ut.refreshAllViews()}),D.CmApp.ShadowApp.DropShadow.offset_down_right.$().click(()=>{_e(2*t.dropShadow.blurRadius,2*t.dropShadow.blurRadius),Wo(),ut.refreshAllViews()}),D.CmApp.ShadowApp.DropShadow.ArrowControl.zero.$().click(()=>{_e(0,0),Wo(),ut.refreshAllViews()}),e(D.CmApp.ShadowApp.DropShadow.ArrowControl.up,D.CmApp.ShadowApp.DropShadow.ArrowControl.down,xe,Te),e(D.CmApp.ShadowApp.DropShadow.ArrowControl.left,D.CmApp.ShadowApp.DropShadow.ArrowControl.right,ve,Ae),D.CmApp.ShadowApp.DropShadow.crop_enabled.$().click(()=>(ae(!t.dropShadow.cropEnabled,!0),!1)),o(D.CmApp.ShadowApp.MirrorShadow.Opacity,Le,ze,$e),o(D.CmApp.ShadowApp.MirrorShadow.Height,Ne,He,Ve,je),o(D.CmApp.ShadowApp.MirrorShadow.OffsetY,Xe,qe,Je,je),D.CmApp.ShadowApp.MirrorShadow.Enabled.$().click(()=>{Ie(!t.mirrorShadow.enabled,!0)}),o(D.CmApp.ShadowApp.PerspectiveShadow.ShadowOpacity,so,ro,no),o(D.CmApp.ShadowApp.PerspectiveShadow.OpacityScale,co,po,uo,ko),o(D.CmApp.ShadowApp.PerspectiveShadow.BlurRadius,mo,fo,So,ko),o(D.CmApp.ShadowApp.PerspectiveShadow.BlurRadiusScale,yo,bo,vo,ko),D.CmApp.ShadowApp.PerspectiveShadow.Enabled.$().click(()=>{eo(!t.perspectiveShadow.enabled,!0)})}}function Qt(){let t=Po();D.CmApp.ShadowApp.PreviewButton.$().toggle(t.length>0)}function jt(t,e){return t=P.clamp(parseFloat(t.toFixed(2)),0,1),null!=d&&t!=d.strength&&(e&&O.push(),d.strength=t,_o(),Io(),ut.subViewPort.refreshAllViews(),e&&Wo(),!0)}function Zt(){jt(y().strength,!0)}function Kt(){null!=d&&jt(d.strength-.01,!1)}function te(){null!=d&&jt(d.strength+.01,!1)}function oe(t,e){return t=P.clamp(parseFloat(t.toFixed(2)),0,1),null!=d&&t!=d.core&&(e&&O.push(),d.core=t,_o(),Io(),e&&Wo(),ut.subViewPort.refreshAllViews(),!0)}function ie(){oe(y().core,!0)}function se(){null!=d&&oe(d.core-.01,!1)}function re(){null!=d&&oe(d.core+.01,!1)}function ne(e,o){return e!=t.dropShadow.enabled&&(o&&O.push(),t.dropShadow.enabled=e,_o(),De(),Pe(),o&&Wo(),!0)}function ae(e,o){return e!=t.dropShadow.cropEnabled&&(o&&O.push(),t.dropShadow.cropEnabled=e,e&&(f.isEmpty()&&f.fromRect(x.M.getCrop_o()),t.dropShadow.enabled||(t.dropShadow.enabled=!0),B.Grab.pick()),_o(),De(),Pe(),o&&Wo(),!0)}function le(e,o){let i=Math.round(P.clamp(e,0,100));return i!=t.dropShadow.opacity&&(o&&O.push(),t.dropShadow.opacity=i,_o(),De(),o&&Wo(),!0)}function ce(e){le(t.dropShadow.opacity+e|0,!1),ut.subViewPort.refreshAllViews()}function pe(){const e=b();t.dropShadow.opacity!=e.opacity&&(le(e.opacity,!0),ut.subViewPort.refreshAllViews())}function ue(){ce(-1)}function he(){ce(1)}function de(e,i){let s=Math.round(P.clamp(e,0,o));return s!=t.dropShadow.blurRadius&&(i&&O.push(),t.dropShadow.blurRadius=s,_o(),De(),i&&(Pe(),Wo()),!0)}function fe(e){de(t.dropShadow.blurRadius+e|0,!1)}function Se(){const e=b();t.dropShadow.blurRadius!=e.blurRadius&&de(e.blurRadius,!0)}function we(){fe(-1)}function Ce(){fe(1)}function ye(e,o){let i=Math.round(e);return i!=t.dropShadow.offsetX&&(o&&O.push(),t.dropShadow.offsetX=i,_o(),De(),o&&Wo(),!0)}function be(e){ye(t.dropShadow.offsetX+e|0,!1),ut.refreshAllViews()}function ve(){be(-1)}function Ae(){be(1)}function ke(e,o){let i=Math.round(e);return i!=t.dropShadow.offsetY&&(o&&O.push(),t.dropShadow.offsetY=i,_o(),De(),o&&Wo(),!0)}function Me(e){ke(t.dropShadow.offsetY+e|0,!1),ut.refreshAllViews()}function xe(){Me(-1)}function Te(){Me(1)}function _e(e,o){o|=0,(e|=0)==t.dropShadow.offsetX&&o==t.dropShadow.offsetY||(t.dropShadow.offsetX=e,t.dropShadow.offsetY=o,_o(),De())}function De(){const e=b();D.CmApp.ShadowApp.DropShadow.Enabled.$().prop("checked",t.dropShadow.enabled),D.CmApp.ShadowApp.DropShadow.CropEnabled.$().html(t.dropShadow.cropEnabled?p.s("Disable"):p.s("Enable")),D.CmApp.ShadowApp.DropShadow.controls.$().toggle(t.dropShadow.enabled),D.CmApp.ShadowApp.DropShadow.crop_enabled_display.$().html(t.dropShadow.cropEnabled?p.s("On"):p.s("Off"));let o=t.dropShadow.opacity==e.opacity;D.CmApp.ShadowApp.DropShadow.Opacity.display.$().html(t.dropShadow.opacity+"%"),D.CmApp.ShadowApp.DropShadow.Opacity.reset.$().toggleClass("disabled",o);let i=t.dropShadow.blurRadius==e.blurRadius;D.CmApp.ShadowApp.DropShadow.BlurRadius.display.$().html(t.dropShadow.blurRadius+"px"),D.CmApp.ShadowApp.DropShadow.BlurRadius.reset.$().toggleClass("disabled",i),D.CmApp.ShadowApp.DropShadow.offset_display.$().html(P.signedNumber(0|t.dropShadow.offsetX)+", "+P.signedNumber(0|t.dropShadow.offsetY)),Qt()}function Pe(){-1!=ot&&(t.dropShadow.enabled?(F||-1==ot||(M=new ee("DropShadow",null,ge,Ee),T=ot+2*i,R=it+2*i,E=T*R,F=new It(T,R),I=F.context().getImageData(0,0,T,R),L=I.data,z=new Uint8Array(E)),Re()):F&&(F.clearAll(),ut.refreshAllViews()))}function Re(){if(z){U.show();let e=new Uint8ClampedArray(x.M.previewCanvasData),o={w:T,h:R,blurRadius:t.dropShadow.blurRadius,result:e,alphas:z,polygonPoints:t.dropShadow.cropEnabled?f.getPolygonPoints():[]};try{M.postMessage(o,[z.buffer,e.buffer])}catch(t){M.postMessage(o)}z=null,e=null}}function Ee(e){let o=e.data;if(o.exception)throw o.exception;if(z=o.alphas,z){for(let t=0,e=3;t<E;t++,e+=4)L[e]=z[t];F.context().putImageData(I,0,0)}U.hide(),ut.refreshAllViews(),o.blurRadius!=t.dropShadow.blurRadius&&Re()}function Fe(e=!1){if(t.mirrorShadow.enabled&&(!t.mirrorShadow.mutated||G.isEmpty()||e)){let t=x.M.getBoundingRect_o(),e=new Pt((t.left+t.right)/2,t.bottom);e.rotateInPlace(x.M.totalRotationAngleRad_o2i(),ut.main.getImageCenter_i()),G.clear(),G.add(e),_o(),Wo()}}function Ie(e,o){return e!=t.mirrorShadow.enabled&&(o&&O.push(),t.mirrorShadow.enabled=e,Fe(),_o(),Qe(),je(),o&&Wo(),!0)}function Be(e,o){let i=Math.round(P.clamp(e,0,100));return i!=t.mirrorShadow.opacity&&(o&&O.push(),t.mirrorShadow.opacity=i,_o(),Qe(),o&&Wo(),!0)}function Oe(e){Be(t.mirrorShadow.opacity+e|0,!1),ut.subViewPort.refreshAllViews()}function Le(){const e=v();t.mirrorShadow.opacity!=e.opacity&&(Be(e.opacity,!0),ut.subViewPort.refreshAllViews())}function ze(){Oe(-1)}function $e(){Oe(1)}function Ue(e,o){let i=Math.round(P.clamp(e,0,s));return i!=t.mirrorShadow.height&&(o&&O.push(),t.mirrorShadow.height=i,_o(),Qe(),o&&Wo(),!0)}function Ge(e){Ue(t.mirrorShadow.height+e|0,!1)}function Ne(){const e=v();t.mirrorShadow.height!=e.height&&(Ue(e.height,!0),je())}function He(){Ge(-1)}function Ve(){Ge(1)}function We(e,o){let i=Math.round(P.clamp(e,0,r));return i!=t.mirrorShadow.offsetY&&(o&&O.push(),t.mirrorShadow.offsetY=i,_o(),Qe(),o&&Wo(),!0)}function Ye(e){We(t.mirrorShadow.offsetY+e|0,!1)}function Xe(){const e=v();t.mirrorShadow.offsetY!=e.offsetY&&(We(e.offsetY,!0),je())}function qe(){Ye(-1)}function Je(){Ye(1)}function Qe(){const e=v();G.updatePolyLine(),D.CmApp.ShadowApp.MirrorShadow.Enabled.$().prop("checked",t.mirrorShadow.enabled),D.CmApp.ShadowApp.MirrorShadow.controls.$().toggle(t.mirrorShadow.enabled);let o=t.mirrorShadow.opacity==e.opacity;D.CmApp.ShadowApp.MirrorShadow.Opacity.display.$().html(t.mirrorShadow.opacity+"%"),D.CmApp.ShadowApp.MirrorShadow.Opacity.reset.$().toggleClass("disabled",o);let i=t.mirrorShadow.height==e.height;D.CmApp.ShadowApp.MirrorShadow.Height.display.$().html(t.mirrorShadow.height+"px"),D.CmApp.ShadowApp.MirrorShadow.Height.reset.$().toggleClass("disabled",i);let s=t.mirrorShadow.offsetY==e.offsetY;D.CmApp.ShadowApp.MirrorShadow.OffsetY.display.$().html(t.mirrorShadow.offsetY+"px"),D.CmApp.ShadowApp.MirrorShadow.OffsetY.reset.$().toggleClass("disabled",s),Qt()}function je(){-1!=ot&&(t.mirrorShadow.enabled&&G.nonEmpty()?(!function(){N||-1==ot||(N=new ee("MirrorShadow",null,me,Ke)),G.updatePolyLine();let e=x.M.getRotationCrop_o().pad(20),o=G.getPolyLine_o(t.mirrorShadow.offsetY).bounds().padBottom(t.mirrorShadow.height);if(H=o.dup().setHorizontal(e).snap(),!V||V.width()<H.width()||V.height()<H.height()){let t=Math.ceil(1.2*H.width()),e=Math.ceil(1.2*H.height());V=new It(t,e)}}(),Ze()):V&&(V.clearAll(),ut.refreshAllViews()))}function Ze(){if(V&&G&&G.nonEmpty())if(W.outOfSync())W.callFor();else{W.incrementIndexSentAndShowIndicator();let e=G.getPolyLine_o(t.mirrorShadow.offsetY),o={w:H.width(),h:H.height()},i={imageSize:{w:ot,h:it},imageCenter:{x:ot/2,y:it/2},bufferSize:o,result:new Uint8ClampedArray(x.M.previewCanvasImageDataSmart().data),bounds_o:H,points:e.points,angleRad:x.M.totalRotationAngleRad_o2i(),height:t.mirrorShadow.height,index:W.indexSent};try{N.postMessage(i,[i.result.buffer])}catch(t){N.postMessage(i)}}}function Ke(t){let e=t.data;if(e.exception)throw e.exception;{W.setIndexReceived(e.index);let t=V.context().createImageData(e.bufferSize.w,e.bufferSize.h);for(let o=0;o<e.buffer.length;o++)t.data[o]=e.buffer[o];V.clearAll(),V.context().putImageData(t,0,0),ut.refreshAllViews(),W.readyToResubmit()&&(W.resetCalledFor(),Ze())}}function to(e=!1){!t.perspectiveShadow.enabled||t.perspectiveShadow.mutated&&X.isInitialized&&!e||(X.initialize(e),_o(),Wo())}function eo(e,o){return e!=t.perspectiveShadow.enabled&&(o&&O.push(),t.perspectiveShadow.enabled=e,to(),_o(),Ao(),ko(),o&&Wo(),!0)}function oo(e,o){let i=Math.round(P.clamp(e,0,100));return i!=t.perspectiveShadow.opacity&&(o&&O.push(),t.perspectiveShadow.opacity=i,_o(),Ao(),o&&Wo(),!0)}function io(e){oo(t.perspectiveShadow.opacity+e|0,!1)}function so(){oo(A().opacity,!0)}function ro(){io(-1)}function no(){io(1)}function ao(e,o){let i=Math.round(P.clamp(e,0,100));return i!=t.perspectiveShadow.opacityScale&&(o&&O.push(),t.perspectiveShadow.opacityScale=i,_o(),Ao(),o&&(Wo(),ko()),!0)}function lo(e){ao(t.perspectiveShadow.opacityScale+e|0,!1),ut.subViewPort.refreshAllViews()}function co(){ao(A().opacityScale,!0)}function po(){lo(-1)}function uo(){lo(1)}function ho(e,i){let s=Math.round(P.clamp(e,0,o));return s!=t.perspectiveShadow.blurRadius&&(i&&O.push(),t.perspectiveShadow.blurRadius=s,_o(),Ao(),i&&(Wo(),ko()),!0)}function go(e){ho(t.perspectiveShadow.blurRadius+e|0,!1),ut.subViewPort.refreshAllViews()}function mo(){ho(A().blurRadius,!0)}function fo(){go(-1)}function So(){go(1)}function wo(e,o){let i=Math.round(P.clamp(e,0,1e3));return i!=t.perspectiveShadow.blurRadiusScale&&(o&&O.push(),t.perspectiveShadow.blurRadiusScale=i,_o(),Ao(),o&&(Wo(),ko()),!0)}function Co(e){wo(t.perspectiveShadow.blurRadiusScale+e|0,!1),ut.subViewPort.refreshAllViews()}function yo(){wo(A().blurRadiusScale,!0)}function bo(){Co(-10)}function vo(){Co(10)}function Ao(){const e=A();X.updateGeometry(),D.CmApp.ShadowApp.PerspectiveShadow.Enabled.$().prop("checked",t.perspectiveShadow.enabled),D.CmApp.ShadowApp.PerspectiveShadow.controls.$().toggle(t.perspectiveShadow.enabled);let o=t.perspectiveShadow.opacity==e.opacity;D.CmApp.ShadowApp.PerspectiveShadow.ShadowOpacity.display.$().html(t.perspectiveShadow.opacity+"%"),D.CmApp.ShadowApp.PerspectiveShadow.ShadowOpacity.reset.$().toggleClass("disabled",o);let i=t.perspectiveShadow.opacityScale==e.opacityScale;D.CmApp.ShadowApp.PerspectiveShadow.OpacityScale.display.$().html(t.perspectiveShadow.opacityScale+"%"),D.CmApp.ShadowApp.PerspectiveShadow.OpacityScale.reset.$().toggleClass("disabled",i);let s=t.perspectiveShadow.blurRadius==e.blurRadius;D.CmApp.ShadowApp.PerspectiveShadow.BlurRadius.display.$().html(t.perspectiveShadow.blurRadius+"px"),D.CmApp.ShadowApp.PerspectiveShadow.BlurRadius.reset.$().toggleClass("disabled",s);let r=t.perspectiveShadow.blurRadiusScale==e.blurRadiusScale;D.CmApp.ShadowApp.PerspectiveShadow.BlurRadiusScale.display.$().html(t.perspectiveShadow.blurRadiusScale+"%"),D.CmApp.ShadowApp.PerspectiveShadow.BlurRadiusScale.reset.$().toggleClass("disabled",r),Qt()}function ko(){t.perspectiveShadow.enabled&&X&&X.geometryIsValid?(X.updateGeometry(),function(){Y||-1==ot||(Y=new ee("PerspectiveShadow",[window.Globals.webWorkers.perspectiveshadow_js],null,xo),q=ot+2*i,J=it+2*i);let t=X.canvasRect_o;(!j||j.width()<t.width()||j.height()<t.height())&&(j=new It(t.width()+100,t.height()+100))}(),Mo(),ut.subViewPort.refreshAllViews()):j&&(j.clearAll(),ut.subViewPort.refreshAllViews())}function Mo(){if(Y&&X)if(K.outOfSync())K.callFor();else{K.incrementIndexSentAndShowIndicator();let e=new Uint8ClampedArray(x.M.previewCanvasData),i={w_i:ot,h_i:it,angleRad_i2o:x.M.totalRotationAngleRad_i2o(),cropRect_o:X.cropRect_o,canvasRect_o:X.canvasRect_o,transformDstToSrc_o:X.transformDstToSrc_o,blurRadiusStart:t.perspectiveShadow.blurRadius,blurRadiusEnd:Math.min(t.perspectiveShadow.blurRadius*t.perspectiveShadow.blurRadiusScale/100,o),opacityEnd:t.perspectiveShadow.opacityScale/100,result:e,clipPoints_i:X.quadSrcClip_i.points,clipRect_o:X.clipBoundsSrc_o,index:K.indexSent};try{Y.postMessage(i,[i.result.buffer])}catch(t){Y.postMessage(i)}e=null}}function xo(t){let e=t.data;if(e.exception)throw e.exception;if(K.setIndexReceived(e.index),Z.setFrom(e.dstRect),0!=Z.width()&&0!=Z.height()){j.clearAll();let t=j.context().createImageData(Z.width(),Z.height());for(let o=0,i=3;o<e.alphas.length;o++,i+=4)t.data[i]=e.alphas[o];j.context().putImageData(t,0,0)}ut.refreshAllViews(),K.readyToResubmit()&&(K.resetCalledFor(),Mo())}function To(){D.CmApp.ShadowApp.Sidebar.$().hide(),D.SubappLightbox.$().modal("hide"),et=ut.subViewPort.showing=!1,t.onhide(),x.App.subAppHidden()}function _o(){nt=null,at=!0}function Do(){et&&(De(),Qe(),Ao(),Io(),Qt())}function Po(){let e=[].concat(g);return t.dropShadow.enabled&&(e=e.concat(f.loops),e.push(m)),t.perspectiveShadow.enabled&&e.push(X),t.mirrorShadow.enabled&&e.push(G),e}function Ro(t){lt=bt(6),ct=bt(6),ht=bt(6),gt=bt(14),mt=bt(60),ft=bt(30),St=bt(30),wt=bt(26),Ct=bt(12);let e=ut.subViewPort.getMouse_i();if(B.getSelectedMode()==B.Grab){let o=[],i=Po();for(let t=0;t<i.length;t++){let s=i[t];s.hitShadow(e)&&o.push(s)}let s=null,r=null;for(let t=0;t<o.length;t++){let e=o[t];if(r=e.hitHandle(),r){s=e;break}}let n=o.filter(t=>t instanceof vt).reverse();return Bo(o,s,r,n.length>0?a.cast(n[0]):null,t),r||null==G.candidatePoint?r?r.getToolMode():null:B.ShadowMirror}return Oo(),null}function Eo(t){d=t,Io()}function Fo(t,e,o,i,s){t.decrease.$().toggleClass("disabled",e==i),t.increase.$().toggleClass("disabled",e==s),t.reset.$().toggleClass("disabled",e==o)}function Io(){let t=y(),e=d,o=null!=e;D.CmApp.ShadowApp.EllipseShadow.Container.$().toggle(o),o&&(Fo(D.CmApp.ShadowApp.EllipseShadow.Strength,e.strength,t.strength,0,1),Fo(D.CmApp.ShadowApp.EllipseShadow.Core,e.core,t.core,0,1),D.CmApp.ShadowApp.EllipseShadow.Strength.display.$().text((100*e.strength).toFixed(0)+"%"),D.CmApp.ShadowApp.EllipseShadow.Core.display.$().text((100*e.core).toFixed(0)+"%"))}function Bo(t,e,o,i,s){C=w,w={shadows:t,shadow:e,handle:o,ellipse:i,interactionIdentifier:s}}function Oo(){Bo([],null,null,null,void 0)}function Lo(){S.downState=$.extend({},w),S.downState.toolMode=B.getActiveMode()}function zo(t,e,o){let i=ut.subViewPort.getMouse_i();if(ut.subViewPort.getMouseIsDown()){if(B.is(B.ShadowEllipse)){S.firstMove&&O.push();let t=new vt(new Pt(0,0),0,0,x.M.totalRotationAngleRad_o2i(),y().strength,y().core);t.setRect(S.v0,i),g.push(t),Eo(t),_o(),B.forceSelection(B.Grab,B.ShadowArrow,null),Bo([t],t,t.bottomRight,t,void 0),Lo()}else if(S.downState&&S.downState.handle&&B.is(S.downState.handle.getToolMode())){S.firstMove&&O.push(),S.downState.handle.mouseDrag(i),_o()}S.firstMove=!1}else if(!ut.subViewPort.getShiftIsDown()){let t=Ro(void 0);B.setTempSelect(t)}ut.subViewPort.refreshAllViews()}function $o(){S.v0=null,S.v2=null,S.downState=null,S.firstMove=!0}function Uo(t){return t&&(t.container instanceof c||t.container instanceof u||t.container instanceof Mt||t.container instanceof vt&&C.shadows.indexOf(t.container)>=0||t instanceof Dt&&(t.parentHandle==C.handle||t==C.handle))}function Go(t){return Uo(t)||t&&t.mayGrabWhenInvisible()}function No(e,o,i){function s(t,i,s,r){e.save(),e.translate(o.o2cX(i),o.o2cY(s)),e.rotate(t),r(),e.restore()}let r=B.getSelectedMode();if(r==B.Grab||r==B.ShadowEllipse){t.mirrorShadow.enabled&&s(0,0,0,(function(){i(G)})),t.perspectiveShadow.enabled&&s(0,0,0,(function(){i(X)}));for(let t=0;t<g.length;t++){let e=g[t];s(e.angleRad,e.center.x,e.center.y,(function(){i(e)}))}if(t.dropShadow.enabled&&(s(0,0,0,(function(){i(m)})),t.dropShadow.cropEnabled))for(let t=0;t<f.loops.length;t++){let e=f.loops[t];s(0,0,0,(function(){i(e)}))}}}function Ho(t,e){return null==t?e:t}function Vo(e=!0){const o=b(),i=v(),s=A();let r=g.length>0||t.dropShadow.offsetX!=o.offsetX||t.dropShadow.offsetY!=o.offsetY||t.dropShadow.opacity!=o.opacity||t.dropShadow.blurRadius!=o.blurRadius||t.dropShadow.enabled!=o.enabled||t.dropShadow.cropEnabled!=o.cropEnabled||t.mirrorShadow.enabled!=i.enabled||t.mirrorShadow.opacity!=i.opacity||t.mirrorShadow.height!=i.height||t.mirrorShadow.offsetY!=i.offsetY||G.nonEmpty()||t.perspectiveShadow.enabled!=s.enabled||t.perspectiveShadow.opacity!=s.opacity||t.perspectiveShadow.opacityScale!=s.opacityScale||t.perspectiveShadow.blurRadius!=s.blurRadius||t.perspectiveShadow.blurRadiusScale!=s.blurRadiusScale;r&&e&&O.push(),g.length>0&&(g.length=0),t.dropShadow.offsetX=o.offsetX,t.dropShadow.offsetY=o.offsetY,t.dropShadow.opacity=o.opacity,t.dropShadow.blurRadius=o.blurRadius,t.dropShadow.enabled=o.enabled,t.dropShadow.cropEnabled=o.cropEnabled,f.clear(),t.mirrorShadow.enabled=i.enabled,t.mirrorShadow.opacity=i.opacity,t.mirrorShadow.height=i.height,t.mirrorShadow.offsetY=i.offsetY,t.mirrorShadow.mutated=!1,G.clear(),t.perspectiveShadow.enabled=s.enabled,t.perspectiveShadow.opacity=s.opacity,t.perspectiveShadow.opacityScale=s.opacityScale,t.perspectiveShadow.blurRadius=s.blurRadius,t.perspectiveShadow.blurRadiusScale=s.blurRadiusScale,t.perspectiveShadow.mutated=!1,X.clear(),r&&(_o(),Wo(),De(),Qe(),Ao(),Pe(),je(),ko()),t.mirrorShadow.enabled&&Fe(!0),t.perspectiveShadow.enabled&&to(!0),B.Grab.pick()}function Wo(){at&&(at=!1,x.M.sendSetShadows())}t.updateImage=function(){ot=0|x.M.imageSize.w,it=0|x.M.imageSize.h,st=ot*it,g.length=0,t.dropShadow=$.extend(!0,{},b()),t.mirrorShadow=$.extend(!0,{},v()),t.perspectiveShadow=$.extend(!0,{},A()),F=null,G=new Tt,X=new Mt,m=new c,Jt(),Fe(),to(),Pe(),je(),ko()},t.checkInitializeUi=Jt,t.show=function(){B.Grab.pick(),D.subapp_sidebar.$().hide(),D.CmApp.ShadowApp.Sidebar.$().show(),D.CmApp.SubApps.tab.$().removeClass("active"),D.CmApp.ShadowApp.Tab.$().addClass("active"),P.modal(D.SubappLightbox.css()),ut.subViewPort.setViewConfigAndShow(h,t),et=!0,Do(),ut.refreshAllViews()},t.setEllipseShadowStrength=jt,t.setEllipseShadowCore=oe,t.setDropShadowEnabled=ne,t.setDropShadowCropEnabled=ae,t.setDropShadowOpacity=le,t.dropShadowOpacityReset=pe,t.dropShadowOpacityDecrement=ue,t.dropShadowOpacityIncrement=he,t.setDropShadowBlurRadius=de,t.dropShadowBlurRadiusReset=Se,t.dropShadowBlurRadiusDecrement=we,t.dropShadowBlurRadiusIncrement=Ce,t.setDropShadowOffsetX=ye,t.dropShadowOffsetXReset=function(){const e=b();t.dropShadow.offsetX!=e.offsetX&&ye(e.offsetX,!0)},t.dropShadowOffsetXDecrement=ve,t.dropShadowOffsetXIncrement=Ae,t.setDropShadowOffsetY=ke,t.dropShadowOffsetYReset=function(){const e=b();t.dropShadow.offsetY!=e.offsetY&&ke(e.offsetY,!0)},t.dropShadowOffsetYDecrement=xe,t.dropShadowOffsetYIncrement=Te,t.setDropShadowOffset=_e,t.dropShadowOffsetReset=function(){const e=b();t.dropShadow.offsetX==e.offsetX&&t.dropShadow.offsetY==e.offsetY||(O.push(),_e(e.offsetX,e.offsetY),Wo())},t.updateDropShadowCanvas=Pe,t.initializeMirrorShadow=Fe,t.setMirrorShadowEnabled=Ie,t.setMirrorShadowOpacity=Be,t.mirrorShadowOpacityReset=Le,t.mirrorShadowOpacityDecrement=ze,t.mirrorShadowOpacityIncrement=$e,t.setMirrorShadowHeight=Ue,t.mirrorShadowHeightReset=Ne,t.mirrorShadowHeightDecrement=He,t.mirrorShadowHeightIncrement=Ve,t.setMirrorShadowOffsetY=We,t.mirrorShadowOffsetYReset=Xe,t.mirrorShadowOffsetYDecrement=qe,t.mirrorShadowOffsetYIncrement=Je,t.updateMirrorShadowCanvas=je,t.initializePerspectiveShadow=to,t.setPerspectiveShadowEnabled=eo,t.setPerspectiveShadowOpacity=oo,t.perspectiveShadowOpacityReset=so,t.perspectiveShadowOpacityDecrement=ro,t.perspectiveShadowOpacityIncrement=no,t.setPerspectiveShadowOpacityScale=ao,t.perspectiveShadowOpacityScaleReset=co,t.perspectiveShadowOpacityScaleDecrement=po,t.perspectiveShadowOpacityScaleIncrement=uo,t.setPerspectiveShadowBlurRadius=ho,t.perspectiveShadowBlurRadiusReset=mo,t.perspectiveShadowBlurRadiusDecrement=fo,t.perspectiveShadowBlurRadiusIncrement=So,t.setPerspectiveShadowBlurRadiusScale=wo,t.perspectiveShadowBlurRadiusScaleReset=yo,t.perspectiveShadowBlurRadiusScaleDecrement=bo,t.perspectiveShadowBlurRadiusScaleIncrement=vo,t.updatePerspectiveShadowCanvas=ko,t.hide=To,t.keyDownHandler=function(t){if(t.ctrlKey||t.altKey||t.metaKey)return!1;switch(t.keyCode){case 27:if(dt.hide())break;To();break;case 69:B.select(B.ShadowEllipse)}return!0},t.keyUpHandler=function(t){return!(t.ctrlKey||t.altKey||t.metaKey)&&(t.keyCode,!0)},t.updateDisplay=Do,t.mouseDownHandler=function(e){let o=ut.subViewPort.getMouse_i();if($o(),B.isNot(B.Grab)&&0==e)if(S.v0=o,Lo(),S.downState&&S.downState.handle)S.downState.handle.mouseDown(o);else if(null!=G.candidatePoint){let e=G.add(o);t.mirrorShadow.mutated=!0,S.downState.handle=e,S.downState.toolMode=B.ShadowArrow,B.forceSelection(B.Grab,B.ShadowArrow,null),G.candidatePoint=null,w.handle=e,e.mouseDown(o)}B.is(B.Grab)&&Eo(w.ellipse)},t.mouseMoveHandler=zo,t.mouseUpHandler=function(t){let e=ut.subViewPort.getMouse_i();S.downState&&S.downState.handle instanceof Bt&&Pe(),S.downState&&S.downState.handle instanceof _t&&je(),S.downState&&S.downState.handle instanceof xt&&ko(),S.downState&&S.downState.handle&&S.downState.handle.mouseUp(e),$o(),Wo()},t.mouseDoubleClickHandler=function(t){},t.touchEndHandler=function(){B.setTempSelect(Ro(void 0))},t.mouseWheelHandler=function(t){zo(t.pageX,t.pageY,t.button)},t.pointerInteraction=function(e){let o=ut.subViewPort.getMouse_i();switch(e.type){case pt.InteractionType.CanvasLeave:B.releaseTempSelect();break;case pt.InteractionType.Hover:if(!ut.subViewPort.getShiftIsDown()){let t=Ro(e.interactionIdentifier);B.setTempSelect(t),e.isTouch&&B.is(B.Grab)&&Eo(w.ellipse)}ut.subViewPort.refreshAllViews();break;case pt.InteractionType.Tap:Uo(w.handle)&&(w.handle.mouseDown(o),w.handle.mouseUp(o));break;case pt.InteractionType.ActionStart:if($o(),B.isNot(B.Grab))if(S.v0=o,Go(w.handle))Lo(),S.downState&&S.downState.handle&&S.downState.handle.mouseDown(o);else if(null!=G.candidatePoint){Lo();let e=G.add(o);t.mirrorShadow.mutated=!0,S.downState.handle=e,S.downState.toolMode=B.ShadowArrow,B.forceSelection(B.Grab,B.ShadowArrow,null),G.candidatePoint=null,w.handle=e,e.mouseDown(o)}B.is(B.Grab)&&Eo(w.ellipse);break;case pt.InteractionType.ActionMove:if(B.is(B.ShadowEllipse)){S.firstMove&&O.push();let t=new vt(new Pt(0,0),0,0,x.M.totalRotationAngleRad_o2i(),y().strength,y().core);t.setRect(S.v0,o),g.push(t),Eo(t),_o(),B.forceSelection(B.Grab,B.ShadowArrow,null),Bo([t],t,t.bottomRight,t,e.interactionIdentifier),Lo()}else if(S.downState&&S.downState.handle&&B.is(S.downState.handle.getToolMode())){S.firstMove&&O.push(),S.downState.handle.mouseDrag(o),_o()}S.firstMove=!1,ut.subViewPort.refreshAllViews();break;case pt.InteractionType.ActionEnd:S.downState&&S.downState.handle instanceof Bt&&Pe(),S.downState&&S.downState.handle instanceof _t&&je(),S.downState&&S.downState.handle instanceof xt&&ko(),S.downState&&S.downState.handle&&Go(S.downState.handle)&&(Ro(e.interactionIdentifier),S.downState.handle.mouseUp(o)),$o(),Wo();break;case pt.InteractionType.PanZoom:Oo()}},t.drawUnder_c=function(e,o,i,s){t.mirrorShadow.enabled&&V&&H&&W.inSync()&&s(V,t.mirrorShadow.opacity/100,H.left,H.top),X&&t.perspectiveShadow.enabled&&s(j,t.perspectiveShadow.opacity/100,Z.left,Z.top)},t.drawOver_c=function(t,e){},t.drawUnder_i=function(e,o,s,r){No(o,s,(function(t){t.drawShadow(o,s)})),t.dropShadow.enabled&&r(F,t.dropShadow.opacity/100,t.dropShadow.offsetX-i,t.dropShadow.offsetY-i)},t.drawOver_i=function(t,e){rt||No(e,ut.subViewPort,(function(t){t.drawControls(e)}))},t.encode=function(){if(null!=nt)return nt;let e=[];for(let t=0;t<g.length;t++)e[t]=g[t].encode();let o=f.encode();return nt={ellipses:e,dropShadow:{offsetX:t.dropShadow.offsetX,offsetY:t.dropShadow.offsetY,opacity:0|t.dropShadow.opacity,blurRadius:0|t.dropShadow.blurRadius,enabled:t.dropShadow.enabled,cropEnabled:t.dropShadow.cropEnabled,dropShadowClipPolygon:o},mirrorShadow:{enabled:t.mirrorShadow.enabled,opacity:t.mirrorShadow.opacity,height:t.mirrorShadow.height,offsetY:t.mirrorShadow.offsetY,mutated:t.mirrorShadow.mutated,points:G.encode()},perspectiveShadow:{enabled:t.perspectiveShadow.enabled,opacity:t.perspectiveShadow.opacity,opacityScale:t.perspectiveShadow.opacityScale,blurRadius:t.perspectiveShadow.blurRadius,blurRadiusScale:t.perspectiveShadow.blurRadiusScale,mutated:t.perspectiveShadow.mutated,geometry:X.encode()}},nt},t.decode=function(e){const o=b(),i=v(),s=A();nt=e,g.length=0;try{if(e){if(e.ellipses){for(let t=0;t<e.ellipses.length;t++){let o=e.ellipses[t];g.push(new vt(new Pt(o.centerX_i,o.centerY_i),o.radiusX_i,o.radiusY_i,o.angleRad,o.strength,o.core))}Eo(null),Io()}if(e.dropShadow){let i=e.dropShadow,s=t.dropShadow.blurRadius,r=t.dropShadow.cropEnabled;t.dropShadow.offsetX=Ho(i.offsetX,o.offsetX),t.dropShadow.offsetY=Ho(i.offsetY,o.offsetY),t.dropShadow.opacity=Ho(i.opacity,o.opacity),t.dropShadow.blurRadius=Ho(i.blurRadius,o.blurRadius),t.dropShadow.enabled=Ho(i.enabled,o.enabled),t.dropShadow.cropEnabled=Ho(i.cropEnabled,o.cropEnabled),i.dropShadowClipPolygon&&f.decode(i.dropShadowClipPolygon),De(),s==i.blurRadius&&r==i.cropEnabled||Pe()}if(e.mirrorShadow){let o=e.mirrorShadow;t.mirrorShadow.enabled=Ho(o.enabled,i.enabled),t.mirrorShadow.opacity=Ho(o.opacity,i.opacity),t.mirrorShadow.height=Ho(o.height,i.height),t.mirrorShadow.offsetY=Ho(o.offsetY,i.offsetY),t.mirrorShadow.mutated=Ho(o.mutated,t.mirrorShadow.enabled),G.decode(o.points)}if(Qe(),je(),e.perspectiveShadow){let o=e.perspectiveShadow;t.perspectiveShadow.enabled=Ho(o.enabled,s.enabled),t.perspectiveShadow.opacity=Ho(o.opacity,s.opacity),t.perspectiveShadow.opacityScale=Ho(o.opacityScale,s.opacityScale),t.perspectiveShadow.blurRadius=Ho(o.blurRadius,s.blurRadius),t.perspectiveShadow.blurRadiusScale=Ho(o.blurRadiusScale,s.blurRadiusScale),t.perspectiveShadow.mutated=Ho(o.mutated,t.perspectiveShadow.enabled),X.decode(o.geometry)}Ao(),ko()}}catch(t){}Oo()},t.clear=Vo}(ht||(ht={})),function(t){x.StickySettings=t;var e=!1;function o(t){return'<div class="background-color-swatch-container"><span class="background-color-swatch swatch popover-button-label checker-svg" style="position:absolute;"></span><span class="background-color-swatch swatch popover-button-label" id="background-color-current-swatch" style="position: relative; background-color: '+t+';"></span></div>'}t.backgroundSwatch=o;class i{constructor(t,e,o=0,i,s=[],r=!1,n=0){this.key=t,this.css=e,this.format=o,this.setter=i,this.translateEnum=r,this.settingsContainer=n,this.cachedCurrent=null,this.cachedSticky=null,this.cachedFactory=null,this.currentEqualSticky=!1,this.currentEqualFactory=!1,this.currentEqualDefault=!1,this.stickyEqualFactory=!1,this.defaultEqualFactory=!1,this.hash=Yt.from(s)}main(){switch(this.settingsContainer){case 0:return at.settings;case 1:return ht.getSelectedEllipseShadow();case 2:return ht.dropShadow;case 3:return ht.mirrorShadow;case 4:return ht.perspectiveShadow}}consolidated(t){switch(this.settingsContainer){case 0:return t;case 1:return t.ellipseShadow;case 2:return t.dropShadow;case 3:return t.mirrorShadow;case 4:return t.perspectiveShadow}}default(){return this.consolidated(at.defaultSettings)}sticky(){return this.consolidated(at.stickySettings)}factory(){return this.consolidated(_.FactoryDefaults)}display(t){return null==t||null==t?9==this.format||8==this.format?p.s("Unchanged"):10==this.format?this.displayInner(t):"":this.displayInner(t)}displayInner(t){switch(this.format){case 0:return""+t;case 1:return t+"px";case 2:return t+" megapixels";case 12:return t+" DPI";case 3:return t?p.s("On"):p.s("Off");case 4:return t?p.s("Smart"):p.s("Fixed");case 11:return(100*a.cast(t)).toFixed(0)+"%";case 5:return t+"%";case 6:return parseInt(""+t)/10+"%";case 7:let s=this.hash.getOrElse(t,"");return this.translateEnum&&(s=p.s(s)),s;case 8:var e=a.cast(t);return P.toFixed(e.w,3)+":"+P.toFixed(e.h,3);case 9:var i=a.cast(t);return i.w.toFixed(0)+" x "+i.h.toFixed(0)+"px";case 10:return o(t?t.toString():_.TransparentColor);default:return""+t}}getCurrentDisplay(){return this.display(this.getCurrent())}getDefaultDisplay(){return this.display(this.getDefault())}getDisplay(t){return t?this.getDefaultDisplay():this.getCurrentDisplay()}getSummaryEnabledDisplay(t){const e=this.getCurrent(),o=this.getDefault(),i=e?p.s("{0} enabled",t):p.s("{0} disabled",t);return e!=o?`<b>${i}</b>`:i}getSummaryDisplay(t=""){const e=this.getDisplay(!1).toLowerCase(),o=this.getDisplay(!0).toLowerCase(),i=0==t.length?e:p.s("{0} "+t,e);return e!=o?`<b>${i}</b>`:i}getFrom(t){return a.get(t,this.key)}getCurrent(){return this.getFrom(this.main())}getDefault(){return this.getFrom(this.default())}getSticky(){return this.getFrom(this.sticky())}getFactory(){return this.getFrom(this.factory())}setIn(t,e){a.set(t,this.key,e)}setCurrent(t,e){return t!=this.getCurrent()&&(this.setCurrentInner(t,e),w(),!0)}setCurrentInner(t,e){null!=this.setter&&this.setter(t,e)}setStickyFromCurrent(t){this.setSticky(this.getCurrent(),t)}setSticky(t,e){null!=t&&this.getFactory()==t?this.clearSticky(e):(this.setIn(this.sticky(),t),f(e)),w()}clearSticky(t){this.setSticky(void 0,t)}setCurrentAndStickyToFactory(t){this.setCurrent(this.getFactory(),t),this.clearSticky(t)}setCurrentAndStickyTo(t,e){this.setCurrent(t,e),this.setSticky(t,e)}}class s{constructor(t,e){this.css=t,this.children=e}setStickyToCurrent(){S=!0;for(var t=0;t<this.children.length;t++){var e=this.children[t];e.setSticky(e.getCurrent(),!1)}S=!1,f(!0)}setCurrentToDefault(){S=!0,O.push();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.setCurrent(e.getDefault(),!1)}S=!1,f(!0),at.sendSetGlobal(),at.sendSetShadows()}setCurrentAndStickyToFactory(){S=!0,O.push();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.clearSticky(!1),e.setCurrent(e.getDefault(),!1)}S=!1,f(!0),at.sendSetGlobal(),at.sendSetShadows()}}class r extends i{constructor(){super("autoLevels",D.Settings.Colors.AutoLevels,3,null)}getCurrent(){return!0}getSticky(){let t=super.getSticky();return null==t?this.getFactory():t}}let n,l;!function(t){let e,o,s,n,a,l;t.BrushSize=new i("brushSize",D.Settings.BrushSize,1,at.setBrushSize),t.MaxNumMegapixels=new i("maxNumMegapixels",D.Settings.MaxNumMegapixels,2,at.setMaxNumMegapixels),t.BackgroundColor=new i("backgroundColor",D.Settings.BackgroundColor,10,at.setBackgroundColor),function(t){t.AutoLevels=new r,t.OutputColorSpace=new i("outputColorSpace",D.Settings.Colors.ColorSpace,7,at.setOutputColorSpace,[[_.ColorSpaceSrgb,"sRGB"],[_.ColorSpaceAdobeRgb,"Adobe RGB (1998)"],[_.ColorSpaceAppleRgb,"Apple RGB"],[_.ColorSpaceColorMatchRgb,"ColorMatch RGB"]])}(e=t.Colors||(t.Colors={})),function(t){t.JpegQuality=new i("jpegQuality",D.Settings.ExportOptions.JpegQuality,0,at.setJpegQuality),t.OpaqueFileFormat=new i("opaqueFileFormat",D.Settings.ExportOptions.OpaqueFileFormat,7,at.setOpaqueFileFormat,[[_.OpaqueFileFormatJpeg,"JPEG"],[_.OpaqueFileFormatPng,"PNG"]]),t.PngMode=new i("pngMode",D.Settings.ExportOptions.PngMode,7,at.setPngMode,[[_.PngModeNone,"None"],[_.PngModeLossless,"Lossless"],[_.PngModeLossy,"Lossy"]],!0),t.JpegMode=new i("jpegMode",D.Settings.ExportOptions.JpegMode,7,at.setJpegMode,[[_.JpegModeNone,"None"],[_.JpegModeMoz,"Enabled"]],!0)}(o=t.ExportOptions||(t.ExportOptions={})),function(t){t.Mode=new i("cropMode",D.Settings.Crop.Mode,7,at.setCropMode,[[_.CropUnconstrained,"Unconstrained"],[_.CropLockedAspectRatio,"Aspect Ratio"],[_.CropTargetSize,"Target Size"]],!0),t.AspectRatio=new i("cropAspectRatio",D.Settings.Crop.AspectRatio,8,at.setCropAspectRatio),t.TargetSize=new i("cropTargetSize",D.Settings.Crop.TargetSize,9,at.setCropTargetSize),t.AllowEnlarging=new i("cropAllowEnlarging",D.Settings.Crop.AllowEnlarging,3,at.setCropAllowEnlarging),t.FitToResult=new i("cropFitToResult",D.Settings.Crop.FitToResult,3,at.setCropFitToResult),t.PaddingMils=new i("cropPaddingMils",D.Settings.Crop.PaddingMils,6,at.setCropPadding),t.PaddingPixels=new i("cropPaddingPixels",D.Settings.Crop.PaddingPixels,1,at.setCropPaddingPixels),t.MarginUnits=new i("cropMarginUnits",D.Settings.Crop.MarginUnits,7,at.setCropMarginUnits,[[_.CropMarginPixels,"Pixels"],[_.CropMarginPercent,"Percent"]],!0),t.ObjectSize=new i("cropObjectSize",D.Settings.Crop.ObjectSize,7,at.setCropObjectSize,[[_.CropSizeLarge,"Large"],[_.CropSizeMedium,"Medium"],[_.CropSizeSmall,"Small"]],!0),t.VerticalAlignment=new i("cropVerticalAlignment",D.Settings.Crop.VerticalAlignment,7,at.setCropVerticalAlignment,[[_.CropAlignmentTop,"Top"],[_.CropAlignmentMiddle,"Middle"],[_.CropAlignmentBottom,"Bottom"]],!0),t.Shadows=new i("cropShadows",D.Settings.Crop.Shadows,7,at.setCropShadows,[[_.CropShadowsIgnore,"Ignore"],[_.CropShadowsPad,"Pad"],[_.CropShadowsTight,"Tight"]],!0),t.OutputDpi=new i("outputDpi",D.Settings.Crop.Dpi,12,at.setOutputDpi)}(s=t.Crop||(t.Crop={})),function(t){t.BlurLevel=new i("globalBlurLevel",D.Settings.Edge.BlurLevel,1,at.setGlobalBlurLevel),t.SmoothingLevel=new i("globalSmoothingLevel",D.Settings.Edge.SmoothingLevel,0,at.setGlobalSmoothingLevel),t.Offset=new i("globalOffset",D.Settings.Edge.Offset,1,at.setGlobalOffset),t.UseCornerDetection=new i("useCornerDetection",D.Settings.Edge.UseCornerDetection,3,at.setUseCornerDetection),t.BlurMode=new i("blurMode",D.Settings.Edge.BlurMode,7,at.setBlurMode,[[_.BlurModeFixed,"Fixed"],[_.BlurModeAuto,"Auto"],[_.BlurModeLocal,"Local"]],!0),t.UseLocalSmoothing=new i("useLocalSmoothing",D.Settings.Edge.UseLocalSmoothing,4,at.setUseLocalSmoothing)}(n=t.Edge||(t.Edge={})),function(t){let e,o,s,r;!function(t){t.Strength=new i("strength",D.Settings.Shadows.Ellipse.Strength,11,ht.setEllipseShadowStrength,[],!1,1),t.Core=new i("core",D.Settings.Shadows.Ellipse.Core,11,ht.setEllipseShadowCore,[],!1,1)}(e=t.Ellipse||(t.Ellipse={})),function(t){t.Enabled=new i("enabled",D.Settings.Shadows.Drop.Enabled,3,ht.setDropShadowEnabled,[],!1,2),t.CropEnabled=new i("cropEnabled",D.Settings.Shadows.Drop.CropEnabled,3,ht.setDropShadowCropEnabled,[],!1,2),t.Opacity=new i("opacity",D.Settings.Shadows.Drop.Opacity,5,ht.setDropShadowOpacity,[],!1,2),t.BlurRadius=new i("blurRadius",D.Settings.Shadows.Drop.BlurRadius,1,ht.setDropShadowBlurRadius,[],!1,2),t.OffsetX=new i("offsetX",D.Settings.Shadows.Drop.OffsetX,1,ht.setDropShadowOffsetX,[],!1,2),t.OffsetY=new i("offsetY",D.Settings.Shadows.Drop.OffsetY,1,ht.setDropShadowOffsetY,[],!1,2)}(o=t.Drop||(t.Drop={})),function(t){t.Enabled=new i("enabled",D.Settings.Shadows.Mirror.Enabled,3,ht.setMirrorShadowEnabled,[],!1,3),t.Opacity=new i("opacity",D.Settings.Shadows.Mirror.Opacity,5,ht.setMirrorShadowOpacity,[],!1,3),t.Height=new i("height",D.Settings.Shadows.Mirror.Height,1,ht.setMirrorShadowHeight,[],!1,3),t.OffsetY=new i("offsetY",D.Settings.Shadows.Mirror.OffsetY,1,ht.setMirrorShadowOffsetY,[],!1,3)}(s=t.Mirror||(t.Mirror={})),function(t){t.Enabled=new i("enabled",D.Settings.Shadows.Perspective.Enabled,3,ht.setPerspectiveShadowEnabled,[],!1,4),t.Opacity=new i("opacity",D.Settings.Shadows.Perspective.Opacity,5,ht.setPerspectiveShadowOpacity,[],!1,4),t.OpacityScale=new i("opacityScale",D.Settings.Shadows.Perspective.OpacityScale,5,ht.setPerspectiveShadowOpacityScale,[],!1,4),t.BlurRadius=new i("blurRadius",D.Settings.Shadows.Perspective.BlurRadius,1,ht.setPerspectiveShadowBlurRadius,[],!1,4),t.BlurRadiusScale=new i("blurRadiusScale",D.Settings.Shadows.Perspective.BlurRadiusScale,5,ht.setPerspectiveShadowBlurRadiusScale,[],!1,4)}(r=t.Perspective||(t.Perspective={}))}(a=t.Shadows||(t.Shadows={})),function(e){e.set=function(){t.BackgroundColor.setCurrentAndStickyTo("rgba(255,255,255,1.000000)",!1),s.FitToResult.setCurrentAndStickyTo(!0,!1),s.MarginUnits.setCurrentAndStickyTo(_.CropMarginPercent,!1),s.PaddingMils.setCurrentAndStickyTo(50,!1),s.ObjectSize.setCurrentAndStickyTo(_.CropSizeLarge,!1),f(!0),at.sendSetGlobal(),ut.main.animateZoomToFit()},e.revert=function(){t.BackgroundColor.setCurrentAndStickyToFactory(!1),s.FitToResult.setCurrentAndStickyToFactory(!1),at.setCrop_o(at.defaultSettings.cropRect_o,!1),f(!0),at.sendSetGlobal(),ut.main.animateZoomToFit()}}(l=t.Ecommerce||(t.Ecommerce={}))}(n=t.Settings||(t.Settings={})),function(t){let e;t.BrushSize=new s(D.SettingsGroups.BrushSize,[n.BrushSize]),t.MaxNumMegapixels=new s(D.SettingsGroups.MaxNumMegapixels,[n.MaxNumMegapixels]),t.BackgroundColor=new s(D.SettingsGroups.BackgroundColor,[n.BackgroundColor]),t.CropMode=new s(D.SettingsGroups.Crop.Mode,[n.Crop.Mode,n.Crop.AspectRatio,n.Crop.TargetSize,n.Crop.AllowEnlarging]),t.CropFitToResult=new s(D.SettingsGroups.Crop.FitToResult,[n.Crop.FitToResult,n.Crop.PaddingMils,n.Crop.PaddingPixels,n.Crop.MarginUnits,n.Crop.ObjectSize,n.Crop.VerticalAlignment,n.Crop.Shadows]),t.OutputDpi=new s(D.SettingsGroups.Crop.Dpi,[n.Crop.OutputDpi]),t.Colors=new s(D.SettingsGroups.Colors.AutoLevels,[n.Colors.AutoLevels]),t.OutputColorSpace=new s(D.SettingsGroups.Colors.ColorSpace,[n.Colors.OutputColorSpace]),t.JpegQuality=new s(D.SettingsGroups.ExportOptions.JpegQuality,[n.ExportOptions.JpegQuality]),t.OpaqueFileFormat=new s(D.SettingsGroups.ExportOptions.OpaqueFileFormat,[n.ExportOptions.OpaqueFileFormat]),t.PngMode=new s(D.SettingsGroups.ExportOptions.PngMode,[n.ExportOptions.PngMode]),t.JpegMode=new s(D.SettingsGroups.ExportOptions.JpegMode,[n.ExportOptions.JpegMode]),t.Edges=new s(D.SettingsGroups.Edges,[n.Edge.BlurLevel,n.Edge.SmoothingLevel,n.Edge.Offset,n.Edge.UseCornerDetection,n.Edge.BlurMode,n.Edge.UseLocalSmoothing]),function(t){t.Ellipse=new s(D.SettingsGroups.Shadows.Ellipse,[n.Shadows.Ellipse.Strength,n.Shadows.Ellipse.Core]),t.Drop=new s(D.SettingsGroups.Shadows.Drop,[n.Shadows.Drop.Enabled,n.Shadows.Drop.CropEnabled,n.Shadows.Drop.Opacity,n.Shadows.Drop.BlurRadius,n.Shadows.Drop.OffsetX,n.Shadows.Drop.OffsetY]),t.Mirror=new s(D.SettingsGroups.Shadows.Mirror,[n.Shadows.Mirror.Enabled,n.Shadows.Mirror.Opacity,n.Shadows.Mirror.Height,n.Shadows.Mirror.OffsetY]),t.Perspective=new s(D.SettingsGroups.Shadows.Perspective,[n.Shadows.Perspective.Enabled,n.Shadows.Perspective.Opacity,n.Shadows.Perspective.OpacityScale,n.Shadows.Perspective.BlurRadius,n.Shadows.Perspective.BlurRadiusScale])}(e=t.Shadows||(t.Shadows={})),t.List=[t.BrushSize,t.MaxNumMegapixels,t.BackgroundColor,t.CropMode,t.CropFitToResult,t.OutputDpi,t.JpegQuality,t.OpaqueFileFormat,t.PngMode,t.JpegMode,t.Colors,t.OutputColorSpace,t.Edges,e.Ellipse,e.Drop,e.Mirror,e.Perspective];var o=[];t.List.forEach(t=>o=o.concat(t.children)),t.All=new s(D.SettingsGroups.All,o),t.List.push(t.All)}(l=t.Groups||(t.Groups={}));const c=[];for(var u=0;u<l.All.children.length;u++)c.push(l.All.children[u]);function h(){if(!e){D.PreferencesDialog.DefaultSettingsTab.$().on("show.bs.tab",w);for(var t=0;t<l.List.length;t++)g(l.List[t]);for(t=0;t<c.length;t++)m(c[t]);w(),e=!0}}function d(t,e){var o=t.$(),i=o.parent();o.click(()=>{i.hasClass("disabled")||e()})}function g(t){d(t.css.setStickyToCurrent,()=>t.setStickyToCurrent()),d(t.css.setCurrentToDefault,()=>t.setCurrentToDefault()),d(t.css.setCurrentAndStickyToFactory,()=>t.setCurrentAndStickyToFactory()),t.css.button.$().click(()=>{w()}),t.css.button.$().hover(()=>{t.css.outline.$().addClass(D.sticky_outline_active.name())},()=>{t.css.outline.$().removeClass(D.sticky_outline_active.name())}),at.hasUser()||(t.css.setCurrentAndStickyToFactory.$().toggleClass("disabled",!0),t.css.setCurrentToDefault.$().toggleClass("disabled",!0),t.css.setStickyToCurrent.$().toggleClass("disabled",!0))}function m(t){t.css.setStickyToCurrent.$().click(()=>t.setSticky(t.getCurrent(),!0)),t.css.setCurrentToDefault.$().click(()=>t.setCurrent(t.getDefault(),!0)),t.css.setCurrentAndStickyToFactory.$().click(()=>t.setCurrentAndStickyToFactory(!0))}function f(t){at.hasUser()&&at.setStickySettings($.extend({},at.stickySettings),t),t&&w()}t.ensureInitialized=h,t.commitSticky=f;var S=!1;function w(){if(S)return;var t=!1,e=!1;const o=!at.hasUser();for(var i=0;i<c.length;i++){let l=c[i];var s=l.getCurrent(),r=l.getSticky(),n=l.getDefault(),a=l.getFactory(),p=l.display(s),u=l.display(a),h=l.display(r),d=l.display(n);l.currentEqualFactory=p==u,l.currentEqualSticky=p==h,l.stickyEqualFactory=h==u,l.defaultEqualFactory=d==u,l.currentEqualDefault=p==d,l.cachedCurrent!=p&&l.css.displayCurrent.$().html(p),l.cachedSticky!=h&&l.css.displayDefault.$().html(d),l.cachedFactory!=u&&l.css.displayFactory.$().html(u),l.cachedCurrent=p,l.cachedSticky=h,l.cachedFactory=u;var g=l.currentEqualDefault||o,m=l.currentEqualFactory&&l.defaultEqualFactory||o;t=t||!g,e=e||!m,l.css.setStickyToCurrent.$().toggleClass("disabled",g),l.css.setCurrentToDefault.$().toggleClass("disabled",g),l.css.displayCurrent.$().toggleClass("disabled",g),"autoLevels"==l.key?l.css.setCurrentAndStickyToFactory.$().toggleClass("disabled",l.defaultEqualFactory||o):l.css.setCurrentAndStickyToFactory.$().toggleClass("disabled",m),l.css.displayFactory.$().toggleClass("disabled",m)}for(i=0;i<l.List.length;i++){var f=l.List[i];if(f==l.All)f.css.setCurrentAndStickyToFactory.$().parent().toggleClass("disabled",o);else{for(var w=!0,C=!0,y=!0,b=!0,v=!0,A=!0,k=0;k<f.children.length;k++){let t=f.children[k];w=w&&t.currentEqualFactory,C=C&&t.currentEqualSticky,y=y&&t.stickyEqualFactory,b=b&&t.defaultEqualFactory,v=v&&t.currentEqualDefault,A=A&&""==t.cachedSticky}f==l.Colors?f.css.setCurrentAndStickyToFactory.$().parent().toggleClass("disabled",b||o):f.css.setCurrentAndStickyToFactory.$().parent().toggleClass("disabled",w&&b||o),f.css.setCurrentToDefault.$().parent().toggleClass("disabled",v||o),f.css.setStickyToCurrent.$().parent().toggleClass("disabled",v||o)}}}t.updateDisplay=w;var C=!1;t.isVisible=function(){return C},t.show=function(t=D.PreferencesDialog.DefaultSettingsTab){return C=!0,j.initialize(),J.initialize(),h(),w(),P.modal(D.StickySettingsLightbox.css(),!0),null!=t&&t.$().tab("show"),!1},t.hide=function(){return!!C&&(C=!1,D.StickySettingsLightbox.$().modal("hide"),!0)}}(dt||(dt={})),function(t){var e=!1,o=[],i=[],s=new Xt,r=null,n=-1;function a(){return o.length>0||i.length>0?"Uploads still in progress - closing the page will abort them.":void 0}function l(t){var e=$(document.createElement("tr")),o=$(document.createElement("td")),i=$(document.createElement("div"));i.attr({style:"margin-bottom: 0;",class:"progress"}),o.append(i);var s=$(document.createElement("div"));s.attr({style:"width: 0;",class:"progress-bar"}),i.append(s);var r=$(document.createElement("td"));return e.append($(document.createElement("td")).text(t.name)),e.append(o),e.append(r),D.Bulk.Upload.DialogBody.$().append(e),r.attr("class","pending").text(p.s("Pending...")),{file:t,tr:e,progressContainerEl:o,progressEl:s,statusEl:r}}function c(){if(i.length>0&&o.length<3){var t=i.shift();o.push(t),function(t){function e(e){h(t,e,!0)}t.statusEl.attr("class","uploading").text(p.s("Uploading..."));var o=t.file;ct.loadImageShrinkAndThumbnail(!0,o,e=>{h(t,e.message||p.s("Couldn't read the file"),!1)},(o,i,s)=>{U.createUserImageSpec(o,i,e,a=>{i=null,n<0&&(n=a.id+1),a.id<n&&(n=a.id,D.Bulk.Upload.StartClippingButton.$().attr("href",r+"?minId="+n));var l=0,c=0,u=0,h=0;function g(){var e=Math.ceil(.9*u+.1*h);t.progressEl.attr("style","width: "+e+"%;")}function m(){if(0!=l&&0!=c){var o={hasImage:l,hasThumbnail:c,hasDrawCommands:0};U.updateMetaData(a.id,a.secret,o,e,()=>{d(t)})}}k.uploadS3WithRetry(o,a.image,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Uploading original image"),maxAge:31536e3,progress:t=>{u=t,g()},success:()=>{o=null,l=1,m()}}),k.uploadS3WithRetry(s(),a.thumbnail,{url:window.Globals.s3_url,backupUrl:window.Globals.s3_backup_url,label:p.s("Uploading thumbnail"),maxAge:31536e3,progress:t=>{h=t,g()},success:()=>{c=1,m()}})})},!0)}(t),c()}}function u(t){t.progressContainerEl.empty().text(p.s("Already queued, ignored")),t.statusEl.text(p.s("Duplicate")).attr("class","hair b")}function h(t,e,o){if(t.progressContainerEl.empty().text(e),o){let e="<span class='bg b'>"+p.s("Error")+"</span> <small class='i'>(<a href='#'>"+p.s("Retry")+"</a>)</small>";t.statusEl.html(e).click(()=>(t.statusEl.off("click"),t.tr.remove(),i.push(l(t.file)),c(),!1)),g(t)}else t.statusEl.text(p.s("Error")).attr("class","bg b")}function d(t){t.statusEl.text(p.s("Ok")).attr("class","fg b"),D.Bulk.Upload.StartClippingButton.$().attr("class","app_bttn app_bttn_dark app_bttn_large"),g(t)}function g(t){var e=o.indexOf(t);e>=0&&o.splice(e,1),c()}t.handleNewFiles=function(t){e||(e=!0,P.modal(D.Bulk.Upload.Dialog),$(document).off("focusin.bs.modal"),$(window).on("beforeunload",a),r=D.Bulk.Upload.StartClippingButton.$().attr("href"));for(var o=0,n=0;n<t.length;n++){var p=t[n],h=l(p),d=p.name+"_"+p.size;s.add(d)?(i.push(h),o++):u(h)}o>0&&P.gaTrack("bulk","upload",null,o),c()},t.simulateEntry=function(t,e){let o=l(t);o.statusEl.attr("class","uploading").text(p.s("Uploading...")),o.progressEl.attr("style","width: "+e+"%;"),100==e&&d(o)};let m=new Zt([new jt(D.Bulk.Download.Mode.single,_.BulkDownloadModeSingle),new jt(D.Bulk.Download.Mode.zip,_.BulkDownloadModeZip)]);$(document).ready(()=>{let t={};try{t=JSON.parse(window.GlobalsEx.stickySettings)}catch(t){}let e=t.bulkDownloadMode||window.GlobalsEx.defaultBulkDownloadMode||_.BulkDownloadModeSingle;m.update(e),window.bulkDownloadMode=e,R.registerRadioGroup(m,t=>{m.update(t),window.bulkDownloadMode=t,U.modifyStickySettings(JSON.stringify({bulkDownloadMode:t}),t=>{},()=>{})})})}(gt||(gt={})),function(t){let e=null,o=[],i=new Set,s=new Set,r=new Set,n=null,a=null,l=null,c=!0,p=null,u=null,h=new Xt,d=0;class g{constructor(t){this.elemId=t,this.other=null,this.el=document.getElementById(t),this.contentWindow=this.el.contentWindow,this.image={id:-1,secret:"unknown"},this.readyForNextImage=!0,this.wantsStep=!1,this.hasGenerated=!1,this.hasSaved=!1,this.hasGenerateError=!1,this.exitOnSave=!1}checkHandleEvent(t){if(t.source==this.contentWindow){let e=JSON.parse(t.data);switch(e.command){case _.DocumentReady:case _.Booted:m();break;case _.Skip:this.image.id>0&&(s.add(this.image.id),k(!0)),this.wantsStep=!0,this.hasGenerated=!0,this.hasGenerateError=!1,this.hasSaved=e.saved,A(),this.checkStepImageForThisIframe();break;case _.GenerateResult:this.image.id>0&&(r.add(this.image.id),k(!0)),this.wantsStep=!0,this.hasGenerated=!1,this.hasGenerateError=!1,this.hasSaved=e.saved,A();break;case _.MaybeSaved:this.hasSaved=e.saved,this.checkStepImageForThisIframe(),this.hasSaved&&this.exitOnSave&&this.doExit();break;case _.SavedAndResultReady:window.checkPostMessage(e),this.hasGenerated=e.success,this.hasSaved=e.saved,this.hasGenerateError=!e.success,this.checkStepImageForThisIframe();break;case _.SavedMaskUpdated:this.other.contentWindow.M&&this.other.contentWindow.M.savedMaskUpdated();break;case _.StickySettingsUpdated:this.other.contentWindow.M&&this.other.contentWindow.M.bulkSetStickySettings(e.settings);break;case _.Exiting:this.other.contentWindow.M&&this.other.contentWindow.M.checkSaveDrawCommands();break;case _.Exit:e.isNice&&this.other.contentWindow.M&&this.other.contentWindow.M.hasUnsavedChanges()?this.other.exitOnSave=!0:this.doExit()}return(e.error||e.command==_.Error)&&(window.checkPostMessage(e),this.wantsStep=this.hasGenerated=this.hasSaved=!1,this.readyForNextImage=!0,this.checkStepImageForThisIframe()),!0}return!1}doExit(){this.contentWindow.M.unhookBeforeunload(),this.other.contentWindow.M&&this.other.contentWindow.M.unhookBeforeunload(),window.Globals.Bulk.isApi?R():G.exit()}checkStepImageForThisIframe(){this.wantsStep&&this.hasGenerated&&this.hasSaved?(this.wantsStep=this.hasGenerated=this.hasSaved=!1,this.readyForNextImage=!0,v(!1)):this.hasGenerateError&&E()}setImage(t){t&&(this.wantsStep=!1,this.readyForNextImage=!1,this.hasGenerateError=!1,this.image=t,this.contentWindow.location.replace(this.getUrl()),this.updatImagesRemaining())}getId(){return this.image.id}getUrl(){return"/bulk/iframe/"+this.image.id+"/"+this.image.secret+"?api="+!!window.Globals.Bulk.isApi+"&useStickySettings="+!!window.Globals.Bulk.useStickySettings}updatImagesRemaining(t=!1){if(this.contentWindow&&this.contentWindow.M){let t=i.size-r.size-s.size;this.contentWindow.M.setBulkImagesRemaining(i.size,r.size,s.size,t)}}}function m(){c||n.el.contentWindow.focus()}function f(){if(window.Globals.Bulk.isApi)return;let t=0;for(let o=0;o<e.length;o++)e[o].hasImage&&t++;t<=3&&C()}function S(t){D.BulkLoadingErrorMessage.$().text(t),T("error")}function w(t){e.length;let o=0;e=e.concat(t.images).sort((t,e)=>t.id-e.id).filter(t=>{let e=t.id!=o;return o=t.id,e});for(let t of e)i.add(t.id);k(!0),v(!1),T("ready")}function C(){window.Globals.Bulk.isApi||(T("loading"),o.length>0&&(U.listImagesEx(window.Globals.Bulk.State,void 0,void 0,_.ImagesPerClipBatch,o,window.Globals.Bulk.q,S,w),o=[],k()),U.listImagesEx(window.Globals.Bulk.State,d+1,void 0,_.ImagesPerClipBatch,[],window.Globals.Bulk.q,S,w))}function y(t){let e=t.originalEvent;e.origin!=window.Globals.targetOrigin&&"*"!=window.Globals.targetOrigin||n.checkHandleEvent(e)||a.checkHandleEvent(e)}function b(){for(;;){let t=e.shift();if(k(),null==t)return null;if(!h.contains(t.id)){if(t.hasImage)return t.id>d&&(d=t.id),h.add(t.id),t;o.push(t.id),k()}}}function v(t){n.readyForNextImage&&n.setImage(b()),a.readyForNextImage&&a.setImage(b()),t&&f(),E()}function A(){let t=a;a=n,n=t,M($(a.el)),f(),E()}function k(t=!1){n.updatImagesRemaining(t),a.updatImagesRemaining(t)}function M(t){t.css("z-index",0)}function x(t){t.css("z-index",1001)}function T(t){if(c){l.toggleClass("loading","loading"==t),l.toggleClass("error","error"==t);let e="ready"==t&&!a.readyForNextImage;l.toggleClass("generating",e),e?u.attr("disabled","true"):u.removeAttr("disabled")}p=t}$(document).ready(()=>{if(window.Globals.Bulk.isClip){$(window).on("message",y),e=window.Globals.Bulk.ClipImages;for(let t of e)i.add(t.id);setInterval(k,2e3),n=new g("bulk-iframe-0"),a=new g("bulk-iframe-1"),a.other=n,n.other=a,l=D.BulkStatus.$(),u=D.bulk_download_button.$(),d=window.Globals.Bulk.MinId,v(!1);let t="/bulk";window.Globals.Bulk.q&&(t+="?q="+window.Globals.Bulk.q),G.exitHref=t,$("html").addClass("html-app-mode"),D.UnpaidApiSubscription.$().modal()}});let P=!1;function R(){P||(window.checkPostMessage({command:_.Exit}),P=!0)}function E(){let t=window.bulkDownloadMode==_.BulkDownloadModeSingle;if(D.bulk_download_button.$().toggle(!t),n.readyForNextImage&&!a.readyForNextImage&&a.hasGenerateError)A();else if(n.readyForNextImage&&a.readyForNextImage&&R(),n.readyForNextImage)M($(n.el)),c=!0,T(p),x(l),l.focus();else{let t=`/bulk/clip?state=${window.Globals.Bulk.State}&minId=${n.getId()}`;window.Globals.Bulk.q&&(t+="&q="+window.Globals.Bulk.q),history.replaceState({},"",t),x($(n.el)),c=!1,m(),setTimeout(m,100),M(l)}}window.bulkUpdateImages=C}(mt||(mt={})),function(t){function e(t,e,o){if(window.GlobalsEx.Bulk_isAllowed){window.Globals.Bulk.MinId=t;var i=D.Bulk.Download.Dialog.Waiting.$(),s=D.Bulk.Download.Dialog.Empty.$(),r=D.Bulk.Download.Dialog.Progress.$(),n=D.Bulk.Download.Dialog.Ready.$(),a=D.Bulk.Download.Dialog.Error.$(),l=D.Bulk.Download.Dialog.ErrorMsg.$(),c=null,u=D.Bulk.Download.Dialog.DownloadLink.$();ot.attachToLink(u,(function(){return c?"application/zip:"+c:null}));var h=D.Bulk.Download.Dialog.Single.$(),d=D.Bulk.Download.Dialog.SingleDownloadLink.$(),g=!1;r.css("width","0%"),m("waiting"),P.modal(D.Bulk.Download.Dialog.Dialog.css()),U.listImagesEx(e?"generated":"generatedButNotDownloaded",t,e,_.ImagesPerZipfile,[],o,t=>{l.text(t),m("error")},t=>{var e,o=t.images;if(0==o.length)m("empty");else if(1==o.length){P.gaTrack("bulk","download",null,o.length);var i=o[0];d.attr("href",L.downloadUrl(i.id,i.secret)),m("single")}else{function s(t){g||(l.text(t),m("error"))}function n(t){t.error?s(t.error.message):t.progress?r.css("width",t.progress+"%"):t.url?(u.attr("href",t.url),c=t.filename,m("ready"),g=!0,P.gaTrack("bulk","download",null,o.length)):t.redirectUrl?(location.href=L.redirectUrl(t.redirectUrl,t.kind,t.message),g=!0):t.empty&&(m("empty"),g=!0)}e=U.getWorkerUrl("/bulk/websocket",{}),new se({url:function(){return e},connectedToNewServer:P.empty,disconnectedFromServer:function(){return!0},newMessageFromServer:n,sendOnOpen:{email:window.GlobalsEx.email,images:o},heartbeat:{millis:0,message:{command:_.StatusCheck}},label:p.s("Connect to worker"),closeReasonToMessage:function(t){switch(t){case"3":return p.s("Invalid input");case"-1":return p.s("Internal server error");default:return p.s("Timeout or worker termination")}},unableToConnectMessage:p.s("Unable to connect to the worker. Is your firewall or proxy blocking WebSockets?"),unexpectedCloseMessage:p.s("Download server closed connection prematurely."),sendFailedMessage:p.s("Failed to send message to worker. "),customOnError:function(t){return s(t),!1}})}})}else alert(p.s("Please subscribe to a Bulk Clipping plan first, thanks!"));function m(t){i.toggle("waiting"==t),n.toggle("ready"==t),a.toggle("error"==t),s.toggle("empty"==t),h.toggle("single"==t)}}t.simulateProgress=function(){D.Bulk.Download.Dialog.state.$().hide(),D.Bulk.Download.Dialog.Progress.$().css("width","70%"),D.Bulk.Download.Dialog.Waiting.$().show()},t.simulateReady=function(){D.Bulk.Download.Dialog.state.$().hide(),D.Bulk.Download.Dialog.Ready.$().show()},$(document).ready(()=>{D.bulk_download_button.$().click(()=>{e(window.Globals.Bulk.MinId,void 0,window.Globals.Bulk.q)})}),window.bulkDownload=e}(ft||(ft={})),function(t){t.checkInit=function(){0!==D.CmApp.Help.scroll_crop.$().length&&(D.CmApp.Help.scroll_crop.$().each((function(){const t=$(this);t.css("clip",e(t,0))})),$(window).on("resize.ScrollCrop scroll.ScrollCrop",o),o())};function e(t,e){return"rect(0px, "+(t.width()+1)+"px, "+e+"px, 0px)"}function o(){const t=$(document).scrollTop()+.7*$(window).height(),o=D.CmApp.Help.scroll_crop.$(!0);0==o.length?$(window).off(".ScrollCrop"):o.each((function(){var o=$(this);t>o.offset().top&&function(t){t.removeClass(D.CmApp.Help.scroll_crop.name());const o=Date.now(),i=t.data("scroll-crop-companion"),s=i?$(i):null;s&&s.show(),setTimeout((function i(){const r=Date.now(),n=P.clamp((r-o)/350,0,1),a=t.height()*n,l=n<1?e(t,a):"";t.css("clip",l),s&&(n<1?s.css("top",a+"px"):s.hide()),n<1&&setTimeout(i,16)}),16)}(o)}))}}(St||(St={})),function(t){let e;!function(t){t[t.paypal=0]="paypal",t[t.fake=1]="fake"}(e||(e={}));function o(t){let e=[];function o(t,o){e.push(encodeURIComponent(t)+"="+encodeURIComponent(o))}function i(t,e){if($.isArray(e))$.each(e,(function(e,o){i(t+"["+e+"]",o)}));else if("object"==$.type(e))for(let o in e)e.hasOwnProperty(o)&&i(t+"."+o,e[o]);else o(t,e)}o(GlobalsShared.localeQueryParameter,GlobalsShared.locale);for(let e in t)t.hasOwnProperty(e)&&i(e,t[e]);return e.join("&").replace(" ","+")}function i(t){return function(e,o,i){t({error:{message:r(e,o)}})}}function r(t,e){if(0===t.status)return p.s("Failed to connect to the server.")+"\n"+p.s("Please verify your network connection.")+"\n";{const o=t.responseText.toString().substring(0,200);return t.status<200||299<t.status?t.statusText+" ["+t.status+"]\n"+o:"parsererror"===e?p.s("Failed to parse JSON response.")+" ["+e+"]\n"+o:"timeout"===e?p.s("Request time out.")+" ["+e+"]":"abort"===e?p.s("Request aborted by the server.")+" ["+e+"]":p.s("Unknown error.")+"\n"+o}}function n(){return merchantJs.settings.host+"/payments/v0/preapprovals/"+merchantJs.settings.wud+"/"}function a(t,e){let s=n()+"payment_method?"+o(t);$.ajax(s,{dataType:"jsonp",timeout:3e4,success:function(t){e(t)},error:i(e)})}let l,c,u,h;!function(t){let s=null,r=null;function l(){s&&(r&&(clearInterval(r),r=null),s.close(),s=null)}function c(t,r,a){l(),s=window.open("","_blank"),s.document.write("<h3>Loading...</h3>");var c=n()+e[t]+"?"+o(r);$.ajax(c,{dataType:"jsonp",timeout:3e4,success:function(t){a(t)},error:i(a)})}t.handler=function(t){return function(e,o,i){c(t,e,(function(t){var e,n;!t||t.error?(l(),o(t)):(e=t.preapproval.processorToken.url,n=function(){i(),a(t.preapproval,o)},s&&(s.location.href=e,s.focus(),r=setInterval((function(){s.closed&&(clearInterval(r),r=null,n())}),100)))}))}}}(l||(l={})),function(t){t.initialize=function(){return!0},t.pay=function(t){t({error:{message:"Unavailable"}})},t.radioButton=function(){return new s("__unavailable_payment_processor__")},t.name=function(){return"unavailable"}}(c||(c={})),function(t){let e,o,i;t.initialize=function(){return"undefined"!=typeof Stripe&&(e=Stripe(merchantJs.settings.stripePublishableKey),o=e.elements({locale:GlobalsShared.locale}),i=o.create("card",{style:{base:{lineHeight:"1.429"}}}),i.mount(D.merchant.StripeCardElement.css()),i.on("change",(function(t){t&&t.error?D.merchant.StripeCardErrors.$().text(t.error.message):D.merchant.StripeCardErrors.$().text("")})),i.on("focus",(function(){D.merchant.StripeCardElement.$().addClass("focus")})),i.on("blur",(function(){D.merchant.StripeCardElement.$().removeClass("focus")})),!0)},t.pay=function(t){m(),e.createToken(i,{name:D.merchant.StripeNameElement.$().val()}).then((function(e){if(e.error)t({error:{message:e.error.message}});else{w();const o=e.token;a({processor:"stripe",processorToken:{id:o.id,card:o.card},preapprovalSpec:merchantJs.preapprovalSpec},t)}}))},t.radioButton=function(){return D.merchant.RadioStripe},t.name=function(){return"stripe"}}(u||(u={})),function(t){let e;t.initialize=function(){if("undefined"!=typeof braintree){let t=!0;return braintree.dropin.create({authorization:merchantJs.settings.braintreeTokenizationKey,container:D.merchant.BraintreeDropinContainer.css(),locale:GlobalsShared.locale.replace("-","_"),card:{cardholderName:!0},dataCollector:{kount:!0}}).then((function(t){e=t})).catch((function(e){t=!1,m(),D.merchant.PaymentError.$().text(e.message).show()})),t}return!1},t.pay=function(t){m(),e.requestPaymentMethod((function(o,i){if(o)e.clearSelectedPaymentMethod(),t({error:o});else{w();a({processor:"braintree",processorToken:i,preapprovalSpec:merchantJs.preapprovalSpec},(function(o){o.error&&e.clearSelectedPaymentMethod(),t(o)}))}}))},t.radioButton=function(){return D.merchant.RadioBraintree},t.name=function(){return"braintree"}}(h||(h={}));const d=l.handler(e.paypal),g=l.handler(e.fake);function m(){D.merchant.PaymentError.$().hide(),D.merchant.StripePaymentError.$().hide(),D.merchant.PaymentMethodFormSubmit.$().attr("disabled","disabled")}function f(){D.merchant.PaymentMethodFormSubmit.$().removeAttr("disabled")}function S(t){D.merchant.PaymentError.$().html("<p>"+t).show(),f()}function w(){D.merchant.ShowWhenMinibrowsing.$().modal("hide"),D.merchant.ShowWhenCreatingPm.$().modal("show")}function C(t){D.merchant.ShowWhenMinibrowsing.$().modal("hide"),D.merchant.ShowWhenCreatingPm.$().modal("hide"),null===t?S("Got a null response from the server"):t.error?S(t.error.message):(D.merchant.ShowWhenSubmitting.$().modal("show"),b({streamlexPaymentToken:t.paymentMethod.streamlexPaymentToken,defaultPaymentMethod:y}))}let y="stripe",b=null;$((function(){"undefined"!=typeof merchantJs&&(!function(t){b=t;let e=!1,o=!1;merchantJs.settings.braintreePrimary?merchantJs.settings.canBraintree?e=!0:merchantJs.settings.canStripe&&(o=!0):merchantJs.settings.canStripe?o=!0:merchantJs.settings.canBraintree&&(e=!0);const i=e?h:o?u:c,s=i.initialize(),r=s&&(merchantJs.settings.canBraintree||merchantJs.settings.canStripe||merchantJs.settings.canPaypal);y=i.name();const n=$("input[type=radio][name=paymentMethod]");let a=null,l=!1;n.change((function(){var t;D.merchant.CreditCardProcessorForm.$().toggle(i.radioButton().$().prop("checked")),a=$(this),l=merchantJs.needZipCode&&("paypal"==(t=a.data("processor")||a.val())||"fake"==t),D.merchant.TaxSection.$().toggle(l)})),$("#paymentMethod_"+merchantJs.defaultPaymentMethod).prop("checked",!0).change(),D.merchant.AcceptTermsWrapper.$().removeClass(D.merchant.has_error.name()),D.merchant.InitializingIndicator.$().hide(),D.merchant.SubmitSection.$().show(),D.merchant.PaymentMethodForm.$().submit((function(){y=a&&a.val()||i.name();let e=!1;if(l){let t=/^\d{5}$/,o=(""+D.merchant.TaxPostalCode.$().val()).trim();t.test(o)?(D.merchant.TaxPostalCodeFormGroup.removeClass(D.merchant.has_error),D.merchant.TaxLocationPostalCode.$().val(o)):(D.merchant.TaxPostalCodeFormGroup.addClass(D.merchant.has_error),e=!0)}if(D.merchant.AcceptTerms.$().prop("checked")?D.merchant.AcceptTermsWrapper.removeClass(D.merchant.has_error):(D.merchant.AcceptTermsWrapper.addClass(D.merchant.has_error),e=!0),e)return!1;switch(m(),y){case"stripe":u.pay(C);break;case"braintree":h.pay(C);break;case"paypal":D.merchant.ShowWhenMinibrowsing.$().modal("show"),d(merchantJs.preapprovalSpec,C,w);break;case"fake":merchantJs.settings.isTesting&&(D.merchant.ShowWhenMinibrowsing.$().modal("show"),g(merchantJs.preapprovalSpec,C,w));break;default:D.merchant.ShowWhenSubmitting.$().modal("show"),t({streamlexPaymentToken:y,defaultPaymentMethod:y})}return!1})),r?f():(m(),s||D.merchant.FailedToLoadPaymentBackendJs.$().show())}((function(t){D.merchant.StreamlexPaymentToken.$().val(t.streamlexPaymentToken),D.merchant.DefaultPaymentMethod.$().val(t.defaultPaymentMethod),D.merchant.PaymentForm.$().submit()})),$(window).on("load",(function(){(new Image).src="https://www.paypal.com/home"})))}))}(wt||(wt={})),function(t){t.list=function(){var t=[];function e(e,o){e||t.push(o)}function o(t,o){try{e(t(),o)}catch(t){e(!1,o)}}return o((function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}),"HTML5 Canvas"),e("undefined"!=typeof WebSocket,"WebSockets"),o((function(){var t=document.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t}),"HTML5 Drag-and-Drop"),e("undefined"!=typeof URL,"window.URL Support"),e("undefined"!=typeof XMLHttpRequest,"XML Http Requests"),o((function(){return"undefined"!=typeof Uint32Array&&"undefined"!=typeof Uint8Array&&void 0!==new Uint8Array(2).set}),"Native Type Arrays"),o((function(){var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d").getImageData(0,0,1,1).data;return new Int32Array(e.buffer).length>0}),"ImageData.data is not a Uint8ClampedArray"),e(!(!window.history||!window.history.pushState),"HTML5 History"),e("undefined"!=typeof Worker,"Web Workers"),e(!!Date.now,"Date.now()"),o((function(){return!!new Blob}),"Blob and/or Blob Constructor"),e(navigator.userAgent.indexOf("Trident/7.0;")<0&&navigator.userAgent.indexOf("rv:11.0")<0,"IE 11 not supported due to browser bugs"),t.sort(),t}}(Ct||(Ct={})),function(t){const e=D.Signon.Dialog.anscestorOf(new i("modal-header")),o=[];let s=null;function r(t){const e=t.originalEvent,i=function(t){for(let e of o)if(e.contentWindow==t)return e;return null}(e.source);if(i){let t=parseInt(e.data);t>10&&(i.height=t+"px"),i.hasLoaded||(i.hasLoaded=!0,l())}}function n(){a($(this))}function a(t){const e=t.data("url");if(null==s||s.src!=e){s=function(t){for(let e of o)if(e.src==t)return e;return null}(e)||function(t){let e=document.createElement("iframe");return e.setAttribute("seamless","seamless"),e.frameBorder="0",e.width="100%",e.height="650px",e.style.backgroundColor="#fff",e.hasLoaded=!1,e.onload=function(t){e.hasLoaded=!0,l()},e.src=t,o.push(e),D.Signon.IframeContainer.$().prepend(e),e}(e),s.style.display="block";for(let t of o)t!=s&&(t.style.display="none")}l()}function l(){D.Signon.LoadingIndicator.$().toggle(!(s&&s.hasLoaded))}function c(){const t=$(this);a(t),D.$window.on("message.signup",r);const o=t.data("header");return o?(D.Signon.Header.$().text(o).show(),e.$().css("border-bottom","")):(D.Signon.Header.$().hide(),e.$().css("border-bottom","none")),D.Signon.Dialog.$().modal(),!1}t.checkInit=function(){D.Signon.Dialog.$().length>0&&D.Signon.trigger.$().length>0&&(D.Signon.Dialog.$().on("hide.bs.modal",(function(){D.$window.off("message.signup")})),D.Signon.trigger.elements().forEach(t=>{t.addEventListener("touchstart",n,{passive:!0}),t.addEventListener("mouseover",n,{passive:!0})}),D.Signon.trigger.$().click(c),D.Signon.preload.$().each(n))}}(yt||(yt={})),function(t){var e=[];function o(){for(var t=0;t<e.length;t++)e[t].update()}class i{constructor(t){this.iframe=t,this.initialized=!1,this.$iframe=$(t),this.$iframe.on("load",()=>{this.initialize(),setTimeout(()=>{this.initialize()},100)})}initialize(){this.oh=this.iframe.contentDocument.body.offsetHeight,this.ow=this.iframe.contentDocument.body.offsetWidth;let t=100*this.oh/this.ow+"%";this.$iframe.parent().css({paddingBottom:t}),this.initialized=!0,this.update()}update(){if(this.initialized){let t="scale("+(this.$iframe.parent(D.TutorialScreenshots.wrapper.css()).width()/this.ow).toString()+")";this.iframe.contentWindow.document.body.style.transform=t}}}$((function(){D.TutorialScreenshots.iframe.$().each((function(){e.push(new i(this))})),e.length>0&&$(window).resize(o)}))}(bt||(bt={}));class fe{constructor(t){this.$link=t,this.id=0|t.data("id"),this.$container=$("#"+this.cssId())}name(){return this.$link.data("name")}undoName(){return this.$link.data("undoname")}secret(){return this.$link.data("secret")}undeleteSecret(){return this.$link.data("undeletesecret")}cssId(){return"user_image_"+this.id}cssIdLoader(){return this.cssId()+"-loader"}$loader(){return $("#"+this.cssIdLoader())}}!function(t){let e=!1;function o(){e&&(D.UserImage.rename.$().off("click",i),D.UserImage.remove.$().off("click",s),D.UserImage.undelete.$().off("click",r)),D.UserImage.rename.$(e).click(i),D.UserImage.remove.$(e).click(s),D.UserImage.undelete.$(e).click(r),e=!0}function i(){let t=new fe($(this)),e=t.undoName()||prompt(p.s("Rename image to:"),t.name());return e&&n(t,L.userImageRename(t.id,window.Globals.Bulk.isUpload),{name:e}),!1}function s(){let t=new fe($(this));return n(t,L.userImageRemove(t.id,window.Globals.Bulk.isUpload)),!1}function r(){let t=new fe($(this));return n(t,L.userImageUndelete(t.id,t.secret(),t.undeleteSecret(),window.Globals.Bulk.isUpload)),!1}function n(t,e,i={}){let s=t.$container;s.addClass(D.ajax_loading.name());let r=s.position();t.$loader().css({top:r.top,left:r.left,width:s.width(),height:s.height()}),c.ajax({url:e,cache:!1,complete:function(){s.removeClass(D.ajax_loading.name())},success:function(t){s.html(t),o()},error:function(t,e,o){alert(p.s("Terribly sorry, but the request failed. ")+e+", "+o)},data:i,dataType:"html",type:"POST"})}t.init=o}(vt||(vt={})),function(t){let e=null,o=!1;class i{constructor(t,o,i){this.start=t,this.end=o,this.lastPercent=-1,this.progressChunkEl=i,this.progressBarEl=i.querySelector(D.V2.DemoPitch.progress_bar.css()),this.progressBarSpanEl=this.progressBarEl.querySelector("span"),i.addEventListener("click",(function(){null!=e&&(e.currentTime=t)}))}getPercent(t){return t<=this.start?0:t>=this.end?100:Math.round(100*(t-this.start)/(this.end-this.start))}updateTime(t){let e=this.getPercent(t);e!=this.lastPercent&&(this.progressBarSpanEl.style.width=e+"%",this.lastPercent=e),this.setActiveClass(t)}setActiveClass(t){t>=this.start&&t<=this.end?this.progressChunkEl.classList.add(D.V2.DemoPitch.active.name()):this.progressChunkEl.classList.remove(D.V2.DemoPitch.active.name())}}function s(t,e=0){function i(t){let e=0,o=t;if(o.offsetParent)do{e+=o.offsetTop,o=o.offsetParent}while(o);return e}function s(){o||(r-e>pageYOffset+window.innerHeight||r+t.offsetHeight+e<pageYOffset?t.pause():t.play())}let r=i(t);window.addEventListener("resize",(function(){r=i(t),s()})),window.addEventListener("scroll",(function(){s()})),window.onload=function(){s()}}t.pauseAndDisable=function(){o=!0,e&&e.pause();let t=D.video.hero.el();t&&t.pause()},$(document).ready((function(){if(e=D.video.main.el(),null!=e){let t=D.V2.DemoPitch.video_progress_chunks.elements(),o=0,r=[new i(0,17,t.item(o++)),new i(17,31,t.item(o++)),new i(31,78,t.item(o++))];e.addEventListener("timeupdate",(function(t){let e=t.target.currentTime;for(let t of r)t.updateTime(e)})),s(e,200)}let t=D.video.hero.el();null!=t&&(t.addEventListener("ended",(function(t){let e=t.target;e.classList.add(D.V2.DemoPitch.video_no_shadow.name()),setTimeout((function(){e.classList.remove(D.V2.DemoPitch.video_no_shadow.name()),e.play()}),5e3)})),s(t))}))}(At||(At={})),function(t){const e=D.MainUploadTarget;let o=!1;function i(t){let i=t.keyCode;y.isCommandOrCtrl(i)?(e.ctl_key.addClass(e.active_key),o=!0):o&&86==i&&e.v_key.addClass(e.active_key)}function s(t){let i=t.keyCode;y.isCommandOrCtrl(i)&&(o=!1,e.ctl_key.removeClass(e.active_key),e.v_key.removeClass(e.active_key))}let r=void 0;t.afterPaste=function(t){t||(e.paste_buttons.addClass(e.wrong_shake),null!=r&&clearTimeout(r),r=setTimeout(()=>{e.paste_buttons.removeClass(e.wrong_shake)},600))},t.initialize=function(){D.$window.on("keydown.CtrlV",i).on("keyup.CtrlV",s)},t.disable=function(){D.$window.off(".CtrlV")}}(kt||(kt={})),function(t){let e=null;function o(){e=setTimeout(i,5e3),D.TopAnimationImage.$().fadeIn(1e3)}function i(){e=setTimeout(o,7e3),D.TopAnimationImage.$().fadeOut(1e3)}t.checkStart=function(){D.TopAnimationImage.$().length>0&&(e=setTimeout(i,2e3))},t.stop=function(){clearTimeout(e)}}(Mt||(Mt={})),xt||(xt={}),$(document).ready(()=>{const t=window.Globals.Hosted;if(t){let o=t.spec,i=[],s={};function e(t){let e=[];for(let t of o.images)s.hasOwnProperty(t.id)||e.push(t);let r={event:t.event,error:t.error,images:o.images,clipped:i,skipped:e},n=document.createElement("form"),a=document.createElement("input");a.name="clippingMagicJson",a.value=JSON.stringify(r),n.append(a),n.method="POST",n.target="_top",n.action=o.returnUrl,document.body.append(n),n.submit()}let r=ClippingMagic.initialize({apiId:t.apiId});if(r&&r.length>0)e({event:"error",error:{status:400,code:2e3,message:r.join("\n")}});else{let r=1==o.images.length,n=r?o.images[0]:void 0,a=r?void 0:o.images;ClippingMagic.edit({image:n,images:a,locale:o.locale,useStickySettings:t.spec.useStickySettings,hideBottomToolbar:t.spec.hideBottomToolbar},t=>{switch(t.event){case"error":e(t);break;case"result-generated":let o=t.image;i.push(o),s[o.id]=!0,r&&e({event:"editor-exit"});break;case"editor-exit":e({event:"editor-exit"})}}),document.getElementById("clipping-magic-container").style.padding="0"}}});for(let t of __jqdeferred)$(t);__jqdeferred.length=0,function(t){try{window.myLocalStorage=window.localStorage||{}}catch(t){window.myLocalStorage={}}window.M=at,x.M=a.cast(at),x.App=nt,at.appHasAlreadyRun=!1;var e=null;function i(){var t=!window.Globals.Bulk.isUpload||window.GlobalsEx.Bulk_isAllowed;if(null==e){if((e=Ct.list()).length>0){for(var i="<h3>"+p.s("Unsupported Browser")+"</h3><p>"+p.s("Terribly sorry, but your browser appears to be missing key feature(s) required to use this website:")+"</p><ul>",s=0;s<e.length;s++)i+="<li>"+e[s]+"</li>";i+="</ul>",i+="<p>"+p.s("Please try the latest version of one of these browsers instead: <b>{0}, {1}, {2}, {3}</b>.",'<a href="'+_.BrowserChromeUrl+'">Chrome</a>','<a href="'+_.BrowserFirefoxUrl+'">Firefox</a>','<a href="'+_.BrowserSafariUrl+'">Safari</a>','<a href="'+_.BrowserMicrosoftEdgeUrl+'">Microsoft Edge</a>')+"</p>",$("#modernizr-alert").html(i).slideDown(500)}0==e.length&&t||(D.body.$().addClass(D.cannot_run_app.name()),D.app_starter.$().attr("disabled","disabled").addClass("disabled"),D.app_starter.anscestorOf(new o("button")).$().attr("disabled","disabled").addClass("disabled"))}else e.length>0&&($("html, body").scrollTop(0),P.blink("#modernizr-alert"));return 0==e.length&&t&&$("#app").length>0}function s(){At.pauseAndDisable(),kt.disable(),Mt.stop()}function r(t,e,o){s(),at.checkSaveChanges(()=>{let i=Date.now(),s=t.type.toLowerCase().split(";")[0];P.spinner(!0),ct.loadImageShrinkAndThumbnail(!1,t,e=>{P.gaTrack("image","loadFailed","Type: "+s+", Ext: "+P.getExtensionWithDot(t.name).toLowerCase()),P.fatalErrorStr(p.s('Failed to read image file with name: "{0}", and type: "{1}".',t.name,t.type))},(t,r)=>{P.gaTrack("StartupProgress","readImage",void 0,Date.now()-i);let n=Date.now();P.gaTrack("image","uploaded",s),U.createUserImageSpec(t,r,P.fatalError,i=>{P.gaTrack("StartupProgress","reserveId",void 0,Date.now()-n),P.spinner(!1),at.create(t,r,i,e,o)})},!0)})}function n(){return D.$window.off("beforeunload"),void 0!==window.ResumeImage?top.location.href.indexOf("/bulk")>=0?top.location.href="/bulk":top.location.href="/":top.location.reload(),!1}function l(t,e,o,s){if(!i())return;H.track("newImageFromUrl"),P.gaTrack("image","fromUrl",s||t),P.progress(!0);let n=Date.now(),l=null,c=!1,p=null;function u(){l&&p&&(P.gaTrack("StartupProgress","downloadedImageAndDrawCommandsFromUrl",void 0,Date.now()-n),P.progress(!1),r(l,p,c))}o?P.fetchJson(o,t=>{p=t||{},u()}):(c=!0,p={}),st.download({url:t,displayUrl:s,progress:P.progressUpdate,error:P.fatalErrorStr,success:t=>{e&&a.set(t,"name",e),l=t,u()}})}function c(t,e){i()&&(H.track("resumeUserImage"),s(),P.gaTrack("image","resumed"),P.progress(!0),U.readUserImageSpec(t,e,P.fatalError,t=>{let e=Date.now();var o=null,i=null;function s(){o&&i&&(P.gaTrack("StartupProgress","downloadedImageAndDrawCommandsResume",void 0,Date.now()-e),P.progress(!1),at.resume(o,t,i),D.UnpaidApiSubscription.$().modal())}t.hasDrawCommands>0?P.fetchJson(t.drawCommands.url,t=>{i=t||{},s()}):i={},st.download({url:t.image.url,progress:P.progressUpdate,error:P.fatalErrorStr,success:e=>{let i=P.blobToFile(e,t.originalFilename);ct.loadCheckRotateFlattenImage(i,P.fatalError,t=>{o=t,s()})}})}))}function u(t){window!=window.top&&window.parent&&window.parent.postMessage(JSON.stringify(t),window.Globals.targetOrigin)}$(document).ready(()=>{D.MainUploadTarget.jsNotInitializedYet.removeClass(D.MainUploadTarget.jsNotInitializedYet),D.FileInput.UploadFromWeb.show_dialog.$().attr("href","#");const t=i();Mt.checkStart(),at.setStickySettings(window.GlobalsEx.stickySettings,!1),at.initializeMaxNumMegapixels(),D.cancel_upload.$().click(n),D.ImageThumbs.admin_show_original_button.$().click(()=>{$(document.body).toggleClass(D.ImageThumbs.admin_show_original.name())}),navigator.clipboard&&navigator.clipboard.write&&D.resultDialog.Ready.$().addClass(D.resultDialog.copy_api_supported.name()),window.Globals.err?u(window.Globals.err):u({command:_.DocumentReady,canRun:t}),t&&(B.initialize(),b.initialize({monitor_file_input:D.FileInput.Field,monitor_paste:D.FileInput.PasteTarget,monitor_drag:D.body,hover_class:D.drop_ready,error:(t,e,o)=>{e!=b.InputMethod.Pasted&&alert(t)},drop:(t,e)=>{var o;window.Globals.Bulk.isUpload?gt.handleNewFiles(t):window.Globals.Bulk.isIframe||(o=t[0],H.track("pickedFile"),r(o,{},!0))},pastedUrl:function(t){l(L.fetchUrl(t),void 0,void 0,t)},dropOnce:!1,afterPaste:kt.afterPaste}),G.initialize(),void 0!==window.ResumeImage&&c(window.ResumeImage.id,window.ResumeImage.secret),C.initialize(D.FileInput.UploadFromWeb.show_dialog,(function(t){l(L.fetchUrl(t),void 0,void 0,t),window.Globals.Bulk.isUpload})),D.FileInput.click_to_upload.$().click((function(){let t=D.FileInput.Field.el();t.value=null,t.click()})),kt.initialize()),ot.attachDecorated(),yt.checkInit(),vt.init(),pt.deviceHasTouch()||$('[data-toggle="tooltip"]').tooltip(),D.tabLink.$().click((function(t){t.preventDefault(),$("."+$(this).data("tab")).each((function(t,e){$(e).tab("show")}))})),D.returnUrlForm.$().on("submit",(function(t){let e=$(this),o=e.data("form-element"),i=$(o+" input").val();e.prop("action",i)}));let e=new Zt([new jt(D.PricingPanel.period_monthly,_.PricingMonthly),new jt(D.PricingPanel.period_annual,_.PricingAnnual)]);e.update(_.PricingMonthly),R.registerRadioGroup(e,t=>{e.update(t);let o=t==_.PricingAnnual;D.PricingPanel.period_annual_container.$().toggle(o),D.PricingPanel.period_monthly_container.$().toggle(!o)})}),$(window).on("load",(function(){St.checkInit()}));let h=window;h.checkPostMessage=u,h.resumeUserImage=c,h.newImageFromUrl=l,h.M_initializeFarbtastic=at.initializeFarbtastic,h.Tr_s=p.s,h.StickySettings_backgroundSwatch=dt.backgroundSwatch,h.BulkUpload_simulateEntry=gt.simulateEntry,h.BulkDownload_simulateProgress=ft.simulateProgress,h.BulkDownload_simulateReady=ft.simulateReady}(Tt||(Tt={}))}("undefined"==typeof MainExport?MainExport={}:MainExport);